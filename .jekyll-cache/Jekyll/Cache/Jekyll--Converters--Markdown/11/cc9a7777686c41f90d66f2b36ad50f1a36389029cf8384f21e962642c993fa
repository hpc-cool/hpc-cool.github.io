I"¶<p>å’Œå¾ˆå¤šåºåˆ—åŒ–åº“ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ MessagePack åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå’Œ json ç›¸æ¯”è¿™ä¸ªåº“æä¾›äº†äºŒè¿›åˆ¶çš„åºåˆ—åŒ–ï¼Œåºåˆ—åŒ–ä¹‹åçš„å†…å®¹é•¿åº¦æ¯” json å°å¾ˆå¤š</p>

<!--more-->

<!-- CreateTime:2019/8/31 16:55:58 -->

<p>è¿™ä¸ªåº“èƒ½åºåˆ—çš„å†…å®¹ä¸å¤šï¼Œå¤§å¤šæ•°æ—¶å€™å»ºè®®ä½¿ç”¨çš„åºåˆ—çš„ç±»éƒ½æ˜¯åªæœ‰åŸºç¡€çš„ int å’Œ bool å­—ç¬¦ä¸²ç­‰ï¼Œæœ€å¥½ä¸è¦å­˜åœ¨å¤æ‚çš„ç±»</p>

<p>ä½¿ç”¨ MessagePack çš„å¥½å¤„åªæ˜¯åºåˆ—åŒ–å‡ºæ¥çš„å†…å®¹çš„é•¿åº¦å°ï¼Œä½†æ˜¯ä»æ€§èƒ½ç­‰æ–¹é¢ï¼Œå…¶å®å’Œ Json å·®åˆ«ä¸å¤§ï¼Œåœ¨åºåˆ—åŒ–ç®€å•çš„ç±»çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ° MessagePack çš„åºåˆ—åŒ–é€Ÿåº¦ä¼šæ¯”è¾ƒå¿«ã€‚åœ¨åºåˆ—åŒ–æ¯”è¾ƒå¤§çš„ç±»å¦‚æœåºåˆ—åŒ–åˆ°æ–‡ä»¶ï¼Œé‚£ä¹ˆå› ä¸ºæ–‡ä»¶è¯»å†™çš„æ€§èƒ½ï¼Œå¯ä»¥çœ‹åˆ° MessagePack çš„æ€§èƒ½æ˜æ˜¾æ¯” json å¥½ã€‚</p>

<p>åœ¨ä½¿ç”¨ MessagePack ä¹‹å‰éœ€è¦é€šè¿‡ Nuget å®‰è£…</p>

<p>å®‰è£…æ–¹æ³•æ˜¯åœ¨ Nuget è¾“å…¥ MessagePack å®‰è£…</p>

<p>ä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œå°†ä¼šå¯¹è¿™ä¸ªç±»åºåˆ—åŒ–</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">[</span><span class="n">MessagePackObject</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Foo</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">Key</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Lindexi</span> <span class="p">{</span> <span class="k">set</span><span class="p">;</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>ç°åœ¨ä¸»å‡½æ•°åˆ›å»ºè¿™ä¸ªç±»</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">foo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Foo</span> <span class="p">{</span> <span class="n">Lindexi</span> <span class="p">=</span> <span class="s">"æ—å¾·ç†™æ˜¯é€—æ¯”"</span> <span class="p">};</span>

</code></pre></div></div>

<p>é€šè¿‡ MessagePackSerializer.Serialize æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªç±»åºåˆ—åŒ–ä¸º byte æ•°ç»„ï¼Œæˆ–åºåˆ—åŒ–åˆ° stream ä¹Ÿå°±æ˜¯å¯ä»¥ç›´æ¥åºåˆ—åŒ–åˆ°æ–‡ä»¶</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">byteList</span> <span class="p">=</span> <span class="n">MessagePackSerializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span>

</code></pre></div></div>

<p>å¦‚æœæƒ³è¦çœ‹ byteList çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢æ–¹æ³•å°† byte æ•°ç»„è½¬å­—ç¬¦ä¸²</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="nf">ByteListToString</span><span class="p">(</span><span class="n">byteList</span><span class="p">));</span>

        <span class="k">private</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">ByteListToString</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">byteList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="kt">string</span><span class="p">.</span><span class="nf">Concat</span><span class="p">(</span><span class="n">byteList</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">temp</span> <span class="p">=&gt;</span> <span class="n">temp</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"x2"</span><span class="p">)));</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ä½¿ç”¨ä¸‹é¢ä»£ç å¯ä»¥ååºåˆ—åŒ–</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">foo</span> <span class="p">=</span> <span class="n">MessagePackSerializer</span><span class="p">.</span><span class="n">Deserialize</span><span class="p">&lt;</span><span class="n">Foo</span><span class="p">&gt;(</span><span class="n">byteList</span><span class="p">);</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">Lindexi</span><span class="p">);</span>
</code></pre></div></div>

<p>æˆ‘å°è¯•è¿è¡Œä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">91</span><span class="n">b2e69e97e5beb7e78699e698afe98097e6af94</span>
<span class="err">æ—å¾·ç†™æ˜¯é€—æ¯”</span>
</code></pre></div></div>

<p>å‰é¢æ˜¯å°† Foo åºåˆ—åŒ–çš„äºŒè¿›åˆ¶</p>

<p>å¦‚æœåœ¨ä½¿ç”¨çš„æ—¶å€™å‘ç°ä¸‹é¢ä»£ç ï¼Œé‚£ä¹ˆå¾ˆå¤šæ—¶å€™éƒ½æ˜¯å› ä¸ºæ²¡æœ‰åœ¨ç±»ä¸Šé¢æ·»åŠ ç‰¹æ€§ï¼Œéœ€è¦ä¿®æ”¹ç±»ä¸ºå…¬å¼€çš„ï¼Œç„¶ååœ¨ç±»ä¸Šé¢æ·»åŠ  <code class="language-plaintext highlighter-rouge">MessagePackObject</code> ç‰¹æ€§ï¼Œç„¶ååœ¨æ¯ä¸ªå…¬å¼€å±æ€§ä¸Šé¢æ·»åŠ  <code class="language-plaintext highlighter-rouge">Key</code> ç‰¹æ€§ï¼ŒåŒæ—¶è¾“å…¥è¿™ä¸ªå±æ€§æ˜¯åœ¨å“ªä¸ªé¡ºåº</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MessagePack</span><span class="p">.</span><span class="n">FormatterNotRegisteredException</span><span class="p">:</span><span class="err">â€œ</span><span class="n">KouhoofamerNeejirstistedrea</span><span class="p">.</span><span class="n">Foo</span> <span class="k">is</span> <span class="n">not</span> <span class="n">registered</span> <span class="k">in</span> <span class="k">this</span> <span class="n">resolver</span><span class="p">.</span> <span class="n">resolver</span><span class="p">:</span><span class="n">StandardResolver</span><span class="err">â€</span>
</code></pre></div></div>

<p>githubï¼š<a href="https://github.com/msgpack/msgpack-cli">msgpack/msgpack-cli</a></p>

:ET