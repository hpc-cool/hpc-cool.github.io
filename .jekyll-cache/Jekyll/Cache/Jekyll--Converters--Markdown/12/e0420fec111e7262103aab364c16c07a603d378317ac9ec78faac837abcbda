I"€f<p>æˆ‘æŠŠä»“åº“ä¸Šä¼ åˆ° gogs å‡ºç°é”™è¯¯ï¼Œæç¤ºå¦‚ä¸‹ <code class="language-plaintext highlighter-rouge">remote: hooks/update: line 2: E:/gogs/gogs.exe: No such file or directory</code>
gogs ä»“åº“æ— æ³•ä¸Šä¼ ï¼Œä¸€ä¸ªåŸå› æ˜¯ç§»åŠ¨äº†gogsï¼Œå¦‚æœæŠŠgogsæ”¾åœ¨ç§»åŠ¨Uç›˜ï¼Œæ’å…¥æ—¶ï¼Œä¸Šä¼ ç»å¸¸å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚</p>

<!--more-->

<!-- CreateTime:2018/8/10 19:16:52 -->

<div id="toc"></div>

<p>åœ¨ push çš„æç¤ºï¼š</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">master</span>
<span class="n">Counting</span> <span class="n">objects</span><span class="p">:</span> <span class="m">32</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Delta</span> <span class="n">compression</span> <span class="k">using</span> <span class="nn">up</span> <span class="n">to</span> <span class="m">4</span> <span class="n">threads</span><span class="p">.</span>
<span class="n">Compressing</span> <span class="n">objects</span><span class="p">:</span> <span class="m">100</span><span class="p">%</span> <span class="p">(</span><span class="m">24</span><span class="p">/</span><span class="m">24</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Writing</span> <span class="n">objects</span><span class="p">:</span> <span class="m">100</span><span class="p">%</span> <span class="p">(</span><span class="m">32</span><span class="p">/</span><span class="m">32</span><span class="p">),</span> <span class="m">2.00</span> <span class="n">MiB</span> <span class="p">|</span> <span class="m">0</span> <span class="n">bytes</span><span class="p">/</span><span class="n">s</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Total</span> <span class="m">32</span> <span class="p">(</span><span class="n">delta</span> <span class="m">19</span><span class="p">),</span> <span class="n">reused</span> <span class="m">13</span> <span class="p">(</span><span class="n">delta</span> <span class="m">7</span><span class="p">)</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">hooks</span><span class="p">/</span><span class="n">update</span><span class="p">:</span> <span class="n">line</span> <span class="m">2</span><span class="p">:</span> <span class="n">E</span><span class="p">:/</span><span class="n">gogs</span><span class="p">/</span><span class="n">gogs</span><span class="p">.</span><span class="n">exe</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">hook</span> <span class="n">declined</span> <span class="n">to</span> <span class="n">update</span> <span class="n">refs</span><span class="p">/</span><span class="n">heads</span><span class="p">/</span><span class="n">master</span>
<span class="n">To</span> <span class="n">http</span><span class="p">:</span><span class="c1">//127.0.0.1:3000/lindexi/gogs.git</span>
 <span class="p">!</span> <span class="p">[</span><span class="n">remote</span> <span class="n">rejected</span><span class="p">]</span> <span class="n">master</span> <span class="p">-&gt;</span> <span class="nf">master</span> <span class="p">(</span><span class="n">hook</span> <span class="n">declined</span><span class="p">)</span>
<span class="n">error</span><span class="p">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">push</span> <span class="n">some</span> <span class="n">refs</span> <span class="n">to</span> <span class="err">'</span><span class="n">http</span><span class="p">:</span><span class="c1">//127.0.0.1:3000/lindexi/gogs.git'</span>
</code></pre></div></div>

<p>é‚£ä¹ˆå¦‚ä½•è§£å†³ã€‚</p>

<p>å¯ä»¥çœ‹åˆ°æ˜¯ hook ç‚¸äº†ï¼Œå…¶ä¸­ <code class="language-plaintext highlighter-rouge">update</code> æ–‡ä»¶å‡ºç°æ‰¾ä¸åˆ°è·¯å¾„ã€‚</p>

<p>åŸå› æ˜¯æˆ‘æŠŠ gogs ä»Eç›˜ç§»åŠ¨åˆ°Dç›˜ï¼Œäºæ˜¯ æäº¤ gogs ä»“åº“å‡ºç° <code class="language-plaintext highlighter-rouge">remote: hooks/update: line 2: E:/gogs/gogs.exe: No such file or directory</code> ã€‚</p>

<p>è§£å†³æ–¹æ³•ï¼š</p>

<p>æ‰“å¼€ gogs ä»“åº“ gogs ï¼Œæ³¨æ„æˆ‘çš„gogsä»“åº“ä¹‹å‰æ‰€åœ¨æ˜¯ <code class="language-plaintext highlighter-rouge">E:\gogs\lindexi\gogs.git\</code> æ‰€ä»¥æˆ‘ç§»åŠ¨äº†è·¯å¾„ä½†æ˜¯é‡Œé¢çš„è·¯å¾„ä¸ä¼šå˜ï¼Œæ‰“å¼€ <code class="language-plaintext highlighter-rouge">update</code> æ–‡ä»¶ã€‚</p>

<p>å¯ä»¥çœ‹åˆ°ï¼š</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="err">#</span><span class="p">!/</span><span class="n">usr</span><span class="p">/</span><span class="n">bin</span><span class="p">/</span><span class="n">env</span> <span class="n">bash</span>
  <span class="s">"E:/gogs/gogs.exe"</span> <span class="n">update</span> <span class="err">$</span><span class="m">1</span> <span class="err">$</span><span class="m">2</span> <span class="err">$</span><span class="m">3</span> <span class="p">--</span><span class="n">config</span><span class="p">=</span><span class="err">'</span><span class="n">E</span><span class="p">:/</span><span class="n">gogs</span><span class="p">/</span><span class="n">custom</span><span class="p">/</span><span class="n">conf</span><span class="p">/</span><span class="n">app</span><span class="p">.</span><span class="n">ini</span><span class="err">'</span>
</code></pre></div></div>

<p>äºæ˜¯æˆ‘ä¿®æ”¹ Eç›˜çš„è·¯å¾„åˆ°æˆ‘ç°åœ¨ä½¿ç”¨çš„è·¯å¾„ï¼Œå°±å¥½äº†ã€‚</p>

<p>è¿™é—®é¢˜æ˜¯ update é’©å­æŒ‡å‘é”™è¯¯çš„è·¯å¾„ã€‚</p>

<p>ç®€å•çš„æ–¹æ³•æ˜¯ï¼š</p>

<p>è¿›å…¥æ§åˆ¶æ¿ï¼Œé‡æ–°ç”Ÿæˆæ‰€æœ‰ä»“åº“çš„ Update é’©å­ã€‚è¿™æ ·å°±å¥½äº†ã€‚</p>

<p><img src="http://image.acmx.xyz/4b3afb91-e4b6-4548-a7e0-ab239e814a372017211153253.jpg" alt="" /></p>

<p>é‚£ä¹ˆå¯¹äºå¤‡ä»½äº† gogs è¦æ¢å¤ï¼Œéœ€è¦å¦‚ä½•åšï¼Ÿ</p>

<ol>
  <li>ä¿®æ”¹ custom/conf/app.ini</li>
</ol>

<p>æŠŠ repository è·¯å¾„ä¿®æ”¹ç°åœ¨çš„è·¯å¾„ï¼ŒåŒæ ·ä¿®æ”¹æ—¥å¿—</p>

<ol>
  <li>æ‰“å¼€ gogs ï¼Œè¿›å…¥ç®¡ç†é¡µé¢</li>
</ol>

<p>é‡æ–°ç”Ÿæˆæ‰€æœ‰ä»“åº“çš„ Update é’©å­</p>

<p>å¦‚æœå¯¹äº gogs ä»“åº“åœ¨ä¸Šä¼ æ—¶å‡ºç°çš„é—®é¢˜ï¼Œå¯ä»¥å»çœ‹<a href="https://gogs.io/docs/intro/troubleshooting">gogsæ•…éšœ</a>ï¼Œä¹Ÿå¯ä»¥è”ç³»æˆ‘ï¼šlindexi_gd@163.com</p>

<p>ä¸€èˆ¬æœ‰æ—¶é—´æˆ‘ä¼šå»çœ‹çœ‹ã€‚</p>

<p>å¦‚æœå¯¹äºæ–‡ç« æœ‰ç–‘é—®ï¼Œæ¬¢è¿äº¤æµã€‚</p>

<p>æˆ‘å†™äº†å°ç¨‹åºï¼Œå¯ä»¥å¯åŠ¨ gogs åˆ¤æ–­ä»–æ˜¯ä¸æ˜¯ç§»åŠ¨è·¯å¾„ï¼Œå¦‚æœç§»åŠ¨ï¼Œå°±è‡ªåŠ¨ä¿®æ”¹ï¼Œç¨‹åºå¾ˆç®€å•ã€‚</p>

<p>å¯ä»¥åˆ° <a href="http://download.csdn.net/detail/lindexi_gd/9766835">http://download.csdn.net/detail/lindexi_gd/9766835</a> ä¸‹è½½ã€‚</p>

<p>å¯ä»¥æŠŠ gogs æ”¾åˆ°ä»»ä½•åœ°æ–¹ï¼Œå¯åŠ¨è¿è¡Œ å¯åŠ¨.exe è¿è¡Œå¯ä»¥å…³é—­ï¼Œgogsç»§ç»­è¿è¡Œã€‚</p>

<p>ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
 <span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
 <span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
 <span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
 <span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
 <span class="k">using</span> <span class="nn">System.Xml</span><span class="p">;</span>
 <span class="k">using</span> <span class="nn">IniParser</span><span class="p">;</span>
 <span class="k">using</span> <span class="nn">IniParser.Model</span><span class="p">;</span>

 <span class="k">namespace</span> <span class="nn">gogs.gocer</span>
 <span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// è‡ªåŠ¨è¿ç§»gogs</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="args"&gt;&lt;/param&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">march</span> <span class="p">=</span> <span class="nf">ReadCustomAppini</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">march</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">Restore</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="kt">string</span> <span class="n">str</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span> <span class="p">+</span> <span class="s">"gogs.exe web"</span><span class="p">;</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span> <span class="n">p</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="nf">Process</span><span class="p">();</span>
            <span class="n">p</span><span class="p">.</span><span class="n">StartInfo</span><span class="p">.</span><span class="n">FileName</span> <span class="p">=</span> <span class="s">"cmd.exe"</span><span class="p">;</span>
            <span class="n">p</span><span class="p">.</span><span class="n">StartInfo</span><span class="p">.</span><span class="n">UseShellExecute</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>    <span class="c1">//æ˜¯å¦ä½¿ç”¨æ“ä½œç³»ç»Ÿshellå¯åŠ¨</span>
            <span class="n">p</span><span class="p">.</span><span class="n">StartInfo</span><span class="p">.</span><span class="n">RedirectStandardInput</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span><span class="c1">//æ¥å—æ¥è‡ªè°ƒç”¨ç¨‹åºçš„è¾“å…¥ä¿¡æ¯</span>
            <span class="n">p</span><span class="p">.</span><span class="n">StartInfo</span><span class="p">.</span><span class="n">RedirectStandardOutput</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span><span class="c1">//ç”±è°ƒç”¨ç¨‹åºè·å–è¾“å‡ºä¿¡æ¯</span>
            <span class="n">p</span><span class="p">.</span><span class="n">StartInfo</span><span class="p">.</span><span class="n">RedirectStandardError</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span><span class="c1">//é‡å®šå‘æ ‡å‡†é”™è¯¯è¾“å‡º</span>
            <span class="n">p</span><span class="p">.</span><span class="n">StartInfo</span><span class="p">.</span><span class="n">CreateNoWindow</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span><span class="c1">//ä¸æ˜¾ç¤ºç¨‹åºçª—å£</span>
            <span class="n">p</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span><span class="c1">//å¯åŠ¨ç¨‹åº</span>

            <span class="c1">//å‘cmdçª—å£å‘é€è¾“å…¥ä¿¡æ¯</span>
            <span class="n">p</span><span class="p">.</span><span class="n">StandardInput</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">str</span> <span class="p">+</span> <span class="s">"&amp;exit"</span><span class="p">);</span>

            <span class="n">p</span><span class="p">.</span><span class="n">StandardInput</span><span class="p">.</span><span class="n">AutoFlush</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="c1">//p.StandardInput.WriteLine("exit");</span>
            <span class="c1">//å‘æ ‡å‡†è¾“å…¥å†™å…¥è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™é‡Œä½¿ç”¨&amp;æ˜¯æ‰¹å¤„ç†å‘½ä»¤çš„ç¬¦å·ï¼Œè¡¨ç¤ºå‰é¢ä¸€ä¸ªå‘½ä»¤ä¸ç®¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸéƒ½æ‰§è¡Œåé¢(exit)å‘½ä»¤ï¼Œå¦‚æœä¸æ‰§è¡Œexitå‘½ä»¤ï¼Œåé¢è°ƒç”¨ReadToEnd()æ–¹æ³•ä¼šå‡æ­»</span>
            <span class="c1">//åŒç±»çš„ç¬¦å·è¿˜æœ‰&amp;&amp;å’Œ||å‰è€…è¡¨ç¤ºå¿…é¡»å‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸæ‰ä¼šæ‰§è¡Œåé¢çš„å‘½ä»¤ï¼Œåè€…è¡¨ç¤ºå¿…é¡»å‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥æ‰ä¼šæ‰§è¡Œåé¢çš„å‘½ä»¤</span>

            <span class="n">p</span><span class="p">.</span><span class="n">OutputDataReceived</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Data</span> <span class="p">+</span> <span class="s">"\r\n"</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="n">p</span><span class="p">.</span><span class="n">ErrorDataReceived</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Data</span> <span class="p">+</span> <span class="s">"\r\n"</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="c1">//è·å–cmdçª—å£çš„è¾“å‡ºä¿¡æ¯</span>

            <span class="k">while</span> <span class="p">(!</span><span class="n">p</span><span class="p">.</span><span class="n">HasExited</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">StandardOutput</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">());</span>
            <span class="p">}</span>
         
            <span class="kt">string</span> <span class="n">output</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">StandardOutput</span><span class="p">.</span><span class="nf">ReadToEnd</span><span class="p">();</span>
            <span class="n">p</span><span class="p">.</span><span class="nf">WaitForExit</span><span class="p">();</span><span class="c1">//ç­‰å¾…ç¨‹åºæ‰§è¡Œå®Œé€€å‡ºè¿›ç¨‹</span>
            <span class="n">p</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Restore</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">file</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span> <span class="p">+</span> <span class="s">"custom\\conf\\app.ini"</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">ini</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileIniDataParser</span><span class="p">();</span>
            <span class="n">IniData</span> <span class="n">customAppini</span> <span class="p">=</span> <span class="n">ini</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>

            <span class="kt">string</span> <span class="n">gogs</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span><span class="p">;</span>
            <span class="n">customAppini</span><span class="p">[</span><span class="s">"repository"</span><span class="p">][</span><span class="s">"ROOT"</span><span class="p">]</span> <span class="p">=</span> <span class="n">gogs</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"\\"</span><span class="p">,</span> <span class="s">"/"</span><span class="p">);</span>

            <span class="n">gogs</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span> <span class="p">+</span> <span class="s">"log"</span><span class="p">;</span>
            <span class="n">customAppini</span><span class="p">[</span><span class="s">"log"</span><span class="p">][</span><span class="s">"ROOT_PATH"</span><span class="p">]</span> <span class="p">=</span> <span class="n">gogs</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"\\"</span><span class="p">,</span> <span class="s">"/"</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="n">StreamWriter</span> <span class="n">stream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamWriter</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">ini</span><span class="p">.</span><span class="nf">WriteData</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">customAppini</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nf">RestoreUpdate</span><span class="p">();</span>

        <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">RestoreUpdate</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">folder</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DirectoryInfo</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">gogs</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span> <span class="p">+</span> <span class="s">"gogs.exe"</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">gc</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span> <span class="p">+</span> <span class="s">"custom\\conf\\app.ini"</span><span class="p">;</span>
            <span class="n">gogs</span> <span class="p">=</span> <span class="n">gogs</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"\\"</span><span class="p">,</span> <span class="s">"/"</span><span class="p">);</span>
            <span class="n">gc</span> <span class="p">=</span> <span class="n">gc</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"\\"</span><span class="p">,</span> <span class="s">"/"</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">folder</span><span class="p">.</span><span class="nf">EnumerateDirectories</span><span class="p">(</span><span class="s">"*git"</span><span class="p">,</span> <span class="n">SearchOption</span><span class="p">.</span><span class="n">AllDirectories</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">try</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">file</span> <span class="p">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">FullName</span> <span class="p">+</span> <span class="s">"\\hooks"</span> <span class="p">+</span> <span class="s">"\\update"</span><span class="p">;</span>

                    <span class="kt">string</span> <span class="n">str</span> <span class="p">=</span> <span class="s">$"#!/usr/bin/env bash\n\"</span><span class="p">{</span><span class="n">gogs</span><span class="p">}</span><span class="s">\" update $1 $2 $3 --config='</span><span class="p">{</span><span class="n">gc</span><span class="p">}</span><span class="s">'"</span><span class="p">;</span>

                    <span class="k">using</span> <span class="p">(</span><span class="n">StreamWriter</span> <span class="n">stream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamWriter</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="n">stream</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
                <span class="p">{</span>
                    
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">ReadCustomAppini</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//å½“å‰è·¯å¾„</span>

            <span class="kt">string</span> <span class="n">file</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span><span class="p">;</span>

            <span class="c1">//è·å–è·¯å¾„</span>

            <span class="k">if</span> <span class="p">(!</span><span class="n">file</span><span class="p">.</span><span class="nf">EndsWith</span><span class="p">(</span><span class="s">"\\"</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">file</span> <span class="p">+=</span> <span class="s">"\\"</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">file</span> <span class="p">+=</span> <span class="s">"custom\\conf\\app.ini"</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="kt">var</span> <span class="n">ini</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileIniDataParser</span><span class="p">();</span>
            <span class="n">IniData</span> <span class="n">customAppini</span> <span class="p">=</span> <span class="n">ini</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">gogs</span> <span class="p">=</span> <span class="n">customAppini</span><span class="p">[</span><span class="s">"repository"</span><span class="p">][</span><span class="s">"ROOT"</span><span class="p">];</span>
            <span class="n">gogs</span> <span class="p">=</span> <span class="n">gogs</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="s">"\\"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">gogs</span><span class="p">.</span><span class="nf">EndsWith</span><span class="p">(</span><span class="s">"\\"</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">gogs</span> <span class="p">+=</span> <span class="s">"\\"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">gogs</span> <span class="p">!=</span> <span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
 <span class="p">}</span>

</code></pre></div></div>

:ET