I"ä"<p>åœ¨ UWP ä½¿ç”¨çš„ Binding æˆ– StaticResource è¿™äº›éƒ½æ˜¯æ ‡è®°æ‰©å±•ï¼Œåœ¨ Windows 10 Fall Creators Update ç‰ˆæœ¬å·æ˜¯ 10.0.16299.0 å’Œä»¥ä¸Šæ”¯æŒåœ¨ UWP è‡ªå®šä¹‰æ ‡è®°æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥åœ¨ xaml ä½¿ç”¨çš„æ ‡è®°çš„æ–¹æ³•</p>

<!--more-->

<!-- CreateTime:2019/4/10 9:46:13 -->

<!-- csdn -->

<p>å®šä¹‰ä¸€ä¸ªæ ‡è®°æ‰©å±•éœ€è¦æ»¡è¶³ä¸‹é¢æ¡ä»¶</p>

<ul>
  <li>ç»§æ‰¿ <a href="https://docs.microsoft.com/en-us/uwp/api/windows.ui.xaml.markup.markupextension?wt.mc_id=MVP">MarkupExtension</a> ç±»</li>
  <li>é‡å†™ ProvideValue è¿”å›å€¼</li>
  <li>åœ¨ç±»ä¸Šé¢æ·»åŠ <a href="https://docs.microsoft.com/en-us/uwp/api/windows.ui.xaml.markup.markupextensionreturntypeattribute?wt.mc_id=MVP">MarkupExtensionReturnTypeAttribute</a> æŒ‡å®šè¿”å›çš„ç±»</li>
  <li>å‘½ååç¼€æ˜¯ Extension å­—ç¬¦ä¸²</li>
  <li>æœ‰æ²¡æœ‰å‚æ•°çš„æ„é€ å‡½æ•°</li>
</ul>

<p>ä¸‹é¢æˆ‘ç®€å•å†™ä¸€ä¸ªå¤šè¯­è¨€æ”¯æŒçš„æ ‡è®°æ‰©å±•ï¼Œåœ¨ç•Œé¢ä½¿ç”¨å¤šè¯­è¨€çš„æ—¶å€™æˆ‘æœŸæœ›ä½¿ç”¨è¿™ä¸ªæ–¹å¼å†™å¤šè¯­è¨€</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">&lt;</span><span class="n">TextBlock</span> <span class="n">Text</span><span class="p">=</span><span class="s">"{local:Lang Key=lindexi}"</span> <span class="p">/&gt;</span>

</code></pre></div></div>

<p>äºæ˜¯æˆ‘éœ€è¦åˆ›å»ºå¤šè¯­è¨€çš„ç±»</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">LangExtension</span> <span class="p">:</span> <span class="n">MarkupExtension</span>

</code></pre></div></div>

<p>å¤šè¯­è¨€è¿”å›çš„æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ ‡è®° <a href="https://docs.microsoft.com/en-us/uwp/api/windows.ui.xaml.markup.markupextensionreturntypeattribute?wt.mc_id=MVP">MarkupExtensionReturnTypeAttribute</a> åŒæ—¶è®¾ç½®è¿”å›çš„ç±»</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">[</span><span class="nf">MarkupExtensionReturnType</span><span class="p">(</span><span class="n">ReturnType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">))]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">LangExtension</span> <span class="p">:</span> <span class="n">MarkupExtension</span>
</code></pre></div></div>

<p>æ·»åŠ ä¸€ä¸ªé™æ€å­—å…¸ï¼Œç”¨äºå­˜æ”¾å¤šè¯­è¨€å­—ç¬¦ä¸²</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">static</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">LangList</span> <span class="p">{</span> <span class="k">set</span><span class="p">;</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>

</code></pre></div></div>

<p>æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œç”¨äºç»‘å®šçš„æ—¶å€™è¾“å…¥ï¼Œä»ä¸Šé¢ä»£ç å¯ä»¥çŸ¥é“æˆ‘éœ€è¦ä¸€ä¸ªåä¸º key çš„å­—ç¬¦ä¸²å±æ€§</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="kt">string</span> <span class="n">Key</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

</code></pre></div></div>

<p>é‡å†™ ProvideValue æ–¹æ³•ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥çš„ Key è¿”å›å¯¹åº”çš„å¤šè¯­è¨€</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">protected</span> <span class="k">override</span> <span class="kt">object</span> <span class="nf">ProvideValue</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">LangList</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">Key</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="k">value</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">Key</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æ•´ä¸ª LangExtension ä»£ç è¯·çœ‹</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">[</span><span class="nf">MarkupExtensionReturnType</span><span class="p">(</span><span class="n">ReturnType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">))]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">LangExtension</span> <span class="p">:</span> <span class="n">MarkupExtension</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Key</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="kt">object</span> <span class="nf">ProvideValue</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">LangList</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">Key</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="k">value</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">Key</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">LangList</span> <span class="p">{</span> <span class="k">set</span><span class="p">;</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>æ­¤æ—¶å°±å¯ä»¥åœ¨ xaml ä½¿ç”¨å®šä¹‰çš„æ ‡è®°æ‰©å±•äº†</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">&lt;</span><span class="n">TextBlock</span> <span class="n">Text</span><span class="p">=</span><span class="s">"{local:LangExtension Key=lindexi}"</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="n">TextBlock</span> <span class="n">Text</span><span class="p">=</span><span class="s">"{local:Lang Key=lindexi}"</span> <span class="p">/&gt;</span>
</code></pre></div></div>

<p>åœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥å¿½ç•¥ Extension å­—ç¬¦ä¸²</p>

<p>åœ¨ <a href="https://github.com/windows-toolkit/WindowsCommunityToolkit">WindowsCommunityToolkit</a> ä¹Ÿæœ‰ä¸¤ä¸ªå®šä¹‰ï¼Œè¯·çœ‹ <a href="https://github.com/windows-toolkit/WindowsCommunityToolkit/blob/39858daf1e1b868ae8ac2b0d6f25955b35ff1d81/Microsoft.Toolkit.Uwp.UI/Extensions/Markup/OnDevice.cs">OnDevice.cs</a> å’Œ <a href="https://github.com/windows-toolkit/WindowsCommunityToolkit/blob/3b5a1f480d65c649a1732a8b8a11866ed3c08836/Microsoft.Toolkit.Uwp.UI/Extensions/Markup/NullableBool.cs">NullableBool.cs</a> å¦‚æœæœ‰ä»»ä½•æƒ³æ³•æ¬¢è¿åœ¨ <a href="https://github.com/windows-toolkit/WindowsCommunityToolkit">WindowsCommunityToolkit</a> è®¨è®º</p>

<p>æœ¬æ–‡ä½¿ç”¨çš„æºä»£ç æ”¾åœ¨ <a href="https://github.com/lindexi/lindexi_gd/tree/b22ec35cadc8d11c06769e7dcd7aad23750d6cd5/LocerjanayJarberlewerfair">github</a> æ¬¢è¿è¯„è®º</p>

<p><a href="https://www.pedrolamas.com/2019/03/31/making-the-case-for-xaml-markup-extensions/">Making the case for XAML Markup Extensions â€“ pedrolamas.com</a></p>

:ET