I"Ò<p>æœ¬æ–‡å‘Šè¯‰å¤§å®¶å¦‚ä½•åœ¨ SharpDx é‡Œé¢ä½¿ç”¨ç¬”åˆ·ï¼ŒåŒ…æ‹¬çº¯è‰²ç¬”åˆ·ã€æ¸å˜ç¬”åˆ·å’Œå›¾ç‰‡ç¬”åˆ·</p>

<!--more-->

<!-- CreateTime:2019/8/30 8:50:00 -->

<p>æœ¬æ–‡å±äº <a href="https://blog.lindexi.com/post/WPF-%E4%BD%BF%E7%94%A8-SharpDx-%E6%B8%B2%E6%9F%93%E5%8D%9A%E5%AE%A2%E5%AF%BC%E8%88%AA.html">SharpDx ç³»åˆ—</a> åšå®¢ï¼Œå»ºè®®ä»å¤´å¼€å§‹è¯»</p>

<h2 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h2>

<p>æœ¬æ–‡å°†ä¼šåœ¨ <a href="https://blog.csdn.net/lindexi_gd/article/details/82114907">C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ åˆå§‹åŒ–dxä¿®æ”¹é¢œè‰²</a>çš„ä»£ç åŸºç¡€è¿›è¡Œä¿®æ”¹</p>

<p>ç”¨åˆ°çš„åˆå§‹åŒ–ä»£ç ä¹Ÿä¸å¤šï¼Œè¯·çœ‹ä¸‹é¢ä»£ç ï¼Œè¿™äº›ä»£ç éƒ½å¯ä»¥åœ¨ä¸Šä¸€ç¯‡åšå®¢æ‰¾åˆ°</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">InitializeDeviceResources</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">backBufferDesc</span> <span class="p">=</span>
                <span class="k">new</span> <span class="nf">ModeDescription</span><span class="p">(</span><span class="n">Width</span><span class="p">,</span> <span class="n">Height</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Rational</span><span class="p">(</span><span class="m">60</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">Format</span><span class="p">.</span><span class="n">R8G8B8A8_UNorm</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">swapChainDesc</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SwapChainDescription</span>
            <span class="p">{</span>
                <span class="n">ModeDescription</span> <span class="p">=</span> <span class="n">backBufferDesc</span><span class="p">,</span>
                <span class="n">SampleDescription</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SampleDescription</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
                <span class="n">SwapEffect</span> <span class="p">=</span> <span class="n">SwapEffect</span><span class="p">.</span><span class="n">Discard</span><span class="p">,</span>
                <span class="n">Usage</span> <span class="p">=</span> <span class="n">Usage</span><span class="p">.</span><span class="n">RenderTargetOutput</span><span class="p">,</span>
                <span class="n">BufferCount</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
                <span class="n">OutputHandle</span> <span class="p">=</span> <span class="n">_renderForm</span><span class="p">.</span><span class="n">Handle</span><span class="p">,</span>
                <span class="n">IsWindowed</span> <span class="p">=</span> <span class="k">true</span>
            <span class="p">};</span>

            <span class="n">Device</span><span class="p">.</span><span class="nf">CreateWithSwapChain</span><span class="p">(</span><span class="n">DriverType</span><span class="p">.</span><span class="n">Hardware</span><span class="p">,</span> <span class="n">DeviceCreationFlags</span><span class="p">.</span><span class="n">BgraSupport</span><span class="p">,</span> <span class="n">swapChainDesc</span><span class="p">,</span>
                <span class="k">out</span> <span class="n">_d3DDevice</span><span class="p">,</span> <span class="k">out</span> <span class="n">_swapChain</span><span class="p">);</span>

            <span class="n">_d3DDeviceContext</span> <span class="p">=</span> <span class="n">_d3DDevice</span><span class="p">.</span><span class="n">ImmediateContext</span><span class="p">;</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">backBuffer</span> <span class="p">=</span> <span class="n">_swapChain</span><span class="p">.</span><span class="n">GetBackBuffer</span><span class="p">&lt;</span><span class="n">Texture2D</span><span class="p">&gt;(</span><span class="m">0</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">_renderTargetView</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RenderTargetView</span><span class="p">(</span><span class="n">_d3DDevice</span><span class="p">,</span> <span class="n">backBuffer</span><span class="p">);</span>

                <span class="n">_viewport</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Viewport</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Width</span><span class="p">,</span> <span class="n">Height</span><span class="p">);</span>
                <span class="n">_d3DDeviceContext</span><span class="p">.</span><span class="n">Rasterizer</span><span class="p">.</span><span class="nf">SetViewport</span><span class="p">(</span><span class="n">_viewport</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nf">CreateD2DRender</span><span class="p">();</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>åœ¨ CreateD2DRender æ–¹æ³•é‡Œé¢åˆ›å»º D2D çš„èµ„æºï¼Œæœ¬æ–‡è¿™é‡Œç›´æ¥å†™ä¸Šä»£ç ï¼Œå¦‚æœæƒ³è¦äº†è§£ä»£ç å«ä¹‰è¯·çœ‹ <a href="https://blog.lindexi.com/post/C-%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%86%99-SharpDx-%E5%BA%94%E7%94%A8-%E7%BB%98%E5%88%B6%E5%9F%BA%E7%A1%80%E5%9B%BE%E5%BD%A2.html">C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç»˜åˆ¶åŸºç¡€å›¾å½¢</a></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">CreateD2DRender</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">d2dFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SharpDX</span><span class="p">.</span><span class="n">Direct2D1</span><span class="p">.</span><span class="nf">Factory</span><span class="p">();</span>
            <span class="n">Texture2D</span> <span class="n">backBuffer</span> <span class="p">=</span> <span class="n">D3D11</span><span class="p">.</span><span class="n">Resource</span><span class="p">.</span><span class="n">FromSwapChain</span><span class="p">&lt;</span><span class="n">Texture2D</span><span class="p">&gt;(</span><span class="n">_swapChain</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="n">Surface</span> <span class="n">surface</span> <span class="p">=</span> <span class="n">backBuffer</span><span class="p">.</span><span class="n">QueryInterface</span><span class="p">&lt;</span><span class="n">Surface</span><span class="p">&gt;();</span>
            <span class="kt">var</span> <span class="n">d2dRenderTarget</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RenderTarget</span><span class="p">(</span><span class="n">d2dFactory</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span>
                <span class="k">new</span> <span class="nf">RenderTargetProperties</span><span class="p">(</span><span class="k">new</span> <span class="nf">PixelFormat</span><span class="p">(</span><span class="n">Format</span><span class="p">.</span><span class="n">Unknown</span><span class="p">,</span> <span class="n">AlphaMode</span><span class="p">.</span><span class="n">Premultiplied</span><span class="p">)));</span>

            <span class="kt">var</span> <span class="n">defaultDevice</span> <span class="p">=</span> <span class="n">_d3DDevice</span><span class="p">.</span><span class="n">QueryInterface</span><span class="p">&lt;</span><span class="n">SharpDX</span><span class="p">.</span><span class="n">Direct3D11</span><span class="p">.</span><span class="n">Device1</span><span class="p">&gt;();</span>
            <span class="kt">var</span> <span class="n">dxgiDevice2</span> <span class="p">=</span> <span class="n">defaultDevice</span><span class="p">.</span><span class="n">QueryInterface</span><span class="p">&lt;</span><span class="n">SharpDX</span><span class="p">.</span><span class="n">DXGI</span><span class="p">.</span><span class="n">Device2</span><span class="p">&gt;();</span>
            <span class="kt">var</span> <span class="n">d2dDevice</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SharpDX</span><span class="p">.</span><span class="n">Direct2D1</span><span class="p">.</span><span class="nf">Device</span><span class="p">(</span><span class="n">dxgiDevice2</span><span class="p">);</span>

            <span class="n">_d2dFactory</span> <span class="p">=</span> <span class="n">d2dFactory</span><span class="p">;</span>
            <span class="n">_d2dRenderTarget</span> <span class="p">=</span> <span class="n">d2dRenderTarget</span><span class="p">;</span>
            <span class="n">_d2dContext</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DeviceContext</span><span class="p">(</span><span class="n">surface</span><span class="p">);</span>
            <span class="n">_d2dDevice</span> <span class="p">=</span> <span class="n">d2dDevice</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">Factory</span> <span class="n">_d2dFactory</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">RenderTarget</span> <span class="n">_d2dRenderTarget</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">DeviceContext</span> <span class="n">_d2dContext</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">SharpDX</span><span class="p">.</span><span class="n">Direct2D1</span><span class="p">.</span><span class="n">Device</span> <span class="n">_d2dDevice</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="çº¯è‰²ç¬”åˆ·">çº¯è‰²ç¬”åˆ·</h2>

<p>æœ€åŸºç¡€ä½¿ç”¨çš„æ˜¯çº¯è‰²ç¬”åˆ·ï¼Œåœ¨ SharpDx é‡Œé¢ä¼ å…¥çš„é¢œè‰²æ˜¯ RawColor4 é¢œè‰²ï¼Œé¢œè‰²çš„å€¼èŒƒå›´æ˜¯ 0-1 æˆ‘å†™äº†ä¸€ä¸ªæ–¹æ³•å°† Color è½¬æ¢</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">RawColor4</span> <span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span> <span class="n">color</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">n</span> <span class="p">=</span> <span class="m">255f</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">RawColor4</span><span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="n">R</span> <span class="p">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">G</span> <span class="p">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">B</span> <span class="p">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">A</span> <span class="p">/</span> <span class="n">n</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>åˆ›å»ºçº¯è‰²ç¬”åˆ·éœ€è¦ä¼ å…¥ä¸¤ä¸ªå€¼ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ RenderTarget å¦ä¸€ä¸ªæ˜¯é¢œè‰²</p>

<p>åœ¨ä¸Šé¢åˆå§‹åŒ–ä»£ç åˆ›å»ºäº† <code class="language-plaintext highlighter-rouge">_d2dRenderTarget</code> å’Œ <code class="language-plaintext highlighter-rouge">_d2dContext</code> è¿™ä¸¤ä¸ªéƒ½æ˜¯ RenderTarget éƒ½å¯ä»¥ä¼ å…¥ï¼Œä½†æ˜¯éœ€è¦çŸ¥é“çš„ä¼ å…¥çš„å€¼å’Œä½¿ç”¨çš„å¯¹è±¡éœ€è¦æ˜¯ç›¸åŒçš„</p>

<p>ä¾‹å¦‚ä¼ å…¥çš„æ˜¯  <code class="language-plaintext highlighter-rouge">_d2dRenderTarget</code> é‚£ä¹ˆä¸‹é¢å°è¯•ç”¨çº¯è‰²ç¬”åˆ·ç”»ä¸€ä¸ªçŸ©å½¢</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>

            <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">Clear</span><span class="p">(</span><span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">White</span><span class="p">));</span>

            <span class="kt">var</span> <span class="n">brush</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">_d2dRenderTarget</span><span class="p">,</span> <span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Bisque</span><span class="p">));</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">brush</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawRectangleF</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">top</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="m">500</span><span class="p">,</span> <span class="n">bottom</span><span class="p">:</span> <span class="m">500</span><span class="p">);</span>
                <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">FillRectangle</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">brush</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>

            <span class="n">_swapChain</span><span class="p">.</span><span class="nf">Present</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">PresentFlags</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç å†™åœ¨ <a href="https://blog.csdn.net/lindexi_gd/article/details/82114907">C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ åˆå§‹åŒ–dxä¿®æ”¹é¢œè‰²</a> åˆ›å»ºçš„ Draw æ–¹æ³•</p>

<p>åœ¨å¼€å§‹ç»˜åˆ¶çš„æ—¶å€™è°ƒç”¨ BeginDraw æ–¹æ³•ï¼Œåœ¨ç»˜åˆ¶å®Œæˆè°ƒç”¨ EndDraw æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº¤æ¢é“¾å°†ç¼“å­˜äº¤æ¢</p>

<p>è¿™é‡Œåˆ›å»º SolidColorBrush ä½¿ç”¨çš„æ˜¯ <code class="language-plaintext highlighter-rouge">_d2dRenderTarget</code> å­—æ®µï¼Œå¦‚æœä½¿ç”¨ <code class="language-plaintext highlighter-rouge">_d2dContext</code> é‚£ä¹ˆè¯·å°†ä¸Šé¢ä»£ç æ›¿æ¢</p>

<p>éœ€è¦æ³¨æ„åœ¨ SharpDx åˆ›å»ºçš„èµ„æºéƒ½éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œåˆ›å»ºçš„çº¯è‰²ç¬”åˆ·éœ€è¦æ‰‹åŠ¨é‡Šæ”¾</p>

<h2 id="æ¸å˜ç¬”åˆ·">æ¸å˜ç¬”åˆ·</h2>

<p>åœ¨ SharpDx ä½¿ç”¨ LinearGradientBrush åšæ¸å˜ç¬”åˆ·ï¼Œæ¸å˜ç¬”åˆ·éœ€è¦ç”¨ LinearGradientBrushProperties å’Œ GradientStopCollection ä¸¤ä¸ªå€¼è¿›è¡Œåˆå§‹åŒ–</p>

<p>åœ¨ LinearGradientBrushProperties å¯ä»¥æŒ‡å®šèµ·ç‚¹å’Œç»ˆç‚¹ï¼Œé€šè¿‡èµ·ç‚¹å’Œç»ˆç‚¹è¿çº¿åšæ¸å˜ï¼Œè¿™é‡Œçš„èµ·ç‚¹å’Œç»ˆç‚¹ä½¿ç”¨çš„æ˜¯ç”»å¸ƒåæ ‡ç³»è€Œä¸æ˜¯ç»˜åˆ¶çš„å›¾å½¢çš„åæ ‡ç³»</p>

<p>ä¾‹å¦‚æˆ‘ç»˜åˆ¶çš„çŸ©å½¢åœ¨ <code class="language-plaintext highlighter-rouge">(10,10)</code> ä½œä¸ºå·¦ä¸Šè§’ï¼Œä½†æ˜¯æŒ‡å®šçš„ç¬”åˆ·æ˜¯åœ¨ <code class="language-plaintext highlighter-rouge">(0,0)</code> é‚£ä¹ˆå°†ä¼šåœ¨çŸ©å½¢ä¹‹å¤–å°±å¼€å§‹ç®—ç¬”åˆ·</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">linearGradientBrushProperties</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LinearGradientBrushProperties</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">StartPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawVector2</span><span class="p">(</span><span class="m">10f</span><span class="p">,</span> <span class="m">10f</span><span class="p">),</span>
                <span class="n">EndPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawVector2</span><span class="p">(</span><span class="m">100f</span><span class="p">,</span> <span class="m">100f</span><span class="p">)</span>
            <span class="p">};</span>
</code></pre></div></div>

<p>åœ¨ GradientStopCollection å¯ä»¥æŒ‡å®šç¬”åˆ·çš„æ¸å˜ç‚¹é›†åˆï¼Œä½¿ç”¨çš„æ˜¯ GradientStop æ•°ç»„è¡¨ç¤º</p>

<p>åœ¨ GradientStop æ•°ç»„ï¼Œåœ¨æ¯ä¸ªå¯¹è±¡é‡Œé¢éœ€è¦æŒ‡å®šé¢œè‰²å’Œæ¸å˜ç‚¹çš„è·ç¦»ï¼ŒèŒƒå›´æ˜¯ä» 0 åˆ° 1 è¶Šé è¿‘ 0 çš„å°±æ˜¯è¶Šé è¿‘ LinearGradientBrushProperties èµ·ç‚¹çš„é¢œè‰²</p>

<p>ä¾‹å¦‚æˆ‘åˆ›å»ºäº† 3 ä¸ªé¢œè‰²</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">gradientStop0</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GradientStop</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Color</span> <span class="p">=</span> <span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Yellow</span><span class="p">),</span>
                <span class="n">Position</span> <span class="p">=</span> <span class="m">0f</span>
            <span class="p">};</span>
            <span class="kt">var</span> <span class="n">gradientStop1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GradientStop</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Color</span> <span class="p">=</span> <span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">ForestGreen</span><span class="p">),</span>
                <span class="n">Position</span> <span class="p">=</span> <span class="m">0.5f</span>
            <span class="p">};</span>
            <span class="kt">var</span> <span class="n">gradientStop2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GradientStop</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Color</span> <span class="p">=</span> <span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">White</span><span class="p">),</span>
                <span class="n">Position</span> <span class="p">=</span> <span class="m">1f</span>
            <span class="p">};</span>
            <span class="kt">var</span> <span class="n">gradientStops</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GradientStop</span><span class="p">[]</span>
            <span class="p">{</span>
                <span class="n">gradientStop0</span><span class="p">,</span>
                <span class="n">gradientStop1</span><span class="p">,</span>
                <span class="n">gradientStop2</span><span class="p">,</span>
            <span class="p">};</span>
</code></pre></div></div>

<p>ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„å¯¹è±¡ç»˜åˆ¶åœ¨çŸ©å½¢æ¸å˜</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>

            <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">Clear</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">gradientStopCollection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GradientStopCollection</span><span class="p">(</span><span class="n">_d2dRenderTarget</span><span class="p">,</span> <span class="n">gradientStops</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">brush</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LinearGradientBrush</span><span class="p">(</span><span class="n">_d2dRenderTarget</span><span class="p">,</span>
                                                <span class="n">linearGradientBrushProperties</span><span class="p">,</span>
                                                <span class="n">gradientStopCollection</span><span class="p">);</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">gradientStopCollection</span><span class="p">)</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">brush</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawRectangleF</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">top</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="m">100</span><span class="p">,</span> <span class="n">bottom</span><span class="p">:</span> <span class="m">100</span><span class="p">);</span>
                <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">FillRectangle</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">brush</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>

            <span class="n">_swapChain</span><span class="p">.</span><span class="nf">Present</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">PresentFlags</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
</code></pre></div></div>

<p>è¿è¡Œä»£ç å¯ä»¥çœ‹åˆ°ä¸‹å›¾</p>

<!-- ![](image/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·0.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F2019623203542185" alt="" /></p>

<p>åœ¨ <code class="language-plaintext highlighter-rouge">_d2dRenderTarget.Clear</code> ä¼ å…¥ null å°†ä¼šä½¿ç”¨é€æ˜çš„é»˜è®¤é»‘è‰²æ¸…ç©ºç”»å¸ƒ</p>

<p>åœ¨ä¸Šé¢ä»£ç çš„ GradientStopCollection å°±æ˜¯ç”»å‡ºä¸€æ¡æ¸å˜çº¿ï¼Œåœ¨æ•°å­¦çš„çº¿æ˜¯æ²¡æœ‰å®½åº¦çš„ï¼Œä½†æ˜¯è®©å¤§å®¶èƒ½çœ‹åˆ°æ¯ä¸ªé¢œè‰²æˆ‘å°±ç”»äº†ä¸€æ¡çŸ©å½¢</p>

<!-- ![](image/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·1.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F201962320405465" alt="" /></p>

<p>è¿™å°±æ˜¯å¯¹åº”çš„ä¸‰ä¸ªç‚¹ï¼Œæœ‰äº†ä¸€æ¡çº¿ï¼Œé‚£ä¹ˆå°†è¿™æ¡çº¿åº”ç”¨åˆ°çº¿æ®µä¸Šå°±åšå‡ºäº†æ¸å˜ç¬”åˆ·</p>

<!-- ![](image/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·2.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F2019623204725727" alt="" /></p>

<p>ç”»å‡ºçš„æ¸å˜çº¿éœ€è¦é…åˆæ¸å˜çš„èµ·ç‚¹å’Œç»ˆç‚¹æ‰èƒ½ç”»å‡ºæ¸å˜æ•ˆæœï¼Œåœ¨ä½¿ç”¨çš„åæ ‡æ˜¯ç”»å¸ƒçš„åæ ‡ï¼Œå¯ä»¥è®©èµ·ç‚¹çš„åæ ‡æ¯”ç»ˆç‚¹çš„å¤§</p>

<p>åœ¨ LinearGradientBrush ä¹Ÿæœ‰èµ·ç‚¹å’Œç»ˆç‚¹çš„å±æ€§ï¼Œåœ¨è¿™é‡Œçš„è®¾ç½®ä¼šè¦†ç›– LinearGradientBrushProperties çš„è®¾ç½®</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">brush</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LinearGradientBrush</span><span class="p">(</span><span class="n">_d2dRenderTarget</span><span class="p">,</span>
                                                <span class="n">linearGradientBrushProperties</span><span class="p">,</span>
                                                <span class="n">gradientStopCollection</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">StartPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawVector2</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="m">50</span><span class="p">),</span>
                <span class="n">EndPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawVector2</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">)</span>
            <span class="p">};</span>
</code></pre></div></div>

<p>å¦‚ä¸Šé¢çš„ä»£ç å°±ä¼šè®© LinearGradientBrushProperties è®¾ç½®çš„ä» 10,10 å¼€å§‹ä¿®æ”¹ä¸ºä» 50 å¼€å§‹ç”»æ¸å˜</p>

<h2 id="åœ†å½¢æ¸å˜">åœ†å½¢æ¸å˜</h2>

<p>ä¸Šé¢ä½¿ç”¨çš„æ˜¯æœ€ç®€å•çš„çº¿æ€§æ¸å˜ç¬”åˆ·ï¼Œä¸‹é¢æ¥å‘Šè¯‰å¤§å®¶ä½¿ç”¨åœ†å½¢æ¸å˜çš„æ•ˆæœ</p>

<p>åœ¨ SharpDx ä½¿ç”¨ RadialGradientBrush åšåœ†å½¢æ¸å˜æ•ˆæœ</p>

<p>åœ¨ RadialGradientBrush çš„åˆ›å»ºéœ€è¦ä¼ å…¥ RadialGradientBrushProperties å’Œ GradientStopCollection å¯¹è±¡</p>

<p>åœ¨çº¿æ€§æ¸å˜ç¬”åˆ·å·²ç»å‘Šè¯‰è¿‡å¤§å®¶ GradientStopCollection æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Œåœ¨ GradientStopCollection å¯ä»¥ç”»å‡ºä¸€æ¡æ¸å˜çº¿ï¼Œè¿™æ¡çº¿æ²¡æœ‰æŒ‡å®šèµ·ç‚¹å’Œç»ˆç‚¹ï¼Œä½†æ˜¯æŒ‡å®šäº†é¢œè‰²åœ¨å¯¹åº”çš„çº¿çš„æ¯”ä¾‹</p>

<p>åœ¨åœ†å½¢æ¸å˜ç¬”åˆ·ä¸­ RadialGradientBrushProperties å°†ä¼šä¼ å…¥åœ†å¿ƒçš„åæ ‡ï¼Œåœ†çš„ x æ–¹å‘å’Œ y çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç”»å‡ºæ¤­åœ†ï¼Œå¦å¤–è¿˜æ”¯æŒè®¾ç½®å®é™…çš„æ¸å˜çº¿çš„èµ·ç‚¹</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">radialGradientBrushProperties</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RadialGradientBrushProperties</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Center</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawVector2</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="m">50</span><span class="p">),</span>
                <span class="n">GradientOriginOffset</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawVector2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
                <span class="n">RadiusX</span> <span class="p">=</span> <span class="m">50f</span><span class="p">,</span>
                <span class="n">RadiusY</span> <span class="p">=</span> <span class="m">50f</span>
            <span class="p">};</span>
</code></pre></div></div>

<p>è¿™é‡Œçš„ Center å°±æ˜¯åœ†å½¢æ¸å˜çš„åœ†çš„åœ†å¿ƒçš„åæ ‡ï¼Œåæ ‡ä½¿ç”¨çš„æ˜¯ç”»å¸ƒåæ ‡ï¼Œè€Œ RadiusX å’Œ RadiusY åˆ†åˆ«æ˜¯é•¿åº¦</p>

<p>åœ¨ä¸Šé¢ä»£ç æ¯”è¾ƒå¤æ‚çš„æ˜¯ GradientOriginOffset è¿™ä¸ªå˜é‡ï¼Œåœ¨ GradientOriginOffset æŒ‡å®šæ¸å˜çº¿çš„èµ·ç‚¹è·ç¦»åœ†å¿ƒçš„è·ç¦»ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„åæ ‡ä½¿ç”¨çš„ç›¸å¯¹åœ†å¿ƒçš„åæ ‡</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">gradientStop0</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GradientStop</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Color</span> <span class="p">=</span> <span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Yellow</span><span class="p">),</span>
                <span class="n">Position</span> <span class="p">=</span> <span class="m">0f</span>
            <span class="p">};</span>
            <span class="kt">var</span> <span class="n">gradientStop1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GradientStop</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Color</span> <span class="p">=</span> <span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">ForestGreen</span><span class="p">),</span>
                <span class="n">Position</span> <span class="p">=</span> <span class="m">0.5f</span>
            <span class="p">};</span>
            <span class="kt">var</span> <span class="n">gradientStop2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GradientStop</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Color</span> <span class="p">=</span> <span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">White</span><span class="p">),</span>
                <span class="n">Position</span> <span class="p">=</span> <span class="m">1f</span>
            <span class="p">};</span>
            <span class="kt">var</span> <span class="n">gradientStops</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GradientStop</span><span class="p">[]</span>
            <span class="p">{</span>
                <span class="n">gradientStop0</span><span class="p">,</span>
                <span class="n">gradientStop1</span><span class="p">,</span>
                <span class="n">gradientStop2</span><span class="p">,</span>
            <span class="p">};</span>

            <span class="kt">var</span> <span class="n">gradientStopCollection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GradientStopCollection</span><span class="p">(</span><span class="n">_d2dRenderTarget</span><span class="p">,</span> <span class="n">gradientStops</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">radialGradientBrushProperties</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RadialGradientBrushProperties</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Center</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawVector2</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="m">50</span><span class="p">),</span>
                <span class="n">GradientOriginOffset</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawVector2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
                <span class="n">RadiusX</span> <span class="p">=</span> <span class="m">50f</span><span class="p">,</span>
                <span class="n">RadiusY</span> <span class="p">=</span> <span class="m">50f</span>
            <span class="p">};</span>
            <span class="kt">var</span> <span class="n">brush</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RadialGradientBrush</span><span class="p">(</span><span class="n">_d2dRenderTarget</span><span class="p">,</span> <span class="k">ref</span> <span class="n">radialGradientBrushProperties</span><span class="p">,</span> <span class="n">gradientStopCollection</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="n">gradientStopCollection</span><span class="p">)</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">brush</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawRectangleF</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">top</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="m">100</span><span class="p">,</span> <span class="n">bottom</span><span class="p">:</span> <span class="m">100</span><span class="p">);</span>
                <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">FillRectangle</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">brush</span><span class="p">);</span>
            <span class="p">}</span>
</code></pre></div></div>

<p>è¿è¡Œä»£ç å¯ä»¥çœ‹åˆ°ä¸‹å›¾</p>

<!-- ![](image/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·3.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F201962320590900" alt="" /></p>

<p>åœ¨ä¸Šé¢å›¾ç‰‡çš„å„ä¸ªåæ ‡å¦‚ä¸‹</p>

<!-- ![](image/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·4.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F2019623219257" alt="" /></p>

<p>ä¸‹å›¾æ˜¯è®¾ç½® <code class="language-plaintext highlighter-rouge">GradientOriginOffset = new RawVector2(-10,-10)</code> çš„æ•ˆæœï¼Œé€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥åšå‡ºç¯å…‰çš„æ•ˆæœ</p>

<!-- ![](image/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·5.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F201962321101297" alt="" /></p>

<h2 id="å›¾ç‰‡ç¬”åˆ·">å›¾ç‰‡ç¬”åˆ·</h2>

<p>åœ¨ SharpDx åˆ›å»ºå›¾ç‰‡éœ€è¦æ¯”è¾ƒå¤šçš„ä»£ç ï¼Œä¸‹é¢æˆ‘åˆ›å»ºä¸€ä¸ªå‡½æ•°ç”¨æ¥åŠ è½½å›¾ç‰‡</p>

<p>åœ¨ SharpDx ä½¿ç”¨ WIC è§£æå›¾ç‰‡ï¼Œå…ˆåˆ›å»ºå›¾ç‰‡å·¥å‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">ImagingFactory</span> <span class="n">imagingFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ImagingFactory</span><span class="p">();</span>
</code></pre></div></div>

<p>ç„¶åå°†ä¼ å…¥çš„æ–‡ä»¶ä½œä¸º NativeFileStream åŠ è½½</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">NativeFileStream</span> <span class="n">fileStream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">NativeFileStream</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span>
                <span class="n">NativeFileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">,</span> <span class="n">NativeFileAccess</span><span class="p">.</span><span class="n">Read</span><span class="p">);</span>
</code></pre></div></div>

<p>è¿™é‡Œçš„ filePath å°±æ˜¯ç»å¯¹è·¯å¾„çš„å›¾ç‰‡</p>

<p>åˆ›å»ºå›¾ç‰‡è§£ç å™¨</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">BitmapDecoder</span> <span class="n">bitmapDecoder</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BitmapDecoder</span><span class="p">(</span><span class="n">imagingFactory</span><span class="p">,</span> <span class="n">fileStream</span><span class="p">,</span> <span class="n">DecodeOptions</span><span class="p">.</span><span class="n">CacheOnDemand</span><span class="p">);</span>
</code></pre></div></div>

<p>åœ¨å›¾ç‰‡è§£ç å™¨å¯ä»¥æ‹¿åˆ°å›¾ç‰‡çš„ Frame ä¸€èˆ¬çš„å›¾ç‰‡åªæœ‰ä¸€ä¸ªï¼Œä¸€èˆ¬ gif å›¾ç‰‡å¯èƒ½æœ‰å¤šä¸ªå›¾å±‚åºå·å’Œæ•°ç»„ç›¸åŒ</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                <span class="n">BitmapFrameDecode</span> <span class="n">frame</span> <span class="p">=</span> <span class="n">bitmapDecoder</span><span class="p">.</span><span class="nf">GetFrame</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
</code></pre></div></div>

<p>åˆ›å»ºè½¬æ¢å™¨</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                    <span class="n">FormatConverter</span> <span class="n">converter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FormatConverter</span><span class="p">(</span><span class="n">imagingFactory</span><span class="p">);</span>

</code></pre></div></div>

<p>ä½¿ç”¨ Bitmap.FromWicBitmap åˆ›å»ºå›¾ç‰‡</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                        <span class="n">converter</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">SharpDX</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="n">PixelFormat</span><span class="p">.</span><span class="n">Format32bppPRGBA</span><span class="p">);</span>

                        <span class="c1">// Create the new Bitmap directly from the FormatConverter.</span>
                        <span class="kt">var</span> <span class="n">bitmap</span> <span class="p">=</span> <span class="n">SharpDX</span><span class="p">.</span><span class="n">Direct2D1</span><span class="p">.</span><span class="n">Bitmap</span><span class="p">.</span><span class="nf">FromWicBitmap</span><span class="p">(</span><span class="n">_d2dRenderTarget</span><span class="p">,</span> <span class="n">converter</span><span class="p">);</span>
</code></pre></div></div>

<p>å› ä¸ºä½¿ç”¨çš„å¯¹è±¡éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨ä»£ç æ·»åŠ å¾ˆå¤š using ä»£ç ï¼Œå‡½æ•°çš„ä»£ç è¯·çœ‹ä¸‹é¢</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="n">Bitmap</span> <span class="nf">LoadBitmapFromContentFile</span><span class="p">(</span><span class="kt">string</span> <span class="n">filePath</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ImagingFactory</span> <span class="n">imagingFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ImagingFactory</span><span class="p">();</span>
            <span class="n">NativeFileStream</span> <span class="n">fileStream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">NativeFileStream</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span>
                <span class="n">NativeFileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">,</span> <span class="n">NativeFileAccess</span><span class="p">.</span><span class="n">Read</span><span class="p">);</span>

            <span class="n">BitmapDecoder</span> <span class="n">bitmapDecoder</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BitmapDecoder</span><span class="p">(</span><span class="n">imagingFactory</span><span class="p">,</span> <span class="n">fileStream</span><span class="p">,</span> <span class="n">DecodeOptions</span><span class="p">.</span><span class="n">CacheOnDemand</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="n">imagingFactory</span><span class="p">)</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">fileStream</span><span class="p">)</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">bitmapDecoder</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">BitmapFrameDecode</span> <span class="n">frame</span> <span class="p">=</span> <span class="n">bitmapDecoder</span><span class="p">.</span><span class="nf">GetFrame</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>

                <span class="k">using</span> <span class="p">(</span><span class="n">frame</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">FormatConverter</span> <span class="n">converter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FormatConverter</span><span class="p">(</span><span class="n">imagingFactory</span><span class="p">);</span>
                    <span class="k">using</span> <span class="p">(</span><span class="n">converter</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">converter</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">SharpDX</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="n">PixelFormat</span><span class="p">.</span><span class="n">Format32bppPRGBA</span><span class="p">);</span>

                        <span class="kt">var</span> <span class="n">bitmap</span> <span class="p">=</span> <span class="n">SharpDX</span><span class="p">.</span><span class="n">Direct2D1</span><span class="p">.</span><span class="n">Bitmap</span><span class="p">.</span><span class="nf">FromWicBitmap</span><span class="p">(</span><span class="n">_d2dRenderTarget</span><span class="p">,</span> <span class="n">converter</span><span class="p">);</span>

                        <span class="k">return</span> <span class="n">bitmap</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

</code></pre></div></div>

<p>é€šè¿‡ä¸Šé¢æ–¹æ³•å°±å¯ä»¥åœ¨ SharpDx åŠ è½½å›¾ç‰‡æ–‡ä»¶</p>

<p>åœ¨ SharpDx ä¹Ÿæœ‰ Utilities.Dispose æ–¹æ³•å¯ä»¥ååŠ©æ¸…ç†æŸä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•çš„ç”¨æ³•å’Œ using å·®ä¸å¤š</p>

<p>ä¸è¿‡åœ¨ C# 8.0 æä¾›äº† <code class="language-plaintext highlighter-rouge">using var</code> çš„å†™æ³•ï¼Œå¯ä»¥åœ¨æ–¹æ³•ç»“æŸçš„æ—¶å€™é‡Šæ”¾å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ä¼šæ¯”ä¸Šé¢ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">using</code> çš„ä»£ç å¥½</p>

<p>åœ¨åˆ›å»ºå›¾ç‰‡ç¬”åˆ·éœ€è¦æ‹¿åˆ° å›¾ç‰‡ ç„¶ååˆ›å»º BitmapBrushProperties è¯´æ˜å¦‚ä½•ä½¿ç”¨å›¾ç‰‡</p>

<p>åœ¨ BitmapBrushProperties æœ‰ ExtendModeX å’Œ ExtendModeY ä¸¤ä¸ªå±æ€§ï¼Œè¯´æ˜åœ¨å›¾ç‰‡çš„å¤§å°æ¯”å¡«å……çš„èŒƒå›´å°çš„æ—¶å€™ï¼Œå¦‚ä½•è¿›è¡Œå¡«å……ï¼Œå¦‚è¿›è¡Œæ°´å¹³æ–¹å‘çš„å¤åˆ¶è¿˜æ˜¯é•œåƒ</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="p">=</span> <span class="nf">LoadBitmapFromContentFile</span><span class="p">(</span><span class="s">@"D:\lindexi\1.png"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">bitmapBrushProperties</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BitmapBrushProperties</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">ExtendModeX</span> <span class="p">=</span> <span class="n">ExtendMode</span><span class="p">.</span><span class="n">Wrap</span><span class="p">,</span>
                <span class="n">ExtendModeY</span> <span class="p">=</span> <span class="n">ExtendMode</span><span class="p">.</span><span class="n">Wrap</span><span class="p">,</span>
            <span class="p">};</span>
            <span class="kt">var</span> <span class="n">brushProperties</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BrushProperties</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Opacity</span> <span class="p">=</span> <span class="m">1f</span><span class="p">,</span>
                <span class="n">Transform</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawMatrix3x2</span><span class="p">()</span>
                <span class="p">{</span>
                    <span class="n">M11</span> <span class="p">=</span> <span class="m">1f</span><span class="p">,</span>
                    <span class="n">M22</span> <span class="p">=</span> <span class="m">1f</span>
                <span class="p">}</span>
            <span class="p">};</span>
            <span class="kt">var</span> <span class="n">brush</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BitmapBrush</span><span class="p">(</span><span class="n">_d2dRenderTarget</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">bitmapBrushProperties</span><span class="p">,</span> <span class="n">brushProperties</span><span class="p">);</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">bitmap</span><span class="p">)</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">brush</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawRectangleF</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">top</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="m">500</span><span class="p">,</span> <span class="n">bottom</span><span class="p">:</span> <span class="m">500</span><span class="p">);</span>
                <span class="n">_d2dRenderTarget</span><span class="p">.</span><span class="nf">FillRectangle</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">brush</span><span class="p">);</span>
            <span class="p">}</span>
</code></pre></div></div>

<p>åœ¨å¡«å……å›¾ç‰‡ç¬”åˆ·çš„æ—¶å€™ï¼Œå›¾ç‰‡æ˜¯ä»ç”»å¸ƒçš„ 0,0 å¼€å§‹å¡«å……ï¼Œä¹Ÿå°±æ˜¯å¦‚æœå›¾ç‰‡å¤ªå°äº†ï¼Œé‚£ä¹ˆåœ¨å¡«å……çš„èŒƒå›´æ˜¯çœ‹ä¸åˆ°å¡«å……çš„ï¼Œä¾‹å¦‚æˆ‘çš„å›¾ç‰‡çš„å®½åº¦åªæœ‰ 5 é‚£ä¹ˆåœ¨ä¸Šé¢çš„çŸ©å½¢çš„å·¦ä¸Šè§’åæ ‡æ˜¯ 10 å°±ä¼šçœ‹ä¸åˆ°å›¾ç‰‡</p>

<p>è¿™æ—¶å°±éœ€è¦ç”¨åˆ° BrushProperties è¿™ä¸ªå±æ€§ï¼Œå…¶å®åœ¨ä¸Šé¢çš„ç¬”åˆ·ä¹Ÿæ˜¯å¯ä»¥æ·»åŠ è¿™ä¸ªå±æ€§ï¼Œåœ¨è¿™ä¸ªå±æ€§æä¾›äº†ç¬”åˆ·çš„é€æ˜åº¦å’Œå˜æ¢çš„æ–¹æ³•</p>

<p>ä½¿ç”¨å˜æ¢æ–¹æ³•å¯ä»¥ç§»åŠ¨æˆ–æ—‹è½¬å›¾ç‰‡ç¬”åˆ·ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆšå¥½å›¾ç‰‡çš„å¤§å°å°±æ˜¯å¡«å……çš„å¤§å°çš„æ—¶å€™ï¼Œå°†å›¾ç‰‡ç§»åŠ¨åˆ°å¡«å……çš„åæ ‡å°±æ˜¯ä½¿ç”¨å˜æ¢çš„æ–¹æ³•</p>

<p>è¿è¡Œä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ä¸‹å›¾</p>

<!-- ![](image/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·/C# ä»é›¶å¼€å§‹å†™ SharpDx åº”ç”¨ ç¬”åˆ·6.png) -->

<p><img src="https://i.loli.net/2019/06/23/5d0f7f2f39e2655524.jpg" alt="" /></p>

<p>å¦ä¸€ä¸ªå›¾ç‰‡ç¬”åˆ·æ˜¯ ImageBrush ç”¨æ³•å’Œä¸Šé¢ä»£ç å·®ä¸å¤š</p>

<p>è¿™é‡Œçš„ ImageBrush ä¸æ˜¯ WPF çš„ ImageBrush è€Œæ˜¯ SharpDX.Direct2D1.ImageBrush ç±»</p>

<p>å› ä¸º ImageBrush ä½¿ç”¨çš„æ˜¯ <code class="language-plaintext highlighter-rouge">_d2dContext</code> æ‰€ä»¥éœ€è¦ä¿®æ”¹ LoadBitmapFromContentFile é‡Œé¢çš„æ–¹æ³•</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kt">var</span> <span class="n">bitmap</span> <span class="p">=</span> <span class="n">SharpDX</span><span class="p">.</span><span class="n">Direct2D1</span><span class="p">.</span><span class="n">Bitmap</span><span class="p">.</span><span class="nf">FromWicBitmap</span><span class="p">(</span><span class="n">_d2dContext</span><span class="p">,</span> <span class="n">converter</span><span class="p">);</span>
</code></pre></div></div>

<p>åœ¨ SharpDx ä½¿ç”¨çš„èµ„æºå’Œåˆ›å»ºçš„èµ„æºéœ€è¦ç›¸åŒ</p>

<p>åˆ›å»º ImageBrush éœ€è¦ ImageBrushProperties å±æ€§ Image å±æ€§ï¼Œè¿™é‡Œçš„ Image å¯ä»¥å°† SharpDX.Direct2D1.Bitmap ä¼ å…¥</p>

<p>åœ¨ SharpDx çš„ Image æ˜¯åŸºç±»ï¼Œå¯ä»¥ä½¿ç”¨ Bitmap1 ImageSourceFromWic CommandList ç­‰</p>

<p>åœ¨ ImageBrushProperties ä¹Ÿæä¾›äº†åœ¨ç”»åˆ·å°äºå¡«å……èŒƒå›´æ—¶ï¼Œå¯¹ç”»åˆ·å†…å®¹çš„å›¾ç‰‡åšå¤åˆ¶è¿˜æ˜¯åšé•œåƒçš„æ–¹æ³•</p>

<p>ä½†æ˜¯è¿™ä¸ªç±»éœ€è¦ SourceRectangle è¯´æ˜ç”»åˆ·é‡Œçš„å›¾ç‰‡çš„èŒƒå›´ï¼Œä¹Ÿå°±æ˜¯æ”¯æŒå¯¹ä¼ å…¥çš„å›¾ç‰‡åªæ˜¾ç¤ºé‡Œé¢çš„éƒ¨åˆ†ï¼Œå¯¹å›¾ç‰‡è£å‰ªçš„æ–¹æ³•</p>

<p>é»˜è®¤ä¼ å…¥çš„å°±æ˜¯å›¾ç‰‡çš„å¤§å°</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="p">=</span> <span class="nf">LoadBitmapFromContentFile</span><span class="p">(</span><span class="s">@"D:\lindexi\1.png"</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">imageBrushProperties</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ImageBrushProperties</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">ExtendModeX</span> <span class="p">=</span> <span class="n">ExtendMode</span><span class="p">.</span><span class="n">Wrap</span><span class="p">,</span>
                <span class="n">ExtendModeY</span> <span class="p">=</span> <span class="n">ExtendMode</span><span class="p">.</span><span class="n">Wrap</span><span class="p">,</span>
                <span class="n">SourceRectangle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectangleF</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">Height</span><span class="p">),</span>
            <span class="p">};</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç åˆ›å»ºäº† ImageBrushProperties è®¾ç½®äº†å½“å¡«å……çš„èŒƒå›´å¤§äºå›¾ç‰‡çš„å¤§å°çš„æ—¶å€™ï¼Œä½¿ç”¨é•œåƒçš„æ–¹æ³•ã€‚å¦å¤–è®¾ç½®å›¾ç‰‡çš„å¡«å……å¤§å°ä¸ºåŸå›¾å¤§å°ï¼Œä¹Ÿå°±æ˜¯åæ ‡ç‚¹æ˜¯ 0 ç‚¹å¤§å°å°±æ˜¯å›¾ç‰‡å¤§å°</p>

<p>åˆ›å»ºå›¾ç‰‡ç¬”åˆ·ç„¶åæ·»åŠ çŸ©å½¢è¯·çœ‹ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">brush</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ImageBrush</span><span class="p">(</span><span class="n">_d2dContext</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">imageBrushProperties</span><span class="p">);</span>

            <span class="n">_d2dContext</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>
            <span class="n">_d2dContext</span><span class="p">.</span><span class="nf">Clear</span><span class="p">(</span><span class="nf">ColorToRaw4</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">White</span><span class="p">));</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">bitmap</span><span class="p">)</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">brush</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RawRectangleF</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">top</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="m">500</span><span class="p">,</span> <span class="n">bottom</span><span class="p">:</span> <span class="m">500</span><span class="p">);</span>
                <span class="n">_d2dContext</span><span class="p">.</span><span class="nf">FillRectangle</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">brush</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">_d2dContext</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>
</code></pre></div></div>

<p>è¿è¡Œä»£ç å¯ä»¥çœ‹åˆ°å¡«å……å›¾ç‰‡</p>

<p>å›¾ç‰‡åœ¨ä½¿ç”¨ä¹‹åéœ€è¦é‡Šæ”¾</p>

<p>åœ¨å®é™…çš„ä»£ç å¾ˆå°‘ä¼šåœ¨ Draw æ–¹æ³•ä¸æ–­åˆ›å»ºèµ„æºåŒæ—¶è¿›è¡Œé‡Šæ”¾ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨åˆ›å»ºèµ„æºæ–¹æ³•è¿›è¡Œåˆ›å»º</p>

<p>å¦å¤– SharpDx æä¾›çš„æ˜¯å¾ˆåº•å±‚çš„å°è£…ï¼Œé€šè¿‡åº•å±‚çš„å°è£…æ˜¯å¯ä»¥è‡ªå·±å†™å‡ºä¸€å¥— UI ç•Œé¢çš„ï¼Œä¸è¿‡é€æ­¥ SharpDx å°†ä¼šè¿‡æ—¶ï¼Œåœ¨ Windows ä¸‹çš„åº•å±‚æ¸²æŸ“æ˜¯ Win2d æ‰æ¯”è¾ƒå¥½ç”¨</p>

<p>æœ¬æ–‡åœ¨åŠ è½½å›¾ç‰‡å‚è€ƒäº†ä¸‹é¢çš„åšå®¢</p>

<p><a href="https://www.cnblogs.com/grenet/p/3330440.html">SharpDXä¹‹Direct2Dæ•™ç¨‹IIâ€”â€”åŠ è½½ä½å›¾æ–‡ä»¶å’Œä¿å­˜ä½å›¾æ–‡ä»¶ - ä¸‡ä»“ä¸€é» - åšå®¢å›­</a></p>

<p><a href="http://english.r2d2rigo.es/2014/08/12/loading-and-drawing-bitmaps-with-direct2d-using-sharpdx/">Loading and drawing bitmaps with Direct2D using SharpDX â€“ int main</a></p>

<p><a href="http://english.r2d2rigo.es/2014/08/19/applying-direct2d-built-in-effects-to-bitmaps-with-sharpdx/">Applying Direct2D built-in effects to bitmaps with SharpDX â€“ int main</a></p>

<p><a href="https://docs.microsoft.com/en-us/windows/desktop/Direct2D/direct2d-brushes-overview?wt.mc_id=MVP">Brushes Overview - Windows applications</a></p>

:ET