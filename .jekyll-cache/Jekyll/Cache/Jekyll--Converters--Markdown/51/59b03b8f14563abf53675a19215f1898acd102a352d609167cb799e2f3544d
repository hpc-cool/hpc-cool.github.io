I"/<p>æœ¬æ–‡æ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•åœ¨ Direct2D1 ç»˜åˆ¶åŸºæœ¬å›¾å½¢ï¼ŒåŒ…æ‹¬çº¿æ®µã€çŸ©å½¢ã€æ¤­åœ†</p>

<!--more-->

<!-- CreateTime:2018/8/10 19:16:53 -->

<div id="toc"></div>
<!-- æ ‡ç­¾ï¼šWPFï¼ŒD2D,DirectX,æ¸²æŸ“ -->

<p>æœ¬æ–‡æ˜¯ä¸€ä¸ªç³»åˆ—</p>

<ul>
  <li>
    <p><a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-Direct2D1-%E7%94%BB%E5%9B%BE%E5%85%A5%E9%97%A8.html">WPF ä½¿ç”¨ Direct2D1 ç”»å›¾å…¥é—¨</a></p>
  </li>
  <li>
    <p><a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-Direct2D1-%E7%94%BB%E5%9B%BE-%E7%BB%98%E5%88%B6%E5%9F%BA%E6%9C%AC%E5%9B%BE%E5%BD%A2.html">WPF ä½¿ç”¨ Direct2D1 ç”»å›¾ ç»˜åˆ¶åŸºæœ¬å›¾å½¢</a></p>
  </li>
  <li>
    <p><a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-SharpDX.html">WPF ä½¿ç”¨ SharpDX</a></p>
  </li>
</ul>

<p>æœ¬æ–‡çš„ç»„ç»‡å‚è€ƒ<a href="http://www.cnblogs.com/grenet/category/507059.html">Direct2D</a>ï¼Œå¯¹å¤§ç¥è¡¨ç¤ºæ„Ÿè°¢ã€‚</p>

<p>åœ¨å¼€å§‹å‰å…ˆå‘Šè¯‰å¤§å®¶ä¸ºä½•éœ€è¦ä½¿ç”¨ Direct2D ï¼Œè™½ç„¶ WPF ä¹Ÿæ˜¯åŸºäº DX è¿›è¡Œæ¸²æŸ“ï¼Œä½†æ˜¯ WPF åšäº†å¾ˆå¤šå…¼å®¹å¤„ç†ï¼Œæ‰€ä»¥æ²¡æœ‰æ¯”ç›´æ¥ä½¿ç”¨ Direct2D çš„æ€§èƒ½é«˜ã€‚ç»è¿‡æµ‹è¯•ï¼Œåœ¨ä½¿ç”¨ä¸‹é¢çš„æ‰€æœ‰ä»£ç ï¼Œå ç”¨ CPU å‡ ä¹éƒ½æ˜¯ 0% ï¼Œå› ä¸ºæ²¡æœ‰å¸ƒå±€ã€é€æ˜å’Œäº‹ä»¶å¤„ç†ï¼Œæ‰€ä»¥é€Ÿåº¦æ˜¯å¾ˆå¿«ã€‚</p>

<h2 id="ç‚¹">ç‚¹</h2>

<p>åœ¨ Direct2D ä½¿ç”¨çš„ ç‚¹æ˜¯ Point2F ï¼Œä¼ å…¥çš„æ˜¯ä¸¤ä¸ª float ï¼Œå’Œ Point å·®ä¸å¤šã€‚</p>

<p>Point2F ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæ‰€ä»¥å’Œ Point ç±»å‹å·®ä¸å¤š</p>

<h2 id="çº¿æ®µ">çº¿æ®µ</h2>

<p>çº¿æ®µéœ€è¦ä½¿ç”¨ DrawLine ï¼Œæ–¹æ³•çš„ç­¾å</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">void</span> <span class="nf">DrawLine</span><span class="p">(</span><span class="n">Point2F</span> <span class="n">firstPoint</span> <span class="err">èµ·å§‹ç‚¹</span> <span class="p">,</span> <span class="n">Point2F</span> <span class="n">secondPoint</span> <span class="err">ç»ˆç‚¹</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">brush</span> <span class="err">ç¬”åˆ·</span><span class="p">,</span> <span class="kt">float</span> <span class="n">strokeWidth</span> <span class="err">çº¿æ®µå®½åº¦</span><span class="p">)</span>

 <span class="k">public</span> <span class="k">unsafe</span> <span class="k">void</span> <span class="nf">DrawLine</span><span class="p">(</span><span class="n">Point2F</span> <span class="n">firstPoint</span><span class="p">,</span> <span class="n">Point2F</span> <span class="n">secondPoint</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">brush</span><span class="p">,</span> <span class="kt">float</span> <span class="n">strokeWidth</span><span class="p">,</span> <span class="n">StrokeStyle</span> <span class="n">strokeStyle</span> <span class="err">çº¿æ®µæ ·å¼</span><span class="p">)</span>
</code></pre></div></div>

<p>æ‰€ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•å°±å¯ä»¥åœ¨ (10,10) (100,10) ç”»å‡ºä¸€æ¡å®½åº¦ä¸º 2 çš„çº¢çº¿</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span>
                <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span> <span class="m">2</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="http://image.acmx.xyz/lindexi%2F20184191049105692.jpg" alt="" /></p>

<p>ä¸Šé¢çš„ä»£ç è¿è¡Œåœ¨<a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-Direct2D1-%E7%94%BB%E5%9B%BE%E5%85%A5%E9%97%A8.html">WPF ä½¿ç”¨ Direct2D1 ç”»å›¾å…¥é—¨</a>æ–‡ç« çš„ OnRendering æ–¹æ³•ï¼Œä¸ºäº†è®©å¤§å®¶ä¹Ÿå¯ä»¥è¯•è¯•ä¸‹é¢çš„ä»£ç ï¼Œå»ºè®®å¤§å®¶å…ˆå»çœ‹è¿™ç¯‡åšå®¢ã€‚</p>

<p>å…³äºç¬”åˆ·ä¼šåœ¨åé¢è¯´</p>

<h2 id="strokestyle">StrokeStyle</h2>

<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢çº¿æ®µçš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯ StrokeStyle é‚£ä¹ˆè¿™ä¸ªå‚æ•°æ˜¯å¦‚ä½•åˆ›å»ºï¼Ÿåœ¨ Direct2D æœ‰å¾ˆå¤šç±»éƒ½ä¸èƒ½ç›´æ¥ç›´æ¥åˆ›å»ºéœ€è¦ä½¿ç”¨ D2DFactory æˆ– RenderTarget æ‰èƒ½åˆ›å»ºã€‚StrokeStyle å°±éœ€è¦ä½¿ç”¨ D2DFactory è¿›è¡Œåˆ›å»ºã€‚</p>

<p>åˆ›å»º StrokeStyle éœ€è¦å‚æ•° StrokeStylePropertiesï¼Œè¿™ä¸ªç±»çš„æ„é€ æœ‰ä¸¤ä¸ªé‡è½½ï¼Œä¸€ä¸ªæ˜¯ä¸éœ€è¦å‚æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯éœ€è¦å¾ˆå¤šå‚æ•°ã€‚ä»£ç è¯·çœ‹ä¸‹é¢ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="nf">StrokeStyleProperties</span><span class="p">(</span><span class="n">CapStyle</span> <span class="n">startCap</span><span class="p">,</span> <span class="n">CapStyle</span> <span class="n">endCap</span><span class="p">,</span> <span class="n">CapStyle</span> <span class="n">dashCap</span><span class="p">,</span> <span class="n">LineJoin</span> <span class="n">lineJoin</span><span class="p">,</span> <span class="kt">float</span> <span class="n">miterLimit</span><span class="p">,</span> <span class="n">DashStyle</span> <span class="n">dashStyle</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dashOffset</span><span class="p">)</span>
</code></pre></div></div>

<p>ä»ä»£ç çš„å‘½åå¤§æ¦‚å¤§å®¶ä¹Ÿå¯ä»¥çŸ¥é“ StrokeStyleProperties å‚æ•°çš„æ„æ€ï¼Œä¸‹é¢å…ˆåˆ›å»ºä¸€ä¸ªæ²¡æœ‰æ„é€ å‡½æ•°çš„æ¥åˆ›å»º StrokeStyle ï¼Œè¯·çœ‹ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">strokeStyleProperties</span> <span class="p">=</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">StrokeStyleProperties</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">strokeStyle</span> <span class="p">=</span> <span class="n">d2DFactory</span><span class="p">.</span><span class="nf">CreateStrokeStyle</span><span class="p">(</span><span class="n">strokeStyleProperties</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">10</span><span class="p">),</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">10</span><span class="p">),</span> <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span><span class="m">2</span><span class="p">,</span> <span class="n">strokeStyle</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>
</code></pre></div></div>

<p>éœ€è¦æ³¨æ„ï¼Œåˆ›å»º strokeStyle çš„å·¥å‚éœ€è¦å’Œåˆ›å»º RenderTarget ä¸€æ ·ï¼Œå¦‚æœä½¿ç”¨ä¸ä¸€æ ·çš„å·¥å‚å°±ä¼šå‡ºç°ä¸‹é¢å¼‚å¸¸ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Microsoft</span><span class="p">.</span><span class="n">WindowsAPICodePack</span><span class="p">.</span><span class="n">DirectX</span><span class="p">.</span><span class="n">Direct2D1</span><span class="p">.</span><span class="n">Direct2DException</span><span class="p">:</span><span class="err">â€œ</span><span class="n">EndDraw</span> <span class="n">has</span> <span class="n">failed</span> <span class="n">with</span> <span class="n">error</span><span class="p">:</span> <span class="err">ä¸€èµ·ä½¿ç”¨çš„å¯¹è±¡å¿…é¡»åˆ›å»ºè‡ªç›¸åŒçš„å·¥å‚å®ä¾‹ã€‚</span> <span class="p">(</span><span class="err">å¼‚å¸¸æ¥è‡ª</span> <span class="n">HRESULT</span><span class="p">:</span><span class="m">0x88990012</span><span class="p">)</span> <span class="n">Tags</span><span class="p">=(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">).</span><span class="err">â€</span>
</code></pre></div></div>

<p>æ‰€ä»¥éœ€è¦ä¿®æ”¹<a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-Direct2D1-%E7%94%BB%E5%9B%BE%E5%85%A5%E9%97%A8.html">WPF ä½¿ç”¨ Direct2D1 ç”»å›¾å…¥é—¨</a>æ–‡ç« çš„ä»£ç ï¼ŒæŠŠ D2DFactory å†™ä¸ºå­—æ®µ</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>

            <span class="n">CompositionTarget</span><span class="p">.</span><span class="n">Rendering</span> <span class="p">+=</span> <span class="n">OnRendering</span><span class="p">;</span>

            <span class="n">Loaded</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">d2DFactory</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">D2DFactory</span><span class="p">.</span><span class="nf">CreateFactory</span><span class="p">(</span><span class="n">D2D</span><span class="p">.</span><span class="n">D2DFactoryType</span><span class="p">.</span><span class="n">Multithreaded</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">windowHandle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WindowInteropHelper</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="n">Handle</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">renderTarget</span> <span class="p">=</span> <span class="n">d2DFactory</span><span class="p">.</span><span class="nf">CreateHwndRenderTarget</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">RenderTargetProperties</span><span class="p">(),</span>
                    <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">HwndRenderTargetProperties</span><span class="p">(</span><span class="n">windowHandle</span><span class="p">,</span>
                        <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">SizeU</span><span class="p">((</span><span class="kt">uint</span><span class="p">)</span> <span class="n">ActualWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="n">ActualHeight</span><span class="p">),</span>
                        <span class="n">D2D</span><span class="p">.</span><span class="n">PresentOptions</span><span class="p">.</span><span class="n">RetainContents</span><span class="p">));</span>

                <span class="n">_redBrush</span> <span class="p">=</span> <span class="n">renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>

                <span class="n">_greenBrush</span> <span class="p">=</span> <span class="n">renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>

                <span class="n">_blueBrush</span> <span class="p">=</span> <span class="n">renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>

                <span class="n">_renderTarget</span> <span class="p">=</span> <span class="n">renderTarget</span><span class="p">;</span>

                <span class="n">_d2DFactory</span> <span class="p">=</span> <span class="n">d2DFactory</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="strokestyleproperties">StrokeStyleProperties</h2>

<p>å…³äº StrokeStyleProperties éœ€è¦è¯´ä¸€ä¸‹ï¼Œå°±æ˜¯å„ä¸ªå‚æ•°ã€‚</p>

<p>ä»åå­—å¯ä»¥çœ‹åˆ° StartCap å’Œ EndCap å°±æ˜¯çº¿æ®µçš„ä¸¤ç«¯çš„å›¾å½¢ï¼Œå¯ä»¥é€‰çš„å‚æ•°</p>

<ul>
  <li>Flat</li>
  <li>Square</li>
  <li>Round</li>
  <li>Triangle</li>
</ul>

<p>å…·ä½“è¡¨ç¤ºæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä¼šä½¿ç”¨ä¸‹é¢çš„ä¾‹å­</p>

<h3 id="flat">Flat</h3>

<p>å¹³çš„</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">strokeStyleProperties</span> <span class="p">=</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">StrokeStyleProperties</span><span class="p">();</span>

            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">StartCap</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">CapStyle</span><span class="p">.</span><span class="n">Flat</span><span class="p">;</span>
            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">EndCap</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">CapStyle</span><span class="p">.</span><span class="n">Flat</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">strokeStyle</span> <span class="p">=</span> <span class="n">_d2DFactory</span><span class="p">.</span><span class="nf">CreateStrokeStyle</span><span class="p">(</span><span class="n">strokeStyleProperties</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">10</span><span class="p">),</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">10</span><span class="p">),</span> <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span><span class="m">2</span><span class="p">,</span> <span class="n">strokeStyle</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>
</code></pre></div></div>

<p><img src="http://image.acmx.xyz/lindexi%2F20184191145368673.jpg" alt="" /></p>

<h3 id="round">Round</h3>

<p>åœ†çš„</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       <span class="kt">float</span> <span class="n">h</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>

            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">StartCap</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">CapStyle</span><span class="p">.</span><span class="n">Round</span><span class="p">;</span>
            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">EndCap</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">CapStyle</span><span class="p">.</span><span class="n">Round</span><span class="p">;</span>
            <span class="n">strokeStyle</span> <span class="p">=</span> <span class="n">_d2DFactory</span><span class="p">.</span><span class="nf">CreateStrokeStyle</span><span class="p">(</span><span class="n">strokeStyleProperties</span><span class="p">);</span>

            <span class="n">h</span> <span class="p">+=</span> <span class="m">20</span><span class="p">;</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span> <span class="m">5</span><span class="p">,</span> <span class="n">strokeStyle</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>
</code></pre></div></div>

<p><img src="http://image.acmx.xyz/lindexi%2F2018419114895088.jpg" alt="" /></p>

<h3 id="square">Square</h3>

<p>æ–¹å½¢</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">StartCap</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">CapStyle</span><span class="p">.</span><span class="n">Square</span><span class="p">;</span>
            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">EndCap</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">CapStyle</span><span class="p">.</span><span class="n">Square</span><span class="p">;</span>
            <span class="n">strokeStyle</span> <span class="p">=</span> <span class="n">_d2DFactory</span><span class="p">.</span><span class="nf">CreateStrokeStyle</span><span class="p">(</span><span class="n">strokeStyleProperties</span><span class="p">);</span>

            <span class="n">h</span> <span class="p">+=</span> <span class="m">20</span><span class="p">;</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span> <span class="m">5</span><span class="p">,</span> <span class="n">strokeStyle</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>
</code></pre></div></div>

<p><img src="http://image.acmx.xyz/lindexi%2F2018419115013995.jpg" alt="" /></p>

<h3 id="triangle">Triangle</h3>

<p>ä¸‰è§’å½¢</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">StartCap</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">CapStyle</span><span class="p">.</span><span class="n">Triangle</span><span class="p">;</span>
            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">EndCap</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">CapStyle</span><span class="p">.</span><span class="n">Triangle</span><span class="p">;</span>
            <span class="n">strokeStyle</span> <span class="p">=</span> <span class="n">_d2DFactory</span><span class="p">.</span><span class="nf">CreateStrokeStyle</span><span class="p">(</span><span class="n">strokeStyleProperties</span><span class="p">);</span>

            <span class="n">h</span> <span class="p">+=</span> <span class="m">20</span><span class="p">;</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span> <span class="m">5</span><span class="p">,</span> <span class="n">strokeStyle</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>
</code></pre></div></div>

<p><img src="http://image.acmx.xyz/lindexi%2F201841911520144.jpg" alt="" /></p>

<h3 id="dashstyle">DashStyle</h3>

<p>å¦‚æœéœ€è¦ç”»è™šçº¿å°±å¯ä»¥ä½¿ç”¨ DashStyle ï¼Œè™šçº¿æ˜¾ç¤ºå°±æ˜¯ä½¿ç”¨ CapStyle</p>

<p><img src="http://image.acmx.xyz/lindexi%2F20184191158581837.jpg" alt="" /></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">DashStyle</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">DashStyle</span><span class="p">.</span><span class="n">DashDot</span><span class="p">;</span>
            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">DashCap</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">CapStyle</span><span class="p">.</span><span class="n">Square</span><span class="p">;</span>
            <span class="n">strokeStyleProperties</span><span class="p">.</span><span class="n">DashOffset</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>

            <span class="n">h</span> <span class="p">+=</span> <span class="m">20</span><span class="p">;</span>

            <span class="n">strokeStyle</span> <span class="p">=</span> <span class="n">_d2DFactory</span><span class="p">.</span><span class="nf">CreateStrokeStyle</span><span class="p">(</span><span class="n">strokeStyleProperties</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span> <span class="m">5</span><span class="p">,</span> <span class="n">strokeStyle</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>
</code></pre></div></div>

<p>å¤§å®¶è‡ªå·±è¯•ä¸€è¯•å°±çŸ¥é“</p>

<p>é‡Œé¢è¿˜æœ‰å±æ€§ LineJoin è¿™ä¸ªä¸æ˜¯çº¿æ®µå¯ä»¥åšçš„ï¼Œæ˜¯æŠ˜çº¿æ‰å¯ä»¥ä½¿ç”¨ï¼Œè¡¨ç¤ºä¸¤ä¸ªçº¿æ®µå¦‚ä½•é“¾æ¥</p>

<h2 id="çŸ©å½¢">çŸ©å½¢</h2>

<p>ç”»çŸ©å½¢ä½¿ç”¨ DrawRectangle ï¼Œå‚æ•°éœ€è¦ä¼ å…¥ RectF éœ€è¦ä¼ å…¥ä¸Šä¸‹å·¦å³çš„æµ®ç‚¹æ•°ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawRectangle</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">RectF</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="n">brush</span><span class="p">,</span> <span class="m">10</span><span class="p">);</span>

</code></pre></div></div>

<p>çŸ©å½¢æœ‰ä¸¤ä¸ªé‡è½½</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">void</span> <span class="nf">DrawRectangle</span><span class="p">(</span><span class="n">RectF</span> <span class="n">rect</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">brush</span><span class="p">,</span> <span class="kt">float</span> <span class="n">strokeWidth</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">unsafe</span> <span class="k">void</span> <span class="nf">DrawRectangle</span><span class="p">(</span><span class="n">RectF</span> <span class="n">rect</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">brush</span><span class="p">,</span> <span class="kt">float</span> <span class="n">strokeWidth</span><span class="p">,</span> <span class="n">StrokeStyle</span> <span class="n">strokeStyle</span><span class="p">)</span>
</code></pre></div></div>

<p>çŸ©å½¢çš„ StrokeStyle å’Œçº¿æ®µä¸€æ ·ã€‚</p>

<p><img src="http://image.acmx.xyz/lindexi%2F20184191445547057.jpg" alt="" /></p>

<h2 id="æ¤­åœ†">æ¤­åœ†</h2>

<p>å®é™…ä¸Šç”»åœ†å’Œæ¤­åœ†æ˜¯ä¸€æ ·çš„ï¼Œç”»åœ†çš„å‡½æ•°æœ‰ä¸¤ä¸ªé‡è½½</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">void</span> <span class="nf">DrawEllipse</span><span class="p">(</span><span class="n">Ellipse</span> <span class="n">ellipse</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">brush</span><span class="p">,</span> <span class="kt">float</span> <span class="n">strokeWidth</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">unsafe</span> <span class="k">void</span> <span class="nf">DrawEllipse</span><span class="p">(</span><span class="n">Ellipse</span> <span class="n">ellipse</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">brush</span><span class="p">,</span> <span class="kt">float</span> <span class="n">strokeWidth</span><span class="p">,</span> <span class="n">StrokeStyle</span> <span class="n">strokeStyle</span><span class="p">)</span>
</code></pre></div></div>

<p>éœ€è¦å…ˆåˆ›å»º Ellipse å’Œç¬”åˆ·ã€‚</p>

<p>åˆ›å»º Ellipse éœ€è¦ç»™åœ†å¿ƒå’Œä¸¤ä¸ªè½´ï¼Œä¸‹é¢åˆ›å»ºä¸€ä¸ªåœ†å¿ƒåœ¨ (100,100) ï¼Œä¸¤ä¸ªè½´éƒ½æ˜¯50çš„æ¤­åœ†ã€‚å®é™…ä¸Šå°±æ˜¯åŠå¾„æ˜¯50çš„åœ†å½¢ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">ellipse</span> <span class="p">=</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Ellipse</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="m">50</span><span class="p">,</span> <span class="m">50</span><span class="p">);</span>

</code></pre></div></div>

<p><img src="http://image.acmx.xyz/lindexi%2F2018419145042837.jpg" alt="" /></p>

<p>è¿™å°±æ˜¯ç»˜åˆ¶åŸºæœ¬çš„å›¾å½¢ã€‚</p>

<p>é‚£ä¹ˆå¦‚ä½•å¡«å……å›¾å½¢ï¼Ÿå®é™…ä¸Šæ‰€æœ‰ Draw éƒ½æœ‰å¯¹åº”çš„ Fill å‡½æ•°ï¼Œé™¤äº†çº¿æ®µã€‚æ‰€ä»¥å¡«å……å°±æ˜¯è°ƒç”¨å¯¹åº”çš„ Fill å‡½æ•°ã€‚</p>

<p>å°è¯•è¿è¡Œç¨‹åºï¼Œçœ‹çœ‹è¿™æ—¶çš„ CPU ï¼Œå®é™…ä¸Šæ˜¯å‡ ä¹ä¸ä¼šåŠ¨ï¼Œå› ä¸ºæ‰€æœ‰çš„è®¡ç®—éƒ½åœ¨ GPU è®¡ç®—ã€‚ä¸è¿‡ç¨‹åºé‡Œçš„ä»£ç åŒ…æ‹¬åˆ›å»ºå›¾å½¢ï¼Œå®é™…ä¸Šæ˜¯åœ¨ CPU åˆ›å»ºï¼Œä½†æ˜¯å› ä¸ºé€Ÿåº¦å¾ˆå¿«ï¼Œå‡ ä¹ä¸éœ€è¦è®¡ç®—ï¼Œæ‰€ä»¥éœ€è¦çš„æ—¶é—´å¾ˆçŸ­ã€‚</p>

<h2 id="æ–‡å­—">æ–‡å­—</h2>

<p>æœ€åå°±æ˜¯å‘Šè¯‰å¤§å®¶å¦‚ä½•ç»˜åˆ¶æ–‡å­—ã€‚</p>

<p>ç»˜åˆ¶æ–‡å­—éœ€è¦ä½¿ç”¨ DirectWrite ï¼Œéœ€è¦å…ˆåˆ›å»º DWriteFactory ç„¶åæ‰å¯ä»¥ç»˜åˆ¶æ–‡æœ¬ã€‚</p>

<p>ç»˜åˆ¶æ–‡æœ¬æœ‰å¤šä¸ªæ–¹å¼ï¼Œå› ä¸ºéœ€è¦çš„å¾ˆå¤šå‚æ•°éƒ½ä¸èƒ½ç›´æ¥åˆ›å»ºéœ€è¦ä½¿ç”¨ DWriteFactory åˆ›å»ºï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆä½¿ç”¨ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">dWriteFactory</span> <span class="p">=</span> <span class="n">DWriteFactory</span><span class="p">.</span><span class="nf">CreateFactory</span><span class="p">();</span>

</code></pre></div></div>

<p>åˆ›å»ºæ–‡å­—æœ‰å¤šä¸ªæ–¹æ³•</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">DrawText</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">,</span> <span class="n">TextFormat</span> <span class="n">textFormat</span><span class="p">,</span> <span class="n">RectF</span> <span class="n">layoutRect</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">defaultForegroundBrush</span><span class="p">)</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">DrawText</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">,</span> <span class="n">TextFormat</span> <span class="n">textFormat</span><span class="p">,</span> <span class="n">RectF</span> <span class="n">layoutRect</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">defaultForegroundBrush</span><span class="p">,</span> <span class="n">MeasuringMode</span> <span class="n">measuringMode</span><span class="p">)</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">DrawText</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">,</span> <span class="n">TextFormat</span> <span class="n">textFormat</span><span class="p">,</span> <span class="n">RectF</span> <span class="n">layoutRect</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">defaultForegroundBrush</span><span class="p">,</span> <span class="n">DrawTextOptions</span> <span class="n">options</span><span class="p">)</span>

<span class="k">public</span> <span class="k">unsafe</span> <span class="k">void</span> <span class="nf">DrawText</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">,</span> <span class="n">TextFormat</span> <span class="n">textFormat</span><span class="p">,</span> <span class="n">RectF</span> <span class="n">layoutRect</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">defaultForegroundBrush</span><span class="p">,</span> <span class="n">DrawTextOptions</span> <span class="n">options</span><span class="p">,</span> <span class="n">MeasuringMode</span> <span class="n">measuringMode</span><span class="p">)</span>


 <span class="k">public</span> <span class="k">unsafe</span> <span class="k">void</span> <span class="nf">DrawTextLayout</span><span class="p">(</span><span class="n">Point2F</span> <span class="n">origin</span><span class="p">,</span> <span class="n">TextLayout</span> <span class="n">textLayout</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">defaultForegroundBrush</span><span class="p">)</span>

 <span class="k">public</span> <span class="k">unsafe</span> <span class="k">void</span> <span class="nf">DrawTextLayout</span><span class="p">(</span><span class="n">Point2F</span> <span class="n">origin</span><span class="p">,</span> <span class="n">TextLayout</span> <span class="n">textLayout</span><span class="p">,</span> <span class="n">Brush</span> <span class="n">defaultForegroundBrush</span><span class="p">,</span> <span class="n">DrawTextOptions</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div></div>

<p>å› ä¸ºæœ‰å¾ˆå¤šä¸ªå‚æ•°ï¼Œéœ€è¦å¤§å®¶è‡ªå·±å»è¯•è¯•</p>

<p>ä¸‹é¢æ¥å†™å‡ºç®€å•æ–‡å­—</p>

<p><img src="https://i.loli.net/2018/04/19/5ad83f4ecdf15.gif" alt="" /></p>

<p>éœ€è¦å…ˆåˆ›å»º textFormat éœ€è¦å‘Šè¯‰ä½¿ç”¨å“ªä¸ªå­—å½¢ï¼Œå’Œå­—ä½“å¤§å°</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">textFormat</span> <span class="p">=</span> <span class="n">dWriteFactory</span><span class="p">.</span><span class="nf">CreateTextFormat</span><span class="p">(</span><span class="s">"å®‹ä½“"</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>

</code></pre></div></div>

<p>ä¸‹é¢å°±æ˜¯ç”»å‡ºæ–‡å­—ï¼Œæ–‡å­—æ¢è¡Œå¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">\n</code>ï¼Œå¤æ‚çš„æ¢è¡Œè¯·ä½¿ç”¨æ–‡å­—é‡è½½æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘å°±ä¸è¯´äº†</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s">"lindexi æœ¬æ–‡æ‰€æœ‰åšå®¢æ”¾åœ¨ lindexi.oschina.io \næ¬¢è¿å¤§å®¶æ¥è®¿é—®\n\nè¿™æ˜¯ç³»åˆ—åšå®¢ï¼Œå‘Šè¯‰å¤§å®¶å¦‚ä½•åœ¨ WPF ä½¿ç”¨Direct2D1"</span><span class="p">,</span> <span class="n">textFormat</span><span class="p">,</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">RectF</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">1000</span><span class="p">,</span> <span class="m">1000</span><span class="p">),</span> <span class="n">brush</span><span class="p">);</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>
</code></pre></div></div>

<p>éœ€è¦è¯´çš„æ˜¯ Windows API Code Pack 1.1 å·²ç»å¾ˆä¹…æ²¡æ›´æ–°ï¼Œè€Œä¸”æœ‰é”™è¯¯ï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨ <a href="http://www.sharpdx.org/">SharpDX</a></p>

<p>å‚è§ï¼š<a href="https://www.codeproject.com/Articles/113991/Using-Direct-D-with-WPF">Using Direct2D with WPF - CodeProject</a></p>

<p>https://jeremiahmorrill.wordpress.com/2011/02/14/a-critical-deep-dive-into-the-wpf-rendering-system/</p>

:ET