I"»(<p>æœ¬æ–‡å‘Šè¯‰å¤§å®¶å¦‚ä½•åœ¨ xaml ç»‘å®šå±æ€§ä½¿ç”¨æ˜¾å¼ç»§æ‰¿æ¥å£ã€‚</p>

<!--more-->

<!-- CreateTime:2018/6/15 21:07:19 -->

<p>æ—©ä¸Š<a href="https://kljzndx.github.io/My-Blog/">å¿«ä¹ å°±åœ¨ä½ çš„å¿ƒ</a>é—®äº†æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œä»–ä½¿ç”¨çš„å±æ€§æ˜¯æ˜¾å¼ç»§æ‰¿ï¼Œä½†æ˜¯æ— æ³•åœ¨xamlç»‘å®š</p>

<p>æˆ‘å†™äº†ç®€å•çš„ä»£ç ï¼Œä¸€ä¸ªæ¥å£å’Œå±æ€§</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">:</span> <span class="n">INotifyPropertyChanged</span><span class="p">,</span> <span class="n">IF1</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">string</span> <span class="n">_name</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">event</span> <span class="n">PropertyChangedEventHandler</span> <span class="n">PropertyChanged</span><span class="p">;</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnPropertyChanged</span><span class="p">([</span><span class="n">CallerMemberName</span><span class="p">]</span> <span class="kt">string</span> <span class="n">propertyName</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">PropertyChanged</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="nf">PropertyChangedEventArgs</span><span class="p">(</span><span class="n">propertyName</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="kt">string</span> <span class="n">IF1</span><span class="p">.</span><span class="n">Name</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_name</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">set</span> <span class="p">{</span> <span class="n">_name</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="nf">OnPropertyChanged</span><span class="p">();</span> <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IF1</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">set</span><span class="p">;</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>ç„¶åæˆ‘å°è¯•å†™ä¸€ä¸ªåˆ—è¡¨ï¼Œåœ¨å‰å°ç»‘å®š</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">public</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">Foo</span><span class="p">&gt;</span> <span class="n">Foo</span> <span class="p">{</span> <span class="k">set</span><span class="p">;</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">Foo</span><span class="p">&gt;()</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="nf">Foo</span><span class="p">(</span><span class="s">"jlong"</span><span class="p">){}</span>
        <span class="p">};</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">&lt;</span><span class="n">ListView</span> <span class="n">ItemsSource</span><span class="p">=</span><span class="s">"{x:Bind Foo}"</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="n">ListView</span><span class="p">.</span><span class="n">ItemTemplate</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="n">DataTemplate</span> <span class="n">x</span><span class="p">:</span><span class="n">DataType</span><span class="p">=</span><span class="s">"local:Foo"</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="n">TextBlock</span> <span class="n">Text</span><span class="p">=</span><span class="s">"{Binding Path=Name }"</span><span class="p">&gt;&lt;/</span><span class="n">TextBlock</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="n">DataTemplate</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="n">ListView</span><span class="p">.</span><span class="n">ItemTemplate</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="n">ListView</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>ä½†æ˜¯è¿™æ ·å†™å‡ºç°ç»‘å®šé”™è¯¯ï¼Œå› ä¸ºåœ¨ Foo æ˜¯æ‰¾ä¸åˆ° Name å±æ€§ï¼Œéœ€è¦ä½¿ç”¨ IF1.Name å»æ‹¿åˆ°</p>

<p>æˆ‘ä¿®æ”¹äº†ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                    <span class="p">&lt;</span><span class="n">TextBlock</span> <span class="n">Text</span><span class="p">=</span><span class="s">"{Binding (local:IF1.Name)}"</span><span class="p">&gt;&lt;/</span><span class="n">TextBlock</span><span class="p">&gt;</span>

</code></pre></div></div>

<p>ä½†æ˜¯è¿è¡Œå°±å‡ºç°äº†å¼‚å¸¸ï¼Œè¯´æœªæŒ‡å®šï¼Œæœ€åæˆ‘å°è¯•äº†æ–°çš„æ–¹æ³•ï¼Œå±…ç„¶å°±ç¼–è¯‘é€šè¿‡ï¼Œä¸‹é¢è®©æˆ‘æ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                    <span class="p">&lt;</span><span class="n">TextBlock</span> <span class="n">Text</span><span class="p">=</span><span class="s">"{x:Bind Path=(local:IF1.Name) }"</span><span class="p">&gt;&lt;/</span><span class="n">TextBlock</span><span class="p">&gt;</span>

</code></pre></div></div>

<p>å¦‚æœä½¿ç”¨æ˜¾å¼ç»§æ‰¿ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦ä½¿ç”¨ä»–çš„æ¥å£æ¥æ‹¿ï¼Œä½†æ˜¯æ¥å£ä¸æ˜¯ç›´æ¥å†™ï¼Œéœ€è¦å…ˆå†™ç©ºé—´ï¼Œä¸€èˆ¬ç©ºé—´æ˜¯å†™åœ¨æœ€ä¸Šï¼Œè¯·çœ‹ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="n">Page</span>
    <span class="n">x</span><span class="p">:</span><span class="n">Class</span><span class="p">=</span><span class="s">"JoleenOneal.MainPage"</span>
    <span class="n">xmlns</span><span class="p">=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="n">xmlns</span><span class="p">:</span><span class="n">x</span><span class="p">=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="n">xmlns</span><span class="p">:</span><span class="n">local</span><span class="p">=</span><span class="s">"using:JoleenOneal"</span>  <span class="err">è¿™æ˜¯ç©ºé—´</span>
    <span class="n">xmlns</span><span class="p">:</span><span class="n">d</span><span class="p">=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="n">xmlns</span><span class="p">:</span><span class="n">mc</span><span class="p">=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="n">mc</span><span class="p">:</span><span class="n">Ignorable</span><span class="p">=</span><span class="s">"d"</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>ç„¶åéœ€è¦åŠ ä¸Šæ‹¬å·ï¼Œæ‰å¯ä»¥ä½¿ç”¨</p>

<p>ä¸ºä»€ä¹ˆä¸Šé¢çš„ä»£ç æ— æ³•ä½¿ç”¨ï¼Œç°åœ¨æˆ‘è¿˜ä¸çŸ¥é“ã€‚</p>

<p>æˆ‘æ‰¾åˆ°äº†ä¸‹é¢çš„è§‚ç‚¹</p>

<blockquote>
  <p>The data binding team discussed adding support for interfaces a while ago but ended up not implementing it because we could not come up with a good design for it. The problem was that interfaces donâ€™t have a hierarchy like object types do. Consider the scenario where your data source implements both <code class="language-plaintext highlighter-rouge">IMyInterface1</code> and <code class="language-plaintext highlighter-rouge">IMyInterface2</code> and you have DataTemplates for both of those interfaces in the resources: which DataTemplate do you think we should pick up?</p>
</blockquote>

<blockquote>
  <p>When doing implicit data templating for object types, we first try to find a <code class="language-plaintext highlighter-rouge">DataTemplate</code> for the exact type, then for its parent, grandparent and so on. There is very well defined order of types for us to apply. When we talked about adding support for interfaces, we considered using reflection to find out all interfaces and adding them to the end of the list of types. The problem we encountered was defining the order of the interfaces when the type implements multiple interfaces.</p>
</blockquote>

<blockquote>
  <p>The other thing we had to keep in mind is that reflection is not that cheap, and this would decrease our perf a little for this scenario.</p>
</blockquote>

<blockquote>
  <p>So whatâ€™s the solution? You canâ€™t do this all in XAML, but you can do it easily with a little bit of code. The <code class="language-plaintext highlighter-rouge">ItemTemplateSelector</code> property of <code class="language-plaintext highlighter-rouge">ItemsControl</code> can be used to pick which <code class="language-plaintext highlighter-rouge">DataTemplate</code> you want to use for each item. In the <code class="language-plaintext highlighter-rouge">SelectTemplate</code> method for your template selector, you receive as a parameter the item you will template. Here, you can check for what interface it implements and return the <code class="language-plaintext highlighter-rouge">DataTemplate</code> that matches it.</p>
</blockquote>

:ET