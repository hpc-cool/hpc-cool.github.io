I"<p>å¦‚æœåšèŠå¤©å·¥å…·ï¼Œéœ€è¦æ°”æ³¡ã€‚
æœ¬æ–‡ï¼Œå¦‚æœå†™ä¸€ä¸ªæ°”æ³¡æ§ä»¶éœ€è¦å¦‚ä½•åš</p>

<!--more-->

<!-- CreateTime:2018/8/10 19:16:50 -->

<div id="toc"></div>
<!-- csdn -->
<h2 id="wpf-æ°”æ³¡">WPF æ°”æ³¡</h2>

<p>å…ˆè¯´å¦‚ä½•åœ¨ WPF åšä¸€ä¸ªæ°”æ³¡ã€‚</p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæ°”æ³¡å°±æ˜¯ä¸€ä¸ªå’Œ Grid å·®ä¸å¤šçš„ä¸œè¥¿ï¼Œåªæ˜¯æœ‰è¾¹æ¡†ï¼Œè¾¹æ¡†æ˜¯ä¸€ä¸ªæ°”æ³¡</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F201755145936.jpg" alt="" /></p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F2017551502.jpg" alt="" /></p>

<p>å¦‚ä½•å»å†™ä¸€ä¸ªå¤–æ¡†ï¼Ÿ</p>

<p>å¯ä»¥æ–°å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿ Decorator ï¼Œå°±å¯ä»¥å•¦</p>

<p>ç°åœ¨çš„éš¾ç‚¹æ˜¯å¦‚ä½•è·å¾—å­å…ƒç´ çš„å¤§å°ã€‚</p>

<p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ°”æ³¡æ˜¯å°–çš„æ°”æ³¡å’Œä¸€ä¸ªçŸ©å½¢ç»„æˆ</p>

<p>æˆ‘åšäº†ä¸€äº›ä¿®æ”¹ï¼Œå…ˆåšä¸€ä¸ªåƒè¿™æ ·çš„æ°”æ³¡</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F20175515140.jpg" alt="" /></p>

<p>æ°”æ³¡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯å°–å¤´ä¸€ä¸ªçŸ©å½¢</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F20175515350.jpg" alt="" /></p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå°–å¤´å¤§å°å¯ä»¥å›ºå®šï¼Œä½†æ˜¯çŸ©å½¢å¿…é¡»ä½¿ç”¨å­æ§ä»¶çš„å¤§å°</p>

<p>äºæ˜¯å…ˆå‡å¦‚å­å…ƒç´ çš„å®½åº¦æ˜¯100ï¼Œé«˜åº¦ 50 ï¼Œè¿™æ ·æ¥ç”»ä¸€ä¸ªæ°”æ³¡ã€‚</p>

<p>å¦‚ä½•ç”»ä¸€ä¸ªä¸‰è§’ï¼Ÿ</p>

<p>å‡è®¾å°–å¤´å®½åº¦ 10 é«˜åº¦ 5 ï¼Œé‚£ä¹ˆå¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªç‚¹æ˜¯ ï¼ˆ0ï¼Œ5ï¼‰ ç¬¬äºŒä¸ªç‚¹æ˜¯ ï¼ˆ5ï¼Œ0ï¼‰ ç¬¬ä¸‰ä¸ªç‚¹æ˜¯ ï¼ˆ10ï¼Œ5ï¼‰</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F201755165744.jpg" alt="" /></p>

<p>éœ€è¦çŸ¥é“ï¼Œ WPF ä½¿ç”¨çš„å¸ƒå±€ä¸æ˜¯å’Œä»¥å‰è¯¾æœ¬è¯´çš„ä¸€æ ·</p>

<p>ä½†æ˜¯é™¤äº†å°–å¤´ï¼Œè¿˜éœ€è¦æ·»åŠ çŸ©å½¢çš„è·ç¦»</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F20175517242.jpg" alt="" /></p>

<p>æ·»åŠ çš„è·ç¦»æ˜¯çŸ©å½¢å®½åº¦çš„ä¸€åŠå‡å»5ï¼Œçœ‹åˆ°è¿™é‡Œä¸€èˆ¬ä¸ä¼šè§‰å¾—æœ‰å›°éš¾ã€‚</p>

<p>äºæ˜¯æ·»åŠ åˆ°å®é™…çš„å€¼ï¼Œè¿™é‡ŒçŸ©å½¢å®½åº¦ä¸º 100 äºæ˜¯æœ€åçš„å€¼å°±æ˜¯ ï¼ˆ45ï¼Œ5ï¼‰ ï¼Œç¬¬äºŒä¸ªç‚¹æ˜¯ ï¼ˆ50ï¼Œ0ï¼‰ ç¬¬ä¸‰ä¸ªç‚¹æ˜¯ ï¼ˆ55ï¼Œ5ï¼‰</p>

<p>æ¥ä¸‹æ¥å°±æ˜¯è®¡ç®—çŸ©å½¢çš„å€¼ï¼ŒçŸ©å½¢çš„å€¼å°±æ˜¯ x=0 y=5 ï¼Œå®½åº¦ 100 é«˜åº¦ 50</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F20175517557.jpg" alt="" /></p>

<p>è®¡ç®—å‡ºæ¥ï¼Œå°±éœ€è¦ç”»å‡ºæ¥ã€‚</p>

<p>PathFigure å¯ä»¥ç”»çº¿ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä»–ç»™ä»–ä¸‰ä¸ªç‚¹å°±å¥½</p>

<p>æŠŠä¸Šé¢çš„å‡ ä¸ªç‚¹å†™å‡ºæ¥</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                            <span class="k">new</span> <span class="n">PathFigure</span>
                            <span class="p">{</span>
                                <span class="n">IsClosed</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                                <span class="n">StartPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">45</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span>
                                <span class="n">Segments</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PathSegmentCollection</span><span class="p">()</span>
                                <span class="p">{</span>
                                    <span class="k">new</span> <span class="nf">LineSegment</span><span class="p">(</span><span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">50</span><span class="p">),</span> <span class="m">0</span><span class="p">),</span> <span class="k">true</span><span class="p">),</span>
                                    <span class="k">new</span> <span class="nf">LineSegment</span><span class="p">(</span><span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">55</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> <span class="k">true</span><span class="p">)</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
</code></pre></div></div>

<p>ä½†éœ€è¦æŠŠä¸‰è§’åŠ åˆ° PathGeometry æ‰å¯ä»¥æ˜¾ç¤º</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    
                    <span class="n">Geometry1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PathGeometry</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Figures</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PathFigureCollection</span><span class="p">()</span>
                        <span class="p">{</span>
                            <span class="k">new</span> <span class="n">PathFigure</span>
                            <span class="p">{</span>
                                <span class="n">IsClosed</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                                <span class="n">StartPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">45</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span>
                                <span class="n">Segments</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PathSegmentCollection</span><span class="p">()</span>
                                <span class="p">{</span>
                                    <span class="k">new</span> <span class="nf">LineSegment</span><span class="p">(</span><span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">50</span><span class="p">),</span> <span class="m">0</span><span class="p">),</span> <span class="k">true</span><span class="p">),</span>
                                    <span class="k">new</span> <span class="nf">LineSegment</span><span class="p">(</span><span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">55</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> <span class="k">true</span><span class="p">)</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
</code></pre></div></div>

<p>è¿™æ ·å†™åœ¨ç•Œé¢pathï¼Œå¯ä»¥çœ‹åˆ°æ˜¾ç¤ºå‡ºæ¥ä¸‰è§’å½¢ï¼Œå› ä¸ºæ²¡æœ‰è®¾ç½®çº¿æ¡ï¼Œæ‰€ä»¥æ²¡æœ‰æŠŠé¼ æ ‡ç§»åˆ°ä¸‰è§’æ˜¯çœ‹ä¸åˆ°çš„</p>

<p>æ¥ç€éœ€è¦ç”»çŸ©å½¢</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                        <span class="n">Geometry2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectangleGeometry</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span>
                            <span class="m">50</span><span class="p">)</span>
                        <span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</code></pre></div></div>

<p>ä½†æ˜¯å¦‚ä½•ç›´æ¥æŠŠä¸¤ä¸ªæ˜¾ç¤ºï¼Œçœ‹èµ·æ¥æ˜¯ä¸å¯¹çš„ï¼Œå› ä¸ºæ˜¯ä¸€ä¸ªçŸ©å½¢å’Œä¸‰è§’ï¼Œä¸æ˜¯æ°”æ³¡</p>

<p>æ‰€ä»¥ç»„åˆä¸€ä¸‹å›¾å½¢å°±å¥½</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                 <span class="kt">var</span> <span class="n">cg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CombinedGeometry</span>
                <span class="p">{</span>
                    <span class="n">Geometry1</span> <span class="p">,</span>
                    <span class="n">Geometry2</span> <span class="p">,</span>
                    <span class="n">GeometryCombineMode</span> <span class="p">=</span> <span class="n">GeometryCombineMode</span><span class="p">.</span><span class="n">Xor</span>
                <span class="p">};</span>
</code></pre></div></div>

<p>ä½†æ˜¯å®é™…éœ€è¦è·å¾—å­å…ƒç´ çš„å¤§å°ï¼Œä¹Ÿéœ€è¦æ˜¾ç¤ºï¼Œé‚£ä¹ˆæ˜¾ç¤ºå¯ä»¥å…ˆé‡å†™ OnRender</p>

<p>ä» OnRender ç”»å‡ºçš„æ–¹æ³•å¾ˆç®€å•</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                <span class="n">GuidelineSet</span> <span class="n">guideLines</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GuidelineSet</span><span class="p">();</span>
                <span class="n">drawingContext</span><span class="p">.</span><span class="nf">PushGuidelineSet</span><span class="p">(</span><span class="n">guideLines</span><span class="p">);</span>
                <span class="n">drawingContext</span><span class="p">.</span><span class="nf">DrawGeometry</span><span class="p">(</span><span class="n">brush</span><span class="p">,</span> <span class="n">pen</span><span class="p">,</span> <span class="n">cg</span><span class="p">);</span>
</code></pre></div></div>
<p>å…¶ä¸­çš„ é¢œè‰²è‡ªå·±å®šä¹‰ï¼Œcgå°±æ˜¯ä¸Šé¢çš„å›¾å½¢ã€‚</p>

<p>ä½†æ˜¯è¿™æ ·çš„è‡ªå®šä¹‰æ§ä»¶éœ€è¦è®¾ç½®å®½é«˜ï¼Œå¦‚ä½•ä½¿ç”¨å­å…ƒç´ çš„å®½é«˜åŠ ä¸Šè‡ªå·±çš„paddingï¼Ÿ</p>

<p>å¦‚æœåªæ˜¯é‡æ–°æ˜¾ç¤ºï¼Œé‚£ä¹ˆç•Œé¢æ˜¯ä¸çŸ¥é“æ°”æ³¡çš„å¤§å°ï¼Œæ‰€ä»¥å¾—åˆ°çš„æ˜¯æ²¡æ˜¾ç¤ºï¼Œä¸ºäº†è®©æ°”æ³¡å¯ä»¥æ˜¾ç¤ºï¼Œå…ˆç»™ä»–ä¸€ä¸ªå®½é«˜ï¼Œè¿™æ ·å°±å¯ä»¥æ¼”ç¤ºã€‚</p>

<p>ä½†æ˜¯æˆ‘éœ€è¦ç›´æ¥å°±å†™å¦‚ä½•è·å–å­å…ƒç´ çš„å¤§å°ï¼ŒæŠŠä»–ä½œä¸ºæ°”æ³¡çš„å¤§å°ã€‚</p>

<p>è·å–å­å…ƒç´ å¯ä»¥é€šè¿‡é‡å†™ MeasureOverride</p>

<p>ç¬¬ä¸€æ­¥ï¼Œæµ‹é‡å­å…ƒç´ ï¼Œé€šè¿‡å­å…ƒç´ å¯ä»¥è·å¾—é«˜åº¦å®½åº¦</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                    <span class="n">Child</span><span class="p">.</span><span class="nf">Measure</span><span class="p">(</span><span class="n">constraint</span><span class="p">);</span>
</code></pre></div></div>

<p>å®šä¹‰è‡ªå·±çš„ padding ï¼Œè¿™ä¸ªå€¼å…ˆéšæ„ç»™ï¼Œè¡¨ç¤ºæ°”æ³¡ç¦»å…ƒç´ è·ç¦»</p>

<p>é‚£ä¹ˆè®¡ç®—å¾—åˆ°è‡ªå·±çš„å¤§å°å°±æ˜¯ å­å…ƒç´ çš„å®½é«˜åŠ ä¸Š padding åŠ ä¸Šæ°”æ³¡éœ€è¦çš„å¤–æ¡†</p>

<p>å› ä¸ºå¯¹äºé«˜åº¦ï¼Œéœ€è¦åŠ ä¸Šæ°”æ³¡çš„é«˜åº¦ 5 æ‰å¯ä»¥ï¼Œä»£ç å¾ˆå®¹æ˜“å°±çœ‹æ‡‚ï¼Œæˆ‘å°±ä¸è¯´å•¦</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">protected</span> <span class="k">override</span> <span class="n">Size</span> <span class="nf">MeasureOverride</span><span class="p">(</span><span class="n">Size</span> <span class="n">constraint</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Thickness</span> <span class="n">padding</span> <span class="p">=</span> <span class="n">Padding</span><span class="p">;</span>
            <span class="n">Size</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Size</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Child</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//æµ‹é‡å­æ§ä»¶çš„å¤§å°</span>
                <span class="n">Child</span><span class="p">.</span><span class="nf">Measure</span><span class="p">(</span><span class="n">constraint</span><span class="p">);</span>

                <span class="n">result</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="n">Child</span><span class="p">.</span><span class="n">DesiredSize</span><span class="p">.</span><span class="n">Width</span> <span class="p">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">Left</span> <span class="p">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
                <span class="n">result</span><span class="p">.</span><span class="n">Height</span> <span class="p">=</span> <span class="n">Child</span><span class="p">.</span><span class="n">DesiredSize</span><span class="p">.</span><span class="n">Height</span> <span class="p">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">Top</span> <span class="p">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">+</span> <span class="m">5</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æ‹¿åˆ°äº†å­æ§ä»¶çš„é«˜åº¦ï¼Œè¿˜éœ€è¦é‡å†™è‡ªå·±çš„å¸ƒå±€</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">protected</span> <span class="k">override</span> <span class="n">Size</span> <span class="nf">ArrangeOverride</span><span class="p">(</span><span class="n">Size</span> <span class="n">arrangeSize</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Thickness</span> <span class="n">padding</span> <span class="p">=</span> <span class="n">Padding</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Child</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Size</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Size</span><span class="p">();</span>
                <span class="n">Child</span><span class="p">.</span><span class="nf">Arrange</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="n">padding</span><span class="p">.</span><span class="n">Left</span><span class="p">,</span> <span class="m">5</span> <span class="p">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">Top</span><span class="p">),</span> <span class="n">Child</span><span class="p">.</span><span class="n">DesiredSize</span><span class="p">));</span>
                <span class="n">result</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="n">Child</span><span class="p">.</span><span class="n">DesiredSize</span><span class="p">.</span><span class="n">Width</span> <span class="p">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">Left</span> <span class="p">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
                <span class="n">result</span><span class="p">.</span><span class="n">Height</span> <span class="p">=</span> <span class="n">Child</span><span class="p">.</span><span class="n">DesiredSize</span><span class="p">.</span><span class="n">Height</span> <span class="p">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">Top</span> <span class="p">+</span> <span class="n">padding</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">+</span> <span class="m">5</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">arrangeSize</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>
<p>è¿™é‡Œå‡ºç°å¾ˆå¤šä¸ª 5 ï¼Œæ„æ€å°±æ˜¯æ°”æ³¡é«˜åº¦ï¼Œä¸ºäº†è®¾ç½®æ°”æ³¡é«˜åº¦ï¼Œæ‰€ä»¥ç»™ä»–ä¸€ä¸ªå±æ€§ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         <span class="k">public</span> <span class="kt">double</span> <span class="n">HeadHeight</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">HeadHeightProperty</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="nf">SetValue</span><span class="p">(</span><span class="n">HeadHeightProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

         <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     æ ‡è¯† &lt;see cref="HeadHeight" /&gt; çš„ä¾èµ–é¡¹å±æ€§ã€‚</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">HeadHeightProperty</span> <span class="p">=</span> <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span>
            <span class="s">"HeadHeight"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">PeakedAdorner</span><span class="p">),</span> <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="m">5d</span><span class="p">));</span>
</code></pre></div></div>

<p>ç°åœ¨å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼Œè®©ä»–å¯ä»¥è‡ªåŠ¨é€‚åº”</p>

<p>çŸ©å½¢çš„å®½é«˜å¯ä»¥é€šè¿‡è‡ªå·±çš„å¤§å°è®¡ç®—</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">Geometry2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectangleGeometry</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">HeadHeight</span><span class="p">,</span> <span class="n">ActualWidth</span><span class="p">,</span>
                            <span class="n">ActualHeight</span> <span class="p">-</span> <span class="n">HeadHeight</span><span class="p">)</span>
                        <span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ° åæ ‡æ²¡æœ‰å˜åŒ–ï¼Œæœ‰å˜åŒ–çš„æ˜¯é«˜åº¦ï¼Œå®½åº¦ï¼Œå¯ä»¥é€šè¿‡è·å¾—è‡ªå·±çš„å¤§å°è®¾ç½®ï¼Œå› ä¸ºåœ¨è®¡ç®—å¤§å°å·²ç»ä»å­å…ƒç´ åŠ ä¸Šè‡ªå·±çš„éœ€è¦å¤§å°ï¼Œæ‰€ä»¥å¾—åˆ°çš„å¤§å°å¯ä»¥è®¾ç½®</p>

<p>é‚£ä¹ˆç°åœ¨çš„ OnRender å¯ä»¥å†™ä¸º</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnRender</span><span class="p">(</span><span class="n">DrawingContext</span> <span class="n">drawingContext</span><span class="p">)</span>
        <span class="p">{</span>
           
            
                <span class="n">Pen</span> <span class="n">pen</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Pen</span><span class="p">();</span>
                <span class="n">pen</span><span class="p">.</span><span class="n">Brush</span> <span class="p">=</span> <span class="n">BorderBrush</span><span class="p">;</span>
                <span class="n">pen</span><span class="p">.</span><span class="n">Thickness</span> <span class="p">=</span> <span class="n">BorderThickness</span><span class="p">;</span>

                <span class="kt">var</span> <span class="n">leftpad</span> <span class="p">=</span> <span class="p">(</span><span class="n">ActualWidth</span> <span class="p">-</span> <span class="n">HeadWidth</span><span class="p">)</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">cg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CombinedGeometry</span>
                <span class="p">{</span>
                    <span class="n">Geometry1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PathGeometry</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Figures</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PathFigureCollection</span><span class="p">()</span>
                        <span class="p">{</span>
                            <span class="k">new</span> <span class="n">PathFigure</span>
                            <span class="p">{</span>
                                <span class="n">IsClosed</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                                <span class="n">StartPoint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="n">leftpad</span><span class="p">,</span> <span class="n">HeadHeight</span><span class="p">),</span>
                                <span class="n">Segments</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PathSegmentCollection</span><span class="p">()</span>
                                <span class="p">{</span>
                                    <span class="k">new</span> <span class="nf">LineSegment</span><span class="p">(</span><span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="n">leftpad</span> <span class="p">+</span> <span class="p">(</span><span class="n">HeadWidth</span> <span class="p">/</span> <span class="m">2</span><span class="p">),</span> <span class="m">0</span><span class="p">),</span> <span class="k">true</span><span class="p">),</span>
                                    <span class="k">new</span> <span class="nf">LineSegment</span><span class="p">(</span><span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="n">leftpad</span> <span class="p">+</span> <span class="n">HeadWidth</span><span class="p">,</span> <span class="n">HeadHeight</span><span class="p">),</span> <span class="k">true</span><span class="p">)</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="n">Geometry2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RectangleGeometry</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">HeadHeight</span><span class="p">,</span> <span class="n">ActualWidth</span><span class="p">,</span>
                            <span class="n">ActualHeight</span> <span class="p">-</span> <span class="n">HeadHeight</span><span class="p">)</span>
                        <span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
                    <span class="n">GeometryCombineMode</span> <span class="p">=</span> <span class="n">GeometryCombineMode</span><span class="p">.</span><span class="n">Xor</span>
                <span class="p">};</span>


                <span class="n">GuidelineSet</span> <span class="n">guideLines</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GuidelineSet</span><span class="p">();</span>
                <span class="n">drawingContext</span><span class="p">.</span><span class="nf">PushGuidelineSet</span><span class="p">(</span><span class="n">guideLines</span><span class="p">);</span>
                <span class="n">drawingContext</span><span class="p">.</span><span class="nf">DrawGeometry</span><span class="p">(</span><span class="n">Background</span><span class="p">,</span> <span class="n">pen</span><span class="p">,</span> <span class="n">cg</span><span class="p">);</span>
            
        <span class="p">}</span>

</code></pre></div></div>

<p>BorderBrush ä¹Ÿæ˜¯è‡ªå·±è®¾ç½®çš„ ï¼ŒBorderThickness ä¹Ÿæ˜¯ï¼Œäºæ˜¯ç»§ç»­è®¾ç½®èƒŒæ™¯è‰²  Background å’Œå…¶å®ƒçš„å¦‚åœ†è§’</p>

<p>ç°åœ¨çœ‹èµ·æ¥çš„å±æ€§æ˜¯</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">BackgroundProperty</span> <span class="p">=</span>
            <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="s">"Background"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Brush</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">PeakedAdorner</span><span class="p">)</span>
                <span class="p">,</span> <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="nf">FromRgb</span><span class="p">(</span><span class="m">255</span><span class="p">,</span> <span class="m">255</span><span class="p">,</span> <span class="m">255</span><span class="p">))));</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">PaddingProperty</span> <span class="p">=</span>
            <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="s">"Padding"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Thickness</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">PeakedAdorner</span><span class="p">)</span>
                <span class="p">,</span> <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="k">new</span> <span class="nf">Thickness</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">5</span><span class="p">)));</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">BorderBrushProperty</span> <span class="p">=</span>
            <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="s">"BorderBrush"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Brush</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">PeakedAdorner</span><span class="p">)</span>
                <span class="p">,</span> <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Black</span><span class="p">)));</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">BorderThicknessProperty</span> <span class="p">=</span>
            <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="s">"BorderThickness"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">PeakedAdorner</span><span class="p">),</span>
                <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="m">1d</span><span class="p">));</span>


        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     æ ‡è¯† &lt;see cref="HeadWidth" /&gt; çš„ä¾èµ–é¡¹å±æ€§ã€‚</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">HeadWidthProperty</span> <span class="p">=</span> <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span>
            <span class="s">"HeadWidth"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">PeakedAdorner</span><span class="p">),</span> <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="m">0d</span><span class="p">));</span>


        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     æ ‡è¯† &lt;see cref="HeadHeight" /&gt; çš„ä¾èµ–é¡¹å±æ€§ã€‚</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">HeadHeightProperty</span> <span class="p">=</span> <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span>
            <span class="s">"HeadHeight"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">PeakedAdorner</span><span class="p">),</span> <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="m">5d</span><span class="p">));</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">CornerRadiusProperty</span> <span class="p">=</span>
            <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="s">"CornerRadius"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">CornerRadius</span><span class="p">)</span>
                <span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">PeakedAdorner</span><span class="p">),</span> <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="k">new</span> <span class="nf">CornerRadius</span><span class="p">(</span><span class="m">0</span><span class="p">)));</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     èƒŒæ™¯è‰²</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="n">Brush</span> <span class="n">Background</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">Brush</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">BackgroundProperty</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="nf">SetValue</span><span class="p">(</span><span class="n">BackgroundProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     å†…è¾¹è·</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="n">Thickness</span> <span class="n">Padding</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">Thickness</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">PaddingProperty</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="nf">SetValue</span><span class="p">(</span><span class="n">PaddingProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è¾¹æ¡†é¢œè‰²</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="n">Brush</span> <span class="n">BorderBrush</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">Brush</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">BorderBrushProperty</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="nf">SetValue</span><span class="p">(</span><span class="n">BorderBrushProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è¾¹æ¡†å¤§å°</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="kt">double</span> <span class="n">BorderThickness</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">BorderThicknessProperty</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="nf">SetValue</span><span class="p">(</span><span class="n">BorderThicknessProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è·å–æˆ–è®¾ç½®å°–è§’width</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="kt">double</span> <span class="n">HeadWidth</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">HeadWidthProperty</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="nf">SetValue</span><span class="p">(</span><span class="n">HeadWidthProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è·å–æˆ–è®¾ç½®å°–è§’</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="kt">double</span> <span class="n">HeadHeight</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">HeadHeightProperty</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="nf">SetValue</span><span class="p">(</span><span class="n">HeadHeightProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è¾¹æ¡†å¤§å°</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="n">CornerRadius</span> <span class="n">CornerRadius</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">CornerRadius</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">CornerRadiusProperty</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="nf">SetValue</span><span class="p">(</span><span class="n">CornerRadiusProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

</code></pre></div></div>

<p>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="p">&lt;</span><span class="n">local</span><span class="p">:</span><span class="n">PeakedAdorner</span> <span class="n">CornerRadius</span><span class="p">=</span><span class="s">"5"</span> <span class="n">Margin</span><span class="p">=</span><span class="s">"0,0,0.4,-0.2"</span> <span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="n">TextBlock</span> <span class="n">Text</span><span class="p">=</span><span class="s">"æ—å¾·ç†™"</span><span class="p">&gt;&lt;/</span><span class="n">TextBlock</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="n">local</span><span class="p">:</span><span class="n">PeakedAdorner</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>è¿™æ ·å°±å¥½äº†ï¼Œé‡Œé¢çš„æ§ä»¶å¯ä»¥æ˜¯ä»»ä½•çš„ï¼Œä½ æƒ³è¦çš„ï¼Œå¦‚Grid ï¼ŒtextBox</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F20175517277.jpg" alt="" /></p>

<p>ç°åœ¨çœ‹èµ·æ¥å°±æ˜¯è¿™æ ·</p>

<p>è¿™æ ·å°±åšå¥½æ°”æ³¡ï¼Œå¦‚æœéœ€è¦æ°”æ³¡æ˜¾ç¤ºåœ¨å…¶ä»–çš„ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è‡ªå·±è®¡ç®—ï¼Œæ‰€æœ‰çš„å€¼éœ€è¦æ”¾åœ¨å“ª</p>

:ET