I"ıD<p>æœ¬æ–‡å‘Šè¯‰å¤§å®¶å¦‚ä½•ä½¿ç”¨ Windows Community Toolkit çš„æ–°æ§ä»¶ï¼Œåœ¨ WPF ä½¿ç”¨ Edge æµè§ˆå™¨</p>

<!--more-->

<!-- CreateTime:2018/8/13 15:33:05 -->

<p>é¦–å…ˆéœ€è¦é€šè¿‡ VisualStudio åˆ›å»º WPF é¡¹ç›®ã€‚å› ä¸º  Microsoft.Toolkit.Win32.UI.Controls åº“åªæ”¯æŒ 4.6.2 ä»¥ä¸Šï¼Œæ‰€ä»¥éœ€è¦é€‰æ‹©æ¡†æ¶å¤§äº 4.6.2</p>

<p>æ‰“å¼€ Nuget å®‰è£… Microsoft.Toolkit.Win32.UI.Controls ï¼Œéœ€è¦åŒæ„è®¸å¯</p>

<p><img src="http://image.acmx.xyz/lindexi%2F201861174809142.jpg" alt="" /></p>

<!-- ![](image/WPF ä½¿ç”¨ Edge æµè§ˆå™¨/WPF ä½¿ç”¨ Edge æµè§ˆå™¨0.png) -->
<p><img src="http://image.acmx.xyz/lindexi%2F2018611747372558.jpg" alt="" /></p>

<p>æ‰“å¼€ä¸»é¡µé¢ï¼Œåœ¨ xaml æ·»åŠ ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">xmlns</span><span class="p">:</span><span class="n">wpf</span><span class="p">=</span><span class="s">"clr-namespace:Microsoft.Toolkit.Win32.UI.Controls.WPF;assembly=Microsoft.Toolkit.Win32.UI.Controls"</span> 
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">&lt;</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"WebView"</span><span class="p">&gt;&lt;/</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>åœ¨ä»£ç è·³è½¬åˆ°æˆ‘çš„åšå®¢</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>

            <span class="n">WebView</span><span class="p">.</span><span class="nf">Navigate</span><span class="p">(</span><span class="s">"https://lindexi.gitee.io"</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>è¿è¡Œä¸€ä¸‹è½¯ä»¶</p>

<!-- ![](image/WPF ä½¿ç”¨ Edge æµè§ˆå™¨/WPF ä½¿ç”¨ Edge æµè§ˆå™¨1.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F201861175161261.jpg" alt="" /></p>

<p>å¦‚æœä¸æƒ³åœ¨ xaml å†™ä»»ä½•çš„ä»£ç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢ä»£ç æ·»åŠ </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">webView</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WebView</span><span class="p">();</span>
            <span class="n">webView</span><span class="p">.</span><span class="nf">Navigate</span><span class="p">(</span><span class="s">"https://lindexi.gitee.io"</span><span class="p">);</span>
            <span class="n">Content</span> <span class="p">=</span> <span class="n">webView</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>

<ul>
  <li>
    <p>è§¦æ‘¸éå¸¸æµç•…</p>
  </li>
  <li>
    <p>åŠ è½½é¡µé¢éå¸¸å¿«</p>
  </li>
  <li>
    <p>ç¼©æ”¾é¡µé¢å‡ ä¹ä¸ä½¿ç”¨CPU</p>
  </li>
  <li>
    <p>å¯¹äºå¾ˆå¤šå›¾ç‰‡çš„æ—¶å€™ä½¿ç”¨å†…å­˜å¾ˆå°</p>
  </li>
  <li>
    <p>å¯ä»¥ä½¿ç”¨ RenderTransform ä¿®æ”¹æ˜¾ç¤ºï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„å˜æ¢éƒ½å¯ä»¥ä½¿ç”¨</p>
  </li>
  <li>
    <p>å¯ä»¥è¿›è¡Œå¸ƒå±€ï¼Œå¦‚ä¸‹å›¾ï¼Œä½¿ç”¨Gridåˆ†å¼€æŒ‰é’®</p>
  </li>
</ul>

<p><!-- ![](image/WPF ä½¿ç”¨ Edge æµè§ˆå™¨/WPF ä½¿ç”¨ Edge æµè§ˆå™¨4.png) --></p>

<p><img src="http://image.acmx.xyz/lindexi%2F201862105019597" alt="" /></p>

<h2 id="å­˜åœ¨çš„é—®é¢˜">å­˜åœ¨çš„é—®é¢˜</h2>

<ul>
  <li>
    <p>åƒæ‰äº† Touch äº‹ä»¶ã€MouseDownäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯åƒæ‰äº†æ‰€æœ‰ç”¨æˆ·è¾“å…¥</p>
  </li>
  <li>
    <p>ç¬¬ä¸€æ¬¡åŠ è½½æ— æ³•è¦†ç›–æ§ä»¶å¤§å°ï¼Œåœ¨ä¿®æ”¹çª—å£å¤§å°ä¹‹åæ‰å¯ä»¥</p>
  </li>
  <li>
    <p>è®¾ç½® IsEnable æ— ä½œç”¨</p>
  </li>
  <li>
    <p>è®¾ç½® IsHitTestVisible æ— ä½œç”¨ï¼Œä¾ç„¶å¯ä»¥å“åº”è¾“å…¥</p>
  </li>
  <li>
    <p>é»˜è®¤æ²¡æœ‰è®¾ç½® IsManipulationEnable ï¼Œä½†æ˜¯å¯ä»¥å“åº”æ‰‹åŠ¿</p>
  </li>
  <li>
    <p>èƒ½å¤Ÿä½¿ç”¨ snoop åœ¨è§†è§‰æ ‘æ‰¾åˆ° WebView ä½†æ˜¯æ²¡æœ‰çœ‹åˆ° WebView é‡Œé¢çš„å…ƒç´ </p>
  </li>
</ul>

<h3 id="æ— æ³•åœ¨-webview-ä¸Šé¢æ”¾æ§ä»¶">æ— æ³•åœ¨ WebView ä¸Šé¢æ”¾æ§ä»¶</h3>

<p>æˆ‘å°è¯•äº†ä¸‹é¢çš„ä»£ç ï¼Œè™½ç„¶è®¾è®¡çš„ç•Œé¢å¯ä»¥çœ‹åˆ°æŒ‰é’®ï¼Œä½†æ˜¯è¿è¡Œç•Œé¢æ²¡æœ‰æŒ‰é’®</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="p">&lt;</span><span class="n">Grid</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"Grid"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"WebView"</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">.</span><span class="n">RenderTransform</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="n">RotateTransform</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"BupeLesedaicee"</span> <span class="n">Angle</span><span class="p">=</span><span class="s">"10"</span><span class="p">&gt;&lt;/</span><span class="n">RotateTransform</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">.</span><span class="n">RenderTransform</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="n">TextBlock</span> <span class="n">Text</span><span class="p">=</span><span class="s">"æ—å¾·ç†™éƒ½æ¯”"</span><span class="p">&gt;&lt;/</span><span class="n">TextBlock</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="n">Button</span> <span class="n">Content</span><span class="p">=</span><span class="s">"ç¡®å®š"</span> 
                <span class="n">Click</span><span class="p">=</span><span class="s">"Button_OnClick"</span><span class="p">&gt;&lt;/</span><span class="n">Button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="n">Grid</span><span class="p">&gt;</span>
</code></pre></div></div>

<!-- ![](image/WPF ä½¿ç”¨ Edge æµè§ˆå™¨/WPF ä½¿ç”¨ Edge æµè§ˆå™¨2.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F201862104737741" alt="" /></p>

<p>ä½†æ˜¯è¿è¡Œçš„æ—¶å€™å°±çœ‹ä¸åˆ°æŒ‰é’®äº†ï¼Œæ‰€ä»¥å­˜åœ¨å±‚çº§é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯åœ¨08å¹´å°±æœ‰å¤§ç¥è¯´åˆ°çš„é—®é¢˜ã€‚</p>

<p>å¤§æ¦‚å°±æ˜¯å¦‚æœåŒæ—¶æœ‰å¤šä¸ªæ¸²æŸ“ï¼ŒWPF ã€ WinForms å¦‚æœä¸¤ä¸ªç»˜åˆ¶çš„çŸ©å½¢æœ‰é‡å ï¼Œé‚£ä¹ˆé‡å éƒ¨åˆ†å°±ä¸èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p>

<!-- ![](image/WPF ä½¿ç”¨ Edge æµè§ˆå™¨/WPF ä½¿ç”¨ Edge æµè§ˆå™¨3.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F201862105019597" alt="" /></p>

<p>æ— è®ºåœ¨ä»€ä¹ˆå±‚çº§æ”¾ WebView ï¼Œä»–çš„å±‚çº§éƒ½æ˜¯çª—å£æœ€é«˜</p>

<p>è¿™ä¸ªé—®é¢˜å‚è§ï¼š<a href="https://blogs.msdn.microsoft.com/dwayneneed/2013/02/26/mitigating-airspace-issues-in-wpf-applications/">Mitigating Airspace Issues In WPF Applications â€“ Presentation Source</a></p>

<p>ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯ï¼š<a href="https://github.com/chris84948/AirspaceFixer">chris84948/AirspaceFixer: AirspacePanel fixes all Airspace issues with WPF-hosted Winforms.</a></p>

<h3 id="æ—‹è½¬">æ—‹è½¬</h3>

<p>æˆ‘å°è¯•ä½¿ç”¨ä¸‹é¢çš„ä»£ç è®© WebView æ—‹è½¬ï¼Œä½†æ˜¯è®¾ç½®å€¼åªèƒ½è®©ä»–åç§»</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="p">&lt;</span><span class="n">Grid</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"Grid"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="n">Grid</span><span class="p">.</span><span class="n">ColumnDefinitions</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="n">ColumnDefinition</span> <span class="n">Width</span><span class="p">=</span><span class="s">"337*"</span><span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="n">ColumnDefinition</span> <span class="n">Width</span><span class="p">=</span><span class="s">"456*"</span><span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="n">Grid</span><span class="p">.</span><span class="n">ColumnDefinitions</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"WebView"</span> <span class="n">Grid</span><span class="p">.</span><span class="n">Column</span><span class="p">=</span><span class="s">"0"</span> <span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">.</span><span class="n">RenderTransform</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="n">RotateTransform</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"BupeLesedaicee"</span> <span class="n">Angle</span><span class="p">=</span><span class="s">"10"</span><span class="p">&gt;&lt;/</span><span class="n">RotateTransform</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">.</span><span class="n">RenderTransform</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="n">TextBlock</span> <span class="n">Grid</span><span class="p">.</span><span class="n">Column</span><span class="p">=</span><span class="s">"0"</span> <span class="n">Text</span><span class="p">=</span><span class="s">"lindexi"</span> <span class="n">HorizontalAlignment</span><span class="p">=</span><span class="s">"Center"</span> <span class="n">VerticalAlignment</span><span class="p">=</span><span class="s">"Center"</span><span class="p">&gt;&lt;/</span><span class="n">TextBlock</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="n">Button</span> <span class="n">Content</span><span class="p">=</span><span class="s">"ç¡®å®š"</span> 
                <span class="n">Click</span><span class="p">=</span><span class="s">"Button_OnClick"</span> <span class="n">Grid</span><span class="p">.</span><span class="n">Column</span><span class="p">=</span><span class="s">"1"</span> <span class="n">Margin</span><span class="p">=</span><span class="s">"10,10,10,10"</span><span class="p">&gt;&lt;/</span><span class="n">Button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="n">Grid</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>æŒ‰é’®ç‚¹å‡»çš„æ—¶å€™å°±æ·»åŠ æ—‹è½¬</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Button_OnClick</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">BupeLesedaicee</span><span class="p">.</span><span class="n">Angle</span> <span class="p">+=</span> <span class="m">5</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<!-- ![](image/WPF ä½¿ç”¨ Edge æµè§ˆå™¨/æµè§ˆå™¨2.gif) -->

<p><img src="https://i.loli.net/2018/06/02/5b12087b380ce.gif" alt="" /></p>

<h3 id="æ·»åŠ å¤šä¸ªæµè§ˆå™¨">æ·»åŠ å¤šä¸ªæµè§ˆå™¨</h3>

<p>å¦‚æœåœ¨ç›¸åŒçŸ©å½¢åŒºåŸŸæ·»åŠ å¤šä¸ªæµè§ˆå™¨ï¼Œåœ¨é€»è¾‘æ ‘ç¬¬ä¸€ä¸ªæµè§ˆå™¨æ˜¾ç¤ºåœ¨æœ€å‰</p>

<p>æˆ‘åœ¨ä»£ç æ‰“å¼€äº†æˆ‘çš„åšå®¢å’Œ<a href="https://huangtengxiao.gitee.io/">é»„è…¾éœ„</a>åšå®¢ï¼Œç»“æœå‘ç°æˆ‘çš„åšå®¢æ˜¾ç¤ºåœ¨å‰é¢</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
        <span class="p">&lt;</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"WebView"</span> <span class="n">Grid</span><span class="p">.</span><span class="n">Column</span><span class="p">=</span><span class="s">"0"</span> <span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">.</span><span class="n">RenderTransform</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="n">RotateTransform</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"BupeLesedaicee"</span> <span class="n">Angle</span><span class="p">=</span><span class="s">"10"</span><span class="p">&gt;&lt;/</span><span class="n">RotateTransform</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">.</span><span class="n">RenderTransform</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span> <span class="n">Grid</span><span class="p">.</span><span class="n">Column</span><span class="p">=</span><span class="s">"0"</span> <span class="n">Source</span><span class="p">=</span><span class="s">"https://huangtengxiao.gitee.io/"</span><span class="p">&gt;&lt;/</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span><span class="p">&gt;</span>
</code></pre></div></div>

<!-- ![](image/WPF ä½¿ç”¨ Edge æµè§ˆå™¨/WPF ä½¿ç”¨ Edge æµè§ˆå™¨6.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F20186211323328" alt="" /></p>

<p>æˆ‘å°è¯•ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Panel.ZIndex</code> ä½†æ˜¯æ— æ³•ä¿®æ”¹é¡ºåº</p>

<p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯å¯¹æ¯”ä¸€ä¸‹åŸæ¥çš„æµè§ˆå™¨å’Œæ–°çš„æµè§ˆå™¨</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">&lt;</span><span class="n">Grid</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="n">Grid</span><span class="p">.</span><span class="n">ColumnDefinitions</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="n">ColumnDefinition</span> <span class="n">Width</span><span class="p">=</span><span class="s">"337*"</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="n">ColumnDefinition</span> <span class="n">Width</span><span class="p">=</span><span class="s">"456*"</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="n">Grid</span><span class="p">.</span><span class="n">ColumnDefinitions</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="n">wpf</span><span class="p">:</span><span class="n">WebView</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"WebView"</span> <span class="n">Grid</span><span class="p">.</span><span class="n">Column</span><span class="p">=</span><span class="s">"0"</span> <span class="n">Source</span><span class="p">=</span><span class="s">"https://lindexi.gitee.io"</span> <span class="p">/&gt;</span>

        <span class="p">&lt;</span><span class="n">WebBrowser</span> <span class="n">Grid</span><span class="p">.</span><span class="n">Column</span><span class="p">=</span><span class="s">"1"</span> <span class="n">Source</span><span class="p">=</span><span class="s">"https://huangtengxiao.gitee.io/"</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="n">Grid</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°æ–°çš„æµè§ˆå™¨è¿˜æ˜¯æ¯”ä»¥å‰çš„å¥½å¾ˆå¤š</p>

<p>å‚è§ï¼š<a href="https://blog.csdn.net/lindexi_gd/article/details/80533053">Windows Community Toolkit 3.0 æ–°åŠŸèƒ½ åœ¨WinForms å’Œ WPF ä½¿ç”¨ UWP æ§ä»¶ - CSDNåšå®¢</a></p>

<p><a href="https://blogs.windows.com/msedgedev/2018/05/09/modern-webview-winforms-wpf-apps/#gUx8ACTB19D37Sdj.97">Bringing a modern WebView to your .NET WinForms and WPF Apps - Microsoft Edge Dev BlogMicrosoft Edge Dev Blog</a></p>

:ET