I"ø<p>åœ¨é»˜è®¤çš„ VisualStudio å¯ä»¥å³å‡»ä»»æ„çš„æ–‡ä»¶ï¼Œè®©è¿™ä¸ªæ–‡ä»¶åœ¨ç¼–è¯‘æ—¶å¤åˆ¶åˆ°è¾“å‡ºç›®å½•ï¼Œä½†æ˜¯è¿™ä¸ªé€‰é¡¹å°†ä¼šåœ¨å¤åˆ¶åˆ°è¾“å‡ºç›®å½•æ—¶å¸¦ä¸Šè¿™ä¸ªæ–‡ä»¶æ‰€åœ¨ VisualStudio çš„æ–‡ä»¶å¤¹ç»“æ„ã€‚æœ¬æ–‡å‘Šè¯‰å¤§å®¶å‡ ä¸ªæ–¹æ³•è®© VisualStudio çš„æ–‡ä»¶å¯ä»¥åœ¨ç¼–è¯‘æ—¶è¾“å‡ºåˆ°è‡ªå®šä¹‰çš„ä»»æ„è·¯å¾„</p>

<!--more-->

<!-- CreateTime:2020/1/19 18:08:07 -->

<h2 id="æ–‡ä»¶å¤¹åˆ°æ–‡ä»¶å¤¹">æ–‡ä»¶å¤¹åˆ°æ–‡ä»¶å¤¹</h2>

<p>å°†æ•´ä¸ªæ–‡ä»¶å¤¹å†…å®¹è¾“å‡ºåˆ°è‡ªå®šä¹‰æ–‡ä»¶å¤¹å¯ä»¥ä½¿ç”¨å†™ä¸€ä¸ª Target çš„æ–¹æ³•</p>

<p>å¦‚æˆ‘éœ€è¦å°† VisualStudio çš„ <code class="language-plaintext highlighter-rouge">dll</code> æ–‡ä»¶å¤¹çš„å†…å®¹å…¨éƒ¨è¾“å‡ºåˆ°è¾“å‡ºç›®å½•ï¼Œè€Œä¸æ˜¯è¾“å‡ºåˆ° è¾“å‡ºç›®å½•ä¸‹çš„ Dll æ–‡ä»¶å¤¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢ä»£ç </p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"CopyReferenceDll"</span> <span class="na">AfterTargets=</span><span class="s">"Build"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ItemGroup&gt;</span>
            <span class="nt">&lt;ReferenceDll</span> <span class="na">Include=</span><span class="s">"Dll\*.dll"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/ReferenceDll&gt;</span>
        <span class="nt">&lt;/ItemGroup&gt;</span>
        <span class="nt">&lt;Copy</span> <span class="na">SourceFiles=</span><span class="s">"@(ReferenceDll)"</span> <span class="na">DestinationFolder=</span><span class="s">"$(OutputPath)"</span> <span class="na">SkipUnchangedFiles=</span><span class="s">"True"</span><span class="nt">&gt;&lt;/Copy&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>
</code></pre></div></div>

<p>å°†ä¸Šé¢ä»£ç å¤åˆ¶åˆ° csproj æ–‡ä»¶é‡Œé¢ï¼Œæ”¾åœ¨ <code class="language-plaintext highlighter-rouge">&lt;/Project&gt;</code> ä¹‹å‰å°±å¯ä»¥åšåˆ°å°† VisualStudio é‡Œé¢çš„ Dll æ–‡ä»¶å¤¹çš„ <code class="language-plaintext highlighter-rouge">dll</code> æ–‡ä»¶å¤åˆ¶åˆ°è¾“å‡ºæ–‡ä»¶å¤¹</p>

<p>è‡³äºéœ€è¦è¾“å‡ºå…¶ä»–æ–‡ä»¶åˆ°å…¶ä»–æ–‡ä»¶å¤¹çš„ï¼Œçœ‹ä¸Šé¢çš„ä»£ç ä¿®æ”¹å°±å¯ä»¥äº†ï¼Œå¦‚æœä¸çŸ¥é“å¦‚ä½•ä¿®æ”¹è¯·è”ç³»æˆ‘</p>

<h2 id="ç”¨-link-ä¿®æ”¹è·¯å¾„">ç”¨ Link ä¿®æ”¹è·¯å¾„</h2>

<p>é€šè¿‡ä¿®æ”¹æ–‡ä»¶é“¾æ¥çš„åœ°å€ï¼Œè¿™ä¸ªæ–¹æ³•åªèƒ½è¾“å‡ºåˆ°è¾“å‡ºæ–‡ä»¶å¤¹å†…æŸä¸ªæ–‡ä»¶å¤¹ä¸‹</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;ItemGroup&gt;</span>
      <span class="nt">&lt;None</span> <span class="na">Update=</span><span class="s">"Dll\*.dll"</span> <span class="na">Link=</span><span class="s">"%(Filename)%(Extension)"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;CopyToOutputDirectory&gt;</span>PreserveNewest<span class="nt">&lt;/CopyToOutputDirectory&gt;</span>
      <span class="nt">&lt;/None&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<p>æ­¤æ—¶çš„ Dll æ–‡ä»¶å¤¹çš„ dll æ–‡ä»¶ï¼Œå°†ä¼šé‡æ–°é“¾æ¥åˆ° <code class="language-plaintext highlighter-rouge">*.dll</code> è·¯å¾„è€Œä¸æ˜¯ <code class="language-plaintext highlighter-rouge">Dll\*.dll</code> ä½†æ˜¯æ­¤æ—¶ä¼šåœ¨ VisualStudio çœ‹åˆ°é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹å­˜åœ¨å¾ˆå¤š dll æ–‡ä»¶</p>

<p>å¦‚æœä¸æƒ³çœ‹åˆ°è¿™äº›æ–‡ä»¶é€šè¿‡ <code class="language-plaintext highlighter-rouge">Visible</code> å±æ€§</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;ItemGroup&gt;</span>
      <span class="nt">&lt;None</span> <span class="na">Update=</span><span class="s">"Dll\*.dll"</span> <span class="na">Link=</span><span class="s">"%(Filename)%(Extension)"</span> <span class="na">Visible=</span><span class="s">"false"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;CopyToOutputDirectory&gt;</span>PreserveNewest<span class="nt">&lt;/CopyToOutputDirectory&gt;</span>
      <span class="nt">&lt;/None&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<h2 id="é€šè¿‡-contentwithtargetpath-é¡¹">é€šè¿‡ ContentWithTargetPath é¡¹</h2>

<p>å°†åŸæœ¬çš„ None æ›¿æ¢ä¸º ContentWithTargetPath é¡¹ï¼Œè¿™ä¸ªé¡¹æä¾› TargetPath å±æ€§ï¼Œè®¾ç½®è¾“å‡ºçš„æ–‡ä»¶</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;ContentWithTargetPath</span> <span class="na">Include=</span><span class="s">"Dll\*.dll"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;CopyToOutputDirectory&gt;</span>PreserveNewest<span class="nt">&lt;/CopyToOutputDirectory&gt;</span>
            <span class="nt">&lt;TargetPath&gt;</span>%(Filename)%(Extension)<span class="nt">&lt;/TargetPath&gt;</span>
        <span class="nt">&lt;/ContentWithTargetPath&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<p>è¿™ä¸ªæ–¹æ³•åº•å±‚ä¹Ÿæ˜¯è°ƒç”¨äº† Copy å‘½ä»¤</p>

<p>é€‚åˆæ–‡ä»¶åˆ°æ–‡ä»¶çš„æ–¹å¼ï¼Œå°† <code class="language-plaintext highlighter-rouge">%(Filename)%(Extension)</code> æ›¿æ¢ä¸ºå…·ä½“æ–‡ä»¶ï¼Œå¦‚å°†æŸä¸ªæ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šçš„è·¯å¾„ï¼Œè¿™æ ·å†™æ¸…çœŸå¾ˆå¤šï¼Œè¯·çœ‹ä»£ç </p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;ContentWithTargetPath</span> <span class="na">Include=</span><span class="s">"Dll\lindexi.dll"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;CopyToOutputDirectory&gt;</span>PreserveNewest<span class="nt">&lt;/CopyToOutputDirectory&gt;</span>
            <span class="nt">&lt;TargetPath&gt;</span>lindexi.dll<span class="nt">&lt;/TargetPath&gt;</span>
        <span class="nt">&lt;/ContentWithTargetPath&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<p>æœ¬æ–‡ç”¨åˆ°äº† <code class="language-plaintext highlighter-rouge">%(Filename)</code> ä»¥åŠ <code class="language-plaintext highlighter-rouge">Copy</code> å’Œ <code class="language-plaintext highlighter-rouge">Target</code> ç­‰ï¼Œè¿™äº›å¯ä»¥åœ¨æˆ‘åšå®¢çœ‹åˆ°å¦‚ä½•ä½¿ç”¨</p>

<p><a href="https://blog.lindexi.com/post/Roslyn-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-MSBuild-Copy-%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6.html">Roslyn å¦‚ä½•ä½¿ç”¨ MSBuild Copy å¤åˆ¶æ–‡ä»¶</a></p>

<p><a href="https://stackoverflow.com/questions/18743907/visual-studio-how-to-copy-to-output-directory-without-copying-the-folder-stru">c# - Visual Studio: How to â€œCopy to Output Directoryâ€ without copying the folder structure? - Stack Overflow</a></p>

:ET