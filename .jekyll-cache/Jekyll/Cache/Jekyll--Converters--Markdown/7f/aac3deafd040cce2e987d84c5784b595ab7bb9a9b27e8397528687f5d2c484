I"<p>本文来聊聊在 XP 系统里面，是如何在清空回收站的时候修改回收站图标的</p>

<!--more-->

<!-- CreateTime:2020/11/24 21:06:27 -->

<p>声明 我没有拿到微软泄露 XP 系统的源代码，以下逻辑都是我瞎说的，微软才不会写出如此逗比的代码</p>

<p>在 bitbuck.c 文件里面有 SHUpdateRecycleBinIcon 的实际实现，而这个方法实际上只是调用了 UpdateIcon 方法而已。大概的代码如下</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">STDAPI_</span><span class="p">(</span><span class="k">void</span><span class="p">)</span> <span class="nf">SHUpdateRecycleBinIcon</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">UpdateIcon</span><span class="p">(!</span><span class="err">回收站是不是空的</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div>

<p>在 UpdateIcon 方法里面，先从注册表拿到回收站的图标，因为回收站的图标是可以让用户定制的</p>

<p>通过传入是否回收站是空的，获取不同的图标</p>

<p>拿到图标之后，调用 SHUpdateImage 方法将图标设置给回收站</p>

<p>这就是在 XP 系统里面的逻辑。上面代码也说明了 BitBucket 打不过 GitHub 的原因了，因为在 XP 上就是垃圾桶</p>

<p>感谢工具人 <a href="https://blog.sdlsj.net/">少珺</a> 的协助</p>

:ET