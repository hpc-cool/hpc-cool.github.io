I"°¡<p>æœ¬æ–‡æ˜¯æˆ‘åœ¨è¯» WPF æºä»£ç åšçš„ç¬”è®°ã€‚åœ¨ WPF ä¸­çš„å¯åŠ¨ç•Œé¢ï¼Œä¸ºäº†èƒ½è®© WPF çš„å¯åŠ¨ç•Œé¢æ˜¾ç¤ºè¶³å¤Ÿå¿«ï¼Œéœ€è¦åœ¨åº”ç”¨çš„ WPF ä¸»æœºè¿˜æ²¡æœ‰å¯åŠ¨å®Œæˆä¹‹å‰å°±æ˜¾ç¤ºå‡ºå¯åŠ¨å›¾ï¼Œæ­¤æ—¶çš„å¯åŠ¨å›¾éœ€è¦è‡ªå·±è§£æå›¾ç‰‡åŒæ—¶ä¹Ÿéœ€è¦è‡ªå·±åˆ›å»ºæ˜¾ç¤ºçª—å£</p>

<!--more-->

<!-- CreateTime:2020/12/21 9:04:51 -->

<!-- æ ‡ç­¾ï¼šWPFï¼ŒWPFæºä»£ç  -->
<!-- å‘å¸ƒ -->

<p>ä» WPF çš„ <code class="language-plaintext highlighter-rouge">src\Microsoft.DotNet.Wpf\src\WindowsBase\System\Windows\SplashScreen.cs</code> æ–‡ä»¶å¯ä»¥çœ‹åˆ° WPF çš„ SplashScreen çš„æ ¸å¿ƒé€»è¾‘</p>

<p>åœ¨ SplashScreen çš„æ„é€ å‡½æ•°ä¼šä¼ å…¥èµ„æºåï¼Œä¹Ÿå°±æ˜¯å¯åŠ¨å›¾çš„èµ„æºåï¼Œæˆ–è€…åŠ ä¸ŠæŒ‡å®šç¨‹åºé›†å’Œå›¾ç‰‡èµ„æºå</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="nf">SplashScreen</span><span class="p">(</span><span class="kt">string</span> <span class="n">resourceName</span><span class="p">)</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">GetEntryAssembly</span><span class="p">(),</span> <span class="n">resourceName</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="nf">SplashScreen</span><span class="p">(</span><span class="n">Assembly</span> <span class="n">resourceAssembly</span><span class="p">,</span> <span class="kt">string</span> <span class="n">resourceName</span><span class="p">)</span>
        <span class="p">{</span>
        	<span class="c1">// å¿½ç•¥ä»£ç </span>
        <span class="p">}</span>
</code></pre></div></div>

<p>å½“ç„¶äº†ï¼Œè¿™ä¸ªè®¾è®¡æ‰©å±•æ€§ä¸å¤Ÿå¥½å“ˆï¼Œä¸æ”¯æŒæŒ‡å®šä»»æ„çš„å›¾ç‰‡ã€‚å¦‚æœæƒ³è¦æŒ‡å®šæœ¬åœ°è·¯å¾„çš„ä»»æ„å›¾ç‰‡ä½œä¸ºå¯åŠ¨å›¾çš„ï¼Œå¯ä»¥ä½¿ç”¨ lsj æä¾›çš„ <a href="https://github.com/kkwpsv/SplashImage">kkwpsv/SplashImage: Fast splash Image with GDI+ in C#</a> åº“ï¼Œå½“ç„¶äº†ï¼Œè¿™ä¸ªåº“ä»£ç é‡ç‰¹åˆ«å°‘ï¼Œæˆ‘æ¨èå¤§å®¶å¯ä»¥æŠ„æŠ„ä»£ç ã€‚è¿™ä¸ªåº“æä¾›çš„æ˜¯é«˜æ€§èƒ½çš„ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä½¿ç”¨ <a href="https://github.com/kkwpsv/SplashImage">kkwpsv/SplashImage</a> ä½œä¸ºæ¬¢è¿ç•Œé¢ï¼Œæ˜¯å¯ä»¥åšåˆ°ä¸å ç”¨ WPF ä¸»çº¿ç¨‹æ—¶é—´çš„ï¼Œæ€§èƒ½æ¯” WPF æä¾›çš„å¥½</p>

<p>åœ¨ WPF çš„ SplashScreen çš„ Show æ–¹æ³•ï¼Œå°±æ˜¯å¯åŠ¨å›¾çš„æ ¸å¿ƒé€»è¾‘</p>

<p>å…ˆè°ƒç”¨ GetResourceStream ä»è‡ªå·±çš„ç¨‹åºé›†é‡Œé¢è¯»å–å›¾ç‰‡èµ„æºçš„åŸå§‹ Stream å¯¹è±¡ï¼Œé€šè¿‡æ­¤æ–¹å¼çš„è¯»å–æ€§èƒ½ç‰¹åˆ«å¼ºï¼Œå› æ­¤ä¸æ˜¯çœŸçš„è¯»å–åˆ°å†…å­˜é‡Œé¢ï¼Œè€Œæ˜¯è·å–ä¸€ä¸ªæŒ‡é’ˆè€Œå·²ã€‚ä½†æ˜¯æœ‰è¶£çš„æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•ä¸Šé¢æœ‰æ³¨é‡Šè¯´æ¯” Assembly.GetManifestResourceStream æ…¢ 200-300 æ¯«ç§’ï¼Œä¹Ÿè®¸æ˜¯å½“å¹´çš„è®¾å¤‡æ‰éœ€è¦è¿™ä¹ˆé•¿çš„æ—¶é—´</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">// This is 200-300 ms slower than Assembly.GetManifestResourceStream() but works with localization.</span>
        <span class="k">private</span> <span class="n">UnmanagedMemoryStream</span> <span class="nf">GetResourceStream</span><span class="p">()</span>
</code></pre></div></div>

<p>åœ¨è·å–åˆ°å¯åŠ¨å›¾ç‰‡çš„ UnmanagedMemoryStream ä¹‹åï¼Œå°†ä½¿ç”¨ä¸‹é¢ä»£ç è½¬æ¢ä¸ºæŒ‡é’ˆï¼Œç”¨äºåç»­ä¼ å…¥ç»™ WIC å±‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IntPtr</span> <span class="n">pImageSrcBuffer</span><span class="p">;</span>
<span class="k">unsafe</span>
<span class="p">{</span>
    <span class="n">pImageSrcBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IntPtr</span><span class="p">(</span><span class="n">umemStream</span><span class="p">.</span><span class="n">PositionPointer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨ CreateLayeredWindowFromImgBuffer åˆ›å»ºä¸€ä¸ªçª—å£ç„¶åè¿™ä¸ªçª—å£æ˜¾ç¤ºå›¾ç‰‡å†…å®¹</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nf">CreateLayeredWindowFromImgBuffer</span><span class="p">(</span><span class="n">pImageSrcBuffer</span><span class="p">,</span> <span class="n">umemStream</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">topMost</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">autoClose</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Dispatcher</span><span class="p">.</span><span class="n">CurrentDispatcher</span><span class="p">.</span><span class="nf">BeginInvoke</span><span class="p">(</span>
        <span class="n">DispatcherPriority</span><span class="p">.</span><span class="n">Loaded</span><span class="p">,</span>
        <span class="p">(</span><span class="n">DispatcherOperationCallback</span><span class="p">)</span><span class="n">ShowCallback</span><span class="p">,</span>
        <span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨ CreateLayeredWindowFromImgBuffer æ–¹æ³•æˆåŠŸä¹‹åï¼Œå°±ä¼šè°ƒç”¨ Dispatcher æ’å…¥ ShowCallback å‡½æ•°ï¼Œåœ¨ ShowCallback é‡Œé¢ç”¨æ¥è‡ªåŠ¨å…³é—­å¯åŠ¨ç•Œé¢ï¼Œå¦‚ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">static</span> <span class="kt">object</span> <span class="nf">ShowCallback</span><span class="p">(</span><span class="kt">object</span> <span class="n">arg</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">SplashScreen</span> <span class="n">splashScreen</span> <span class="p">=</span> <span class="p">(</span><span class="n">SplashScreen</span><span class="p">)</span><span class="n">arg</span><span class="p">;</span>
            <span class="n">splashScreen</span><span class="p">.</span><span class="nf">Close</span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">0.3</span><span class="p">));</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ WPF ä¸­é»˜è®¤çš„å¯åŠ¨å›¾ç•Œé¢å°†ä¼šåœ¨ Loaded å®Œæˆä¹‹åå»¶è¿Ÿ 0.3 ç§’æ‰§è¡Œï¼Œè€Œå…·ä½“æ˜¯ä»€ä¹ˆ Loaded å°±ä¸éœ€è¦å…³æ³¨äº†ã€‚å› ä¸ºé€šè¿‡ BeginInvoke æ’å…¥çš„ä¼˜å…ˆçº§æ˜¯ DispatcherPriority.Loaded ä¼˜å…ˆçº§ï¼Œä¹Ÿå°±æ˜¯å¯åŠ¨è¿‡ç¨‹å¦‚æœå†æ²¡æœ‰ä»€ä¹ˆæ¯” DispatcherPriority.Loaded æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œé‚£å°±æ˜¯å¯åŠ¨å®Œæˆäº†</p>

<p>åœ¨ WPF é‡Œé¢çš„ SplashScreen çš„æ ¸å¿ƒé€»è¾‘é‡Œé¢åŒ…å«ä»¥ä¸‹ä¸‰æ­¥</p>

<p>ç¬¬ä¸€æ­¥æ˜¯é€šè¿‡ WIC å±‚è§£ç å’±ä¼ å…¥çš„å›¾ç‰‡ï¼Œè¿™æ ·å°±æ”¯æŒä¸åšä»»ä½•ä¼˜åŒ–çš„å›¾ç‰‡éƒ½èƒ½ä½œä¸ºå¯åŠ¨å›¾</p>

<p>ç¬¬äºŒæ­¥å°±æ˜¯å°†è§£ç ä¹‹åçš„å›¾ç‰‡ç¼–ç ä¸º BGRA å›¾ç‰‡æ ¼å¼ä¼ ç»™ GDI å›¾ç‰‡å¯¹è±¡ï¼Œè¿™æ ·å°±èƒ½å°†å’±çš„å›¾ç‰‡ä½œä¸º GDI å›¾ç‰‡å¯¹è±¡èƒ½ä½¿ç”¨çš„èµ„æº</p>

<p>ç¬¬ä¸‰æ­¥æ˜¯åˆ›å»ºçª—å£æ˜¾ç¤ºè¿™å¼  GDI å›¾ç‰‡</p>

<p>å›åˆ°åˆ›å»ºçª—å£çš„æ ¸å¿ƒæ–¹æ³• CreateLayeredWindowFromImgBuffer ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢å¤§é‡è°ƒç”¨ WIC å±‚çš„é€»è¾‘ï¼Œç”¨æ¥å¤„ç†å›¾ç‰‡çš„æ¸²æŸ“ï¼Œè¿‡ç¨‹ä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼Œä¸‹é¢ä»£ç ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œå’Œ WPF æºä»£ç æœ‰äº›ä¸ç›¸åŒ</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="kt">bool</span> <span class="nf">CreateLayeredWindowFromImgBuffer</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">pImgBuffer</span><span class="p">,</span> <span class="kt">long</span> <span class="n">cImgBufferLen</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">topMost</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">bSuccess</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">IntPtr</span> <span class="n">pImagingFactory</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
            <span class="n">IntPtr</span> <span class="n">pDecoder</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
            <span class="n">IntPtr</span> <span class="n">pIStream</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
            <span class="n">IntPtr</span> <span class="n">pDecodedFrame</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
            <span class="n">IntPtr</span> <span class="n">pBitmapSourceFormatConverter</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
            <span class="n">IntPtr</span> <span class="n">pBitmapFlipRotator</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>

            <span class="c1">// åˆ›å»ºå›¾ç‰‡å·¥å‚ï¼Œä¹Ÿå°±æ˜¯è·å¾— pImagingFactory å¯¹è±¡</span>
            <span class="c1">// åœ¨ WPF é‡Œé¢ä½¿ç”¨çš„ WINCODEC_SDK_VERSION æ˜¯ 0x0236 ä¸€ä¸ªæ¯”è¾ƒå¤è€çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸‹æ–‡æœ‰å‘Šè¯‰å¤§å®¶æœ‰å“ªäº›æ›´æ–°</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">CreateImagingFactory</span><span class="p">(</span><span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="n">WINCODEC_SDK_VERSION</span><span class="p">,</span>
                <span class="k">out</span> <span class="n">pImagingFactory</span><span class="p">);</span>

            <span class="c1">// ä½¿ç”¨ pImagingFactory å›¾ç‰‡å·¥å‚åˆ›å»ºå‡ºä¸€ä¸ªç©ºçš„ Stream è¿”å›æŒ‡é’ˆç»™åˆ° pIStream å˜é‡</span>
            <span class="c1">// Use the WIC stream class to wrap the unmanaged pointer</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">CreateStream</span><span class="p">(</span><span class="n">pImagingFactory</span><span class="p">,</span> <span class="k">out</span> <span class="n">pIStream</span><span class="p">);</span>

            <span class="c1">// ä½¿ç”¨ä¼ è¿›æ¥çš„å›¾ç‰‡æŒ‡é’ˆå’Œé•¿åº¦ï¼Œåˆå§‹åŒ–å›¾ç‰‡å·¥å‚åˆ›å»ºå‡ºæ¥çš„ pIStream å¯¹è±¡</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">InitializeStreamFromMemory</span><span class="p">(</span><span class="n">pIStream</span><span class="p">,</span> <span class="n">pImgBuffer</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="n">cImgBufferLen</span><span class="p">);</span>

            <span class="c1">// Create an object that will decode the encoded image</span>
            <span class="n">Guid</span> <span class="n">vendor</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
            <span class="c1">// æ‹¿åˆ°ç¼–è§£ç å™¨</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">CreateDecoderFromStream</span><span class="p">(</span><span class="n">pImagingFactory</span><span class="p">,</span> <span class="n">pIStream</span><span class="p">,</span>
                <span class="k">ref</span> <span class="n">vendor</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="k">out</span> <span class="n">pDecoder</span><span class="p">);</span>

            <span class="c1">// Get the frame from the decoder. Most image formats have only a single frame, in the case</span>
            <span class="c1">// of animated gifs we are ok with only displaying the first frame of the animation.</span>
            <span class="c1">// ä»å›¾ç‰‡è§£ç é‡Œé¢è·å–å›¾ç‰‡çš„ç¬¬ä¸€å¸§ï¼Œå¦‚æœæ˜¯ Gif å›¾ç‰‡ä¹Ÿåªæ˜¯æ˜¾ç¤ºç¬¬ä¸€å¸§</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">GetFrame</span><span class="p">(</span><span class="n">pDecoder</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="k">out</span> <span class="n">pDecodedFrame</span><span class="p">);</span>

            <span class="c1">// è·å–æ ¼å¼è½¬æ¢å™¨</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">CreateFormatConverter</span><span class="p">(</span><span class="n">pImagingFactory</span><span class="p">,</span> <span class="k">out</span> <span class="n">pBitmapSourceFormatConverter</span><span class="p">);</span>

            <span class="c1">// å®šä¹‰äº† 32 ä½çš„ BGRA å›¾ç‰‡æ ¼å¼ï¼Œè½¬æ¢ä¸ºæ­¤æ ¼å¼æ–¹ä¾¿åˆ›å»ºçª—å£ä½¿ç”¨ GDI æ¸²æŸ“</span>
            <span class="c1">// Convert the image from whatever format it is in to 32bpp premultiplied alpha BGRA</span>
            <span class="n">Guid</span> <span class="n">pixelFormat</span> <span class="p">=</span> <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="n">WICPixelFormat32bppPBGRA</span><span class="p">;</span>

            <span class="c1">// åˆå§‹åŒ–è½¬æ¢å™¨</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">InitializeFormatConverter</span><span class="p">(</span><span class="n">pBitmapSourceFormatConverter</span><span class="p">,</span> <span class="n">pDecodedFrame</span><span class="p">,</span>
                <span class="k">ref</span> <span class="n">pixelFormat</span><span class="p">,</span> <span class="m">0</span> <span class="cm">/*DitherTypeNone*/</span><span class="p">,</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span>
                <span class="m">0</span><span class="p">,</span> <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="n">WICPaletteType</span><span class="p">.</span><span class="n">WICPaletteTypeCustom</span><span class="p">);</span>
            <span class="c1">// Reorient the image</span>
            <span class="c1">// è·å–å›¾ç‰‡çš„è£å‰ªå’Œæ—‹è½¬</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">CreateBitmapFlipRotator</span><span class="p">(</span><span class="n">pImagingFactory</span><span class="p">,</span> <span class="k">out</span> <span class="n">pBitmapFlipRotator</span><span class="p">);</span>

            <span class="c1">// åˆå§‹åŒ–å›¾ç‰‡çš„è£å‰ªå’Œæ—‹è½¬ç‰¹æ•ˆï¼Œæ­¤æ—¶çš„ pBitmapFlipRotator å°±æ˜¯æœ€ç»ˆå åŠ äº†ç‰¹æ•ˆçš„å›¾ç‰‡</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">InitializeBitmapFlipRotator</span><span class="p">(</span><span class="n">pBitmapFlipRotator</span><span class="p">,</span> <span class="n">pBitmapSourceFormatConverter</span><span class="p">,</span>
                <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="n">WICBitmapTransformOptions</span><span class="p">.</span><span class="n">WICBitmapTransformFlipVertical</span><span class="p">);</span>

            <span class="c1">// è·å–å›¾ç‰‡çš„å¤§å°ï¼Œç”¨æ¥åœ¨ä¸‹é¢åˆ›å»ºåƒç´ æ•°ç»„</span>
            <span class="n">Int32</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">;</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">GetBitmapSize</span><span class="p">(</span><span class="n">pBitmapFlipRotator</span><span class="p">,</span> <span class="k">out</span> <span class="n">width</span><span class="p">,</span> <span class="k">out</span> <span class="n">height</span><span class="p">);</span>

            <span class="c1">// å› ä¸ºä¸€ä¸ªåƒç´ ç”± BGRA æ ¼å¼å®šä¹‰</span>
            <span class="n">Int32</span> <span class="n">stride</span> <span class="p">=</span> <span class="n">width</span> <span class="p">*</span> <span class="m">4</span><span class="p">;</span>

            <span class="c1">// åˆ›å»ºä¸€ä¸ª GDI å¯¹è±¡ï¼Œå¯¹è±¡çš„å¤§å°é€šè¿‡ä¸Šé¢çš„é€»è¾‘æ‹¿åˆ°</span>
            <span class="c1">// initialize the bitmap header</span>
            <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">NativeMethods</span><span class="p">.</span><span class="n">BITMAPINFO</span> <span class="n">bmInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">NativeMethods</span><span class="p">.</span><span class="nf">BITMAPINFO</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="m">32</span> <span class="cm">/*bpp*/</span><span class="p">);</span>
            <span class="n">bmInfo</span><span class="p">.</span><span class="n">bmiHeader_biCompression</span> <span class="p">=</span> <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">NativeMethods</span><span class="p">.</span><span class="n">BI_RGB</span><span class="p">;</span>
            <span class="n">bmInfo</span><span class="p">.</span><span class="n">bmiHeader_biSizeImage</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">stride</span> <span class="p">*</span> <span class="n">height</span><span class="p">);</span>

            <span class="c1">// åˆ›å»º GDI å›¾ç‰‡å¯¹è±¡çš„å†…å­˜å¡«å……</span>
            <span class="c1">// Create a 32bpp DIB.  This DIB must have an alpha channel for UpdateLayeredWindow to succeed.</span>
            <span class="n">IntPtr</span> <span class="n">pBitmapBits</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
            <span class="n">_hBitmap</span> <span class="p">=</span> <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">CreateDIBSection</span><span class="p">(</span><span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(),</span> <span class="k">ref</span> <span class="n">bmInfo</span><span class="p">,</span> <span class="m">0</span> <span class="cm">/* DIB_RGB_COLORS*/</span><span class="p">,</span>
                <span class="k">ref</span> <span class="n">pBitmapBits</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>

            <span class="c1">// ä» WIC è§£ç å™¨é‡Œé¢æ‹·è´åƒç´ å†…å®¹åˆ° GDI å›¾ç‰‡é‡Œé¢</span>
            <span class="c1">// Copy the decoded image to the new buffer which backs the HBITMAP</span>
            <span class="n">Int32Rect</span> <span class="n">rect</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Int32Rect</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">WIC</span><span class="p">.</span><span class="nf">CopyPixels</span><span class="p">(</span><span class="n">pBitmapFlipRotator</span><span class="p">,</span> <span class="k">ref</span> <span class="n">rect</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="n">stride</span> <span class="p">*</span> <span class="n">height</span><span class="p">,</span> <span class="n">pBitmapBits</span><span class="p">);</span>

            <span class="c1">// ä½¿ç”¨ GDI å›¾ç‰‡ _hBitmap å»åˆ›å»ºä¸€ä¸ªçª—å£</span>
            <span class="n">_hwnd</span> <span class="p">=</span> <span class="nf">CreateWindow</span><span class="p">(</span><span class="n">_hBitmap</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">topMost</span><span class="p">);</span>

            <span class="n">bSuccess</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="c1">// å¿½ç•¥ä¸€äº›æ¸…ç†èµ„æºçš„ä»£ç </span>
            <span class="k">return</span> <span class="n">bSuccess</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç ä¸­çš„ UnsafeNativeMethods.WIC å°±æ˜¯è°ƒç”¨ WIC å±‚çš„é€»è¾‘ï¼Œåœ¨ WPF ä¸­çš„ WIC å±‚é€»è¾‘å’Œå…¶ä»– Win32 åº”ç”¨ä¸€æ ·ï¼Œé€šè¿‡ WindowsCodecs.dll æä¾›ï¼Œåªæ˜¯åœ¨ <code class="language-plaintext highlighter-rouge">UnsafeNativeMethods.WIC.CreateImagingFactory(UnsafeNativeMethods.WIC.WINCODEC_SDK_VERSION, out pImagingFactory);</code> å¯ä»¥çœ‹åˆ° WPF ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ 0x236 æ¯”è¾ƒå¤è€</p>

<p>é€šè¿‡å¯¹æ¯” 6.2.9200.21830-Windows_7.0 å’Œ 6.3.9600.17415-Windows_8.1 ç‰ˆæœ¬çš„ windowscodecs.dll å¯ä»¥çœ‹åˆ°æœ‰åšäº†å¦‚ä¸‹çš„æ›´æ”¹</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- #define WINCODEC_SDK_VERSION 0x0236
</span><span class="gi">+ #define WINCODEC_SDK_VERSION1 0x0236
+ #define WINCODEC_SDK_VERSION2 0x0237
</span><span class="gd">- DEFINE_GUID(CLSID_WICImagingFactory, 0xcacaf262, 0x9370, 0x4615, 0xa1, 0x3b, 0x9f, 0x55, 0x39, 0xda, 0x4c, 0xa);
</span><span class="gi">+ DEFINE_GUID(CLSID_WICImagingFactory, 0xcacaf262, 0x9370, 0x4615, 0xa1, 0x3b, 0x9f, 0x55, 0x39, 0xda, 0x4c, 0xa);
+ DEFINE_GUID(CLSID_WICImagingFactory1, 0xcacaf262, 0x9370, 0x4615, 0xa1, 0x3b, 0x9f, 0x55, 0x39, 0xda, 0x4c, 0xa);
+ DEFINE_GUID(CLSID_WICImagingFactory2, 0x317d06e8, 0x5f24, 0x433d, 0xbd, 0xf7, 0x79, 0xce, 0x68, 0xd8, 0xab, 0xc2);
+ #if(_WIN32_WINNT &gt;= _WIN32_WINNT_WIN8) || defined(_WIN7_PLATFORM_UPDATE)
+    #define WINCODEC_SDK_VERSION WINCODEC_SDK_VERSION2
+    #define CLSID_WICImagingFactory CLSID_WICImagingFactory2
+ #else
+    #define WINCODEC_SDK_VERSION WINCODEC_SDK_VERSION1
+ #endif
</span></code></pre></div></div>

<p>æ–°ç‰ˆæœ¬çš„ WindowsCodecs.dll æ›´æ–°è¯·çœ‹ <a href="https://docs.microsoft.com/zh-cn/windows/win32/wic/what-s-new-in-wic-for-windows-8-1">Whatâ€™s New in WIC - Win32 apps</a></p>

<p>åœ¨è°ƒç”¨åˆ°ä½¿ç”¨ GDI å›¾ç‰‡åˆ›å»ºçª—å£çš„é€»è¾‘å°±ååˆ†ç®€å•äº†ï¼Œéƒ½æ˜¯ä¸€äº› Win32 çš„æ¥å£è°ƒç”¨</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="n">IntPtr</span> <span class="nf">CreateWindow</span><span class="p">(</span><span class="n">NativeMethods</span><span class="p">.</span><span class="n">BitmapHandle</span> <span class="n">hBitmap</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">topMost</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_defWndProc</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_defWndProc</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">NativeMethods</span><span class="p">.</span><span class="nf">WndProc</span><span class="p">(</span><span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">DefWindowProc</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// åŸºæœ¬çš„ Win32 çª—å£åˆ›å»ºæ–¹æ³•ï¼Œæ²¡å•¥ç‰¹åˆ«çš„</span>
            <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">NativeMethods</span><span class="p">.</span><span class="n">WNDCLASSEX_D</span> <span class="n">wndClass</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">NativeMethods</span><span class="p">.</span><span class="nf">WNDCLASSEX_D</span><span class="p">();</span>
            <span class="n">wndClass</span><span class="p">.</span><span class="n">cbSize</span> <span class="p">=</span> <span class="n">Marshal</span><span class="p">.</span><span class="nf">SizeOf</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">NativeMethods</span><span class="p">.</span><span class="n">WNDCLASSEX_D</span><span class="p">));</span>
            <span class="n">wndClass</span><span class="p">.</span><span class="n">style</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span> <span class="cm">/* CS_HREDRAW | CS_VREDRAW */</span>
            <span class="n">wndClass</span><span class="p">.</span><span class="n">lpfnWndProc</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="n">wndClass</span><span class="p">.</span><span class="n">hInstance</span> <span class="p">=</span> <span class="n">_hInstance</span><span class="p">;</span>
            <span class="n">wndClass</span><span class="p">.</span><span class="n">hCursor</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
            <span class="n">wndClass</span><span class="p">.</span><span class="n">lpszClassName</span> <span class="p">=</span> <span class="n">CLASSNAME</span><span class="p">;</span>
            <span class="n">wndClass</span><span class="p">.</span><span class="n">lpszMenuName</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
            <span class="c1">// åŠ ä¸Šæ¶ˆæ¯å¾ªç¯ï¼Œä¸ç„¶ä¼šæç¤ºåº”ç”¨åœæ­¢å“åº”</span>
            <span class="n">wndClass</span><span class="p">.</span><span class="n">lpfnWndProc</span> <span class="p">=</span> <span class="n">_defWndProc</span><span class="p">;</span>

            <span class="c1">// We chose to ignore re-registration errors in RegisterClassEx on the off chance that the user</span>
            <span class="c1">// wants to open multiple splash screens.</span>
            <span class="n">_wndClass</span> <span class="p">=</span> <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">IntRegisterClassEx</span><span class="p">(</span><span class="n">wndClass</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_wndClass</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
            	<span class="c1">// ä¸‹é¢ä»£ç ä¸å¤ªåˆç†ï¼Œäºæ˜¯æˆ‘å°±æäº†ä¸€ä¸ªæ›´æ”¹ https://github.com/dotnet/wpf/pull/3923</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Marshal</span><span class="p">.</span><span class="nf">GetLastWin32Error</span><span class="p">()</span> <span class="p">!=</span> <span class="m">0x582</span><span class="p">)</span> <span class="cm">/* class already registered */</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Win32Exception</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// å†³å®šå¯åŠ¨çª—å£æ˜¾ç¤ºåˆ°å“ª</span>
            <span class="kt">int</span> <span class="n">screenWidth</span> <span class="p">=</span> <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">GetSystemMetrics</span><span class="p">(</span><span class="n">SM</span><span class="p">.</span><span class="n">CXSCREEN</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">screenHeight</span> <span class="p">=</span> <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">GetSystemMetrics</span><span class="p">(</span><span class="n">SM</span><span class="p">.</span><span class="n">CYSCREEN</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="p">(</span><span class="n">screenWidth</span> <span class="p">-</span> <span class="n">width</span><span class="p">)</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="p">(</span><span class="n">screenHeight</span> <span class="p">-</span> <span class="n">height</span><span class="p">)</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>

            <span class="c1">// çª—å£çš„æ ·å¼ï¼Œæ ¸å¿ƒçš„å°±æ˜¯ WS_EX_LAYERED å’Œ WS_EX_TOOLWINDOW æ ·å¼</span>
            <span class="n">HandleRef</span> <span class="n">nullHandle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">windowCreateFlags</span> <span class="p">=</span>
                <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">NativeMethods</span><span class="p">.</span><span class="n">WS_EX_WINDOWEDGE</span> <span class="p">|</span>
                      <span class="n">NativeMethods</span><span class="p">.</span><span class="n">WS_EX_TOOLWINDOW</span> <span class="p">|</span>
                      <span class="n">NativeMethods</span><span class="p">.</span><span class="n">WS_EX_LAYERED</span> <span class="p">|</span>
                      <span class="c1">// æ˜¯å¦æ˜¾ç¤ºåˆ°æœ€å‰</span>
                      <span class="p">(</span><span class="n">topMost</span> <span class="p">?</span> <span class="n">NativeMethods</span><span class="p">.</span><span class="n">WS_EX_TOPMOST</span> <span class="p">:</span> <span class="m">0</span><span class="p">);</span>

            <span class="c1">// åˆ›å»ºçª—å£</span>
            <span class="c1">// CreateWindowEx will either succeed or throw</span>
            <span class="n">IntPtr</span> <span class="n">hWnd</span> <span class="p">=</span>  <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">CreateWindowEx</span><span class="p">(</span>
                <span class="n">windowCreateFlags</span><span class="p">,</span>
                <span class="n">CLASSNAME</span><span class="p">,</span> <span class="n">SR</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">SRID</span><span class="p">.</span><span class="n">SplashScreenIsLoading</span><span class="p">),</span>
                <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">NativeMethods</span><span class="p">.</span><span class="n">WS_POPUP</span> <span class="p">|</span> <span class="n">MS</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">NativeMethods</span><span class="p">.</span><span class="n">WS_VISIBLE</span><span class="p">,</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                <span class="n">nullHandle</span><span class="p">,</span> <span class="n">nullHandle</span><span class="p">,</span> <span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">_hInstance</span><span class="p">),</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">);</span>

            <span class="c1">// å°†å›¾ç‰‡åœ¨çª—å£ä¸Šæ˜¾ç¤ºå‡ºæ¥</span>
            <span class="c1">// Display the image on the window</span>
            <span class="n">IntPtr</span> <span class="n">hScreenDC</span> <span class="p">=</span> <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">GetDC</span><span class="p">(</span><span class="k">new</span> <span class="nf">HandleRef</span><span class="p">());</span>
            <span class="n">IntPtr</span> <span class="n">memDC</span> <span class="p">=</span> <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">CreateCompatibleDC</span><span class="p">(</span><span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">hScreenDC</span><span class="p">));</span>
            <span class="n">IntPtr</span> <span class="n">hOldBitmap</span> <span class="p">=</span> <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">SelectObject</span><span class="p">(</span><span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">memDC</span><span class="p">),</span> <span class="n">hBitmap</span><span class="p">.</span><span class="nf">MakeHandleRef</span><span class="p">(</span><span class="k">null</span><span class="p">).</span><span class="n">Handle</span><span class="p">);</span>

            <span class="n">NativeMethods</span><span class="p">.</span><span class="n">POINT</span> <span class="n">newSize</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeMethods</span><span class="p">.</span><span class="nf">POINT</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
            <span class="n">NativeMethods</span><span class="p">.</span><span class="n">POINT</span> <span class="n">newLocation</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeMethods</span><span class="p">.</span><span class="nf">POINT</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
            <span class="n">NativeMethods</span><span class="p">.</span><span class="n">POINT</span> <span class="n">sourceLocation</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeMethods</span><span class="p">.</span><span class="nf">POINT</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="n">_blendFunc</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeMethods</span><span class="p">.</span><span class="nf">BLENDFUNCTION</span><span class="p">();</span>
            <span class="n">_blendFunc</span><span class="p">.</span><span class="n">BlendOp</span> <span class="p">=</span> <span class="n">NativeMethods</span><span class="p">.</span><span class="n">AC_SRC_OVER</span><span class="p">;</span>
            <span class="n">_blendFunc</span><span class="p">.</span><span class="n">BlendFlags</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="n">_blendFunc</span><span class="p">.</span><span class="n">SourceConstantAlpha</span> <span class="p">=</span> <span class="m">255</span><span class="p">;</span>
            <span class="n">_blendFunc</span><span class="p">.</span><span class="n">AlphaFormat</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="cm">/*AC_SRC_ALPHA*/</span>

            <span class="kt">bool</span> <span class="n">result</span> <span class="p">=</span> <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">UpdateLayeredWindow</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">hScreenDC</span><span class="p">,</span> <span class="n">newLocation</span><span class="p">,</span> <span class="n">newSize</span><span class="p">,</span>
                <span class="n">memDC</span><span class="p">,</span> <span class="n">sourceLocation</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="k">ref</span> <span class="n">_blendFunc</span><span class="p">,</span> <span class="n">NativeMethods</span><span class="p">.</span><span class="n">ULW_ALPHA</span><span class="p">);</span>

            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">SelectObject</span><span class="p">(</span><span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">memDC</span><span class="p">),</span> <span class="n">hOldBitmap</span><span class="p">);</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">ReleaseDC</span><span class="p">(</span><span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">memDC</span><span class="p">));</span>
            <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="nf">ReleaseDC</span><span class="p">(</span><span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">HandleRef</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">hScreenDC</span><span class="p">));</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">UnsafeNativeMethods</span><span class="p">.</span><span class="n">HRESULT</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="n">Marshal</span><span class="p">.</span><span class="nf">GetHRForLastWin32Error</span><span class="p">());</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">hWnd</span><span class="p">;</span>
        <span class="p">}</span>

</code></pre></div></div>

<p>å½“ç„¶äº†ï¼Œåœ¨ WPF é‡Œé¢å†å¿«çš„å¯åŠ¨å›¾æ˜¾ç¤ºé€Ÿåº¦éƒ½ä¸å¦‚ UWP å¿«ï¼Œå› æ­¤ UWP æ˜¯ç³»ç»Ÿç»™çš„ä¼˜åŒ–ï¼Œé€šè¿‡ AppFrameHost æ˜¾ç¤ºçš„ï¼ŒåŸºæœ¬ä¸Šç‚¹å‡»åº”ç”¨ç«‹åˆ»æ‰“å¼€</p>

<p>å½“å‰çš„ WPF åœ¨ <a href="https://github.com/dotnet/wpf">https://github.com/dotnet/wpf</a> å®Œå…¨å¼€æºï¼Œä½¿ç”¨å‹å¥½çš„ MIT åè®®ï¼Œæ„å‘³ç€å…è®¸ä»»ä½•äººä»»ä½•ç»„ç»‡å’Œä¼ä¸šä»»æ„å¤„ç½®ï¼ŒåŒ…æ‹¬ä½¿ç”¨ï¼Œå¤åˆ¶ï¼Œä¿®æ”¹ï¼Œåˆå¹¶ï¼Œå‘è¡¨ï¼Œåˆ†å‘ï¼Œå†æˆæƒï¼Œæˆ–è€…é”€å”®ã€‚åœ¨ä»“åº“é‡Œé¢åŒ…å«äº†å®Œå…¨çš„æ„å»ºé€»è¾‘ï¼Œåªéœ€è¦æœ¬åœ°çš„ç½‘ç»œè¶³å¤Ÿå¥½ï¼ˆå› ä¸ºéœ€è¦ä¸‹è½½ä¸€å †æ„å»ºå·¥å…·ï¼‰ï¼Œå³å¯è¿›è¡Œæœ¬åœ°æ„å»º</p>

:ET