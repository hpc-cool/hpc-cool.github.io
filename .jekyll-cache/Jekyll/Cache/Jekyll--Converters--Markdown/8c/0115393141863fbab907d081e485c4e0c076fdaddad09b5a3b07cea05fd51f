I"À<p>å †æ ˆçš„å°ä¼™ä¼´å¥½å¥‡ä»–æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œé¢æ˜¯ BGRA çš„åƒç´ ï¼Œä»–éœ€è¦å°†è¿™ä¸ªæ•°ç»„è½¬æ¢ä¸º PNG æ–‡ä»¶
åœ¨ UWP å¯ä»¥ä½¿ç”¨ BitmapEncoder å°†åƒç´ æ•°ç»„åŠ å¯†ä¸ºæ–‡ä»¶</p>

<!--more-->

<!-- CreateTime:2019/3/25 8:53:01 -->

<!-- csdn -->

<p>åœ¨ä½¿ç”¨ BitmapEncoder ä¹‹å‰éœ€è¦è¦æ±‚æœ‰åƒç´ æ•°ç»„ï¼Œåƒç´ æ•°ç»„çš„è§„å¾‹æœ‰è¦æ±‚ï¼ŒæŒ‰ç…§ BGRA æŒ‰ç…§é¡ºåºçš„æ•°ç»„ï¼ŒåŒæ—¶è¦æ±‚çŸ¥é“åƒç´ çš„åŸå›¾çš„åƒç´ å®½åº¦ã€‚å› ä¸ºå­˜æ”¾åƒç´ æ•°ç»„ä½¿ç”¨çš„æ˜¯ä¸€ç»´çš„æ•°ç»„ï¼Œå¦‚æœä¸çŸ¥é“å›¾ç‰‡å®½åº¦ï¼Œé‚£ä¹ˆå°±ä¸çŸ¥é“è¿™ä¸ªå›¾ç‰‡çš„åƒç´ æ˜¯å¯¹åº”æ•°ç»„å“ªä¸ª</p>

<p>é€šè¿‡ä¸‹é¢æ–¹æ³•å¯ä»¥è½¬æ¢åƒç´ æ•°ç»„åˆ°æ–‡ä»¶</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">ByteToPng</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">byteList</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="n">IRandomAccessStream</span> <span class="n">file</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">encoder</span> <span class="p">=</span> <span class="k">await</span> <span class="n">BitmapEncoder</span><span class="p">.</span><span class="nf">CreateAsync</span><span class="p">(</span><span class="n">BitmapEncoder</span><span class="p">.</span><span class="n">PngEncoderId</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>
                <span class="n">encoder</span><span class="p">.</span><span class="nf">SetPixelData</span><span class="p">(</span><span class="n">BitmapPixelFormat</span><span class="p">.</span><span class="n">Bgra8</span><span class="p">,</span> <span class="n">BitmapAlphaMode</span><span class="p">.</span><span class="n">Ignore</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="n">width</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="n">height</span><span class="p">,</span> <span class="m">96</span><span class="p">,</span>
                    <span class="m">96</span><span class="p">,</span> <span class="n">byteList</span><span class="p">);</span>
                <span class="k">await</span> <span class="n">encoder</span><span class="p">.</span><span class="nf">FlushAsync</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>è¿™é‡Œçš„ IRandomAccessStream å°±æ˜¯ StorageFile æ‰“å¼€æ–‡ä»¶</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">SaveToFileAsync</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">byteList</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="n">IStorageFile</span> <span class="n">file</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="p">(</span><span class="k">await</span> <span class="n">file</span><span class="p">.</span><span class="nf">OpenStreamForWriteAsync</span><span class="p">()).</span><span class="nf">AsRandomAccessStream</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="k">await</span> <span class="nf">ByteToPng</span><span class="p">(</span><span class="n">byteList</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥æ•°ç»„å’Œå›¾ç‰‡çš„å®½åº¦å’Œé«˜åº¦ï¼Œä¿å­˜çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥å°†åƒç´ æ•°ç»„ä¿å­˜åˆ° png æ–‡ä»¶</p>

:ET