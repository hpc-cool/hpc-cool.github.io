I"€n<p>æœ¬æ–‡æ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•åœ¨ WPF ä½¿ç”¨ D2D ç”»å›¾ã€‚</p>

<!--more-->

<!-- CreateTime:2018/8/10 19:16:53 -->

<div id="toc"></div>
<!-- æ ‡ç­¾ï¼šWPFï¼ŒD2D,DirectXï¼Œæ¸²æŸ“ -->

<p>æœ¬æ–‡æ˜¯ä¸€ä¸ªç³»åˆ—</p>

<ul>
  <li>
    <p><a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-Direct2D1-%E7%94%BB%E5%9B%BE%E5%85%A5%E9%97%A8.html">WPF ä½¿ç”¨ Direct2D1 ç”»å›¾å…¥é—¨</a></p>
  </li>
  <li>
    <p><a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-Direct2D1-%E7%94%BB%E5%9B%BE-%E7%BB%98%E5%88%B6%E5%9F%BA%E6%9C%AC%E5%9B%BE%E5%BD%A2.html">WPF ä½¿ç”¨ Direct2D1 ç”»å›¾ ç»˜åˆ¶åŸºæœ¬å›¾å½¢</a></p>
  </li>
  <li>
    <p><a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-SharpDX.html">WPF ä½¿ç”¨ SharpDX</a></p>
  </li>
  <li>
    <p><a href="https://lindexi.gitee.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-SharpDX-%E5%9C%A8-D3DImage-%E6%98%BE%E7%A4%BA.html">WPF ä½¿ç”¨ SharpDX åœ¨ D3DImage æ˜¾ç¤º</a></p>
  </li>
  <li>
    <p><a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8%E5%B0%81%E8%A3%85%E7%9A%84-SharpDx-%E6%8E%A7%E4%BB%B6.html">WPF ä½¿ç”¨å°è£…çš„ SharpDx æ§ä»¶</a></p>
  </li>
  <li>
    <p><a href="https://lindexi.oschina.io/lindexi/post/WPF-%E4%BD%BF%E7%94%A8-SharpDx-%E5%BC%82%E6%AD%A5%E6%B8%B2%E6%9F%93.html">WPF ä½¿ç”¨ SharpDx å¼‚æ­¥æ¸²æŸ“</a></p>
  </li>
</ul>

<h2 id="ä»€ä¹ˆæ˜¯-d2d">ä»€ä¹ˆæ˜¯ D2D</h2>

<p>å®é™…ä¸Šç°åœ¨å¾ˆå¤šå°ä¼™ä¼´å¯¹äºæ¸²æŸ“æ€§èƒ½å°±æ˜¯å¬åˆ° DirectX æ‰ä¼šå»æœç´¢è¿™ä¸ªåšå®¢ã€‚æˆ‘åœ¨åšå®¢å›­çœ‹åˆ°å¾ˆå°‘çš„åšå®¢è®²åˆ°è¿™ä¸ªã€‚å³ä½¿æœ‰ä¹Ÿå¾ˆå°‘ä¼šè¯´å¦‚ä½•ä½¿ç”¨ WPF çš„ã€‚</p>

<p>é‚£ä¹ˆ D2D æ˜¯ä¸€ä¸ªæé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Œå…·ä½“æ˜¯æ€ä¹ˆåšï¼ŸåŸºäº Direct3D å¯ä»¥ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„åŠŸèƒ½ï¼Œå³ä½¿åœ¨æ²¡æœ‰æ˜¾å¡ï¼Œè¿›è¡Œè½¯æ¸²æŸ“çš„æ€§èƒ½ä¹Ÿæ˜¯æ¯” GDI å¿«ï¼Œä½†æ˜¯æ¸²æŸ“é™æ€çš„è¿˜æ˜¯å»ºè®®ä½¿ç”¨ GDIã€‚</p>

<p>ç°åœ¨çš„ WPF åº•å±‚ä½¿ç”¨çš„æ¸²æŸ“æ˜¯ Dx9 æ¸²æŸ“ æˆ–ä½¿ç”¨ Dx11 Dx12 ä¼˜åŒ–  fl9 æ¸²æŸ“ï¼Œæ‰€ä»¥æ€§èƒ½å®é™…ä¸Šå’Œç›´æ¥ä½¿ç”¨ D2D æ˜¯å·®ä¸å¤šï¼Œä½†æ˜¯ WPF æ²¡æœ‰å……åˆ†ä½¿ç”¨DXï¼Œæ‰€ä»¥å¦‚æœè‡ªå·±å†™çš„æ€§èƒ½ä¼šæ¯”è¾ƒé«˜ã€‚</p>

<p>å› ä¸º WPF æ¸²æŸ“ä½¿ç”¨çš„æ˜¯ Dx9 æˆ–è™½ç„¶ä½¿ç”¨äº† Dx11 Dx12 ä½†æ˜¯ä¼˜åŒ–æ˜¯ fl9 ï¼Œæ‰€ä»¥åœ¨ç°åœ¨å¾ˆå¤šè®¾å¤‡æ— æ³•ä½¿ç”¨å…¨éƒ¨çš„æ€§èƒ½ã€‚</p>

<h2 id="direct2dè¿è¡Œéœ€æ±‚">Direct2Dè¿è¡Œéœ€æ±‚</h2>

<p>è¿™æ˜¯æˆ‘ä»å¤§ç¥çš„åšå®¢çœ‹åˆ°ï¼Œå¦‚æœéœ€è¦è¿è¡Œ Direct2D é‚£ä¹ˆå°±éœ€è¦åœ¨ win7 ä¹‹åæ‰å¯ä»¥ã€‚æ‰€ä»¥åœ¨ç°åœ¨å‡ ä¹å¯ä»¥ç›´æ¥è¿è¡Œï¼Œå¾ˆå°‘æœ‰äººä¼šä½¿ç”¨ win7 ä»¥ä¸‹çš„è®¾å¤‡ã€‚</p>

<h2 id="å®‰è£…">å®‰è£…</h2>

<p>ä¸‹é¢æ˜¯æˆ‘ä» Nuget å®‰è£…ï¼Œè¿™ä¸ªæ˜¯å¾ˆè€çš„åº“ï¼Œä¸å¤ªå»ºè®®å¤§å®¶ä½¿ç”¨ã€‚</p>

<p>Nuget æœç´¢ WindowsAPICodePackDirectX å°±å¯ä»¥å®‰è£…ï¼Œå¦‚æœä¸çŸ¥é“å®‰è£…å“ªä¸ªï¼Œè¯·ç‚¹å‡»<a href="https://www.nuget.org/packages/WindowsAPICodePackDirectX">WindowsAPICodePackDirectX</a></p>

<p>è¿™ä¸ªåº“åªæ˜¯ x64 çš„åº“ï¼Œæ‰€ä»¥æƒ³è¦è¿è¡Œè¿˜éœ€è¦è®¾ç½®ç¯å¢ƒã€‚</p>

<h2 id="ç¯å¢ƒ">ç¯å¢ƒ</h2>

<p>å¦‚æœç›´æ¥ä½¿ç”¨è¿™ä¸ªåº“æ˜¯æ— æ³•è¿è¡Œï¼Œä¸‹é¢çš„ä»£ç åªæ˜¯ä½œä¸ºå¤§å®¶å¿«é€Ÿå…¥é—¨ï¼Œä¸èƒ½ç”¨äºäº§å“ã€‚å®‰è£…è¿™ä¸ªåº“å¯ä»¥ç”¨åœ¨ x64 çš„è¿›ç¨‹ï¼Œä½†æ˜¯ä¸èƒ½ç”¨åœ¨ x86 è¿›ç¨‹ã€‚</p>

<p>è€Œä¸”è¿™ä¸ªåº“ä¸èƒ½ç›´æ¥åœ¨ dot net framework 4.5 çš„ç¯å¢ƒè¿è¡Œï¼Œéœ€è¦åˆ›å»º App.config æ–‡ä»¶æ·»åŠ ä¸‹é¢ä»£ç ã€‚éœ€è¦æ³¨æ„ï¼Œè¯·ä¿®æ”¹åˆ›å»ºé¡¹ç›®ä½¿ç”¨ dot net framework 4.5 è€Œä¸æ˜¯æ›´é«˜çš„ç‰ˆæœ¬ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="p">=</span><span class="s">"1.0"</span> <span class="n">encoding</span><span class="p">=</span><span class="s">"utf-8"</span> <span class="p">?&gt;</span>
<span class="p">&lt;</span><span class="n">configuration</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="n">startup</span> <span class="n">useLegacyV2RuntimeActivationPolicy</span><span class="p">=</span><span class="s">"true"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="n">supportedRuntime</span> <span class="n">version</span><span class="p">=</span><span class="s">"v4.0"</span> <span class="n">sku</span> <span class="p">=</span> <span class="s">".NETFramework,Version=v4.5"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">supportedRuntime</span> <span class="n">version</span><span class="p">=</span><span class="s">"v2.0.50727"</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="n">startup</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="n">configuration</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>é‚£ä¹ˆå¦‚ä½•è®©è½¯ä»¶ä½¿ç”¨ x64 è¿›ç¨‹ï¼Ÿå°è¯•å³å‡»é¡¹ç›®ç‚¹å‡»å±æ€§ï¼Œåœ¨ç”Ÿæˆé¡µé¢å°±å¯ä»¥çœ‹åˆ°å¹³å°ç›®æ ‡ï¼Œé€‰æ‹© x64 å°±ä¼šç¼–è¯‘ x64 çš„è½¯ä»¶ã€‚</p>

<p>å¦‚æœå¯¹äºå¹³å°ç›®æ ‡æ„Ÿè§‰æœ‰å…´è¶£ï¼Œè¯·çœ‹<a href="https://lindexi.gitee.io/post/WPF-%E7%BC%96%E8%AF%91%E4%B8%BA-AnyCPU-%E5%92%8C-x86-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB.html">WPF ç¼–è¯‘ä¸º AnyCPU å’Œ x86 æœ‰ä»€ä¹ˆåŒºåˆ«</a></p>

<h2 id="åˆ›å»ºå·¥å‚">åˆ›å»ºå·¥å‚</h2>

<p>é¦–å…ˆæ‰“å¼€ MainPage çš„ä»£ç ï¼Œæ·»åŠ ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">D2D</span> <span class="p">=</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">WindowsAPICodePack</span><span class="p">.</span><span class="n">DirectX</span><span class="p">.</span><span class="n">Direct2D1</span><span class="p">;</span>

</code></pre></div></div>

<p>è¿™æ ·ä¸‹é¢å°±ä¸éœ€è¦å†™é‚£ä¹ˆå¤šä»£ç ï¼Œå› ä¸ºæ‰€æœ‰ä½¿ç”¨<code class="language-plaintext highlighter-rouge">Microsoft.WindowsAPICodePack.DirectX.Direct2D1</code>çš„éƒ½å¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">D2D</code> æ¥æ‰¾åˆ°ï¼Œè¿™æ ·ä¸‹é¢çš„ä»£ç å¤§å®¶ç›´æ¥å¤åˆ¶å°±å¯ä»¥è¿è¡Œã€‚</p>

<p>åœ¨ä½¿ç”¨ Direct2D1 çš„ç¬¬ä¸€æ­¥å°±æ˜¯åˆ›å»ºå·¥å‚ã€‚</p>

<p>è™½ç„¶å·¥å‚æœ‰å¾ˆå¤šé‡è½½ï¼Œä¸è¿‡è¿™é‡Œä¸ä¼šå‘Šè¯‰å¤§å®¶ï¼Œå› ä¸ºåªæ˜¯å¿«é€Ÿå…¥é—¨ï¼Œå¦‚æœéœ€è¦çŸ¥é“å‚æ•°çš„æ„æ€å°±è¯·è‡ªå·±å¤šçœ‹æ–‡ç« ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>

            <span class="n">Loaded</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">d2DFactory</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">D2DFactory</span><span class="p">.</span><span class="nf">CreateFactory</span><span class="p">(</span><span class="n">D2D</span><span class="p">.</span><span class="n">D2DFactoryType</span><span class="p">.</span><span class="n">Multithreaded</span><span class="p">);</span>
            <span class="p">};</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æŠŠä»£ç å†™åœ¨ Loaded æ˜¯å› ä¸ºä¸‹é¢éœ€è¦æ‹¿åˆ°çª—å£ã€‚</p>

<h2 id="è·å¾—çª—å£">è·å¾—çª—å£</h2>

<p>ä»ä¸Šé¢ä»£ç å¤§å®¶ä¹Ÿè®¸ä¼šè¯´ä¸ºä»€ä¹ˆéœ€è¦åœ¨ Load æ‰å†™ï¼Œå› ä¸ºéœ€è¦æ‹¿åˆ°çª—å£ï¼Œåœ¨ Load ä¹‹åæ‹¿æ‰ä¸ä¼šæ˜¯ç©ºã€‚çª—å£åˆ›å»ºè™½ç„¶ä¸æ˜¯åªåœ¨ Loaded æ‹¿æ‰å¯ä»¥ï¼Œä¸è¿‡ä¸ºäº†ä»£ç æ¯”è¾ƒç®€å•ï¼Œäºæ˜¯å†™åœ¨ Loaded ï¼Œè¿™æ—¶æ‹¿åˆ°ä¸€èˆ¬å°±æ˜¯å¯ä»¥ä½¿ç”¨ã€‚</p>

<p>ä½¿ç”¨ä¸‹é¢ä»£ç å°±å¯ä»¥æ‹¿åˆ°çª—å£</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                <span class="kt">var</span> <span class="n">windowHandle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WindowInteropHelper</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="n">Handle</span><span class="p">;</span>

</code></pre></div></div>

<h2 id="æ¸²æŸ“ç›®æ ‡">æ¸²æŸ“ç›®æ ‡</h2>

<p>æœ€ä¸»è¦å°±æ˜¯åˆ›å»º RenderTarget ï¼Œè¯·ä½¿ç”¨ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">renderTarget</span> <span class="p">=</span> <span class="n">d2DFactory</span><span class="p">.</span><span class="nf">CreateHwndRenderTarget</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">RenderTargetProperties</span><span class="p">(),</span>
                    <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">HwndRenderTargetProperties</span><span class="p">(</span><span class="n">windowHandle</span><span class="p">,</span>
                        <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">SizeU</span><span class="p">((</span><span class="kt">uint</span><span class="p">)</span> <span class="n">ActualWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="n">ActualHeight</span><span class="p">),</span>
                        <span class="n">D2D</span><span class="p">.</span><span class="n">PresentOptions</span><span class="p">.</span><span class="n">RetainContents</span><span class="p">));</span>
</code></pre></div></div>

<p>å®é™…ä¸Šä¸Šé¢çš„ä»£ç ä¸å¯ä»¥ç”¨åœ¨å®é™…é¡¹ç›®ï¼Œå› ä¸ºå†™å…¥çš„å¤§å°ï¼Œå¦‚æœçª—å£ä¿®æ”¹äº†å¤§å°ï¼Œé‚£ä¹ˆæ˜¾ç¤ºçš„å°±ä¸€èˆ¬ä¸æ˜¯æœŸæœ›ã€‚</p>

<p>åœ¨æ¸²æŸ“çš„æ—¶å€™è¿˜éœ€è¦ä½¿ç”¨ RenderTarget ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªå­—æ®µä¿å­˜</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>

            <span class="n">Loaded</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">d2DFactory</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">D2DFactory</span><span class="p">.</span><span class="nf">CreateFactory</span><span class="p">(</span><span class="n">D2D</span><span class="p">.</span><span class="n">D2DFactoryType</span><span class="p">.</span><span class="n">Multithreaded</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">windowHandle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WindowInteropHelper</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="n">Handle</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">renderTarget</span> <span class="p">=</span> <span class="n">d2DFactory</span><span class="p">.</span><span class="nf">CreateHwndRenderTarget</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">RenderTargetProperties</span><span class="p">(),</span>
                    <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">HwndRenderTargetProperties</span><span class="p">(</span><span class="n">windowHandle</span><span class="p">,</span>
                        <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">SizeU</span><span class="p">((</span><span class="kt">uint</span><span class="p">)</span> <span class="n">ActualWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="n">ActualHeight</span><span class="p">),</span>
                        <span class="n">D2D</span><span class="p">.</span><span class="n">PresentOptions</span><span class="p">.</span><span class="n">RetainContents</span><span class="p">));</span>

                <span class="n">_renderTarget</span> <span class="p">=</span> <span class="n">renderTarget</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">D2D</span><span class="p">.</span><span class="n">RenderTarget</span> <span class="n">_renderTarget</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="å†™çº¿æ®µ">å†™çº¿æ®µ</h2>

<p>ä¸Šé¢è¯´äº†ä¸»è¦å°±æ˜¯æ‹¿ RenderTarget ï¼Œå› ä¸ºæ‹¿åˆ° RenderTarget å°±å’Œæ‹¿åˆ° DrawContext ä¸€æ ·ï¼Œè‡ªå·±å°è¯•ç‚¹ä¸€ä¸‹ RenderTarget å°±å¯ä»¥çœ‹åˆ°å¾ˆå¤šç”»å›¾çš„æ–¹æ³•ï¼Œåœ¨é‡Œé¢ç”»å›¾çš„æ€§èƒ½å¾ˆé«˜ã€‚</p>

<p>é‚£ä¹ˆå°è¯•å¯¹RenderTargetå†™å…¥çº¿æ®µ</p>

<p>å› ä¸ºéœ€è¦çŸ¥é“åœ¨ä»€ä¹ˆæ—¶å€™æ‰è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥å…ˆæ·»åŠ ä¸‹é¢ä»£ç ã€‚åœ¨ CompositionTarget æ‹¿åˆ°æ¸²æŸ“å°±æ˜¯ä¸€ä¸ªè€—æ€§èƒ½çš„è¿‡ç¨‹ï¼Œä½†æ˜¯ä¸ºäº†è®© DX æ¸²æŸ“å’Œ WPF æ—¶é—´ä¸€æ ·ï¼Œæ‰€ä»¥éœ€è¦åœ¨è¿™ä¸ªäº‹ä»¶è¿›è¡Œæ¸²æŸ“ã€‚ä¸»è¦ä¸è¦è®©è¿™ä¸ªæ–¹æ³•æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿ï¼Œé™¤äº†ç”»å‡ºæ¥å°±ä¸è¦åšå…¶ä»–çš„ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">CompositionTarget</span><span class="p">.</span><span class="n">Rendering</span> <span class="p">+=</span> <span class="n">OnRendering</span><span class="p">;</span>

</code></pre></div></div>

<p>æƒ³è¦ç”»å‡ºä¸€æ¡çº¿ï¼Œéœ€è¦çŸ¥é“çº¿çš„ä¸¤ä¸ªç‚¹ï¼Œå’Œçº¿çš„é¢œè‰²ï¼Œå®½åº¦ã€‚ä½†æ˜¯åœ¨ RenderTarget ä¼ å…¥çº¿çš„æ ·å¼éœ€è¦ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ã€‚æ³¨æ„ä¼ å…¥çš„å€¼æ˜¯ ColorF è€Œä¸”ä¸‰ä¸ªå€¼éƒ½æ˜¯[0,1]ï¼Œæ‰€ä»¥å¯¹æ™®é€šçš„é¢œè‰²ä¼ å…¥éœ€è¦è®¡ç®—ã€‚</p>

<p>åˆ›å»ºç¬”åˆ·çš„æ–¹æ³•</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">brush</span> <span class="p">=</span> <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>

</code></pre></div></div>

<p>è¿›è¡Œæ¸²æŸ“</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">if</span> <span class="p">(</span><span class="n">_renderTarget</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">brush</span> <span class="p">=</span> <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span> <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">Point2F</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="n">brush</span><span class="p">,</span> <span class="m">10</span><span class="p">);</span>
            
            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>
</code></pre></div></div>

<p>æ¸²æŸ“éœ€è¦å…ˆ BeginDraw ç„¶åç”»å‡ºï¼Œæœ€åè°ƒç”¨ EndDraw ç”»å‡ºæ¥ã€‚æ³¨æ„ï¼Œå¦‚æœè¿è¡Œçœ‹ä¸åˆ°ç”»å‡ºçš„ï¼Œé‚£ä¹ˆè¯·å…ˆçœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯è°ƒäº†å¤šæ¬¡ BeginDraw æ²¡æœ‰åŒ¹é… EndDraw ã€‚</p>

<p>å°è¯•è¿è¡Œå°±å¯ä»¥çœ‹åˆ°ä¸‹é¢ç•Œé¢</p>

<p><img src="http://image.acmx.xyz/lindexi%2F2018418215519377.jpg" alt="" /></p>

<p>è¿™æ—¶çœ‹ä¸€ä¸‹ CPU ï¼Œå‡ ä¹ä¸éœ€è¦ã€‚</p>

<p>ä¸‹é¢æ¥åšå¾ˆå°ä¿®æ”¹ï¼Œå†™å‡ºä¸€ä¸ªä¼šåŠ¨çš„å›¾ï¼Œä¸‹é¢çš„ä»£ç æ”¾åœ¨æœ€åã€‚</p>

<p><img src="https://i.loli.net/2018/04/18/5ad745c728813.gif" alt="" /></p>

<p><a href="http://www.cnblogs.com/grenet/p/3249664.html">Direct2Dæ•™ç¨‹Iâ€”â€”ç®€ä»‹åŠé¦–ä¸ªä¾‹å­ - ä¸‡ä»“ä¸€é» - åšå®¢å›­</a></p>

<p>æ‰€æœ‰ä»£ç ï¼š<a href="https://download.csdn.net/download/lindexi_gd/10358588">WPF Direct2D å…¥é—¨-CSDNä¸‹è½½</a></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>

            <span class="n">CompositionTarget</span><span class="p">.</span><span class="n">Rendering</span> <span class="p">+=</span> <span class="n">OnRendering</span><span class="p">;</span>

            <span class="n">Loaded</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">d2DFactory</span> <span class="p">=</span> <span class="n">D2D</span><span class="p">.</span><span class="n">D2DFactory</span><span class="p">.</span><span class="nf">CreateFactory</span><span class="p">(</span><span class="n">D2D</span><span class="p">.</span><span class="n">D2DFactoryType</span><span class="p">.</span><span class="n">Multithreaded</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">windowHandle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WindowInteropHelper</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="n">Handle</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">renderTarget</span> <span class="p">=</span> <span class="n">d2DFactory</span><span class="p">.</span><span class="nf">CreateHwndRenderTarget</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">RenderTargetProperties</span><span class="p">(),</span>
                    <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">HwndRenderTargetProperties</span><span class="p">(</span><span class="n">windowHandle</span><span class="p">,</span>
                        <span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">SizeU</span><span class="p">((</span><span class="kt">uint</span><span class="p">)</span> <span class="n">ActualWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="n">ActualHeight</span><span class="p">),</span>
                        <span class="n">D2D</span><span class="p">.</span><span class="n">PresentOptions</span><span class="p">.</span><span class="n">RetainContents</span><span class="p">));</span>

                <span class="n">_redBrush</span> <span class="p">=</span> <span class="n">renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>

                <span class="n">_greenBrush</span> <span class="p">=</span> <span class="n">renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>

                <span class="n">_blueBrush</span> <span class="p">=</span> <span class="n">renderTarget</span><span class="p">.</span><span class="nf">CreateSolidColorBrush</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">ColorF</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>

                <span class="n">_renderTarget</span> <span class="p">=</span> <span class="n">renderTarget</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">D2D</span><span class="p">.</span><span class="n">RenderTarget</span> <span class="n">_renderTarget</span><span class="p">;</span>

        <span class="k">private</span> <span class="n">D2D</span><span class="p">.</span><span class="n">SolidColorBrush</span> <span class="n">_redBrush</span><span class="p">;</span>

        <span class="k">private</span> <span class="n">D2D</span><span class="p">.</span><span class="n">SolidColorBrush</span> <span class="n">_greenBrush</span><span class="p">;</span>

        <span class="k">private</span> <span class="n">D2D</span><span class="p">.</span><span class="n">SolidColorBrush</span> <span class="n">_blueBrush</span><span class="p">;</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">OnRendering</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_renderTarget</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">D2D</span><span class="p">.</span><span class="n">SolidColorBrush</span> <span class="n">brush</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

            <span class="k">switch</span> <span class="p">(</span><span class="n">ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">3</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="m">0</span><span class="p">:</span>
                    <span class="n">brush</span> <span class="p">=</span> <span class="n">_redBrush</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="m">1</span><span class="p">:</span>
                    <span class="n">brush</span> <span class="p">=</span> <span class="n">_greenBrush</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="m">2</span><span class="p">:</span>
                    <span class="n">brush</span> <span class="p">=</span> <span class="n">_blueBrush</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">BeginDraw</span><span class="p">();</span>
            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">DrawRectangle</span><span class="p">(</span><span class="k">new</span> <span class="n">D2D</span><span class="p">.</span><span class="nf">RectF</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">_x</span> <span class="p">+</span> <span class="m">10</span><span class="p">,</span> <span class="n">_y</span> <span class="p">+</span> <span class="m">10</span><span class="p">),</span> <span class="n">brush</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">_renderTarget</span><span class="p">.</span><span class="nf">EndDraw</span><span class="p">();</span>

            <span class="n">_x</span> <span class="p">=</span> <span class="n">_x</span> <span class="p">+</span> <span class="n">_dx</span><span class="p">;</span>
            <span class="n">_y</span> <span class="p">=</span> <span class="n">_y</span> <span class="p">+</span> <span class="n">_dy</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_x</span> <span class="p">&gt;=</span> <span class="n">ActualWidth</span> <span class="p">-</span> <span class="m">100</span> <span class="p">||</span> <span class="n">_x</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_dx</span> <span class="p">=</span> <span class="p">-</span><span class="n">_dx</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">_y</span> <span class="p">&gt;=</span> <span class="n">ActualHeight</span> <span class="p">-</span> <span class="m">100</span> <span class="p">||</span> <span class="n">_y</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_dy</span> <span class="p">=</span> <span class="p">-</span><span class="n">_dy</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">float</span> <span class="n">_dx</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">float</span> <span class="n">_dy</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">float</span> <span class="n">_x</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">float</span> <span class="n">_y</span><span class="p">;</span>

        <span class="k">private</span> <span class="n">Random</span> <span class="n">ran</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="æ›´å¤šåšå®¢">æ›´å¤šåšå®¢</h2>

<p><a href="https://lindexi.oschina.io/lindexi/post/%E4%B8%BA%E4%BD%95%E4%BD%BF%E7%94%A8-DirectComposition.html">ä¸ºä½•ä½¿ç”¨ DirectComposition</a></p>

<p>C++ çš„ Direct2D è¯·çœ‹ <a href="http://www.cnblogs.com/graphics/category/412802.html">Direct2D</a></p>

:ET