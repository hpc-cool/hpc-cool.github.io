I"œ1<p>åœ¨å†™ msbuild çš„é¢„ç¼–è¯‘é€»è¾‘ï¼Œå¦‚æœæƒ³è¦æ‹¿åˆ°é¡¹ç›®å®‰è£…çš„ NuGet åº“å’Œç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡è·å– PackageReference çš„æ–¹æ³•è·å–</p>

<!--more-->

<!-- CreateTime:2020/8/5 16:12:49 -->

<p>è·å–æ–¹æ³•æ˜¯æ”¾åœ¨ Target é‡Œé¢ï¼Œå¦‚ä¸‹é¢ä»£ç </p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"LabaijalacarDaqarheelu"</span> <span class="na">BeforeTargets=</span><span class="s">"Build"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ItemGroup&gt;</span>
            <span class="nt">&lt;PackageReferenceVersion</span> <span class="na">Include=</span><span class="s">"Name='%(PackageReference.Identity)' Version='%(PackageReference.Version)' PrivateAssets='%(PackageReference.PrivateAssets)'"</span><span class="nt">&gt;&lt;/PackageReferenceVersion&gt;</span>
        <span class="nt">&lt;/ItemGroup&gt;</span>
        <span class="nt">&lt;Warning</span> <span class="na">Text=</span><span class="s">"@(PackageReferenceVersion)"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç ä½¿ç”¨ PackageReferenceVersion è·å–é¡¹ç›®æ‰€æœ‰çš„ PackageReference ç„¶åä½¿ç”¨ Warning è¾“å‡º</p>

<p>ä¸ºä»€ä¹ˆä½¿ç”¨ Warning è¾“å‡ºï¼Œå› ä¸ºè¿™æ ·è°ƒè¯•å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤çš„ dotnet å·¥å…·è¾“å‡ºçš„ Waring ç­‰çº§ï¼Œå…³äº dotnet çš„è¾“å‡ºï¼Œè¯·çœ‹ <a href="https://blog.lindexi.com/post/How-to-output-the-target-message-in-dotnet-build-command-line.html">How to output the target message in dotnet build command line</a></p>

<p>å¦å¤–ä¸Šé¢çš„è·å– ItemGroup çš„æŸä¸ª Item çš„å±æ€§ä½¿ç”¨çš„æ˜¯ <a href="https://blog.walterlv.com/post/how-to-reference-msbuild-item-metadata.html">å¦‚ä½•åœ¨ MSBuild ä¸­æ­£ç¡®ä½¿ç”¨ % æ¥å¼•ç”¨æ¯ä¸€ä¸ªé¡¹ï¼ˆItemï¼‰ä¸­çš„å…ƒæ•°æ®</a></p>

<p>é¡¹ç›®æ–‡ä»¶çš„ä»£ç å¦‚ä¸‹</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;PropertyGroup&gt;</span>
        <span class="nt">&lt;TargetFramework&gt;</span>netcoreapp3.1<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;/PropertyGroup&gt;</span>
    <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"NewLife.RocketMQ"</span> <span class="na">Version=</span><span class="s">"1.3.2020.802"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.Extensions.Logging.Abstractions"</span> <span class="na">Version=</span><span class="s">"3.1.6"</span> <span class="na">PrivateAssets=</span><span class="s">"all"</span><span class="nt">&gt;&lt;/PackageReference&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>
    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"LabaijalacarDaqarheelu"</span> <span class="na">BeforeTargets=</span><span class="s">"Build"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ItemGroup&gt;</span>
            <span class="nt">&lt;PackageReferenceVersion</span> <span class="na">Include=</span><span class="s">"Name='%(PackageReference.Identity)' Version='%(PackageReference.Version)' PrivateAssets='%(PackageReference.PrivateAssets)'"</span><span class="nt">&gt;&lt;/PackageReferenceVersion&gt;</span>
        <span class="nt">&lt;/ItemGroup&gt;</span>
        <span class="nt">&lt;Warning</span> <span class="na">Text=</span><span class="s">"@(PackageReferenceVersion)"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>
<span class="nt">&lt;/Project&gt;</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç æ”¾åœ¨ <a href="https://github.com/lindexi/lindexi_gd/tree/63498da1cd6ae26ed3983bc9fc684fbfbed23e6b/DealayhuneaWheluyearfair">github</a> åœ¨ä¸Šé¢ä»£ç æ‰€åœ¨æ–‡ä»¶å¤¹æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet build
</code></pre></div></div>

<p>è¾“å‡ºå†…å®¹æ˜¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ç”¨äº .NET Core çš„ Microsoft (R) ç”Ÿæˆå¼•æ“ç‰ˆæœ¬ 16.6.0+5ff7b0c9e
ç‰ˆæƒæ‰€æœ‰(C) Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚

  æ­£åœ¨ç¡®å®šè¦è¿˜åŸçš„é¡¹ç›®â€¦
  æ‰€æœ‰é¡¹ç›®å‡æ˜¯æœ€æ–°çš„ï¼Œæ— æ³•è¿˜åŸã€‚
  ChedarlelaNaykerkeargaini -&gt; C:\lindexi\DealayhuneaWheluyearfair\bin\Debug\netcoreapp3.1\ChedarlelaNaykerkeargaini.dll
C:\lindexi\DealayhuneaWheluyearfair\ChedarlelaNaykerkeargaini.csproj(13,9): warning : Name='NewLife.RocketMQ' Version='1.3.2020.802' PrivateAssets='';Name='Microsoft.Extensions.Logging.Abstractions' Version='3.1.6' PrivateAssets='all'

å·²æˆåŠŸç”Ÿæˆã€‚

C:\lindexi\DealayhuneaWheluyearfair\ChedarlelaNaykerkeargaini.csproj(13,9): warning : Name='NewLife.RocketMQ' Version='1.3.2020.802' PrivateAssets='';Name='Microsoft.Extensions.Logging.Abstractions' Version='3.1.6' PrivateAssets='all'
</code></pre></div></div>

<p>å¦‚æœå°†ä»£ç çš„ PackageReferenceVersion æ”¾åœ¨ Target å¤–ï¼Œå¦‚ä¸‹é¢ä»£ç </p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;PackageReferenceVersion</span> <span class="na">Include=</span><span class="s">"Name='%(PackageReference.Identity)' Version='%(PackageReference.Version)' PrivateAssets='%(PackageReference.PrivateAssets)'"</span><span class="nt">&gt;&lt;/PackageReferenceVersion&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>
    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"LabaijalacarDaqarheelu"</span> <span class="na">BeforeTargets=</span><span class="s">"Build"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Warning</span> <span class="na">Text=</span><span class="s">"@(PackageReferenceVersion)"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>
</code></pre></div></div>

<p>ä½¿ç”¨å‘½ä»¤è¡Œè¾“å…¥ä¸‹é¢ä»£ç æ„å»º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet build
</code></pre></div></div>

<p>é‚£ä¹ˆæ­¤æ—¶çš„è¾“å‡ºå¦‚ä¸‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\lindexi\QecoladeBafayearcur\QecoladeBafayearcur.csproj(13,9): warning : Name='%(PackageReference.Identity)' Version='%(PackageReference.Version)' PrivateAssets='%(PackageReference.PrivateAssets)'
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰å†…å®¹ï¼Œä¸Šé¢ä»£ç æ”¾åœ¨ <a href="https://github.com/lindexi/lindexi_gd/tree/63498da1cd6ae26ed3983bc9fc684fbfbed23e6b/QecoladeBafayearcur">github</a> è¯·å°ä¼™ä¼´è‡ªå·±ä½¿ç”¨å‘½ä»¤è¡Œè¯•è¯•</p>

<p>æ›´å¤šç¼–è¯‘ç›¸å…³è¯·çœ‹<a href="https://blog.lindexi.com/post/roslyn.html">æ‰‹æŠŠæ‰‹æ•™ä½ å†™ Roslyn ä¿®æ”¹ç¼–è¯‘</a></p>

<p>å…¶å®åœ¨ msbuild é‡Œï¼Œå¦‚æœå°ä¼™ä¼´è¯»è¿‡å•æ°´å¤§å¤§çš„ <a href="https://blog.walterlv.com/post/prevent-nuget-package-been-depended.html">å¸®åŠ©å®˜æ–¹ NuGet è§£æ‰ Bugï¼Œåˆ¶ä½œç»å¯¹ä¸ä¼šä¼ é€’ä¾èµ–çš„ NuGet åŒ… - walterlv</a> é‚£ä¹ˆè´ºå–œï¼Œè¯·è¯•è¯•ä¸‹é¢çš„ä»£ç </p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;PropertyGroup&gt;</span>
        <span class="nt">&lt;TargetFramework&gt;</span>netcoreapp3.1<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;/PropertyGroup&gt;</span>

    <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"NewLife.RocketMQ"</span> <span class="na">Version=</span><span class="s">"1.3.2020.802"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.Extensions.Logging.Abstractions"</span> <span class="na">Version=</span><span class="s">"3.1.6"</span> <span class="na">PrivateAssets=</span><span class="s">"all"</span><span class="nt">&gt;&lt;/PackageReference&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>

    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"LaldalllayjeaCawerequrwai"</span> <span class="na">BeforeTargets=</span><span class="s">"CollectPackageReferences"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ItemGroup&gt;</span>
            <span class="nt">&lt;PackageReference</span> <span class="na">Update=</span><span class="s">"F123123"</span> <span class="na">PrivateAssets=</span><span class="s">"123"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/ItemGroup&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>

    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"LabaijalacarDaqarheelu"</span> <span class="na">BeforeTargets=</span><span class="s">"Build"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ItemGroup&gt;</span>
            <span class="nt">&lt;PackageReferenceVersion</span> <span class="na">Include=</span><span class="s">"Name='%(PackageReference.Identity)' Version='%(PackageReference.Version)' PrivateAssets='%(PackageReference.PrivateAssets)'"</span><span class="nt">&gt;&lt;/PackageReferenceVersion&gt;</span>
        <span class="nt">&lt;/ItemGroup&gt;</span>
        <span class="nt">&lt;Warning</span> <span class="na">Text=</span><span class="s">"@(PackageReferenceVersion)"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>

<span class="nt">&lt;/Project&gt;</span>
</code></pre></div></div>

<p>å¯¹æ¯”ä¸Šé¢çš„ä»£ç ï¼Œå…¶å®æ·»åŠ äº† LaldalllayjeaCawerequrwai çš„ä»£ç ï¼Œåœ¨è¿™é‡Œé¢æ›´æ–°äº†ä¸€ä¸ªéšæ„çš„ NuGet åŒ…ï¼Œå°† PrivateAssets è®¾ç½®ä¸º 123 çš„å€¼</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"LaldalllayjeaCawerequrwai"</span> <span class="na">BeforeTargets=</span><span class="s">"CollectPackageReferences"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ItemGroup&gt;</span>
            <span class="nt">&lt;PackageReference</span> <span class="na">Update=</span><span class="s">"F123123"</span> <span class="na">PrivateAssets=</span><span class="s">"123"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/ItemGroup&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>
</code></pre></div></div>

<p>æ­¤æ—¶æœ‰ä»€ä¹ˆé”…ï¼Ÿè¯•è¯•ä½¿ç”¨å‘½ä»¤è¡Œæ„å»º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\lindexi\DealayhuneaWheluyearfair\ChedarlelaNaykerkeargaini.csproj(22,9): warning : Name='NewLife.RocketMQ' Version='1.3.2020.802' PrivateAssets='123';Name='Microsoft.Extensions.Logging.Abstractions' Version='3.1.6' PrivateAssets='123'
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°æ›´æ–°äº†ä¸€ä¸ª NuGet åº“ï¼Œä½†æ˜¯å…¨éƒ¨çš„ NuGet å¼•ç”¨çš„ PrivateAssets éƒ½è¢«æ›´æ”¹äº†</p>

<p>é™¤äº† PrivateAssets è¿˜å¯ä»¥ä¿®æ”¹ Version ç‰ˆæœ¬çš„å€¼ï¼Œä¹Ÿæ˜¯å…¨å±€</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"LaldalllayjeaCawerequrwai"</span> <span class="na">BeforeTargets=</span><span class="s">"CollectPackageReferences"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ItemGroup&gt;</span>
            <span class="nt">&lt;PackageReference</span> <span class="na">Update=</span><span class="s">"Microsoft.Extensions.Logging.Abstractions"</span> <span class="na">Version=</span><span class="s">"3.1.6"</span> <span class="na">PrivateAssets=</span><span class="s">"123"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/ItemGroup&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>
</code></pre></div></div>

<p>æ­¤æ—¶æ‰€æœ‰çš„ NuGet ç‰ˆæœ¬å°†è¢«ä¿®æ”¹ä¸º 3.1.6 ç‰ˆæœ¬</p>

<p>æ­¤æ—¶å°†ä¼šæç¤º NewLife.RocketMQ ä¸åŒ…å« 3.1.6 ç‰ˆæœ¬</p>

<p><a href="https://github.com/dotnet/sdk/issues/12777">Updated a PackageReference Version will update all of the PackageReference Â· Issue #12777 Â· dotnet/sdk</a></p>

:ET