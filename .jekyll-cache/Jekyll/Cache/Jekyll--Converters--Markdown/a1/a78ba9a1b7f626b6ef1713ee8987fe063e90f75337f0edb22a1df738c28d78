I"Š<p>æˆ‘é‡åˆ°äº†æœ‰è€å¸ˆç»™æˆ‘åé¦ˆè¯´ç”¨æˆ‘çš„å°å·¥å…·å»è¾…åŠ©ç¼–è¾‘è¯¾ä»¶çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä»–ä½¿ç”¨ WPS åˆ¶ä½œçš„æ–‡æ¡£æ‰“å¼€å¤±è´¥ï¼ŒåŸå› æ˜¯ WPS åˆ¶ä½œçš„ä¸€äº›æ–‡æ¡£ä¸ç¬¦åˆå‹ç¼©æ–‡æ¡£è§„èŒƒã€‚è€Œ Office çš„åŸºäº ECMA 376 çš„æ–‡æ¡£ï¼Œéƒ½æ˜¯ä½¿ç”¨æ ‡å‡†çš„ ZIP å‹ç¼©è§„èŒƒçš„æ–‡æ¡£ï¼Œå› æ­¤å¯¹äºè¿™äº›ä¸ç¬¦åˆå‹ç¼©æ–‡æ¡£è§„èŒƒçš„æ–‡ä»¶ï¼Œå°†ä¼šè§£æå¤±è´¥</p>

<!--more-->

<!-- CreateTime:2021/1/7 15:02:35 -->

<!-- å‘å¸ƒ -->

<p>å¦‚æœä½¿ç”¨äº†ä¸ç¬¦åˆå‹ç¼©è§„èŒƒçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ OpenXML SDK è¯»å–çš„æ—¶å€™ï¼Œå°†ä¼šåœ¨è§£å‹ç¼©çš„æ—¶å€™ç‚¸æ‰ï¼Œå¦‚ä¸‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>System.IO.FileFormatException:â€œFile contains corrupted data.â€
æ­¤å¼‚å¸¸æœ€åˆæ˜¯åœ¨æ­¤è°ƒç”¨å †æ ˆä¸­å¼•å‘çš„: 
  System.IO.Packaging.ZipPackage.ZipPackage(System.IO.Stream, System.IO.FileMode, System.IO.FileAccess)
  System.IO.Packaging.Package.Open(System.IO.Stream, System.IO.FileMode, System.IO.FileAccess)
  DocumentFormat.OpenXml.Packaging.OpenXmlPackage.OpenCore(System.IO.Stream, bool)
  DocumentFormat.OpenXml.Packaging.PresentationDocument.Open(System.IO.Stream, bool, DocumentFormat.OpenXml.Packaging.OpenSettings)
  DocumentFormat.OpenXml.Packaging.PresentationDocument.Open(System.IO.Stream, bool)  
</code></pre></div></div>

<p>æˆ–è€…ä¸‹é¢æç¤º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//å¦‚æœæ˜¯ InvalidDataException æˆ– FileFormatException æ˜¯ WPS çš„è¯¡å¼‚æ ¼å¼ï¼Œæ­¤æ—¶ä½¿ç”¨æ­¤æ–¹æ³•è§£å†³
System.IO.InvalidDataException	End of Central Directory record could not be found.	

at System.IO.Compression.ZipArchive.ReadEndOfCentralDirectory()
at System.IO.Compression.ZipArchive.Init(Stream stream, ZipArchiveMode mode, Boolean leaveOpen)
at System.IO.Compression.ZipArchive..ctor(Stream stream, ZipArchiveMode mode, Boolean leaveOpen, Encoding entryNameEncoding)
at System.IO.Packaging.ZipPackage..ctor(String path, FileMode packageFileMode, FileAccess packageFileAccess, FileShare share)
at System.IO.Packaging.Package.Open(String path, FileMode packageMode, FileAccess packageAccess, FileShare packageShare)
at DocumentFormat.OpenXml.Packaging.OpenXmlPackage.OpenCore(String path, Boolean readWriteMode)
at DocumentFormat.OpenXml.Packaging.PresentationDocument.Open(String path, Boolean isEditable, OpenSettings openSettings)
at DocumentFormat.OpenXml.Packaging.PresentationDocument.Open(String path, Boolean isEditable)
</code></pre></div></div>

<p>åœ¨è¯»å–åˆ° System.IO.InvalidDataException End of Central Directory record could not be found. å°±æ˜¯å› ä¸ºå‹ç¼©æ–‡æ¡£ä¸ç¬¦åˆè§„èŒƒï¼Œæˆ–è€…æ–‡ä»¶æŸå</p>

<p>è€Œç»™æˆ‘åé¦ˆçš„è€å¸ˆçš„è¯¾ä»¶å…¶å®åªæ˜¯å‹ç¼©æ–‡æ¡£ä¸ç¬¦åˆè§„èŒƒï¼Œæˆ‘ä½¿ç”¨ Office 2016 æ‰“å¼€ï¼Œæ­¤æ—¶ä¼šæç¤ºæ–‡æ¡£æŸå</p>

<!-- ![](image/dotnet OpenXML è§£æ WPS ä¸ç¬¦åˆå‹ç¼©æ–‡æ¡£è§„èŒƒçš„æ–‡æ¡£/dotnet OpenXML è§£æ WPS ä¸ç¬¦åˆå‹ç¼©æ–‡æ¡£è§„èŒƒçš„æ–‡æ¡£0.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F2021171579876.jpg" alt="" /></p>

<p>å½“ç„¶äº†ï¼Œç‚¹å‡»ä¿®å¤è¿˜æ˜¯èƒ½æ‰“å¼€è¯¾ä»¶çš„</p>

<p>ä½†æ˜¯æˆ‘çš„å·¥å…·æ— æ³•é€šè¿‡ OpenXML SDK è¯»å–</p>

<p>è§£å†³æ–¹æ³•å°±æ˜¯å…ˆä½¿ç”¨å…¶ä»–å‹ç¼©åº“è¿›è¡Œè§£å‹ç¼©å’Œå‹ç¼©ï¼Œè¿™æ ·çš„æ–‡ä»¶å°±ç¬¦åˆå‹ç¼©è§„èŒƒäº†</p>

<p>å¦‚ä½¿ç”¨ DotNetZip è¿›è¡Œè§£å‹ç¼©ï¼Œåœ¨ csproj ä¸Šæ·»åŠ ä¸‹é¢ä»£ç ï¼Œç”¨æ¥å®‰è£… DotNetZip è¿™ä¸ª NuGet åº“ã€‚å½“ç„¶äº†ï¼Œä½¿ç”¨ NuGet å®‰è£…ä¹Ÿå¯ä»¥</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"DotNetZip"</span> <span class="na">Version=</span><span class="s">"1.15.0"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>æ¥ä¸‹æ¥ä½¿ç”¨ä¸‹é¢ä»£ç è¿›è¡Œè§£å‹ç¼©ï¼Œç„¶åå‹ç¼©</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kt">var</span> <span class="n">folder</span> <span class="p">=</span> <span class="n">tempFolder</span><span class="p">;</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">zipFile</span> <span class="p">=</span> <span class="n">Ionic</span><span class="p">.</span><span class="n">Zip</span><span class="p">.</span><span class="n">ZipFile</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">zipFile</span><span class="p">.</span><span class="nf">ExtractAll</span><span class="p">(</span><span class="n">folder</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// é‡æ–°å‹ç¼©å›</span>
            <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">Compression</span><span class="p">.</span><span class="n">ZipFile</span><span class="p">.</span><span class="nf">CreateFromDirectory</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">newZipFile</span><span class="p">);</span>
</code></pre></div></div>

<p>è¿™æ ·æ–‡ä»¶å°±ç¬¦åˆå‹ç¼©è§„èŒƒäº†ï¼Œä»¥ä¸Šä»£ç ç‰¹åˆ«ä½¿ç”¨è¿è¡Œæ—¶æä¾›çš„å‹ç¼©æ–¹æ³•</p>

<p>æœ¬æ–‡çš„ä»£ç æ”¾åœ¨ <a href="https://github.com/lindexi/lindexi_gd/tree/2ce10a89/NairjelbibelLuqeefufejelnoche">github</a> æ¬¢è¿å°ä¼™ä¼´è®¿é—®</p>

<p>æ›´å¤šè¯·çœ‹ <a href="https://blog.lindexi.com/post/Office-%E4%BD%BF%E7%94%A8-OpenXML-SDK-%E8%A7%A3%E6%9E%90%E6%96%87%E6%A1%A3%E5%8D%9A%E5%AE%A2%E7%9B%AE%E5%BD%95.html">Office ä½¿ç”¨ OpenXML SDK è§£ææ–‡æ¡£åšå®¢ç›®å½•</a></p>

:ET