I"(é<p>æœ¬æ–‡æ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•ä½¿ç”¨ WPF æ¥å†™ä¸€ä¸ªè¾“å…¥æ³•ï¼Œä½¿ç”¨çš„æ–¹å¼æ˜¯é’©å­ã€‚</p>

<!--more-->

<!-- CreateTime:2019/6/5 17:06:58 -->

<!-- csdn -->
<div id="toc"></div>
<!-- æ ‡ç­¾ï¼šè¾“å…¥æ³•ï¼Œwpf -->

<p>å®é™…ä¸Šæœ¬æ–‡æ˜¯åœ¨ä½¿ç”¨ä¸€ä¸ªå¥½ç”¨çš„è½¯ä»¶ <a href="http://easinote.seewo.com/">å¸Œæ²ƒç™½æ¿</a> çš„æ—¶å€™å‘ç°åœ¨é‡Œé¢å¾ˆéš¾è¾“å…¥æ‹¼éŸ³æ¥åšè¯¾å ‚æ´»åŠ¨ã€‚</p>

<p><img src="http://image.acmx.xyz/lindexi%2F2018430111201441.jpg" alt="" /></p>

<p>å› ä¸ºç°åœ¨æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªè½¯ä»¶å¯ä»¥ç”¨æ¥è¾“å…¥æ‹¼éŸ³çš„ï¼Œå¿«é€Ÿçš„è¾“å…¥ã€‚è¾“å…¥éŸ³è°ƒæ˜¯æ¯”è¾ƒéš¾çš„ï¼Œæ‰€ä»¥æˆ‘å°±é‡æ–°åšäº†ä¸€ä¸ªè¾“å…¥æ³•ã€‚</p>

<p>åœ¨<a href="http://www.cnblogs.com/yswenli/">yswenli</a>çš„å¸®åŠ©ï¼Œä½¿ç”¨äº†<a href="https://github.com/yswenli/Wenli.IEM">yswenli/Wenli.IEM</a> æ–¹æ³•åšäº†ä¸€ä¸ªè¾“å…¥æ³•ã€‚</p>

<h2 id="é”®ç›˜">é”®ç›˜</h2>

<p>å¦‚æœè¦åšä¸€ä¸ªè¾“å…¥æ³•ï¼Œå¯ä»¥ä½¿ç”¨å¾ˆå¤šæ–¹æ³•ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯å…¨å±€ hook çš„æ–¹å¼ï¼Œéœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªæ–¹å¼å¾ˆå®¹æ˜“è®© 360 æ€æ‰ã€‚</p>

<p>æ³¨å†Œé’©å­çš„æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‡½æ•°</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">StdCall</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">SetWindowsHookEx</span><span class="p">(</span><span class="kt">int</span> <span class="n">idHook</span><span class="p">,</span> <span class="n">HookProc</span> <span class="n">lpfn</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">hInstance</span><span class="p">,</span> <span class="kt">int</span> <span class="n">threadId</span><span class="p">);</span>
</code></pre></div></div>

<p>å…³äº HookProc è¯·çœ‹ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">delegate</span> <span class="kt">int</span> <span class="nf">HookProc</span><span class="p">(</span><span class="kt">int</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">);</span>

</code></pre></div></div>

<p>æ‰€ä»¥ç®€å•çš„æ³¨å†Œä¸€ä¸ªé’©å­åªéœ€è¦ä¸‰è¡Œä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                <span class="kt">var</span> <span class="n">keyboardHookProcedure</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HookProc</span><span class="p">(</span><span class="n">KeyboardHookProc</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">hKeyboardHook</span> <span class="p">=</span> <span class="nf">SetWindowsHookEx</span><span class="p">(</span><span class="n">WH_KEYBOARD_LL</span><span class="p">,</span> <span class="n">keyboardHookProcedure</span><span class="p">,</span> <span class="nf">GetModuleHandle</span><span class="p">(</span><span class="n">Process</span><span class="p">.</span><span class="nf">GetCurrentProcess</span><span class="p">().</span><span class="n">MainModule</span><span class="p">.</span><span class="n">ModuleName</span><span class="p">),</span> <span class="m">0</span><span class="p">);</span>

                <span class="k">private</span> <span class="kt">int</span> <span class="nf">KeyboardHookProc</span><span class="p">(</span><span class="kt">int</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">)</span>
                <span class="p">{</span>
                	<span class="c1">// å¦‚æœä½ è¦ç®—æ‹¬å·å°±æœ‰å¾ˆå¤šè¡Œ</span>
                <span class="p">}</span>
</code></pre></div></div>

<p>é‚£ä¹ˆæ‹¿åˆ°äº† hook å¯ä»¥å¦‚ä½•ä½¿ç”¨ï¼Œä¸‹é¢æ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•è§£æä¿¡æ¯</p>

<h2 id="è§£æé”®ç›˜">è§£æé”®ç›˜</h2>

<p>è§£æçš„æ–¹å¼å¾®è½¯æœ‰è¯´åˆ°ï¼Œå› ä¸ºå¾ˆç®€å•ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ªç»“æ„ï¼Œè¯·çœ‹ä»£ç ã€‚å®šä¹‰çš„ç»“æ„éœ€è¦æ˜¯è¿™æ ·çš„ï¼Œä¸è¦å»ä¼˜åŒ–ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">KeyboardHookStruct</span>
        <span class="p">{</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">vkCode</span><span class="p">;</span>  <span class="c1">//å®šä¸€ä¸ªè™šæ‹Ÿé”®ç ã€‚è¯¥ä»£ç å¿…é¡»æœ‰ä¸€ä¸ªä»·å€¼çš„èŒƒå›´1è‡³254</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">scanCode</span><span class="p">;</span> <span class="c1">// æŒ‡å®šçš„ç¡¬ä»¶æ‰«æç çš„å…³é”®</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>  <span class="c1">// é”®æ ‡å¿—</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">time</span><span class="p">;</span> <span class="c1">// æŒ‡å®šçš„æ—¶é—´æˆ³è®°çš„è¿™ä¸ªè®¯æ¯</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">dwExtraInfo</span><span class="p">;</span> <span class="c1">// æŒ‡å®šé¢å¤–ä¿¡æ¯ç›¸å…³çš„ä¿¡æ¯</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ä»å‚æ•°å°±å¯ä»¥æ‹¿åˆ°ï¼Œå› ä¸ºå‚æ•°æ˜¯æŒ‡é’ˆï¼Œéœ€è¦<code class="language-plaintext highlighter-rouge">Marshal.PtrToStructure</code>æ¥æ‹¿åˆ°</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">KeyboardHookStruct</span> <span class="n">myKeyboardHookStruct</span> <span class="p">=</span> <span class="p">(</span><span class="n">KeyboardHookStruct</span><span class="p">)</span> <span class="n">Marshal</span><span class="p">.</span><span class="nf">PtrToStructure</span><span class="p">(</span><span class="n">lParam</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">KeyboardHookStruct</span><span class="p">));</span>
</code></pre></div></div>

<p>ç°åœ¨é€šè¿‡è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥æ‹¿åˆ°é”®ç›˜çš„è¾“å…¥ã€‚</p>

<h2 id="è·å¾—æŒ‰é”®">è·å¾—æŒ‰é”®</h2>

<p>è™½ç„¶å·²ç»è§£æäº†ï¼Œä½†æ˜¯ç°åœ¨è¿˜æ˜¯ä¸çŸ¥é“ç”¨æˆ·æŒ‰é”®æ˜¯å“ªä¸ªã€‚éœ€è¦é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è½¬æ¢ï¼Œé¦–å…ˆå¼•ç”¨ WinForm ï¼Œå› ä¸ºå®šä¹‰åœ¨ WinForm æœ‰ï¼Œè€Œä¸”ä¸‹é¢å‘é€æ¶ˆæ¯ä¹Ÿæ˜¯éœ€è¦é€šè¿‡ã€‚</p>

<p>å³å‡»å¼•ç”¨ï¼Œç‚¹å‡»ç¨‹åºé›†ã€æ¡†æ¶ï¼Œå°±å¯ä»¥çœ‹åˆ° System.Windows.Forms ï¼Œè¯·çœ‹å›¾ç‰‡</p>

<p><img src="http://image.acmx.xyz/lindexi%2F20184301122315730.jpg" alt="" /></p>

<p>å¼•ç”¨äº†ä¹‹åå°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ‹¿åˆ°æŒ‰é”®</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Keys</span> <span class="n">keyData</span> <span class="p">=</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span> <span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span><span class="p">;</span>
</code></pre></div></div>

<p>å°è¯•ç‚¹ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„å€¼ï¼Ÿ</p>

<p>æœ‰äº†æŒ‰é”®ï¼Œé‚£ä¹ˆä¸‹é¢å¦‚ä½•å†™ä¸€ä¸ªè¾“å…¥æ³•å°±æ˜¯éœ€è¦ä½¿ç”¨äº†å¯¹åº”çš„ç®—æ³•äº†ï¼Œå¦‚æœæƒ³ä½¿ç”¨å¾®è½¯æä¾›çš„ç®—æ³•ï¼Œè¯·çœ‹<a href="http://www.cnblogs.com/yswenli/p/6528447.html">C# è¾“å…¥æ³•</a>ï¼Œæˆ‘æ˜¯éœ€è¦ç”¨æ¥è¾“å…¥æ‹¼éŸ³ã€‚æ‰€ä»¥ä¸‹é¢æ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•ä»ç”¨æˆ·æŒ‰é”®æ‹¿åˆ°ç”¨æˆ·æƒ³è¦çš„è¾“å…¥ã€‚</p>

<h2 id="è¾“å…¥æµå‘">è¾“å…¥æµå‘</h2>

<p>è™½ç„¶å·²ç»æ‹¿åˆ°äº†æŒ‰é”®ï¼Œä½†æ˜¯æ‹¿åˆ°çš„æŒ‰é”®è¿˜æ˜¯éœ€è¦è½¬æ¢å­—ç¬¦ä¸²æ‰å¯ä»¥å¤„ç†</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">key</span> <span class="p">=</span> <span class="n">keyData</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>
</code></pre></div></div>

<p>ç°åœ¨çš„ key å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåœ¨è¾“å…¥æ‹¼éŸ³ï¼Œç”¨æˆ·æƒ³çš„æ˜¯å¿«é€Ÿçš„è¾“å…¥ï¼Œè€Œä¸æ˜¯ä¸åœå¤åˆ¶ç²˜è´´ï¼Œå¯¹äºæ™®é€šçš„å­—ç¬¦è¾“å…¥æ˜¯å¯ä»¥ç›´æ¥è¾“å…¥ï¼Œä½†æ˜¯å¯¹äº<code class="language-plaintext highlighter-rouge">ÄÃ¡Ç</code>çš„è¾“å…¥å°±æ— æ³•ç›´æ¥è¾“å…¥çš„ã€‚</p>

<p>æˆ‘çœ‹åˆ°ä¸€ä½è€å¸ˆæ˜¯åœ¨è®°äº‹æœ¬å†™äº†ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">ÄÃ¡ÇÃ </span>
<span class="err">Ä“Ã©Ä›Ã¨</span>
<span class="err">Ä«Ã­ÇÃ¬</span>
<span class="err">ÅÃ³Ç’Ã²</span>
<span class="err">Å«ÃºÇ”Ã¹</span>
<span class="err">Ç–Ç˜ÇšÇœ</span>
</code></pre></div></div>

<p>éœ€è¦å“ªä¸ªå°±å»å¤åˆ¶å“ªä¸ªï¼Œå¦‚å†™ <code class="language-plaintext highlighter-rouge">yÃ¹n</code> å°±éœ€è¦è¾“å…¥ <code class="language-plaintext highlighter-rouge">y</code> ç„¶åå¤åˆ¶ä¸€ä¸‹<code class="language-plaintext highlighter-rouge">Ã¹</code>ï¼Œç„¶åå†™ <code class="language-plaintext highlighter-rouge">n</code> ï¼Œè¿™æ ·æƒ³è¾“å…¥è¿ç»­çš„æ‹¼éŸ³æ˜¯å¾ˆæ…¢çš„ã€‚</p>

<p>æ‰€ä»¥å¯¹äº<code class="language-plaintext highlighter-rouge">a,e,i,o,u,v</code>æ‰éœ€è¦è¾“å…¥æ³•è½¬æ¢ï¼Œå¯¹äºå…¶ä»–çš„å°±ç›´æ¥è¾“å…¥å°±å¥½äº†ã€‚</p>

<p><img src="http://image.acmx.xyz/lindexi%2F20184301135348021.jpg" alt="" /></p>

<p>é‚£ä¹ˆå¦‚ä½•è®©ç”¨æˆ·çš„æŒ‰é”®æ— æ³•ç›´æ¥è¾“å…¥åˆ°å¯¹åº”çš„ç¨‹åºï¼Œå°±éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">StdCall</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">CallNextHookEx</span><span class="p">(</span><span class="kt">int</span> <span class="n">idHook</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">);</span>
</code></pre></div></div>

<p>ä½¿ç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥é€šè¿‡ä¿¡æ¯é’©å­ç»§ç»­ä¸‹ä¸€ä¸ªé’©å­ï¼Œåœ¨ <code class="language-plaintext highlighter-rouge">private int KeyboardHookProc(int nCode, Int32 wParam, IntPtr lParam)</code> å¤§å®¶ä¹Ÿçœ‹åˆ°æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œé€šè¿‡è¿™ä¸ªè¿”å›å€¼å¯ä»¥å‘Šè¯‰ç³»ç»Ÿï¼Œæ˜¯ä¸æ˜¯è¦æŠŠè¿™ä¸ªæ¶ˆæ¯ä¼ ç»™ä¸‹ä¸€ä¸ªç¨‹åºã€‚</p>

<p>å¦‚æœè¿”å›çš„æ˜¯ 0 é‚£ä¹ˆå°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œè¿™ä¸ª hook ä¸å¤„ç†ï¼Œä½ éœ€è¦æŠŠæ¶ˆæ¯å‘ç»™å…¶ä»–çš„ç¨‹åºã€‚å¦‚æœè¿”å›ä¸æ˜¯0 ï¼Œé‚£ä¹ˆå°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œè¿™ä¸ªæˆ‘å¤„ç†äº†ï¼Œå…¶ä»–çš„ç¨‹åºä¸èƒ½æ”¶åˆ°ã€‚</p>

<p>è¾“å…¥æ³•åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„æ˜¯ [a,z] [0,9] å‘Šè¯‰ç³»ç»Ÿï¼Œä¸è¦å‘ç»™å…¶ä»–çš„ç¨‹åºã€‚</p>

<p>é‚£ä¹ˆå¦‚æœç”¨æˆ·è¾“å…¥çš„ä¸æ˜¯ <code class="language-plaintext highlighter-rouge">a,e,i,o,u,v</code> ä¹Ÿå°±æ˜¯å¯ä»¥ç›´æ¥ç»™å…¶ä»–ç¨‹åºï¼Œè¿™æ—¶æ€ä¹ˆåšï¼Ÿ</p>

<p>å®é™…ä¸Šä¸ç®¡ç”¨æˆ·è¾“å…¥çš„æ˜¯ä»€ä¹ˆï¼Œåªè¦å‘ç»™å…¶ä»–ç¨‹åºéƒ½éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">SendKeys</span><span class="p">.</span><span class="nf">SendWait</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span>
</code></pre></div></div>

<p>é€šè¿‡è¿™ä¸ªæ–¹æ³•å°±ä¼šæŠŠ str å‘é€ç»™å½“å‰ç”¨æˆ·è¾“å…¥çš„ç¨‹åºã€‚</p>

<h2 id="ç®—æ³•">ç®—æ³•</h2>

<p>ç°åœ¨å¯ä»¥æ‹¿åˆ°äº†å…¨éƒ¨çš„è¾“å…¥ï¼Œè€Œä¸”çŸ¥é“äº†å¦‚ä½•æŠŠè½¬æ¢çš„å€¼å‘é€ç»™ç”¨æˆ·ï¼Œå¤§æ¦‚ä¸€ä¸ªè¾“å…¥æ³•å°±æ˜¯éœ€è¦è¿™ä¸¤ä¸ªã€‚</p>

<p>å¦‚æœä»ç”¨æˆ·çš„è¾“å…¥çŸ¥é“ç”¨æˆ·éœ€è¦çš„ä»€ä¹ˆå°±æ˜¯ç®—æ³•ï¼Œä¸‹é¢ä½¿ç”¨çš„æ–¹æ³•å¾ˆç®€å•ã€‚</p>

<p>åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„æ˜¯ä¸æ˜¯<code class="language-plaintext highlighter-rouge">a,e,i,o,u,v</code>ï¼Œå‘ç°ä¸æ˜¯å°±ç›´æ¥å‘é€è¾“å…¥ã€‚å¦‚æœæ˜¯å°±ä¸å‘é€ä»»ä½•è¾“å…¥ï¼Œè®©ç”¨æˆ·é€‰éœ€è¦çš„æ˜¯å“ªä¸ª</p>

<p><img src="http://image.acmx.xyz/34fdad35-5dfe-a75b-2b4b-8c5e313038e2%2F2018116195923.jpg" alt="" /></p>

<p>è¿™æ˜¯æˆ‘æŠŠå®ƒæ˜¾ç¤ºå‡ºæ¥ï¼Œä»£ç è¿˜éœ€è¦ä¸€ä¸ªå±æ€§ï¼Œè¡¨ç¤ºå½“å‰æ˜¯ä¸æ˜¯å­˜åœ¨ç”¨æˆ·æ²¡æœ‰é€‰çš„å­—ç¬¦ã€‚å¦‚æœå­˜åœ¨ï¼Œä¸‹ä¸€æ¬¡è¾“å…¥çš„æ˜¯[0,9]å°±æ˜¯ç”¨æˆ·é€‰çš„å­—ç¬¦ï¼Œå› ä¸ºåªè¦5ä¸ªå¯ä»¥é€‰ï¼Œå¯¹äºå¤§äº5å’Œ0çš„å°±ç›´æ¥å‘é€è¾“å…¥ã€‚å½“å‰å¯¹äºç°åœ¨å¾ˆå¤šè¾“å…¥æ³•ï¼Œéƒ½æ˜¯æŒ‰ç©ºæ ¼é€‰ç¬¬ä¸€ä¸ªï¼Œè¿™é‡Œä¹Ÿæ˜¯éœ€è¦åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„æ˜¯ä¸æ˜¯ç©ºæ ¼ã€‚</p>

<p>åœ¨å¼€å‘çš„æ—¶å€™å‘ç°è¿˜æœ‰å¾ˆå¤šçš„ç»†èŠ‚ï¼Œä¸è¿‡è¿™äº›æˆ‘å°±ä¸åœ¨è¿™é‡Œå‘Šè¯‰å¤§å®¶ï¼Œæˆ‘æŠŠä»£ç æ”¾åœ¨ä¸‹é¢ï¼Œå¤§å®¶çœ‹ä¸€ä¸‹ã€‚</p>

<p>æˆ‘æŠŠç¨‹åºæ”¾åœ¨è®ºå›ï¼Œå¯ä»¥ç‚¹å‡» <a href="http://bbs.seewoedu.cn/forum.php?mod=viewthread&amp;tid=10625&amp;highlight=%E6%8B%BC%E9%9F%B3">å¿«é€Ÿåœ¨è¯¾å ‚æ´»åŠ¨è¾“å…¥æ‹¼éŸ³</a> ä¸‹è½½</p>

<p>æºä»£ç è¯·çœ‹</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="n">Loaded</span> <span class="p">+=</span> <span class="n">MainWindow_Loaded</span><span class="p">;</span>
            <span class="n">DataContext</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="n">Topmost</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">HideVexogzPybnj</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">LdefkgzYclfeufwx</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Visible</span><span class="p">;</span>
            <span class="n">KqhRst</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Hidden</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">MainWindow_Loaded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">HideVexogzPybnj</span><span class="p">();</span>

            <span class="n">App</span><span class="p">.</span><span class="n">KeyBordHook</span><span class="p">.</span><span class="n">KeyUpEvent</span> <span class="p">+=</span> <span class="n">KeyBordHook_KeyUpEvent</span><span class="p">;</span>
            <span class="n">App</span><span class="p">.</span><span class="n">KeyBordHook</span><span class="p">.</span><span class="n">OnSpaced</span> <span class="p">+=</span> <span class="n">KeyBordHook_OnSpaced</span><span class="p">;</span>
            <span class="n">App</span><span class="p">.</span><span class="n">KeyBordHook</span><span class="p">.</span><span class="n">OnBacked</span> <span class="p">+=</span> <span class="n">KeyBordHook_OnBacked</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">KeyBordHook_OnBacked</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">_yuanyin</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_key</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
                <span class="n">App</span><span class="p">.</span><span class="n">KeyBordHook</span><span class="p">.</span><span class="n">IsStarted</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">_yuanyin</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="nf">HideVexogzPybnj</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">KeyBordHook_OnSpaced</span><span class="p">(</span><span class="kt">int</span> <span class="n">choose</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">choose</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">choose</span> <span class="p">=</span> <span class="n">choose</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">choose</span> <span class="p">&lt;</span> <span class="m">5</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_yuanyin</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">App</span><span class="p">.</span><span class="n">KeyBordHook</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="n">_yuanyinList</span><span class="p">[</span><span class="n">_key</span><span class="p">][</span><span class="n">choose</span><span class="p">].</span><span class="nf">ToString</span><span class="p">());</span>
                    <span class="n">_yuanyin</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                    <span class="nf">HideVexogzPybnj</span><span class="p">();</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">App</span><span class="p">.</span><span class="n">KeyBordHook</span><span class="p">.</span><span class="n">IsStarted</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">KeyBordHook_KeyUpEvent</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">Keys</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">key</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">();</span>

            <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">yuanyin</span> <span class="p">=</span> <span class="s">"a,e,i,o,u,v"</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">','</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">yuanyin</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">temp</span> <span class="p">=&gt;</span> <span class="n">temp</span> <span class="p">==</span> <span class="n">key</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_yuanyin</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">App</span><span class="p">.</span><span class="n">KeyBordHook</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="n">_key</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">_key</span> <span class="p">=</span> <span class="n">key</span><span class="p">;</span>
                <span class="nf">ShowDvfarVawmkezbi</span><span class="p">(</span><span class="n">_yuanyinList</span><span class="p">[</span><span class="n">key</span><span class="p">]);</span>
                <span class="n">_yuanyin</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_yuanyin</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">_key</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">_yuanyin</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                    <span class="n">App</span><span class="p">.</span><span class="n">KeyBordHook</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="n">_yuanyinList</span><span class="p">[</span><span class="n">_key</span><span class="p">][</span><span class="m">4</span><span class="p">].</span><span class="nf">ToString</span><span class="p">());</span>
                    <span class="n">_key</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
                    <span class="nf">HideVexogzPybnj</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="n">App</span><span class="p">.</span><span class="n">KeyBordHook</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>


        <span class="k">private</span> <span class="kt">string</span> <span class="n">_key</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">bool</span> <span class="n">_yuanyin</span><span class="p">;</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">ShowDvfarVawmkezbi</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">StringBuilder</span> <span class="n">temp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">str</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">temp</span><span class="p">.</span><span class="nf">Append</span><span class="p">((</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">+</span> <span class="s">"."</span> <span class="p">+</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">+</span> <span class="s">"    "</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">Key</span> <span class="p">=</span> <span class="n">temp</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>

            <span class="n">KqhRst</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Visible</span><span class="p">;</span>
            <span class="n">LdefkgzYclfeufwx</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Hidden</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">KeyProperty</span> <span class="p">=</span> <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span>
            <span class="k">nameof</span><span class="p">(</span><span class="n">Key</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MainWindow</span><span class="p">),</span> <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="k">default</span><span class="p">(</span><span class="kt">string</span><span class="p">)));</span>

        <span class="k">public</span> <span class="kt">string</span> <span class="n">Key</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="nf">GetValue</span><span class="p">(</span><span class="n">KeyProperty</span><span class="p">);</span>
            <span class="k">set</span> <span class="p">=&gt;</span> <span class="nf">SetValue</span><span class="p">(</span><span class="n">KeyProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">readonly</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">_yuanyinList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;()</span>
        <span class="p">{</span>
            <span class="p">{</span><span class="s">"a"</span><span class="p">,</span><span class="s">"ÄÃ¡ÇÃ a"</span> <span class="p">},</span>
            <span class="p">{</span><span class="s">"e"</span><span class="p">,</span><span class="s">"Ä“Ã©Ä›Ã¨e"</span> <span class="p">},</span>
            <span class="p">{</span><span class="s">"i"</span><span class="p">,</span><span class="s">"Ä«Ã­ÇÃ¬i"</span> <span class="p">},</span>
            <span class="p">{</span><span class="s">"o"</span><span class="p">,</span><span class="s">"ÅÃ³Ç’Ã²o"</span> <span class="p">},</span>
            <span class="p">{</span><span class="s">"u"</span><span class="p">,</span><span class="s">"Å«ÃºÇ”Ã¹u"</span> <span class="p">},</span>
            <span class="p">{</span><span class="s">"v"</span><span class="p">,</span><span class="s">"Ç–Ç˜ÇšÇœÃ¼"</span> <span class="p">},</span>
        <span class="p">};</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">class</span> <span class="nc">KeyboardHook</span>
    <span class="p">{</span>

        <span class="err">#</span><span class="n">region</span> <span class="n">win32</span>
        <span class="k">public</span> <span class="k">delegate</span> <span class="kt">int</span> <span class="nf">HookProc</span><span class="p">(</span><span class="kt">int</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">);</span>
        <span class="k">static</span> <span class="kt">int</span> <span class="n">hKeyboardHook</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">//å£°æ˜é”®ç›˜é’©å­å¤„ç†çš„åˆå§‹å€¼</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">WH_KEYBOARD_LL</span> <span class="p">=</span> <span class="m">13</span><span class="p">;</span>   <span class="c1">//çº¿ç¨‹é”®ç›˜é’©å­ç›‘å¬é¼ æ ‡æ¶ˆæ¯è®¾ä¸º2ï¼Œå…¨å±€é”®ç›˜ç›‘å¬é¼ æ ‡æ¶ˆæ¯è®¾ä¸º13</span>
        <span class="n">HookProc</span> <span class="n">KeyboardHookProcedure</span><span class="p">;</span> <span class="c1">//å£°æ˜KeyboardHookProcedureä½œä¸ºHookProcç±»å‹</span>

        <span class="c1">//é”®ç›˜ç»“æ„</span>
        <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">KeyboardHookStruct</span>
        <span class="p">{</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">vkCode</span><span class="p">;</span>  <span class="c1">//å®šä¸€ä¸ªè™šæ‹Ÿé”®ç ã€‚è¯¥ä»£ç å¿…é¡»æœ‰ä¸€ä¸ªä»·å€¼çš„èŒƒå›´1è‡³254</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">scanCode</span><span class="p">;</span> <span class="c1">// æŒ‡å®šçš„ç¡¬ä»¶æ‰«æç çš„å…³é”®</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>  <span class="c1">// é”®æ ‡å¿—</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">time</span><span class="p">;</span> <span class="c1">// æŒ‡å®šçš„æ—¶é—´æˆ³è®°çš„è¿™ä¸ªè®¯æ¯</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">dwExtraInfo</span><span class="p">;</span> <span class="c1">// æŒ‡å®šé¢å¤–ä¿¡æ¯ç›¸å…³çš„ä¿¡æ¯</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">struct</span> <span class="nc">INPUT</span>
        <span class="p">{</span>
            <span class="k">public</span> <span class="n">InputType</span> <span class="n">dwType</span><span class="p">;</span>
            <span class="k">public</span> <span class="n">KEYBDINPUT</span> <span class="n">ki</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">,</span> <span class="n">Pack</span> <span class="p">=</span> <span class="m">1</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">struct</span> <span class="nc">KEYBDINPUT</span>
        <span class="p">{</span>
            <span class="k">public</span> <span class="n">Int16</span> <span class="n">wVk</span><span class="p">;</span>
            <span class="k">public</span> <span class="n">Int16</span> <span class="n">wScan</span><span class="p">;</span>
            <span class="k">public</span> <span class="n">KEYEVENTF</span> <span class="n">dwFlags</span><span class="p">;</span>
            <span class="k">public</span> <span class="n">Int32</span> <span class="n">time</span><span class="p">;</span>
            <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">dwExtraInfo</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">enum</span> <span class="n">KEYEVENTF</span>
        <span class="p">{</span>
            <span class="n">EXTENDEDKEY</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
            <span class="n">KEYUP</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
            <span class="n">UNICODE</span> <span class="p">=</span> <span class="m">4</span><span class="p">,</span>
            <span class="n">SCANCODE</span> <span class="p">=</span> <span class="m">8</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1">//ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œå®‰è£…äº†ä¸€ä¸ªé’©å­</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">StdCall</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">SetWindowsHookEx</span><span class="p">(</span><span class="kt">int</span> <span class="n">idHook</span><span class="p">,</span> <span class="n">HookProc</span> <span class="n">lpfn</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">hInstance</span><span class="p">,</span> <span class="kt">int</span> <span class="n">threadId</span><span class="p">);</span>


        <span class="c1">//è°ƒç”¨æ­¤å‡½æ•°å¸è½½é’©å­</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">StdCall</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="nf">UnhookWindowsHookEx</span><span class="p">(</span><span class="kt">int</span> <span class="n">idHook</span><span class="p">);</span>


        <span class="c1">//ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œé€šè¿‡ä¿¡æ¯é’©å­ç»§ç»­ä¸‹ä¸€ä¸ªé’©å­</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">StdCall</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">CallNextHookEx</span><span class="p">(</span><span class="kt">int</span> <span class="n">idHook</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">);</span>


        <span class="c1">// å–å¾—å½“å‰çº¿ç¨‹ç¼–å·ï¼ˆçº¿ç¨‹é’©å­éœ€è¦ç”¨åˆ°ï¼‰</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"kernel32.dll"</span><span class="p">)]</span>
        <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">GetCurrentThreadId</span><span class="p">();</span>


        <span class="c1">//ä½¿ç”¨WINDOWS APIå‡½æ•°ä»£æ›¿è·å–å½“å‰å®ä¾‹çš„å‡½æ•°,é˜²æ­¢é’©å­å¤±æ•ˆ</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"kernel32.dll"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">GetModuleHandle</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">);</span>




        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">WM_KEYDOWN</span> <span class="p">=</span> <span class="m">0x100</span><span class="p">;</span><span class="c1">//KEYDOWN</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">WM_KEYUP</span> <span class="p">=</span> <span class="m">0x101</span><span class="p">;</span><span class="c1">//KEYUP</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">WM_SYSKEYDOWN</span> <span class="p">=</span> <span class="m">0x104</span><span class="p">;</span><span class="c1">//SYSKEYDOWN</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">WM_SYSKEYUP</span> <span class="p">=</span> <span class="m">0x105</span><span class="p">;</span><span class="c1">//SYSKEYUP</span>

        <span class="c1">//ToAsciièŒèƒ½çš„è½¬æ¢æŒ‡å®šçš„è™šæ‹Ÿé”®ç å’Œé”®ç›˜çŠ¶æ€çš„ç›¸åº”å­—ç¬¦æˆ–å­—ç¬¦</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">ToAscii</span><span class="p">(</span><span class="kt">int</span> <span class="n">uVirtKey</span><span class="p">,</span> <span class="c1">//[in] æŒ‡å®šè™šæ‹Ÿå…³é”®ä»£ç è¿›è¡Œç¿»è¯‘ã€‚</span>
            <span class="kt">int</span> <span class="n">uScanCode</span><span class="p">,</span> <span class="c1">// [in] æŒ‡å®šçš„ç¡¬ä»¶æ‰«æç çš„å…³é”®é¡»ç¿»è¯‘æˆè‹±æ–‡ã€‚é«˜é˜¶ä½çš„è¿™ä¸ªå€¼è®¾å®šçš„å…³é”®ï¼Œå¦‚æœæ˜¯ï¼ˆä¸å‹ï¼‰</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">lpbKeyState</span><span class="p">,</span> <span class="c1">// [in] æŒ‡é’ˆï¼Œä»¥256å­—èŠ‚æ•°ç»„ï¼ŒåŒ…å«å½“å‰é”®ç›˜çš„çŠ¶æ€ã€‚æ¯ä¸ªå…ƒç´ ï¼ˆå­—èŠ‚ï¼‰çš„æ•°ç»„åŒ…å«çŠ¶æ€çš„ä¸€ä¸ªå…³é”®ã€‚å¦‚æœé«˜é˜¶ä½çš„å­—èŠ‚æ˜¯ä¸€å¥—ï¼Œå…³é”®æ˜¯ä¸‹è·Œï¼ˆæŒ‰ä¸‹ï¼‰ã€‚åœ¨ä½æ¯”ç‰¹ï¼Œå¦‚æœè®¾ç½®è¡¨æ˜ï¼Œå…³é”®æ˜¯å¯¹åˆ‡æ¢ã€‚åœ¨æ­¤åŠŸèƒ½ï¼Œåªæœ‰è‚˜ä½çš„CAPS LOCKé”®æ˜¯ç›¸å…³çš„ã€‚åœ¨åˆ‡æ¢çŠ¶æ€çš„NUMä¸ªé”å’Œæ»šåŠ¨é”å®šé”®è¢«å¿½ç•¥ã€‚</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">lpwTransKey</span><span class="p">,</span> <span class="c1">// [out] æŒ‡é’ˆçš„ç¼“å†²åŒºæ”¶åˆ°ç¿»è¯‘å­—ç¬¦æˆ–å­—ç¬¦ã€‚</span>
            <span class="kt">int</span> <span class="n">fuState</span><span class="p">);</span> <span class="c1">// [in] Specifies whether a menu is active. This parameter must be 1 if a menu is active, or 0 otherwise.</span>

        <span class="c1">//è·å–æŒ‰é”®çš„çŠ¶æ€</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">GetKeyboardState</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">pbKeyState</span><span class="p">);</span>


        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">StdCall</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">short</span> <span class="nf">GetKeyState</span><span class="p">(</span><span class="kt">int</span> <span class="n">vKey</span><span class="p">);</span>

        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">StdCall</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">short</span> <span class="nf">GetAsyncKeyState</span><span class="p">(</span><span class="kt">int</span> <span class="n">vKey</span><span class="p">);</span>

        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">)]</span>
        <span class="k">internal</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">uint</span> <span class="nf">SendInput</span><span class="p">(</span><span class="kt">uint</span> <span class="n">nInputs</span><span class="p">,</span>
            <span class="p">[</span><span class="nf">MarshalAs</span><span class="p">(</span><span class="n">UnmanagedType</span><span class="p">.</span><span class="n">LPArray</span><span class="p">),</span> <span class="n">In</span><span class="p">]</span> <span class="n">INPUT</span><span class="p">[]</span> <span class="n">pInputs</span><span class="p">,</span>
            <span class="kt">int</span> <span class="n">cbSize</span><span class="p">);</span>

        <span class="err">#</span><span class="n">endregion</span>


        <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">Keys</span><span class="p">&gt;</span> <span class="n">KeyUpEvent</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">event</span> <span class="n">Action</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">OnSpaced</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">event</span> <span class="n">Action</span> <span class="n">OnBacked</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">event</span> <span class="n">Action</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">OnPaged</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// å®‰è£…é”®ç›˜é’©å­</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hKeyboardHook</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">KeyboardHookProcedure</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HookProc</span><span class="p">(</span><span class="n">KeyboardHookProc</span><span class="p">);</span>

                <span class="n">hKeyboardHook</span> <span class="p">=</span> <span class="nf">SetWindowsHookEx</span><span class="p">(</span><span class="n">WH_KEYBOARD_LL</span><span class="p">,</span> <span class="n">KeyboardHookProcedure</span><span class="p">,</span> <span class="nf">GetModuleHandle</span><span class="p">(</span><span class="n">Process</span><span class="p">.</span><span class="nf">GetCurrentProcess</span><span class="p">().</span><span class="n">MainModule</span><span class="p">.</span><span class="n">ModuleName</span><span class="p">),</span> <span class="m">0</span><span class="p">);</span>

                <span class="c1">//å¦‚æœSetWindowsHookExå¤±è´¥</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">hKeyboardHook</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="nf">Stop</span><span class="p">();</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"å®‰è£…é”®ç›˜é’©å­å¤±è´¥"</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Stop</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">retKeyboard</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>


            <span class="k">if</span> <span class="p">(</span><span class="n">hKeyboardHook</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">retKeyboard</span> <span class="p">=</span> <span class="nf">UnhookWindowsHookEx</span><span class="p">(</span><span class="n">hKeyboardHook</span><span class="p">);</span>
                <span class="n">hKeyboardHook</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(!</span><span class="n">retKeyboard</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"å¸è½½é’©å­å¤±è´¥ï¼"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Send</span><span class="p">(</span><span class="kt">string</span> <span class="n">msg</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="nf">Stop</span><span class="p">();</span>
                <span class="n">SendKeys</span><span class="p">.</span><span class="nf">SendWait</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
                <span class="nf">Start</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">isLocked</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsStarted</span> <span class="p">{</span> <span class="k">set</span><span class="p">;</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// æŒ‰é”®å¤„ç†</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="nCode"&gt;&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="wParam"&gt;&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="lParam"&gt;&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;å¦‚æœè¿”å›1ï¼Œåˆ™ç»“æŸæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸å†ä¼ é€’ã€‚å¦‚æœè¿”å›0æˆ–è°ƒç”¨CallNextHookExå‡½æ•°åˆ™æ¶ˆæ¯å‡ºäº†è¿™ä¸ªé’©å­ç»§ç»­å¾€ä¸‹ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯ä¼ ç»™æ¶ˆæ¯çœŸæ­£çš„æ¥å—è€…&lt;/returns&gt;</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="nf">KeyboardHookProc</span><span class="p">(</span><span class="kt">int</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// ä¾¦å¬é”®ç›˜äº‹ä»¶</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nCode</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">wParam</span> <span class="p">==</span> <span class="m">0x0100</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">KeyboardHookStruct</span> <span class="n">myKeyboardHookStruct</span> <span class="p">=</span> <span class="p">(</span><span class="n">KeyboardHookStruct</span><span class="p">)</span> <span class="n">Marshal</span><span class="p">.</span><span class="nf">PtrToStructure</span><span class="p">(</span><span class="n">lParam</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">KeyboardHookStruct</span><span class="p">));</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">==</span> <span class="m">27</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">Environment</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="err">#</span><span class="n">region</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">isLocked</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="err">#</span><span class="n">region</span> <span class="n">page</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">==</span> <span class="m">33</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">OnPaged</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(-</span><span class="m">1</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">==</span> <span class="m">34</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">OnPaged</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="err">#</span><span class="n">endregion</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">IsStarted</span> <span class="p">&amp;&amp;</span> <span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">&gt;=</span> <span class="m">48</span> <span class="p">&amp;&amp;</span> <span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">&lt;=</span> <span class="m">57</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">var</span> <span class="n">c</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(((</span><span class="kt">char</span><span class="p">)</span> <span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span><span class="p">).</span><span class="nf">ToString</span><span class="p">());</span>
                        <span class="n">OnSpaced</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
                        <span class="n">IsStarted</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                        <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">IsStarted</span> <span class="p">&amp;&amp;</span> <span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">==</span> <span class="m">8</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">OnBacked</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">();</span>

                        <span class="k">return</span> <span class="n">IsStarted</span> <span class="p">?</span> <span class="m">1</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">&gt;=</span> <span class="m">65</span> <span class="p">&amp;&amp;</span> <span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">&lt;=</span> <span class="m">90</span><span class="p">)</span> <span class="p">||</span> <span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">==</span> <span class="m">32</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">&gt;=</span> <span class="m">65</span> <span class="p">&amp;&amp;</span> <span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">&lt;=</span> <span class="m">90</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">Keys</span> <span class="n">keyData</span> <span class="p">=</span> <span class="p">(</span><span class="n">Keys</span><span class="p">)</span> <span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span><span class="p">;</span>
                            <span class="n">KeyUpEvent</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">keyData</span><span class="p">);</span>
                            <span class="n">IsStarted</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">myKeyboardHookStruct</span><span class="p">.</span><span class="n">vkCode</span> <span class="p">==</span> <span class="m">32</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">IsStarted</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                            <span class="n">OnSpaced</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">return</span> <span class="n">IsStarted</span> <span class="p">?</span> <span class="m">1</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="err">#</span><span class="n">endregion</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">CallNextHookEx</span><span class="p">(</span><span class="n">hKeyboardHook</span><span class="p">,</span> <span class="n">nCode</span><span class="p">,</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">lParam</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>å‚è§ï¼š<a href="http://www.cnblogs.com/yswenli/p/6528447.html">C# è¾“å…¥æ³•</a></p>

:ET