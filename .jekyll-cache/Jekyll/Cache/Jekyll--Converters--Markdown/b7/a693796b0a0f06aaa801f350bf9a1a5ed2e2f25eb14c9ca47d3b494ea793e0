I"Ğ2<p>ç”¨ WPF å¼€å‘ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨çš„éš¾åº¦å¾ˆä½ï¼Œå› ä¸ºè¡Œä¸šé‡Œé¢æœ‰å¾ˆå¤šå°ä¼™ä¼´å¼€å‘è¿‡ï¼Œè¿™äº›å°ä¼™ä¼´å°†è‡ªå·±çš„ä»£ç å¼€æºäº†ï¼Œå‘å¸ƒåˆ° NuGet ä¸Šï¼Œæ‰€ä»¥è®©æˆ‘å¼€å‘ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨çš„éš¾åº¦å®åœ¨å¤ªä½ã€‚åœ¨ä¸è¦æœ‰å¥‡ç‰¹çš„è¦æ±‚æƒ…å†µä¸‹ï¼Œé€šè¿‡ AvalonEdit å¯ä»¥å¿«é€Ÿå¼€å‘å‡ºè‡ªå·±æƒ³è¦çš„ä»£ç ç¼–è¾‘å™¨</p>

<!--more-->

<!-- CreateTime:2020/1/22 17:11:30 -->

<p>ç¬¬ä¸€æ­¥é€šè¿‡ NuGet å®‰è£… <a href="https://www.nuget.org/packages/AvalonEdit">AvalonEdit</a> æ‰“å¼€ xaml ç•Œé¢ï¼Œæ·»åŠ æ§ä»¶ï¼Œæ­¤æ—¶å¯ä»¥åœ¨ç•Œé¢è®¾ç½®ä»£ç é«˜äº®æ–¹å¼ç­‰</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;avalonEdit:TextEditor</span>
            <span class="na">xmlns:avalonEdit=</span><span class="s">"http://icsharpcode.net/sharpdevelop/avalonedit"</span>
            <span class="na">Name=</span><span class="s">"TextEditor"</span>
            <span class="na">SyntaxHighlighting=</span><span class="s">"C#"</span>
            <span class="na">FontFamily=</span><span class="s">"Consolas"</span>
            <span class="na">FontSize=</span><span class="s">"10pt"</span> 
            <span class="na">LineNumbersForeground=</span><span class="s">"Black"</span> 
            <span class="na">ShowLineNumbers=</span><span class="s">"True"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;avalonEdit:TextEditor.Options&gt;</span>
                <span class="nt">&lt;avalonEdit:TextEditorOptions</span> <span class="na">ShowSpaces=</span><span class="s">"True"</span> <span class="nt">&gt;</span>
                    <span class="nt">&lt;avalonEdit:TextEditorOptions.ColumnRulerPosition&gt;</span>
                        <span class="nt">&lt;system:Int32&gt;</span>10<span class="nt">&lt;/system:Int32&gt;</span>
                    <span class="nt">&lt;/avalonEdit:TextEditorOptions.ColumnRulerPosition&gt;</span>
                <span class="nt">&lt;/avalonEdit:TextEditorOptions&gt;</span>
            <span class="nt">&lt;/avalonEdit:TextEditor.Options&gt;</span>
        <span class="nt">&lt;/avalonEdit:TextEditor&gt;</span>
</code></pre></div></div>

<p>ä¸‹é¢æ˜¯è¯¦ç»†ä¸€ç‚¹çš„å‚æ•°å«ä¹‰</p>

<p>ç¬¬äºŒå¥è¯çš„ <code class="language-plaintext highlighter-rouge">xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"</code> æ˜¯å‘½åç©ºé—´</p>

<p>è®¾ç½® AvalonEdit è¿›è¡Œä»£ç é«˜äº®ï¼Œå¯ä»¥è‡ªå®šä¹‰é«˜äº®é¢œè‰²ç­‰ï¼Œè®¾ç½®å¯¹ C# ä»£ç è¿›è¡Œé«˜äº®æ–¹æ³•æ˜¯ <code class="language-plaintext highlighter-rouge">SyntaxHighlighting="C#"</code> è€Œå¯¹ xml é«˜äº®çš„æ–¹æ³•è‡ªç„¶å°±æ˜¯å°† C# ä¿®æ”¹ä¸º XML è¯·çœ‹ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">SyntaxHighlighting</span><span class="p">=</span><span class="s">"XML"</span>
</code></pre></div></div>

<p>è®¾ç½® AvalonEdit çš„ä»£ç å­—ä½“å’Œå¤§å°åˆ†åˆ«æ˜¯ FontFamily å’Œ FontSize å±æ€§</p>

<p>å¾ˆå¤šä»£ç ç¼–è¾‘å™¨éƒ½æœ‰è¡Œå·ï¼Œé€šè¿‡ <code class="language-plaintext highlighter-rouge">ShowLineNumbers</code> å±æ€§è®©è‡ªå·±ç”¨ WPF å†™çš„ä»£ç ç¼–è¾‘å™¨å¯ä»¥æ˜¾ç¤ºè¡Œå·</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ShowLineNumbers</span><span class="p">=</span><span class="s">"True"</span>
</code></pre></div></div>

<p>ä½œä¸ºä»£ç ç¼–è¾‘å™¨ï¼Œè¿˜æœ‰ä¸€é¡¹åŠŸèƒ½æ˜¯éœ€è¦å°†ç©ºæ ¼ç”¨ <code class="language-plaintext highlighter-rouge">Â·</code> æ˜¾ç¤ºï¼Œé€šè¿‡è®¾ç½® TextEditorOptions çš„æ–¹æ³•</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="nt">&lt;avalonEdit:TextEditor.Options&gt;</span>
                <span class="nt">&lt;avalonEdit:TextEditorOptions</span> <span class="na">ShowSpaces=</span><span class="s">"True"</span> <span class="nt">&gt;</span>
                    <span class="nt">&lt;avalonEdit:TextEditorOptions.ColumnRulerPosition&gt;</span>
                        <span class="nt">&lt;system:Int32&gt;</span>10<span class="nt">&lt;/system:Int32&gt;</span>
                    <span class="nt">&lt;/avalonEdit:TextEditorOptions.ColumnRulerPosition&gt;</span>
                <span class="nt">&lt;/avalonEdit:TextEditorOptions&gt;</span>
            <span class="nt">&lt;/avalonEdit:TextEditor.Options&gt;</span>
</code></pre></div></div>

<p>ä»£ç å¯¹é½å¾ˆé‡è¦ï¼Œæœ€ç®€å•çš„ä»£ç å¯¹é½å°±æ˜¯ç»§æ‰¿ä¸Šä¸€è¡Œçš„ç©ºæ ¼æ•°é‡ï¼Œé€šè¿‡ä¸‹é¢å±æ€§è®© AvalonEdit æ”¯æŒè®¾ç½®ç»§æ‰¿ä¸Šä¸€è¡Œçš„è¡Œé¦–ç©ºæ ¼</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="nt">&lt;avalonEdit:TextEditor.Options&gt;</span>
                <span class="nt">&lt;avalonEdit:TextEditorOptions</span> <span class="na">ShowSpaces=</span><span class="s">"True"</span> <span class="na">WordWrapIndentation=</span><span class="s">"4"</span> <span class="na">InheritWordWrapIndentation=</span><span class="s">"true"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;avalonEdit:TextEditorOptions.ColumnRulerPosition&gt;</span>
                        <span class="nt">&lt;system:Int32&gt;</span>10<span class="nt">&lt;/system:Int32&gt;</span>
                    <span class="nt">&lt;/avalonEdit:TextEditorOptions.ColumnRulerPosition&gt;</span>
                <span class="nt">&lt;/avalonEdit:TextEditorOptions&gt;</span>
            <span class="nt">&lt;/avalonEdit:TextEditor.Options&gt;</span>
</code></pre></div></div>

<p>ä½œä¸ºä»£ç ç¼–è¾‘å™¨ï¼Œå¦‚ä½•èƒ½ä¸è‡ªåŠ¨æç¤ºï¼Ÿè‡ªåŠ¨æç¤ºä¹Ÿå°±æ˜¯ç”¨æˆ·è¾“å…¥ç‰¹æ®Šå­—ç¬¦æ—¶ï¼Œå¦‚ç©ºæ ¼å’Œ <code class="language-plaintext highlighter-rouge">.</code> æç¤ºç”¨æˆ·å¯ä»¥è¾“å…¥çš„å†…å®¹</p>

<p>åœ¨ç”¨æˆ·è¾“å…¥ç‰¹æ®Šå­—ç¬¦è§¦å‘ç‰¹å®šäº‹ä»¶å¯ä»¥é€šè¿‡ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="n">TextEditor</span><span class="p">.</span><span class="n">TextArea</span><span class="p">.</span><span class="n">TextEntered</span> <span class="p">+=</span> <span class="n">TextAreaOnTextEntered</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">TextAreaOnTextEntered</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">TextCompositionEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Text</span> <span class="p">==</span> <span class="s">"."</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç å°†ä¼šåœ¨ç”¨æˆ·è¾“å…¥ <code class="language-plaintext highlighter-rouge">.</code> è¿›å…¥åˆ¤æ–­</p>

<p>åœ¨ AvalonEdit é€šè¿‡ CompletionWindow ç±»åšåˆ°ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼Œéœ€è¦å…ˆè‡ªå·±ç»§æ‰¿ ICompletionData æ¥å£åˆ›å»ºæç¤ºæ•°æ®</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">CompletionData</span> <span class="p">:</span> <span class="n">ICompletionData</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">CompletionData</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Text</span> <span class="p">=</span> <span class="n">text</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">ImageSource</span> <span class="n">Image</span> <span class="p">=&gt;</span> <span class="k">null</span><span class="p">;</span>

        <span class="k">public</span> <span class="kt">string</span> <span class="n">Text</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span>  <span class="p">}</span>

        <span class="k">public</span> <span class="kt">object</span> <span class="n">Content</span> <span class="p">=&gt;</span> <span class="n">Text</span><span class="p">;</span>

        <span class="k">public</span> <span class="kt">object</span> <span class="n">Description</span> <span class="p">=&gt;</span> <span class="s">"Description for "</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>

        <span class="c1">/// &lt;inheritdoc /&gt;</span>
        <span class="k">public</span> <span class="kt">double</span> <span class="n">Priority</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Complete</span><span class="p">(</span><span class="n">TextArea</span> <span class="n">textArea</span><span class="p">,</span> <span class="n">ISegment</span> <span class="n">completionSegment</span><span class="p">,</span>
            <span class="n">EventArgs</span> <span class="n">insertionRequestEventArgs</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">textArea</span><span class="p">.</span><span class="n">Document</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="n">completionSegment</span><span class="p">,</span> <span class="n">Text</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>åŸºæœ¬ä¸Šçœ‹åˆ°å‚æ•°å¤§å®¶éƒ½ç†è§£è¿™æ˜¯ç”¨æ¥åšä»€ä¹ˆ</p>

<p>åˆ›å»ºCompletionWindowç„¶åæ˜¾ç¤ºä»£ç å¦‚ä¸‹</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">TextAreaOnTextEntered</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">TextCompositionEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Text</span> <span class="p">==</span> <span class="s">"."</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_completionWindow</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CompletionWindow</span><span class="p">(</span><span class="n">TextEditor</span><span class="p">.</span><span class="n">TextArea</span><span class="p">);</span>

                <span class="kt">var</span> <span class="n">completionData</span> <span class="p">=</span> <span class="n">_completionWindow</span><span class="p">.</span><span class="n">CompletionList</span><span class="p">.</span><span class="n">CompletionData</span><span class="p">;</span>
                <span class="n">completionData</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">CompletionData</span><span class="p">(</span><span class="s">"æ—å¾·ç†™æ˜¯é€—æ¯”"</span><span class="p">));</span>
                <span class="n">_completionWindow</span><span class="p">.</span><span class="nf">Show</span><span class="p">();</span>

                <span class="n">_completionWindow</span><span class="p">.</span><span class="n">Closed</span> <span class="p">+=</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">_completionWindow</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">CompletionWindow</span> <span class="n">_completionWindow</span><span class="p">;</span>
</code></pre></div></div>

<p>å¤§æ¦‚çš„æ•ˆæœå¦‚ä¸‹</p>

<!-- ![](image/WPF ç”¨ AvalonEdit å¼€å‘ç®€å•çš„ä»£ç ç¼–è¾‘å™¨ æ”¯æŒé«˜äº®è‡ªåŠ¨æç¤º/WPF ç”¨ AvalonEdit å¼€å‘ç®€å•çš„ä»£ç ç¼–è¾‘å™¨ æ”¯æŒé«˜äº®è‡ªåŠ¨æç¤º0.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F202012217649554.jpg" alt="" /></p>

<p>æœ¬æ–‡çš„ä»£ç æ”¾åœ¨ <a href="https://github.com/lindexi/lindexi_gd/tree/7d40e0de674f9892b6fce9014f07074de47bfe75/NakacehenaHemqawhearlel">github</a> æ¬¢è¿å°ä¼™ä¼´è®¿é—®</p>

:ET