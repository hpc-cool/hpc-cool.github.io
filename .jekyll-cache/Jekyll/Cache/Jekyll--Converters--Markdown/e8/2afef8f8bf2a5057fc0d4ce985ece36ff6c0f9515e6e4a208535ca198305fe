I"ñ=<p>åœ¨ WPF ä¸­ï¼Œå¦‚æœæ˜¯é¼ æ ‡ç‚¹å‡»æ‹–åŠ¨çª—å£åæ ‡ï¼Œå¯ä»¥è°ƒç”¨ Window çš„ DragMove æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœæ˜¯è§¦æ‘¸ï¼Œå°±éœ€è¦è‡ªå·±è°ƒç”¨ Win32 çš„æ–¹æ³•å®ç°</p>

<!--more-->

<!-- CreateTime:2020/11/26 10:07:10 -->

<p>åœ¨ WPF ä¸­ï¼Œè°ƒç”¨ Window çš„ DragMove æ–¹æ³•è¦æ±‚é¼ æ ‡çš„å·¦é”®ï¼ˆä¸»é”®ï¼‰æŒ‰ä¸‹ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡ºå¦‚ä¸‹ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">System</span><span class="p">.</span><span class="n">InvalidOperationException</span><span class="p">:</span><span class="err">â€œåªèƒ½åœ¨æŒ‰ä¸‹ä¸»é¼ æ ‡æŒ‰é’®æ—¶è°ƒç”¨</span> <span class="n">DragMove</span><span class="err">ã€‚â€</span>
</code></pre></div></div>

<p>æˆ–è‹±æ–‡ç‰ˆçš„ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">System</span><span class="p">.</span><span class="n">InvalidOperationException</span><span class="p">:</span><span class="s">"Can only call DragMove when primary mouse button is down"</span>
</code></pre></div></div>

<p>å› æ­¤æƒ³è¦åœ¨ WPF ä¸­ä½¿ç”¨æ‰‹æŒ‡ finger è¿›è¡Œ Touch è§¦æ‘¸æ‹–æ‹½çª—å£ï¼Œæ‹–åŠ¨ä¿®æ”¹çª—å£åæ ‡å°±éœ€è¦ç”¨åˆ° Win32 çš„æ–¹æ³•äº†ã€‚ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨ä¿®æ”¹æŸä¸ªå®¹å™¨çš„åæ ‡çš„æ—¶å€™ï¼Œä¸èƒ½ä½¿ç”¨è¿™ä¸ªå®¹å™¨å†…çš„åæ ‡åšå‚è€ƒï¼Œæ‰€ä»¥åœ¨ Touch æ‹–åŠ¨ä¿®æ”¹çª—å£åæ ‡çš„æ—¶å€™ï¼Œå°±ä¸èƒ½ä½¿ç”¨ç›‘å¬çª—å£çš„äº‹ä»¶æ‹¿åˆ°çš„åæ ‡æ¥ä½œä¸ºå‚è€ƒ</p>

<p>æƒ³è¦èƒ½å¹³æ»‘çš„ç§»åŠ¨çª—å£ï¼Œå°±éœ€è¦è·å–ç›¸å¯¹äºå±å¹•çš„åæ ‡ï¼Œè€Œå¦‚æœæ­¤æ—¶å¤„ç†å¤šæŒ‡çš„ Manipulation çš„åŠ¨ä½œï¼Œé‚£ä¹ˆæ•´ä¸ªé€»è¾‘å°†ä¼šéå¸¸å¤æ‚ã€‚æœ¬æ–‡ä»…ä»…æ”¯æŒä½¿ç”¨ä¸€ä¸ªæ‰‹æŒ‡çš„ç§»åŠ¨ï¼Œå› ä¸ºä½¿ç”¨äº† GetCursorPos çš„æ–¹æ³•</p>

<p>å½“ç„¶äº†ï¼Œæ­¤æ—¶å‡è£…æ˜¯æ”¯æŒå¤šæŒ‡æ‹–åŠ¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªéœ€è¦åœ¨è¿›è¡Œå¤šæŒ‡è§¦æ‘¸çš„æ—¶å€™å¼€å¯æ‹–åŠ¨å°±å¯ä»¥äº†ï¼Œæ­¤æ—¶ç”¨æˆ·çš„äº¤äº’ä¸Šä¸ä¼šæœ‰å¾ˆå¤§çš„å·®åˆ«</p>

<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå’±æ¥å°è£…ä¸€ä¸ªç±» DragMoveWindowHelper ç”¨æ¥åœ¨è§¦æ‘¸ä¸‹æ‹–åŠ¨çª—å£</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">DragMoveWindowHelper</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">DragMove</span><span class="p">(</span><span class="n">Window</span> <span class="n">window</span><span class="p">)</span>
        <span class="p">{</span>
        	<span class="c1">// è¿™é‡Œçš„ DragMoveMode åœ¨ä¸‹æ–‡å®ç°</span>
            <span class="kt">var</span> <span class="n">dragMoveMode</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DragMoveMode</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
            <span class="n">dragMoveMode</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç çš„ DragMoveMode ç±»æ”¾åœ¨ä¸‹æ–‡å®ç°ã€‚åœ¨å°è£…å®Œæˆäº† DragMoveWindowHelper ç±»å°±å¯ä»¥å°è¯•åœ¨æ‹–åŠ¨çš„æ—¶å€™ä½¿ç”¨ï¼Œå¦‚ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>

            <span class="n">TouchDown</span> <span class="p">+=</span> <span class="n">MainWindow_TouchDown</span><span class="p">;</span>
            <span class="n">TouchUp</span> <span class="p">+=</span> <span class="n">MainWindow_TouchUp</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">MainWindow_TouchUp</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">TouchEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_currentTouchCount</span><span class="p">--;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">MainWindow_TouchDown</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">TouchEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">CaptureTouch</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">TouchDevice</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">_currentTouchCount</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">DragMoveWindowHelper</span><span class="p">.</span><span class="nf">DragMove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">_currentTouchCount</span><span class="p">++;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">uint</span> <span class="n">_currentTouchCount</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç æœ‰ä¸€ç‚¹éœ€è¦å°å¿ƒå°±æ˜¯ CaptureTouch æ˜¯å¿…å¤‡çš„ï¼Œå¦åˆ™ä½ ä¼šå‘ç°æ‹–åŠ¨çš„æ—¶å€™ï¼Œæ‹–åŠ¨å¤ªå¿«äº†ï¼Œå°±ä¸¢å¤±è§¦æ‘¸è®¾å¤‡äº†ï¼Œè§¦æ‘¸è®¾å¤‡è¢«ä½ çª—å£åé¢çš„å…¶ä»–è½¯ä»¶æŠ“äº†</p>

<p>ä¸‹é¢å¼€å§‹å®ç° DragMoveMode ä¹Ÿå°±æ˜¯æ ¸å¿ƒçš„é€šè¿‡è§¦æ‘¸æ‹–åŠ¨çª—å£çš„é€»è¾‘</p>

<p>å¤§æ¦‚å¯¹å¤–çš„æ¥å£æ–¹æ³•å®ç°è¯·çœ‹ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">class</span> <span class="nc">DragMoveMode</span>
        <span class="p">{</span>
            <span class="k">public</span> <span class="nf">DragMoveMode</span><span class="p">(</span><span class="n">Window</span> <span class="n">window</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_window</span> <span class="p">=</span> <span class="n">window</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">window</span> <span class="p">=</span> <span class="n">_window</span><span class="p">;</span>

                <span class="n">window</span><span class="p">.</span><span class="n">PreviewMouseMove</span> <span class="p">+=</span> <span class="n">Window_PreviewMouseMove</span><span class="p">;</span>
                <span class="n">window</span><span class="p">.</span><span class="n">PreviewMouseUp</span> <span class="p">+=</span> <span class="n">Window_PreviewMouseUp</span><span class="p">;</span>
                <span class="n">window</span><span class="p">.</span><span class="n">LostMouseCapture</span> <span class="p">+=</span> <span class="n">Window_LostMouseCapture</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">void</span> <span class="nf">Stop</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Window</span> <span class="n">window</span> <span class="p">=</span> <span class="n">_window</span><span class="p">;</span>

                <span class="n">window</span><span class="p">.</span><span class="n">PreviewMouseMove</span> <span class="p">-=</span> <span class="n">Window_PreviewMouseMove</span><span class="p">;</span>
                <span class="n">window</span><span class="p">.</span><span class="n">PreviewMouseUp</span> <span class="p">-=</span> <span class="n">Window_PreviewMouseUp</span><span class="p">;</span>
                <span class="n">window</span><span class="p">.</span><span class="n">LostMouseCapture</span> <span class="p">-=</span> <span class="n">Window_LostMouseCapture</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">private</span> <span class="k">readonly</span> <span class="n">Window</span> <span class="n">_window</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>åœ¨ä¸Šé¢ä»£ç é‡Œé¢ç›‘å¬ PreviewMouseMove æ˜¯ä¸ºäº†è·å–ç§»åŠ¨çš„æ—¶æœºï¼Œè€Œä¸æ˜¯ä¸ºäº†è·å–ç›¸å¯¹çš„åæ ‡ã€‚è€Œ PreviewMouseUp å¯ä»¥ç”¨æ¥äº†è§£å•¥æ—¶å€™ç»“æŸã€‚å½“ç„¶äº† LostMouseCapture ä¹Ÿéœ€è¦ç›‘å¬ï¼Œå’Œ PreviewMouseUp ä¸€æ ·ç”¨æ¥äº†è§£å•¥æ—¶å€™ç»“æŸ</p>

<p>åœ¨ Window_PreviewMouseMove æ–¹æ³•éœ€è¦å…ˆåˆ¤æ–­æ˜¯å¦ç¬¬ä¸€æ¬¡è¿›å…¥ç§»åŠ¨ï¼Œå› æ­¤å’±æ²¡æœ‰ç›‘å¬ MouseDown æ–¹æ³•ã€‚ä¸ºä»€ä¹ˆæ²¡æœ‰ç›‘å¬ MouseDown æ–¹æ³•ï¼Œæ˜¯å› ä¸ºåœ¨ä¸Šå±‚ä¸šåŠ¡æ­¤æ—¶ä¸šåŠ¡è°ƒç”¨ MoseDown å®Œæˆ</p>

<p>åˆ¤æ–­æ˜¯å¦ç¬¬ä¸€æ¬¡è¿›å…¥ç§»åŠ¨éœ€è¦ä¸€ä¸ªè¾…åŠ©çš„å­—æ®µï¼Œå’±å®šä¹‰ä¸€ä¸ªå«ä¸Šä¸€æ¬¡ç‚¹å‡»çš„åæ ‡å­—æ®µ</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">private</span> <span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="n">Point</span><span class="p">?</span> <span class="n">_lastPoint</span><span class="p">;</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç çš„ Win32.User32 æ˜¯æˆ‘å®šä¹‰çš„ä»£ç ï¼Œè¿™äº›å®šä¹‰å°†ä¼šæ”¾åœ¨æœ¬æ–‡æœ€å</p>

<p>åˆ¤æ–­æ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥ç§»åŠ¨å¯ä»¥ä½¿ç”¨ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">private</span> <span class="k">void</span> <span class="nf">Window_PreviewMouseMove</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MouseEventArgs</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="nf">GetCursorPos</span><span class="p">(</span><span class="k">out</span> <span class="kt">var</span> <span class="n">lpPoint</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">_lastPoint</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">_lastPoint</span> <span class="p">=</span> <span class="n">lpPoint</span><span class="p">;</span>
                    <span class="n">_window</span><span class="p">.</span><span class="nf">CaptureMouse</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
</code></pre></div></div>

<p>é€šè¿‡ GetCursorPos çš„ Win32 æ–¹æ³•å¯ä»¥æ‹¿åˆ°ç›¸å¯¹äºå±å¹•åæ ‡çš„é¼ æ ‡åæ ‡ï¼Œè€Œè§¦æ‘¸é»˜è®¤ä¼šå°†ç¬¬ä¸€ä¸ªè§¦æ‘¸ç‚¹è½¬æ¢ä¸ºé¼ æ ‡åæ ‡ï¼Œå› æ­¤æ‹¿åˆ°çš„åæ ‡ç‚¹ä¸æ˜¯ç›¸å¯¹äºçª—å£å†…çš„ï¼Œè¿™æ ·å°±èƒ½åšåˆ°åœ¨ç§»åŠ¨çš„æ—¶å€™ä¸ä¼šæŠ–</p>

<p>æ¥ä¸‹æ¥åˆ¤æ–­ç›¸å¯¹ä¸Šä¸€æ¬¡çš„ç§»åŠ¨è·ç¦»ï¼Œå¦‚ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                <span class="kt">var</span> <span class="n">dx</span> <span class="p">=</span> <span class="n">lpPoint</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">_lastPoint</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">dy</span> <span class="p">=</span> <span class="n">lpPoint</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">_lastPoint</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>

                <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"dx=</span><span class="p">{</span><span class="n">dx</span><span class="p">}</span><span class="s"> dy=</span><span class="p">{</span><span class="n">dy</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
</code></pre></div></div>

<p>æ‹¿åˆ°çš„ dx å’Œ dy å°±å¯ä»¥ç”¨æ¥è®¾ç½®çª—å£çš„å·¦ä¸Šè§’åæ ‡äº†ã€‚è€Œæ­¤æ—¶ä¸èƒ½é€šè¿‡ Window çš„ Top å’Œ Left å±æ€§è·å–ï¼Œè¿™ä¸¤ä¸ªå±æ€§çš„å€¼ä½¿ç”¨çš„æ˜¯ WPF å•ä½å’Œåæ ‡ï¼Œè€Œå’±è®¡ç®—çš„ dx å’Œ dy æ˜¯ç›¸å¯¹äºå±å¹•çš„åæ ‡ï¼Œå› æ­¤éœ€è¦è°ƒç”¨ GetWindowRect è¿™ä¸ª win32 æ–¹æ³•è·å–çª—å£æ‰€åœ¨å±å¹•çš„åæ ‡</p>

<p>è®¾ç½®çª—å£åæ ‡ä¹Ÿéœ€è¦ä½¿ç”¨å±å¹•åæ ‡æ¥è®¾ç½®ï¼Œéœ€è¦è°ƒç”¨ SetWindowPos æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="kt">var</span> <span class="n">handle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WindowInteropHelper</span><span class="p">(</span><span class="n">_window</span><span class="p">).</span><span class="n">Handle</span><span class="p">;</span>

     <span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="nf">GetWindowRect</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">lpRect</span><span class="p">);</span>

     <span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="nf">SetWindowPos</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">lpRect</span><span class="p">.</span><span class="n">Left</span> <span class="p">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">lpRect</span><span class="p">.</span><span class="n">Top</span> <span class="p">+</span> <span class="n">dy</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span>
                        <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="n">WindowPositionFlags</span><span class="p">.</span><span class="n">SWP_NOSIZE</span> <span class="p">|</span>
                               <span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="n">WindowPositionFlags</span><span class="p">.</span><span class="n">SWP_NOZORDER</span><span class="p">));</span>
</code></pre></div></div>

<p>è¿™ä¸ª Window_PreviewMouseMove æ–¹æ³•ä»£ç å¦‚ä¸‹</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">private</span> <span class="k">void</span> <span class="nf">Window_PreviewMouseMove</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MouseEventArgs</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="nf">GetCursorPos</span><span class="p">(</span><span class="k">out</span> <span class="kt">var</span> <span class="n">lpPoint</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">_lastPoint</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">_lastPoint</span> <span class="p">=</span> <span class="n">lpPoint</span><span class="p">;</span>
                    <span class="n">_window</span><span class="p">.</span><span class="nf">CaptureMouse</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="kt">var</span> <span class="n">dx</span> <span class="p">=</span> <span class="n">lpPoint</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">_lastPoint</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">dy</span> <span class="p">=</span> <span class="n">lpPoint</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">_lastPoint</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>

                <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"dx=</span><span class="p">{</span><span class="n">dx</span><span class="p">}</span><span class="s"> dy=</span><span class="p">{</span><span class="n">dy</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

                <span class="c1">// ä»¥ä¸‹çš„ 60 æ˜¯è¡¨ç¤ºæœ€å¤§ç§»åŠ¨é€Ÿåº¦</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="p">&lt;</span> <span class="m">60</span> <span class="p">&amp;&amp;</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="p">&lt;</span> <span class="m">60</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">handle</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WindowInteropHelper</span><span class="p">(</span><span class="n">_window</span><span class="p">).</span><span class="n">Handle</span><span class="p">;</span>

                    <span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="nf">GetWindowRect</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">lpRect</span><span class="p">);</span>

                    <span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="nf">SetWindowPos</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">lpRect</span><span class="p">.</span><span class="n">Left</span> <span class="p">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">lpRect</span><span class="p">.</span><span class="n">Top</span> <span class="p">+</span> <span class="n">dy</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span>
                        <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="n">WindowPositionFlags</span><span class="p">.</span><span class="n">SWP_NOSIZE</span> <span class="p">|</span>
                               <span class="n">Win32</span><span class="p">.</span><span class="n">User32</span><span class="p">.</span><span class="n">WindowPositionFlags</span><span class="p">.</span><span class="n">SWP_NOZORDER</span><span class="p">));</span>
                <span class="p">}</span>

                <span class="n">_lastPoint</span> <span class="p">=</span> <span class="n">lpPoint</span><span class="p">;</span>
            <span class="p">}</span>

</code></pre></div></div>

<p>åœ¨ Window_PreviewMouseUp å’Œ Window_LostMouseCapture æ–¹æ³•è°ƒç”¨çš„æ˜¯æ¸…ç†çš„ä»£ç ï¼Œè§£å†³å†…å­˜æ³„éœ²</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">private</span> <span class="k">void</span> <span class="nf">Window_LostMouseCapture</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MouseEventArgs</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">Stop</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">private</span> <span class="k">void</span> <span class="nf">Window_PreviewMouseUp</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MouseButtonEventArgs</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">Stop</span><span class="p">();</span>
            <span class="p">}</span>
</code></pre></div></div>

<p>å¤§æ¦‚å°±å®Œæˆäº†è§¦æ‘¸æ‹–åŠ¨çª—å£çš„é€»è¾‘ï¼Œä¸‹é¢ä»£ç æ˜¯ Win32 çš„ä»£ç ï¼Œéœ€è¦åŠ åˆ°ä½ çš„ä»£ç é‡Œé¢ï¼Œè¿™æ ·æ‰èƒ½æ„å»ºé€šè¿‡</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Win32</span>
        <span class="p">{</span>
            <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">User32</span>
            <span class="p">{</span>
                <span class="c1">/// &lt;summary&gt;</span>
                <span class="c1">/// æ”¹å˜ä¸€ä¸ªå­çª—å£ã€å¼¹å‡ºå¼çª—å£å’Œé¡¶å±‚çª—å£çš„å°ºå¯¸ã€ä½ç½®å’Œ Z åºã€‚</span>
                <span class="c1">/// &lt;/summary&gt;</span>
                <span class="c1">/// &lt;param name="hWnd"&gt;çª—å£å¥æŸ„ã€‚&lt;/param&gt;</span>
                <span class="c1">/// &lt;param name="hWndInsertAfter"&gt;</span>
                <span class="c1">/// åœ¨zåºä¸­çš„ä½äºè¢«ç½®ä½çš„çª—å£å‰çš„çª—å£å¥æŸ„ã€‚è¯¥å‚æ•°å¿…é¡»ä¸ºä¸€ä¸ªçª—å£å¥æŸ„ï¼Œæˆ–ä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š</span>
                <span class="c1">/// &lt;para&gt;HWND_BOTTOMï¼šå°†çª—å£ç½®äº Z åºçš„åº•éƒ¨ã€‚å¦‚æœå‚æ•°hWndæ ‡è¯†äº†ä¸€ä¸ªé¡¶å±‚çª—å£ï¼Œåˆ™çª—å£å¤±å»é¡¶çº§ä½ç½®ï¼Œå¹¶ä¸”è¢«ç½®åœ¨å…¶ä»–çª—å£çš„åº•éƒ¨ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;HWND_NOTOPMOSTï¼šå°†çª—å£ç½®äºæ‰€æœ‰éé¡¶å±‚çª—å£ä¹‹ä¸Šï¼ˆå³åœ¨æ‰€æœ‰é¡¶å±‚çª—å£ä¹‹åï¼‰ã€‚å¦‚æœçª—å£å·²ç»æ˜¯éé¡¶å±‚çª—å£åˆ™è¯¥æ ‡å¿—ä¸èµ·ä½œç”¨ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;HWND_TOPï¼šå°†çª—å£ç½®äºZåºçš„é¡¶éƒ¨ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;HWND_TOPMOSTï¼šå°†çª—å£ç½®äºæ‰€æœ‰éé¡¶å±‚çª—å£ä¹‹ä¸Šã€‚å³ä½¿çª—å£æœªè¢«æ¿€æ´»çª—å£ä¹Ÿå°†ä¿æŒé¡¶çº§ä½ç½®ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;/param&gt;</span>
                <span class="c1">/// &lt;param name="x"&gt;ä»¥å®¢æˆ·åæ ‡æŒ‡å®šçª—å£æ–°ä½ç½®çš„å·¦è¾¹ç•Œã€‚&lt;/param&gt;</span>
                <span class="c1">/// &lt;param name="y"&gt;ä»¥å®¢æˆ·åæ ‡æŒ‡å®šçª—å£æ–°ä½ç½®çš„é¡¶è¾¹ç•Œã€‚&lt;/param&gt;</span>
                <span class="c1">/// &lt;param name="cx"&gt;ä»¥åƒç´ æŒ‡å®šçª—å£çš„æ–°çš„å®½åº¦ã€‚&lt;/param&gt;</span>
                <span class="c1">/// &lt;param name="cy"&gt;ä»¥åƒç´ æŒ‡å®šçª—å£çš„æ–°çš„é«˜åº¦ã€‚&lt;/param&gt;</span>
                <span class="c1">/// &lt;param name="wFlagslong"&gt;</span>
                <span class="c1">/// çª—å£å°ºå¯¸å’Œå®šä½çš„æ ‡å¿—ã€‚è¯¥å‚æ•°å¯ä»¥æ˜¯ä¸‹åˆ—å€¼çš„ç»„åˆï¼š</span>
                <span class="c1">/// &lt;para&gt;SWP_ASYNCWINDOWPOSï¼šå¦‚æœè°ƒç”¨è¿›ç¨‹ä¸æ‹¥æœ‰çª—å£ï¼Œç³»ç»Ÿä¼šå‘æ‹¥æœ‰çª—å£çš„çº¿ç¨‹å‘å‡ºéœ€æ±‚ã€‚è¿™å°±é˜²æ­¢è°ƒç”¨çº¿ç¨‹åœ¨å…¶ä»–çº¿ç¨‹å¤„ç†éœ€æ±‚çš„æ—¶å€™å‘ç”Ÿæ­»é”ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_DEFERERASEï¼šé˜²æ­¢äº§ç”Ÿ WM_SYNCPAINT æ¶ˆæ¯ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_DRAWFRAMEï¼šåœ¨çª—å£å‘¨å›´ç”»ä¸€ä¸ªè¾¹æ¡†ï¼ˆå®šä¹‰åœ¨çª—å£ç±»æè¿°ä¸­ï¼‰ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_FRAMECHANGEDï¼šç»™çª—å£å‘é€ WM_NCCALCSIZE æ¶ˆæ¯ï¼Œå³ä½¿çª—å£å°ºå¯¸æ²¡æœ‰æ”¹å˜ä¹Ÿä¼šå‘é€è¯¥æ¶ˆæ¯ã€‚å¦‚æœæœªæŒ‡å®šè¿™ä¸ªæ ‡å¿—ï¼Œåªæœ‰åœ¨æ”¹å˜äº†çª—å£å°ºå¯¸æ—¶æ‰å‘é€ WM_NCCALCSIZEã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_HIDEWINDOWï¼šéšè—çª—å£ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_NOACTIVATEï¼šä¸æ¿€æ´»çª—å£ã€‚å¦‚æœæœªè®¾ç½®æ ‡å¿—ï¼Œåˆ™çª—å£è¢«æ¿€æ´»ï¼Œå¹¶è¢«è®¾ç½®åˆ°å…¶ä»–æœ€é«˜çº§çª—å£æˆ–éæœ€é«˜çº§ç»„çš„é¡¶éƒ¨ï¼ˆæ ¹æ®å‚æ•°hWndlnsertAfterè®¾ç½®ï¼‰ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_NOCOPYBITSï¼šæ¸…é™¤å®¢æˆ·åŒºçš„æ‰€æœ‰å†…å®¹ã€‚å¦‚æœæœªè®¾ç½®è¯¥æ ‡å¿—ï¼Œå®¢æˆ·åŒºçš„æœ‰æ•ˆå†…å®¹è¢«ä¿å­˜å¹¶ä¸”åœ¨çª—å£å°ºå¯¸æ›´æ–°å’Œé‡å®šä½åæ‹·è´å›å®¢æˆ·åŒºã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_NOMOVEï¼šç»´æŒå½“å‰ä½ç½®ï¼ˆå¿½ç•¥Xå’ŒYå‚æ•°ï¼‰ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_NOOWNERZORDERï¼šä¸æ”¹å˜ Z åºä¸­çš„æ‰€æœ‰è€…çª—å£çš„ä½ç½®ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_NOREDRAWï¼šä¸é‡ç”»æ”¹å˜çš„å†…å®¹ã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªæ ‡å¿—ï¼Œåˆ™ä¸å‘ç”Ÿä»»ä½•é‡ç”»åŠ¨ä½œã€‚é€‚ç”¨äºå®¢æˆ·åŒºå’Œéå®¢æˆ·åŒºï¼ˆåŒ…æ‹¬æ ‡é¢˜æ å’Œæ»šåŠ¨æ¡ï¼‰å’Œä»»ä½•ç”±äºçª—å›ç§»åŠ¨è€Œéœ²å‡ºçš„çˆ¶çª—å£çš„æ‰€æœ‰éƒ¨åˆ†ã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªæ ‡å¿—ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»æ˜ç¡®åœ°ä½¿çª—å£æ— æ•ˆå¹¶åŒºé‡ç”»çª—å£çš„ä»»ä½•éƒ¨åˆ†å’Œçˆ¶çª—å£éœ€è¦é‡ç”»çš„éƒ¨åˆ†ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_NOREPOSITIONï¼šä¸ SWP_NOOWNERZORDER æ ‡å¿—ç›¸åŒã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_NOSENDCHANGINGï¼šé˜²æ­¢çª—å£æ¥æ”¶ WM_WINDOWPOSCHANGING æ¶ˆæ¯ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_NOSIZEï¼šç»´æŒå½“å‰å°ºå¯¸ï¼ˆå¿½ç•¥ cx å’Œ cy å‚æ•°ï¼‰ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_NOZORDERï¼šç»´æŒå½“å‰ Z åºï¼ˆå¿½ç•¥ hWndlnsertAfter å‚æ•°ï¼‰ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;para&gt;SWP_SHOWWINDOWï¼šæ˜¾ç¤ºçª—å£ã€‚&lt;/para&gt;</span>
                <span class="c1">/// &lt;/param&gt;</span>
                <span class="c1">/// &lt;returns&gt;å¦‚æœå‡½æ•°æˆåŠŸï¼Œè¿”å›å€¼ä¸ºéé›¶ï¼›å¦‚æœå‡½æ•°å¤±è´¥ï¼Œè¿”å›å€¼ä¸ºé›¶ã€‚è‹¥æƒ³è·å¾—æ›´å¤šé”™è¯¯æ¶ˆæ¯ï¼Œè¯·è°ƒç”¨ GetLastError å‡½æ•°ã€‚&lt;/returns&gt;</span>
                <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="n">LibraryName</span><span class="p">,</span> <span class="n">ExactSpelling</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
                <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="n">Int32</span> <span class="nf">SetWindowPos</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">hWndInsertAfter</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">x</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">y</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">cx</span><span class="p">,</span>
                    <span class="n">Int32</span> <span class="n">cy</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">wFlagslong</span><span class="p">);</span>

                <span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
                <span class="k">public</span> <span class="k">enum</span> <span class="n">WindowPositionFlags</span>
                <span class="p">{</span>
                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     If the calling thread and the thread that owns the window are attached to different input queues, the system posts</span>
                    <span class="c1">///     the request to the thread that owns the window. This prevents the calling thread from blocking its execution while</span>
                    <span class="c1">///     other threads process the request.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_ASYNCWINDOWPOS</span> <span class="p">=</span> <span class="m">0x4000</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Prevents generation of the WM_SYNCPAINT message.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_DEFERERASE</span> <span class="p">=</span> <span class="m">0x2000</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Draws a frame (defined in the window's class description) around the window.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_DRAWFRAME</span> <span class="p">=</span> <span class="m">0x0020</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Applies new frame styles set using the SetWindowLong function. Sends a WM_NCCALCSIZE message to the window, even if</span>
                    <span class="c1">///     the window's size is not being changed. If this flag is not specified, WM_NCCALCSIZE is sent only when the window's</span>
                    <span class="c1">///     size is being changed.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_FRAMECHANGED</span> <span class="p">=</span> <span class="m">0x0020</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Hides the window.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_HIDEWINDOW</span> <span class="p">=</span> <span class="m">0x0080</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Does not activate the window. If this flag is not set, the window is activated and moved to the top of either the</span>
                    <span class="c1">///     topmost or non-topmost group (depending on the setting of the hWndInsertAfter parameter).</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_NOACTIVATE</span> <span class="p">=</span> <span class="m">0x0010</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Discards the entire contents of the client area. If this flag is not specified, the valid contents of the client</span>
                    <span class="c1">///     area are saved and copied back into the client area after the window is sized or repositioned.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_NOCOPYBITS</span> <span class="p">=</span> <span class="m">0x0100</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Retains the current position (ignores X and Y parameters).</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_NOMOVE</span> <span class="p">=</span> <span class="m">0x0002</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Does not change the owner window's position in the Z order.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_NOOWNERZORDER</span> <span class="p">=</span> <span class="m">0x0200</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Does not redraw changes. If this flag is set, no repainting of any kind occurs. This applies to the client area,</span>
                    <span class="c1">///     the nonclient area (including the title bar and scroll bars), and any part of the parent window uncovered as a</span>
                    <span class="c1">///     result of the window being moved. When this flag is set, the application must explicitly invalidate or redraw any</span>
                    <span class="c1">///     parts of the window and parent window that need redrawing.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_NOREDRAW</span> <span class="p">=</span> <span class="m">0x0008</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Same as the SWP_NOOWNERZORDER flag.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_NOREPOSITION</span> <span class="p">=</span> <span class="m">0x0200</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Prevents the window from receiving the WM_WINDOWPOSCHANGING message.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_NOSENDCHANGING</span> <span class="p">=</span> <span class="m">0x0400</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Retains the current size (ignores the cx and cy parameters).</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_NOSIZE</span> <span class="p">=</span> <span class="m">0x0001</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Retains the current Z order (ignores the hWndInsertAfter parameter).</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_NOZORDER</span> <span class="p">=</span> <span class="m">0x0004</span><span class="p">,</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///     Displays the window.</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="n">SWP_SHOWWINDOW</span> <span class="p">=</span> <span class="m">0x0040</span>
                <span class="p">}</span>


                <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">LibraryName</span> <span class="p">=</span> <span class="s">"user32"</span><span class="p">;</span>

                <span class="c1">/// &lt;summary&gt;</span>
                <span class="c1">/// è·å–çš„æ˜¯ä»¥å±å¹•ä¸ºåæ ‡è½´çª—å£åæ ‡</span>
                <span class="c1">/// &lt;/summary&gt;</span>
                <span class="c1">/// &lt;param name="hWnd"&gt;&lt;/param&gt;</span>
                <span class="c1">/// &lt;param name="lpRect"&gt;&lt;/param&gt;</span>
                <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
                <span class="p">[</span><span class="k">return</span><span class="p">:</span> <span class="nf">MarshalAs</span><span class="p">(</span><span class="n">UnmanagedType</span><span class="p">.</span><span class="n">Bool</span><span class="p">)]</span>
                <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="n">LibraryName</span><span class="p">,</span> <span class="n">ExactSpelling</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
                <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="nf">GetWindowRect</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">,</span> <span class="k">out</span> <span class="n">Rectangle</span> <span class="n">lpRect</span><span class="p">);</span>

                <span class="c1">/// &lt;summary&gt;</span>
                <span class="c1">/// åœ¨ Win32 å‡½æ•°ä½¿ç”¨çš„çŸ©å½¢</span>
                <span class="c1">/// &lt;/summary&gt;</span>
                <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
                <span class="k">public</span> <span class="k">partial</span> <span class="k">struct</span> <span class="nc">Rectangle</span> <span class="p">:</span> <span class="n">IEquatable</span><span class="p">&lt;</span><span class="n">Rectangle</span><span class="p">&gt;</span>
                <span class="p">{</span>
                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">///  åˆ›å»ºåœ¨ Win32 å‡½æ•°ä½¿ç”¨çš„çŸ©å½¢</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="c1">/// &lt;param name="left"&gt;&lt;/param&gt;</span>
                    <span class="c1">/// &lt;param name="top"&gt;&lt;/param&gt;</span>
                    <span class="c1">/// &lt;param name="right"&gt;&lt;/param&gt;</span>
                    <span class="c1">/// &lt;param name="bottom"&gt;&lt;/param&gt;</span>
                    <span class="k">public</span> <span class="nf">Rectangle</span><span class="p">(</span><span class="kt">int</span> <span class="n">left</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">top</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">right</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bottom</span> <span class="p">=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">Left</span> <span class="p">=</span> <span class="n">left</span><span class="p">;</span>
                        <span class="n">Top</span> <span class="p">=</span> <span class="n">top</span><span class="p">;</span>
                        <span class="n">Right</span> <span class="p">=</span> <span class="n">right</span><span class="p">;</span>
                        <span class="n">Bottom</span> <span class="p">=</span> <span class="n">bottom</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">/// åˆ›å»ºåœ¨ Win32 å‡½æ•°ä½¿ç”¨çš„çŸ©å½¢</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="c1">/// &lt;param name="width"&gt;çŸ©å½¢çš„å®½åº¦&lt;/param&gt;</span>
                    <span class="c1">/// &lt;param name="height"&gt;çŸ©å½¢çš„é«˜åº¦&lt;/param&gt;</span>
                    <span class="k">public</span> <span class="nf">Rectangle</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span> <span class="p">=</span> <span class="m">0</span><span class="p">)</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
                    <span class="p">{</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="kt">int</span> <span class="n">Left</span><span class="p">;</span>
                    <span class="k">public</span> <span class="kt">int</span> <span class="n">Top</span><span class="p">;</span>
                    <span class="k">public</span> <span class="kt">int</span> <span class="n">Right</span><span class="p">;</span>
                    <span class="k">public</span> <span class="kt">int</span> <span class="n">Bottom</span><span class="p">;</span>

                    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">Rectangle</span> <span class="n">other</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">Left</span> <span class="p">==</span> <span class="n">other</span><span class="p">.</span><span class="n">Left</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">Right</span> <span class="p">==</span> <span class="n">other</span><span class="p">.</span><span class="n">Right</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">Top</span> <span class="p">==</span> <span class="n">other</span><span class="p">.</span><span class="n">Top</span><span class="p">)</span> <span class="p">&amp;&amp;</span>
                               <span class="p">(</span><span class="n">Bottom</span> <span class="p">==</span> <span class="n">other</span><span class="p">.</span><span class="n">Bottom</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">return</span> <span class="n">obj</span> <span class="k">is</span> <span class="n">Rectangle</span> <span class="p">&amp;&amp;</span> <span class="nf">Equals</span><span class="p">((</span><span class="n">Rectangle</span><span class="p">)</span> <span class="n">obj</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="k">operator</span> <span class="p">==(</span><span class="n">Rectangle</span> <span class="n">left</span><span class="p">,</span> <span class="n">Rectangle</span> <span class="n">right</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">return</span> <span class="n">left</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">right</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="k">operator</span> <span class="p">!=(</span><span class="n">Rectangle</span> <span class="n">left</span><span class="p">,</span> <span class="n">Rectangle</span> <span class="n">right</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">return</span> <span class="p">!(</span><span class="n">left</span> <span class="p">==</span> <span class="n">right</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="k">unchecked</span>
                        <span class="p">{</span>
                            <span class="kt">var</span> <span class="n">hashCode</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Left</span><span class="p">;</span>
                            <span class="n">hashCode</span> <span class="p">=</span> <span class="p">(</span><span class="n">hashCode</span> <span class="p">*</span> <span class="m">397</span><span class="p">)</span> <span class="p">^</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Top</span><span class="p">;</span>
                            <span class="n">hashCode</span> <span class="p">=</span> <span class="p">(</span><span class="n">hashCode</span> <span class="p">*</span> <span class="m">397</span><span class="p">)</span> <span class="p">^</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Right</span><span class="p">;</span>
                            <span class="n">hashCode</span> <span class="p">=</span> <span class="p">(</span><span class="n">hashCode</span> <span class="p">*</span> <span class="m">397</span><span class="p">)</span> <span class="p">^</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Bottom</span><span class="p">;</span>
                            <span class="k">return</span> <span class="n">hashCode</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">/// è·å–å½“å‰çŸ©å½¢æ˜¯å¦ç©ºçŸ©å½¢</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsEmpty</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="n">Left</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="n">Top</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="n">Right</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">==</span> <span class="m">0</span><span class="p">;</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">/// çŸ©å½¢çš„å®½åº¦</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="k">public</span> <span class="kt">int</span> <span class="n">Width</span>
                    <span class="p">{</span>
                        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">unchecked</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">Right</span> <span class="p">-</span> <span class="n">Left</span><span class="p">));</span> <span class="p">}</span>
                        <span class="k">set</span> <span class="p">{</span> <span class="n">Right</span> <span class="p">=</span> <span class="k">unchecked</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">Left</span> <span class="p">+</span> <span class="k">value</span><span class="p">));</span> <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">/// çŸ©å½¢çš„é«˜åº¦</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="k">public</span> <span class="kt">int</span> <span class="n">Height</span>
                    <span class="p">{</span>
                        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">unchecked</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">Bottom</span> <span class="p">-</span> <span class="n">Top</span><span class="p">));</span> <span class="p">}</span>
                        <span class="k">set</span> <span class="p">{</span> <span class="n">Bottom</span> <span class="p">=</span> <span class="k">unchecked</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">Top</span> <span class="p">+</span> <span class="k">value</span><span class="p">));</span> <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="c1">/// &lt;summary&gt;</span>
                    <span class="c1">/// é€šè¿‡ xã€y åæ ‡å’Œå®½åº¦é«˜åº¦åˆ›å»ºçŸ©å½¢</span>
                    <span class="c1">/// &lt;/summary&gt;</span>
                    <span class="c1">/// &lt;param name="x"&gt;&lt;/param&gt;</span>
                    <span class="c1">/// &lt;param name="y"&gt;&lt;/param&gt;</span>
                    <span class="c1">/// &lt;param name="width"&gt;&lt;/param&gt;</span>
                    <span class="c1">/// &lt;param name="height"&gt;&lt;/param&gt;</span>
                    <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
                    <span class="k">public</span> <span class="k">static</span> <span class="n">Rectangle</span> <span class="nf">Create</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">unchecked</span>
                        <span class="p">{</span>
                            <span class="k">return</span> <span class="k">new</span> <span class="nf">Rectangle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">width</span> <span class="p">+</span> <span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">height</span> <span class="p">+</span> <span class="n">y</span><span class="p">));</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="n">Rectangle</span> <span class="nf">From</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">lvalue</span><span class="p">,</span> <span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">rvalue</span><span class="p">,</span>
                        <span class="n">Func</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span> <span class="n">leftTopOperation</span><span class="p">,</span>
                        <span class="n">Func</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span> <span class="n">rightBottomOperation</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">rightBottomOperation</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                            <span class="n">rightBottomOperation</span> <span class="p">=</span> <span class="n">leftTopOperation</span><span class="p">;</span>
                        <span class="k">return</span> <span class="k">new</span> <span class="nf">Rectangle</span><span class="p">(</span>
                            <span class="nf">leftTopOperation</span><span class="p">(</span><span class="n">lvalue</span><span class="p">.</span><span class="n">Left</span><span class="p">,</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Left</span><span class="p">),</span>
                            <span class="nf">leftTopOperation</span><span class="p">(</span><span class="n">lvalue</span><span class="p">.</span><span class="n">Top</span><span class="p">,</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Top</span><span class="p">),</span>
                            <span class="nf">rightBottomOperation</span><span class="p">(</span><span class="n">lvalue</span><span class="p">.</span><span class="n">Right</span><span class="p">,</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Right</span><span class="p">),</span>
                            <span class="nf">rightBottomOperation</span><span class="p">(</span><span class="n">lvalue</span><span class="p">.</span><span class="n">Bottom</span><span class="p">,</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Bottom</span><span class="p">)</span>
                        <span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">Add</span><span class="p">(</span><span class="n">Rectangle</span> <span class="k">value</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">Add</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="k">ref</span> <span class="k">value</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">Subtract</span><span class="p">(</span><span class="n">Rectangle</span> <span class="k">value</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">Subtract</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="k">ref</span> <span class="k">value</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">Multiply</span><span class="p">(</span><span class="n">Rectangle</span> <span class="k">value</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">Multiply</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="k">ref</span> <span class="k">value</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">Divide</span><span class="p">(</span><span class="n">Rectangle</span> <span class="k">value</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">Divide</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="k">ref</span> <span class="k">value</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">Deflate</span><span class="p">(</span><span class="n">Rectangle</span> <span class="k">value</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">Deflate</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="k">ref</span> <span class="k">value</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">Inflate</span><span class="p">(</span><span class="n">Rectangle</span> <span class="k">value</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">Inflate</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="k">ref</span> <span class="k">value</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">Offset</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">Offset</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">OffsetTo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">OffsetTo</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">Scale</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">Scale</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">void</span> <span class="nf">ScaleTo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">ScaleTo</span><span class="p">(</span><span class="k">ref</span> <span class="k">this</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Add</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">lvalue</span><span class="p">,</span> <span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">rvalue</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Left</span> <span class="p">+=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Top</span> <span class="p">+=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Top</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Right</span> <span class="p">+=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">+=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Bottom</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Subtract</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">lvalue</span><span class="p">,</span> <span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">rvalue</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Left</span> <span class="p">-=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Top</span> <span class="p">-=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Top</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Right</span> <span class="p">-=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">-=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Bottom</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Multiply</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">lvalue</span><span class="p">,</span> <span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">rvalue</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Left</span> <span class="p">*=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Top</span> <span class="p">*=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Top</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Right</span> <span class="p">*=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">*=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Bottom</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Divide</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">lvalue</span><span class="p">,</span> <span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">rvalue</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Left</span> <span class="p">/=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Top</span> <span class="p">/=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Top</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Right</span> <span class="p">/=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
                        <span class="n">lvalue</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">/=</span> <span class="n">rvalue</span><span class="p">.</span><span class="n">Bottom</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Deflate</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">target</span><span class="p">,</span> <span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">deflation</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Top</span> <span class="p">+=</span> <span class="n">deflation</span><span class="p">.</span><span class="n">Top</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Left</span> <span class="p">+=</span> <span class="n">deflation</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">-=</span> <span class="n">deflation</span><span class="p">.</span><span class="n">Bottom</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Right</span> <span class="p">-=</span> <span class="n">deflation</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Inflate</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">target</span><span class="p">,</span> <span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">inflation</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Top</span> <span class="p">-=</span> <span class="n">inflation</span><span class="p">.</span><span class="n">Top</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Left</span> <span class="p">-=</span> <span class="n">inflation</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">+=</span> <span class="n">inflation</span><span class="p">.</span><span class="n">Bottom</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Right</span> <span class="p">+=</span> <span class="n">inflation</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Offset</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">target</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Top</span> <span class="p">+=</span> <span class="n">y</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Left</span> <span class="p">+=</span> <span class="n">x</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">+=</span> <span class="n">y</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Right</span> <span class="p">+=</span> <span class="n">x</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">OffsetTo</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">target</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">var</span> <span class="n">width</span> <span class="p">=</span> <span class="n">target</span><span class="p">.</span><span class="n">Width</span><span class="p">;</span>
                        <span class="kt">var</span> <span class="n">height</span> <span class="p">=</span> <span class="n">target</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Left</span> <span class="p">=</span> <span class="n">x</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Top</span> <span class="p">=</span> <span class="n">y</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Right</span> <span class="p">=</span> <span class="n">width</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">=</span> <span class="n">height</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Scale</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">target</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Top</span> <span class="p">*=</span> <span class="n">y</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Left</span> <span class="p">*=</span> <span class="n">x</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Bottom</span> <span class="p">*=</span> <span class="n">y</span><span class="p">;</span>
                        <span class="n">target</span><span class="p">.</span><span class="n">Right</span> <span class="p">*=</span> <span class="n">x</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">ScaleTo</span><span class="p">(</span><span class="k">ref</span> <span class="n">Rectangle</span> <span class="n">target</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">unchecked</span>
                        <span class="p">{</span>
                            <span class="n">x</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">Left</span> <span class="p">/</span> <span class="n">x</span><span class="p">);</span>
                            <span class="n">y</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">Top</span> <span class="p">/</span> <span class="n">y</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="nf">Scale</span><span class="p">(</span><span class="k">ref</span> <span class="n">target</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="n">LibraryName</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
                <span class="p">[</span><span class="k">return</span><span class="p">:</span> <span class="nf">MarshalAs</span><span class="p">(</span><span class="n">UnmanagedType</span><span class="p">.</span><span class="n">Bool</span><span class="p">)]</span>
                <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="nf">GetCursorPos</span><span class="p">(</span><span class="k">out</span> <span class="n">Point</span> <span class="n">lpPoint</span><span class="p">);</span>

                <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
                <span class="k">public</span> <span class="k">struct</span> <span class="nc">Point</span>
                <span class="p">{</span>
                    <span class="k">public</span> <span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
                    <span class="k">public</span> <span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>

                    <span class="k">public</span> <span class="nf">Point</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="n">X</span> <span class="p">=</span> <span class="n">x</span><span class="p">;</span>
                        <span class="k">this</span><span class="p">.</span><span class="n">Y</span> <span class="p">=</span> <span class="n">y</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">implicit</span> <span class="k">operator</span> <span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="nf">Point</span><span class="p">(</span><span class="n">Point</span> <span class="n">p</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">return</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="nf">Point</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">public</span> <span class="k">static</span> <span class="k">implicit</span> <span class="k">operator</span> <span class="nf">Point</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">Point</span> <span class="n">p</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">return</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>å¦‚æœå‘ç°ä½ çš„ä»£ç ä¾ç„¶æ— æ³•æ„å»ºé€šè¿‡ï¼Œè¿˜è¯·å‚é˜…æˆ‘çš„æµ‹è¯•ä»£ç ä»é‡Œé¢æŠ„ä»£ç è§£å†³æ‰¾ä¸åˆ°æŸä¸ªç±»</p>

<p>æœ¬æ–‡ä»£ç æ”¾åœ¨<a href="https://github.com/lindexi/lindexi_gd/tree/a4e6bdc2a18cddea7defa4abcf461629e30763d2/BeehijemwaboHaihafobe">github</a>æ¬¢è¿å°ä¼™ä¼´è®¿é—®</p>

<p>å…³äº Win32 æ–¹æ³•çš„å®šä¹‰ï¼Œæˆ‘æ¨èä½¿ç”¨å®˜æ–¹çš„ <a href="https://github.com/dotnet/pinvoke">dotnet/pinvoke: A library containing all P/Invoke code so you donâ€™t have to import it every time. Maintained and updated to support the latest Windows OS.</a> åº“</p>

<p>æ›´å¤šè§¦æ‘¸è¯·çœ‹ <a href="https://blog.lindexi.com/post/WPF-%E8%A7%A6%E6%91%B8%E7%9B%B8%E5%85%B3.html">WPF è§¦æ‘¸ç›¸å…³</a></p>

<p>å‚è€ƒ</p>

<p><a href="https://www.codeproject.com/Questions/669512/WPF-Touch-DragMove">WPF Touch DragMove() - CodeProject</a></p>

<p><a href="https://www.codeproject.com/Questions/671379/How-to-drag-window-with-finger-not-mouse">[Solved] How to drag window with finger not mouse - CodeProject</a></p>

<p><a href="https://stackoverflow.com/questions/3274097/way-to-make-a-windowless-wpf-window-draggable-without-getting-invalidoperationex/3275712#3275712">Way to make a Windowless WPF window draggable without getting InvalidOperationException - Stack Overflow</a></p>

<p><a href="https://social.msdn.microsoft.com/Forums/vstudio/en-US/975aa7ec-8558-4dcc-90b5-ca12555faa34/can-only-call-dragmove-when-primary-mouse-button-is-down?forum=wpf">Can only call DragMove when primary mouse button is down.</a></p>

<p><a href="https://github.com/microsoft/XamlBehaviorsWpf">microsoft/XamlBehaviorsWpf: Home for WPF XAML Behaviors on GitHub.</a></p>

:ET