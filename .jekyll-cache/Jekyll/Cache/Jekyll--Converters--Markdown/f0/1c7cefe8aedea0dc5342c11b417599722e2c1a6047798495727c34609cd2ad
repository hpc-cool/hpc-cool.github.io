I"À®<p>æœ¬æ–‡å‘Šè¯‰å¤§å®¶ä¸€ä¸ªå°è£…å¥½çš„åº“ï¼Œä½¿ç”¨è¿™ä¸ªåº“å¯ä»¥å¿«é€Ÿæ­å»ºå¤šè¿›ç¨‹ç›¸äº’ä½¿ç”¨ã€‚</p>

<!--more-->

<!-- CreateTime:2019/2/16 9:40:26 -->

<!-- csdn -->
<div id="toc"></div>
<!-- æ ‡ç­¾ï¼šWPFï¼Œdotnetremotingï¼Œrpcï¼Œ -->

<p>åœ¨ <a href="https://lindexi.gitee.io/post/WPF-%E4%BD%BF%E7%94%A8RPC%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%E8%BF%9B%E7%A8%8B.html">WPF ä½¿ç”¨RPCè°ƒç”¨å…¶ä»–è¿›ç¨‹</a> å·²ç»å‘Šè¯‰å¤§å®¶è°ƒç”¨çš„åŸç†ï¼Œä½†æ˜¯å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœè‡ªå·±å†™ä¸€ä¸ªæ¡†æ¶æ˜¯æ¯”è¾ƒéš¾çš„ã€‚</p>

<p>å› ä¸ºæˆ‘ç»å¸¸è°ƒç”¨ C++ ä»£ç ï¼Œå¦‚æœC++å‡ºç°å¼‚å¸¸ï¼Œè½¯ä»¶ä¼šç›´æ¥é€€å‡ºï¼Œæ‰€ä»¥æˆ‘å°±æƒ³æŠŠ C++ ä»£ç æ”¾åœ¨å…¶ä»–è¿›ç¨‹ï¼Œè¿™æ ·C++è¿è¡Œå‡ºç°å¼‚å¸¸äº†ï¼Œè½¯ä»¶ä¹Ÿä¸ä¼šç›´æ¥é€€å‡ºã€‚</p>

<p>ä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½éœ€è¦è‡ªå·±å†™ç›¸åŒçš„ä»£ç ï¼Œæˆ‘æ˜¯ä¸åŒæ„çš„ï¼Œå› ä¸ºå¾ˆå®¹æ˜“å†™é”™ã€‚</p>

<p>å› ä¸ºæˆ‘çš„ä»£ç æ”¾åœ¨äº†å…¬å¸ä»£ç ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šæŠŠæºä»£ç æ”¾å‡ºæ¥ï¼Œä½†æ˜¯å¤§å®¶å¯ä»¥é€šè¿‡å¤åˆ¶æœ¬æ–‡çš„ç±»æ¥åˆ›å»ºæ¡†æ¶ã€‚</p>

<h2 id="åˆ›å»ºç«¯å£">åˆ›å»ºç«¯å£</h2>

<p>åˆ›å»ºç«¯å£åŒ…å«ä¸€ä¸ªæ¥å£å’Œä¸€ä¸ªç±»ï¼Œå› ä¸ºæˆ‘éœ€è¦åœ¨ä¸€ä¸ªè®¾å¤‡è¿è¡Œï¼Œæ‰€ä»¥ä¸ºäº†æ€§èƒ½ï¼Œæˆ‘ä¸ä½¿ç”¨ http è¿æ¥ï¼Œè¿™æ—¶çš„ç«¯å£å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²</p>

<p>ä¸ºäº†åŒºåˆ†ä¸¤ä¸ªç¨‹åºï¼Œæˆ‘æŠŠç¨‹åºåˆ†ä¸ºä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ WPF ç¨‹åºï¼Œä¸€ä¸ªæ˜¯C++ç¨‹åºã€‚å› ä¸ºå¦ä¸€ä¸ªç¨‹åºä¸»è¦æ˜¯è¿è¡Œ C++ ä»£ç ã€‚</p>

<p>ä¸ºäº†è®©ä¸¤ä¸ªç¨‹åºèƒ½è”ç³»ï¼Œå°±éœ€è¦çº¦å®šç«¯å£ï¼Œå› ä¸ºè¿™æ˜¯æ¡†æ¶ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ http é€šä¿¡ï¼Œæ‰€ä»¥å°±éœ€è¦å†™ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ http ä¿®æ”¹ç«¯å£å°±ç»§æ‰¿ï¼Œè¿™æ ·æ¡†æ¶æ‰å¯ä»¥åœ¨å¾ˆå¤šåœ°æ–¹ä½¿ç”¨ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">///     åˆ›å»ºç«¯å£</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IPortGenerator</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è·å¾—ç«¯å£</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="kt">string</span> <span class="nf">GetPort</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>å› ä¸ºæˆ‘éœ€è¦åœ¨ä¸€ä¸ªç³»ç»Ÿè¿è¡Œä¸¤ä¸ªç¨‹åºï¼Œæ‰€ä»¥æˆ‘çš„ç«¯å£æ˜¯è¿™æ ·å†™</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">///     åˆ›å»ºç«¯å£</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">PortGenerator</span> <span class="p">:</span> <span class="n">IPortGenerator</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è·å¾—ä¸€ä¸ªéšæœºç«¯å£</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetPort</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">int</span> <span class="n">maxPort</span> <span class="p">=</span> <span class="m">65535</span><span class="p">;</span>
            <span class="k">const</span> <span class="kt">int</span> <span class="n">minPort</span> <span class="p">=</span> <span class="m">49152</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Process</span><span class="p">.</span><span class="nf">GetCurrentProcess</span><span class="p">().</span><span class="n">Id</span> <span class="p">%</span> <span class="p">(</span><span class="n">maxPort</span> <span class="p">-</span> <span class="n">minPort</span><span class="p">)</span> <span class="p">+</span> <span class="n">minPort</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span> <span class="c1">//è·å¾—è¿›ç¨‹IDä½œä¸ºç«¯å£å·</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<h2 id="è°ƒç”¨è½¯ä»¶">è°ƒç”¨è½¯ä»¶</h2>

<p>ä» WPF ç¨‹åºè°ƒç”¨ C++ ç¨‹åºéœ€è¦å‘Šè¯‰ä»–å‚æ•°ï¼Œå‚æ•°å°±æ˜¯åˆšæ‰çš„ç«¯å£</p>

<p>è¿™æ—¶ C++ ç¨‹åºä½¿ç”¨å‘½ä»¤è¡Œè§£æï¼Œè¯·çœ‹<a href="https://walterlv.github.io/post/mcmaster-extensions-commandlineutils.html">å®‰åˆ©ä¸€æ¬¾éå¸¸å¥½ç”¨çš„å‘½ä»¤è¡Œå‚æ•°åº“ï¼šMcMaster.Extensions.CommandLineUtils - walterlv</a></p>

<p>åˆ›å»ºä¸€ä¸ªç±»ç”¨æ¥è§£æ</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Options</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">Option</span><span class="p">(</span><span class="sc">'p'</span><span class="p">,</span> <span class="s">"port"</span><span class="p">,</span> <span class="n">Required</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">HelpText</span> <span class="p">=</span> <span class="s">"è¿œç¨‹å¼€å¯çš„ç«¯å£"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Port</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>è§£æåªéœ€è¦ä½¿ç”¨ä¸»å‡½æ•°ä¼ å…¥çš„ args å°±å¯ä»¥æ‹¿åˆ°ç«¯å£</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">Parser</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">ParseArguments</span><span class="p">&lt;</span><span class="n">Options</span><span class="p">&gt;(</span><span class="n">args</span><span class="p">).</span><span class="nf">MapResult</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ç«¯å£å·"</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">Port</span><span class="p">);</span>
                <span class="k">new</span> <span class="nf">Thread</span><span class="p">(()</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"å¯åŠ¨åº“"</span><span class="p">);</span>
                    <span class="nf">Run</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Port</span><span class="p">,</span> <span class="n">assembly</span><span class="p">);</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"å¯åŠ¨å®Œæˆ"</span><span class="p">);</span>
                <span class="p">}).</span><span class="nf">Start</span><span class="p">();</span>
                <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">},</span> <span class="n">_</span> <span class="p">=&gt;</span> <span class="p">-</span><span class="m">1</span><span class="p">);</span>
</code></pre></div></div>

<p>è¿™é‡Œå¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹å› ä¸ºC++ç¨‹åºéœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªçº¿ç¨‹å»è®¡ç®—ï¼Œä¸»å‡½æ•°çš„çº¿ç¨‹ä¼šå¦‚æœæ²¡æœ‰ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Console.Read()</code> ä¼šé€€å‡ºã€‚</p>

<p>ç°åœ¨ WPF å¯ä»¥å¼€å§‹è°ƒç”¨ C++ ç¨‹åºï¼Œä½¿ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œç®¡ç†</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">///     ç®¡ç†å…¶ä»–è¿›ç¨‹</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">RemoteProcessManager</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     ç®¡ç†å…¶ä»–è¿›ç¨‹</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="processName"&gt;è¿›ç¨‹åï¼Œç”¨äºå¯åŠ¨è¿›ç¨‹&lt;/param&gt;</span>
        <span class="k">public</span> <span class="nf">RemoteProcessManager</span><span class="p">(</span><span class="kt">string</span> <span class="n">processName</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ProcessName</span> <span class="p">=</span> <span class="n">processName</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è·å–ç®¡ç†çš„è¿›ç¨‹</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">ProcessName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è·å–æ˜¯å¦è¿æ¥</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsConnected</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     åˆ›å»ºç«¯å£</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="n">IPortGenerator</span> <span class="n">PortGenerator</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>


        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è¿œç¨‹åº”ç”¨é€€å‡ºæ—¶ï¼Œå»ºè®®ç›‘å¬åä½¿ç”¨å¼‚å¸¸</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span> <span class="n">RemoteExited</span><span class="p">;</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     è¿æ¥</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Connect</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">IsConnected</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"ç¦æ­¢å¤šæ¬¡è¿æ¥"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">IsConnected</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">PortGenerator</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">PortGenerator</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PortGenerator</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="n">Port</span> <span class="p">=</span> <span class="n">PortGenerator</span><span class="p">.</span><span class="nf">GetPort</span><span class="p">();</span>

            <span class="c1">//å¯åŠ¨è¿œç¨‹è¿›ç¨‹</span>
            <span class="kt">var</span> <span class="n">st</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ProcessStartInfo</span><span class="p">(</span><span class="n">ProcessName</span><span class="p">,</span> <span class="s">"-p "</span> <span class="p">+</span> <span class="n">Port</span><span class="p">);</span>

<span class="cp">#if !DEBUG
</span>            <span class="n">st</span><span class="p">.</span><span class="n">CreateNoWindow</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">st</span><span class="p">.</span><span class="n">WindowStyle</span> <span class="p">=</span> <span class="n">ProcessWindowStyle</span><span class="p">.</span><span class="n">Hidden</span><span class="p">;</span>
<span class="cp">#endif
</span>            <span class="kt">var</span> <span class="n">remoteGuardian</span> <span class="p">=</span> <span class="n">Process</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">st</span><span class="p">);</span> <span class="c1">//ç›‘æ§è¿œç¨‹åº”ç”¨</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">remoteGuardian</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">RemoteProcessStartException</span><span class="p">(</span><span class="s">"å¯åŠ¨æ—¶å‡ºç°è¿”å›å€¼ä¸ºç©º"</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">Data</span> <span class="p">=</span> 
                    <span class="p">{</span>
                        <span class="p">{</span><span class="s">"ProcessStartInfo"</span><span class="p">,</span> <span class="n">st</span><span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">};</span>
            <span class="p">}</span>

            <span class="n">ProcessId</span> <span class="p">=</span> <span class="n">remoteGuardian</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
            <span class="n">remoteGuardian</span><span class="p">.</span><span class="n">EnableRaisingEvents</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">remoteGuardian</span><span class="p">.</span><span class="n">Exited</span> <span class="p">+=</span> <span class="n">RemoteGuardian_OnExited</span><span class="p">;</span>

            <span class="nf">CleanRegister</span><span class="p">();</span>

            <span class="n">_channel</span> <span class="p">=</span> <span class="n">Terminal</span><span class="p">.</span><span class="nf">CreatChannel</span><span class="p">();</span> <span class="c1">//å®¢æˆ·ç«¯</span>

            <span class="n">ChannelServices</span><span class="p">.</span><span class="nf">RegisterChannel</span><span class="p">(</span><span class="n">_channel</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     ä»è¿œç¨‹è·å¾—å®ä¾‹</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;</span>
        <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="n">T</span> <span class="n">GetObject</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;()</span>
        <span class="p">{</span>
            <span class="nf">CheckProcess</span><span class="p">();</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="n">Activator</span><span class="p">.</span><span class="nf">GetObject</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>
                <span class="s">"Ipc://"</span> <span class="p">+</span> <span class="n">Port</span> <span class="p">+</span> <span class="s">"/"</span> <span class="p">+</span> <span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">Name</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     ç»“æŸè¿œç¨‹è¿›ç¨‹</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">ExitProcess</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_isManualExit</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">remoteProcessBrake</span> <span class="p">=</span> <span class="n">GetObject</span><span class="p">&lt;</span><span class="n">RemoteProcessBrake</span><span class="p">&gt;();</span>
<span class="cp">#pragma warning disable 618
</span>            <span class="n">remoteProcessBrake</span><span class="p">.</span><span class="nf">OnExit</span><span class="p">();</span>
<span class="cp">#pragma warning restore 618
</span>        <span class="p">}</span>

        <span class="k">private</span> <span class="n">IChannel</span> <span class="n">_channel</span><span class="p">;</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     æ˜¯å¦æ‰‹åŠ¨é€€å‡ºè¿œç¨‹åº”ç”¨</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="kt">bool</span> <span class="n">_isManualExit</span><span class="p">;</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">RemoteGuardian_OnExited</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IsConnected</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">ProcessId</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>

            <span class="c1">//æ‰‹åŠ¨é€€å‡ºå°±ä¸éœ€è¦äº‹ä»¶</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_isManualExit</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">//é˜²æ­¢360ç­‰åƒåœ¾è½¯ä»¶è§‰å¾—è¿™ä¸ªåº”ç”¨å¯ä»¥é€€å‡º</span>
            <span class="n">RemoteExited</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>

            <span class="c1">//å³ä½¿è¢«ä½ é€€å‡ºäº†ï¼Œæˆ‘è¿˜æ˜¯è¦å¯åŠ¨ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨ä¸€äº›åœ°æ–¹ä½¿ç”¨çš„å˜é‡æ”¾åœ¨æœ¬åœ°ï¼Œæ‰€ä»¥æ‹¿åˆ°çš„å€¼å°±æ˜¯ä¹‹å‰çš„åº”ç”¨ï¼Œè¿˜æ˜¯éœ€è¦ç”¨æˆ·é‡å¯</span>
            <span class="nf">Connect</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///     æ¸…ç†æ³¨å†Œï¼Œå› ä¸ºä¸€ä¸ªä¿¡é“åªèƒ½æ³¨å†Œ</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">CleanRegister</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_channel</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">ChannelServices</span><span class="p">.</span><span class="nf">UnregisterChannel</span><span class="p">(</span><span class="n">_channel</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>


        <span class="k">private</span> <span class="kt">int</span> <span class="n">ProcessId</span> <span class="p">{</span> <span class="k">set</span><span class="p">;</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">Port</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">CheckProcess</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">IsConnected</span> <span class="p">||</span> <span class="n">ProcessId</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">NativeProcessException</span><span class="p">(</span><span class="s">"è¿œç¨‹åº”ç”¨å·²ç»æ„å¤–ç»“æŸæˆ–æ²¡æœ‰å¯åŠ¨"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">processes</span> <span class="p">=</span> <span class="n">Process</span><span class="p">.</span><span class="nf">GetProcesses</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ProcessId</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">processes</span><span class="p">.</span><span class="nf">All</span><span class="p">(</span><span class="n">temp</span> <span class="p">=&gt;</span> <span class="n">temp</span><span class="p">.</span><span class="n">Id</span> <span class="p">!=</span> <span class="n">ProcessId</span><span class="p">))</span>
            <span class="p">{</span>
<span class="cp">#if DEBUG
</span>                <span class="k">throw</span> <span class="k">new</span> <span class="nf">NativeProcessException</span><span class="p">();</span>
<span class="cp">#else
</span>                <span class="n">IsConnected</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="nf">Connect</span><span class="p">();</span>
<span class="cp">#endif
</span>            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>æ³¨æ„ç°åœ¨çš„ä»£ç å­˜åœ¨å¾ˆå¤šç±»æ²¡æœ‰å¼•ç”¨</p>

<p>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä½¿ç”¨çš„è¿æ¥æ˜¯ IPC ï¼Œå› ä¸ºè°ƒç”¨å…¶ä»–è¿›ç¨‹æ˜¯åœ¨åŒä¸€ä¸ªç”µè„‘ï¼Œæ‰€ä»¥è¿™æ—¶ä½¿ç”¨ IPC çš„æ•ˆç‡ä¼šæ¯” http å’Œ tcp é«˜ã€‚åŸå› æ˜¯ IPC æ˜¯è¿›ç¨‹é—´é€šä¿¡ï¼Œæ•ˆç‡å’Œå†…å­˜å…±äº«å·®ä¸å¤šã€‚è€Œä½¿ç”¨ http æˆ– tcp éœ€è¦æŠŠä¿¡æ¯å‘é€ç»™æœ¬åœ°å·¡å›ï¼Œç„¶åå†è¿”å›ã€‚è€Œä¸”ä½¿ç”¨ http éœ€è¦åšé¢å¤–çš„è¿‡ç¨‹ï¼Œéœ€è¦èµ° http çš„åè®®ã€‚ä½¿ç”¨ tcp éœ€è¦ä½¿ç”¨æ¡æ‰‹ï¼Œæ€§èƒ½éƒ½æ¯” IPC å·®ã€‚</p>

<h2 id="è¿è¡Œçš„ç±»">è¿è¡Œçš„ç±»</h2>

<p>æ‰€æœ‰éœ€è¦åœ¨ C++ ç¨‹åºè¿è¡Œçš„ç±»éƒ½éœ€è¦æ³¨å†Œï¼Œå› ä¸ºC++ç¨‹åºéœ€è¦æ‰¾åˆ°ç¨‹åºé›†æ‰€æœ‰ç¬¦åˆçš„ç±»ï¼Œæ‰€ä»¥éœ€è¦è¿™äº›ç±»æ ‡è®°</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// æ”¾åœ¨è¿œç¨‹çš„å®ä¾‹</span>
    <span class="c1">/// &lt;remarks&gt;è¯·ä¸è¦åœ¨ä»£ç ä¿å­˜å®ä¾‹&lt;/remarks&gt;</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">interface</span> <span class="nc">IRemote</span>
    <span class="p">{</span>

    <span class="p">}</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">///  å…±äº«ä½¿ç”¨çš„ç±»ï¼Œè¿™ä¸ªç±»ä¼šåœ¨è¿œç¨‹è¿›ç¨‹åˆ›å»º</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="p">[</span><span class="nf">AttributeUsage</span><span class="p">(</span><span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Class</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">RemoteAttribute</span> <span class="p">:</span> <span class="n">Attribute</span>
    <span class="p">{</span>

    <span class="p">}</span>
</code></pre></div></div>

<p>ä¾‹å¦‚æœ‰ä¸€ä¸ªç±»éœ€è¦åœ¨ C++ ç¨‹åºè¿è¡Œï¼Œåœ¨ WPF ç¨‹åºä½¿ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿™æ ·å†™</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">[</span><span class="n">Remote</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">BaltrartularLouronay</span> <span class="p">:</span> <span class="n">MarshalByRefObject</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">TerecaLesi</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"è°ƒç”¨"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>ç»§æ‰¿ MarshalByRefObject æ ‡è®° Remote å°±å¯ä»¥äº†</p>

<h2 id="è¿è¡Œcç¨‹åº">è¿è¡ŒC++ç¨‹åº</h2>

<p>è¿è¡Œéœ€è¦è·å¾—ç¨‹åºæ‰€æœ‰ç±»ï¼Œéœ€è¦åœ¨C++ç¨‹åºä½¿ç”¨çš„ç±»ï¼Œå®ç°å®ƒã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// è¿œç¨‹æœ¬æœºè¿›ç¨‹</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">RemoteNative</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///  åŠ è½½ç¨‹åºé›†</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="args"&gt;ä¼ å…¥å‚æ•°&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="assembly"&gt;&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Run</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">,</span> <span class="n">Assembly</span> <span class="n">assembly</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Parser</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">ParseArguments</span><span class="p">&lt;</span><span class="n">Options</span><span class="p">&gt;(</span><span class="n">args</span><span class="p">).</span><span class="nf">MapResult</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ç«¯å£å·"</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">Port</span><span class="p">);</span>
                <span class="k">new</span> <span class="nf">Thread</span><span class="p">(()</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"å¯åŠ¨åº“"</span><span class="p">);</span>
                    <span class="nf">Run</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Port</span><span class="p">,</span> <span class="n">assembly</span><span class="p">);</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"å¯åŠ¨å®Œæˆ"</span><span class="p">);</span>
                <span class="p">}).</span><span class="nf">Start</span><span class="p">();</span>
                <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">},</span> <span class="n">_</span> <span class="p">=&gt;</span> <span class="p">-</span><span class="m">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">///  åŠ è½½ç¨‹åºé›†</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="port"&gt;ç«¯å£&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="assembly"&gt;ç¨‹åºé›†&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Run</span><span class="p">(</span><span class="kt">string</span> <span class="n">port</span><span class="p">,</span> <span class="n">Assembly</span> <span class="n">assembly</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_channel</span> <span class="p">=</span> <span class="n">Terminal</span><span class="p">.</span><span class="nf">CreatChannel</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>

            <span class="n">ChannelServices</span><span class="p">.</span><span class="nf">RegisterChannel</span><span class="p">(</span><span class="n">_channel</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

            <span class="c1">//è®¾ç½®ç§Ÿç”¨ç®¡ç†å™¨çš„åˆå§‹ç§Ÿç”¨æ—¶é—´ä¸ºæ— é™ http://www.cnblogs.com/wayfarer/archive/2004/08/05/30437.html</span>
            <span class="n">LifetimeServices</span><span class="p">.</span><span class="n">LeaseTime</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>

            <span class="c1">//æ³¨å†Œå®ä¾‹</span>
            <span class="kt">var</span> <span class="n">remoteProcessBrake</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RemoteProcessBrake</span><span class="p">();</span>

            <span class="n">remoteProcessBrake</span><span class="p">.</span><span class="n">Exit</span> <span class="p">+=</span> <span class="n">RemoteProcessBrake_Exit</span><span class="p">;</span>

            <span class="c1">// é˜²æ­¢å¯¹è±¡å›æ”¶</span>
            <span class="c1">// å¦‚æœä¸ä½¿ç”¨ var objRef = x é‚£ä¹ˆåœ¨è¿è¡Œå°±å‘ç° System.Runtime.Remoting.RemotingException:â€œæ‰¾ä¸åˆ°è¯·æ±‚çš„æœåŠ¡â€</span>
            <span class="kt">var</span> <span class="n">objRef</span> <span class="p">=</span> <span class="n">RemotingServices</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="n">remoteProcessBrake</span><span class="p">,</span> <span class="n">remoteProcessBrake</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span>

            <span class="n">_objRefList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">objRef</span><span class="p">);</span>

            <span class="nf">Init</span><span class="p">(</span><span class="n">assembly</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">RemoteProcessBrake_Exit</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Environment</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">(</span><span class="n">Assembly</span> <span class="n">assembly</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">assembly</span><span class="p">.</span><span class="nf">GetTypes</span><span class="p">().</span><span class="nf">Where</span><span class="p">(</span><span class="n">temp</span> <span class="p">=&gt;</span> <span class="n">temp</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="p">&lt;</span><span class="n">RemoteAttribute</span><span class="p">&gt;()</span> <span class="p">!=</span> <span class="k">null</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="nf">CreateInstance</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// é˜²æ­¢å¯¹è±¡å›æ”¶</span>
                    <span class="kt">var</span> <span class="n">objRef</span> <span class="p">=</span> <span class="n">RemotingServices</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">temp</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
                    <span class="n">_objRefList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">objRef</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">MarshalByRefObject</span> <span class="nf">CreateInstance</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ConstructorInfo</span> <span class="n">constructor</span> <span class="p">=</span> <span class="n">type</span><span class="p">.</span><span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">constructor</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="k">null</span> <span class="p">:</span> <span class="n">Activator</span><span class="p">.</span><span class="nf">CreateInstance</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="k">as</span> <span class="n">MarshalByRefObject</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// é˜²æ­¢å¯¹è±¡å›æ”¶</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ObjRef</span><span class="p">&gt;</span> <span class="n">_objRefList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ObjRef</span><span class="p">&gt;();</span>

        <span class="k">private</span> <span class="n">IChannel</span> <span class="n">_channel</span><span class="p">;</span>
    <span class="p">}</span>

</code></pre></div></div>

<h2 id="é€šé“">é€šé“</h2>

<p>å¦‚æœéœ€è¦ä¸¤ä¸ªç¨‹åºè¿æ¥ï¼Œéœ€è¦åˆ›å»ºé€šé“</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// é€šé“</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Terminal</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// åˆ›å»ºè¿æ¥</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="port"&gt;å¯¹äºæœåŠ¡ç«¯éœ€è¦ä¸€ä¸ªæ ‡ç¤ºç¬¦ï¼Œå¯¹äºå®¢æˆ·ç«¯è¯·ä½¿ç”¨ç©º&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">IChannel</span> <span class="nf">CreatChannel</span><span class="p">(</span><span class="kt">string</span> <span class="n">port</span> <span class="p">=</span> <span class="s">""</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">port</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">().</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"N"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">serverProvider</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BinaryServerFormatterSinkProvider</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">clientProvider</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BinaryClientFormatterSinkProvider</span><span class="p">();</span>
            <span class="n">serverProvider</span><span class="p">.</span><span class="n">TypeFilterLevel</span> <span class="p">=</span> <span class="n">TypeFilterLevel</span><span class="p">.</span><span class="n">Full</span><span class="p">;</span>
            <span class="n">IDictionary</span> <span class="n">props</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Hashtable</span><span class="p">();</span>
            <span class="n">props</span><span class="p">[</span><span class="s">"portName"</span><span class="p">]</span> <span class="p">=</span> <span class="n">port</span><span class="p">;</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nf">IpcChannel</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">clientProvider</span><span class="p">,</span> <span class="n">serverProvider</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>å¯¹äº WPF ç¨‹åºåªéœ€è¦åˆ›å»ºéšæœºçš„ç«¯å£ï¼Œå¯¹äº C++ ç¨‹åºéœ€è¦åˆ›å»º WPF ç¨‹åºå‘Šè¯‰ä»–çš„ç«¯å£ï¼Œè¿™æ · WPF ç¨‹åºæ‰å¯ä»¥å‘é€æ•°æ®åˆ° C++ ç¨‹åº</p>

<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>

<p>å°è¯•æŠŠä¸Šé¢çš„ç±»å¤åˆ¶åˆ°è‡ªå·±çš„ä¸€ä¸ªé¡¹ç›®ï¼Œç„¶ååˆ›å»ºä¸¤ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ªæ˜¯ WPF ç¨‹åºï¼Œä¸€ä¸ªæ˜¯C++ç¨‹åºï¼Œè®©ä¸¤ä¸ªç¨‹åºéƒ½å¼•ç”¨è¿™ä¸ªé¡¹ç›®ã€‚</p>

<p>æ³¨æ„åˆ›å»ºçš„é¡¹ç›®éœ€è¦å¼•ç”¨ System.Runtime.Remoting</p>

<p>ä¾‹å¦‚åˆ›å»º MairzearPowhel ç¨‹åºåš WPF ç¨‹åºç”¨æ¥è°ƒç”¨ SedreaSudome ç¨‹åºã€‚åœ¨ MairzearPowhel éœ€è¦å¼•ç”¨ SedreaSudome å¯ä»¥è·å¾—é‡Œé¢çš„ç±»è€Œä¸”ç”¨æ¥å¯åŠ¨ SedreaSudome ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// MainWindow.xaml çš„äº¤äº’é€»è¾‘</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">SouhaiNosoja</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// å¯åŠ¨C++ç¨‹åº</span>
            <span class="kt">var</span> <span class="n">remoteProcessManager</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RemoteProcessManager</span><span class="p">(</span><span class="s">"SedreaSudome.exe"</span><span class="p">);</span>

            <span class="c1">// è¿æ¥</span>
            <span class="n">remoteProcessManager</span><span class="p">.</span><span class="nf">Connect</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">baltrartularLouronay</span> <span class="p">=</span> <span class="n">remoteProcessManager</span><span class="p">.</span><span class="n">GetObject</span><span class="p">&lt;</span><span class="n">BaltrartularLouronay</span><span class="p">&gt;();</span>

            <span class="c1">// æ‰§è¡Œé‡Œé¢æ–¹æ³•</span>
            <span class="n">baltrartularLouronay</span><span class="p">.</span><span class="nf">TerecaLesi</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">ButtonBase_OnClick</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">SouhaiNosoja</span><span class="p">();</span>

        <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>å¯¹äº C++ ç¨‹åºåªéœ€è¦å‡ ä¸ªä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Debugger</span><span class="p">.</span><span class="nf">Launch</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">remoteNative</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RemoteNative</span><span class="p">();</span>
            <span class="n">remoteNative</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Program</span><span class="p">).</span><span class="n">Assembly</span><span class="p">);</span>

            <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">Read</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>å¦‚æœå‘ç°æ— æ³•ä½¿ç”¨ï¼Œè¯·è”ç³»æˆ‘</p>

<p><img src="https://i.loli.net/2018/06/24/5b2f3c70dd5e9.jpg" alt="" /></p>

<p>æ„Ÿè°¢ <a href="https://www.pixiv.net/member_illust.php?mode=medium&amp;illust_id=69353928">æ´ªä¸‰æ°´</a>æä¾›å›¾ç‰‡</p>

:ET