I"Û<p>ä¿„ç½—æ–¯æ–¹å—æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„æ¸¸æˆï¼Œåšä¸€ä¸ªUWPä¿„ç½—æ–¯æ–¹å—æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œæˆ‘æƒ³è¯´çš„æ˜¯ç§»æ¤ï¼ŒæŠŠç»å…¸æ¸¸æˆç§»æ¤åˆ°UWPã€‚</p>

<!--more-->

<!-- CreateTime:2018/2/13 17:23:03 -->

<div id="toc"></div>

<p>æˆ‘ä»¬ä¹‹å‰æœ‰å¾ˆå¤šæ¸¸æˆï¼Œå¾ˆå¤šè½¯ä»¶ä½¿ç”¨Cæˆ–è€…C++ä¹‹ç±»çš„æ¥å†™ï¼Œæˆ–è€…C#ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æŠŠä¹‹å‰çš„ç®—æ³•æ‹¿å‡ºæ¥ï¼Œè½¬æ¢ä¸ºUWPçš„C#ï¼Œè¿™æ—¶å¤§å®¶ä¼šè¯´ï¼Œç•Œé¢ã€‚å¯¹ï¼Œç•Œé¢æˆ‘ä»¬æ²¡æ³•ç›´æ¥ç§»æ¤ï¼Œä½†æ˜¯ç”¨XAMLåšä¸€ä¸ªç•Œé¢å¾ˆå¿«çš„ï¼Œé‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯ï¼Œæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ä¹‹å‰çš„ç®—æ³•æ¥ç”¨ç°åœ¨çš„ç•Œé¢ã€‚</p>

<p>ç®€å•çš„ä¸€ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»‘å®šã€‚</p>

<p>MVVMçš„çŸ¥è¯†ï¼Œæˆ‘è§‰å¾—çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œå¿˜äº†å‡ºé”™ï¼Œå¸Œæœ›çŸ¥é“çš„å°ä¼™ä¼´æé†’ã€‚ä»–è¯´ï¼ŒMVVMçš„ViewModelä½œç”¨æ˜¯ç•Œé¢çš„æŠ½è±¡ã€‚æˆ‘ä»¬ä¸ç”¨ç†ç•Œé¢ï¼Œå› ä¸ºç•Œé¢æ€»æ˜¯æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŠ½è±¡çš„ç•Œé¢ï¼Œå°±æ˜¯æˆ‘ä»¬åšçš„ViewModelï¼Œé‚£ä¹ˆmodelåšçš„å°±æ˜¯ç®—æ³•ï¼Œæ•°æ®ã€‚Modelä¸çŸ¥é“ç•Œé¢æ€æ ·ï¼Œä»–éœ€è¦çŸ¥é“æ•°æ®ã€‚ViewModelä¸çŸ¥é“ç•Œé¢æ€æ ·ï¼Œä»–çŸ¥é“ç•Œé¢éœ€è¦ä»€ä¹ˆã€‚</p>

<p>MVVMçš„çŸ¥è¯†æˆ‘è¯´çš„ä¸ç®—å¯¹ï¼Œä¹Ÿä¸ç®—é”™ï¼Œä½†ä»è¿™ä¸ªçœ‹ä¹Ÿæ˜¯å¯ä»¥ã€‚</p>

<p>ä¸ºä»€ä¹ˆè¦åˆ†å¼€viewï¼Ÿ</p>

<p>å…¶å®å¯ä»¥çœ‹ä¸‹é¢çš„ï¼š</p>

<p>å‡è®¾æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªè½¯ä»¶ï¼Œè¿™ä¸ªè½¯ä»¶æ˜¯ä¸¾æŠ¥æ¶æ„è½¬è½½çš„åŠŸèƒ½ï¼Œä»–èƒ½å¤Ÿåœ¨ç½‘ä¸Šæœï¼Œæ‰¾åˆ°é‚£äº›æ¶æ„è½¬è½½çš„ç½‘ç«™ã€‚
å…ˆåæ§½ä¸‹ä¸­å›½å­¦ç½‘é‚£äº›åƒåœ¾ç½‘ç«™ï¼Œå…¨éƒ¨ä¸œè¥¿éƒ½æ˜¯è½¬è½½çš„ã€‚åæ§½ä¸‹ç™¾åº¦ï¼Œæœç´¢åˆ°çš„è½¬è½½çš„éƒ½æ˜¯å‰ï¼Œæœç´¢æˆ‘çš„åšå®¢æ ‡é¢˜æ‰¾ä¸åˆ°æˆ‘çš„åšå®¢ã€‚</p>

<p><img src="http://img.blog.csdn.net/20160505152213804" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>è¿˜æ˜¯360å¥½ï¼Œèƒ½æ‰¾åˆ°</p>

<p><img src="http://img.blog.csdn.net/20160505152243696" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>æˆ‘ä»¬è½¯ä»¶å¼€å§‹ç•Œé¢</p>

<p><img src="http://img.blog.csdn.net/20160505152318099" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>å‘ç°æˆ‘ä»¬éœ€è¦æ”¹</p>

<p><img src="http://img.blog.csdn.net/20160505153432025" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>æ¥ç€å‘ç°è¿˜æ˜¯éœ€è¦æ”¹</p>

<p><img src="http://img.blog.csdn.net/20160505153448697" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>å¦‚æœæˆ‘ä»¬å’Œç•Œé¢æœ‰è”ç³»ï¼Œä¸€æ”¹ç•Œé¢å°±éœ€è¦æ”¹ï¼Œé‚£ä¹ˆè¿™æ ·æˆ‘ä»¬å¼€å‘å°†ä¼šå¾ˆæ…¢ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬èƒ½ä½¿ç”¨æŠ½è±¡ï¼Œé‚£ä¹ˆç•Œé¢æ€ä¹ˆæ”¹ï¼Œæˆ‘ä»¬ä¿®æ”¹çš„ä¹Ÿå°±ç•Œé¢ã€‚</p>

<p>ä¸Šé¢å›¾ç‰‡æ¥è‡ªï¼šhttp://my.oschina.net/Android1989/blog/296850</p>

<p>æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªæ¸¸æˆï¼Œæˆ‘ä»¬æœ‰äº†ä¹‹å‰çš„ç®—æ³•ï¼Œæˆ‘æ‹¿åˆ°äº†ä¸€ä½å¤§ç¥ï¼šhttp://www.cnblogs.com/china_x01/p/5253556.html</p>

<p>çœ‹ä¸æ‡‚ä»–å†™çš„ï¼Œé—®äº†ä¸€ä½å¤§ç¥ï¼Œä»–å¸®æˆ‘æ”¹äº†UWPï¼Œæœ€åæˆ‘ä¹Ÿçœ‹ä¸æ‡‚ï¼Œä»–å†™çš„æ²¡æœ‰æ³¨é‡Šã€‚</p>

<p>åšä¸€ä¸ªä¿„ç½—æ–¯æ–¹å—ç®—æ³•ç®€å•ï¼Œæˆ‘ä»¬æ”¾åœ¨åé¢ï¼Œç°åœ¨å…ˆå’Œå¤§å®¶è¯´ç•Œé¢ã€‚</p>

<p><a href="#ä¿„ç½—æ–¯æ–¹å—">åé¢</a>è¯´çš„æœ‰äº›å°ç™½ã€‚</p>

<p>æˆ‘ä»¬ç¨‹åºï¼š</p>

<ul>
  <li>view:MainPage.xaml</li>
  <li>viewModel.cs</li>
  <li>model.cs</li>
</ul>

<p>æˆ‘ä»¬åœ¨ç•Œé¢</p>

<p>æ”¾ä¸€ä¸ªCanvas</p>

<p>é‡Œé¢å°±æ˜¯æ¸¸æˆ</p>

<p><img src="http://img.blog.csdn.net/20160505153731872" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>å› ä¸ºæˆ‘ä»¬éœ€è¦æ¸¸æˆæŒ‰é”®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªTextBox</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;Grid</span> <span class="na">Background=</span><span class="s">"{ThemeResource ApplicationPageBackgroundThemeBrush}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;TextBox</span> <span class="na">Margin=</span><span class="s">"10,10,10,10"</span> <span class="na">Width=</span><span class="s">"1"</span> <span class="na">Height=</span><span class="s">"1"</span> <span class="na">KeyDown=</span><span class="s">"keydown"</span><span class="nt">&gt;&lt;/TextBox&gt;</span>
        <span class="nt">&lt;Canvas</span> <span class="na">x:Name=</span><span class="s">"canvas"</span> <span class="na">Margin=</span><span class="s">"10,10,10,10"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;/Canvas&gt;</span>
    <span class="nt">&lt;/Grid&gt;</span>
</code></pre></div></div>

<p>æ¯ä¸ªæ–¹å—
<code class="language-plaintext highlighter-rouge">Rectangle[,] _rectangle</code>
æˆ‘ä»¬éœ€è¦è®¾è®¡é«˜åº¦å®½åº¦ <code class="language-plaintext highlighter-rouge">size = 10;</code>ï¼Œå…¶å®è¿™é‡Œå¯ä»¥æ ¹æ®ä½ è‡ªå·±éœ€è¦ï¼Œæ¯ä¸ªæ–¹å—çš„sizeå¯ä»¥è®¾ç½®å¤§ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„å›¾ï¼Œæˆ‘çš„æ–¹å—æ˜¯æœ‰äº›å°ã€‚</p>

<p>ç°åœ¨å°±æ˜¯æˆ‘ä»¬é‡è¦çš„ç»‘å®šï¼Œæˆ‘ä»¬æœ‰200ä¸ªRectangleï¼Œå¦‚æœæ¯ä¸ªåœ¨xamlï¼Œå†™æˆ‘è§‰å¾—æˆ‘æ²¡æœ‰è¿™ä¹ˆæ—¶é—´ï¼Œä¹Ÿå®¹æ˜“é”™</p>

<p>æ‰€ä»¥æˆ‘ä»¬åœ¨</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rectangle</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Width</span> <span class="p">=</span> <span class="n">size</span><span class="p">,</span>
                        <span class="n">Height</span> <span class="p">=</span> <span class="n">size</span><span class="p">,</span>
                        <span class="n">Fill</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Gray</span><span class="p">),</span>
                        <span class="n">Stroke</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">LightCoral</span><span class="p">),</span>                      
                        <span class="n">AllowDrop</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                        <span class="n">CanDrag</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                        <span class="n">Margin</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Thickness</span><span class="p">(</span><span class="n">j</span> <span class="p">*</span> <span class="n">size</span><span class="p">,</span> <span class="n">i</span> <span class="p">*</span> <span class="n">size</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">};</span>  
                    <span class="n">canvas</span><span class="p">.</span><span class="n">Children</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]);</span>                 
                <span class="p">}</span>
            <span class="p">}</span>
</code></pre></div></div>

<p>åå°å†™äº†200ä¸ªæ–¹å—ï¼Œå°±å‡ å¥ã€‚æˆ‘ä»¬ç»™å®½åº¦é«˜åº¦ã€æ˜¾ç¤ºçš„é¢œè‰²ã€‚æ˜¾ç¤ºé¢œè‰²æ˜¯æ²¡æœ‰æ–¹å—æ˜¾ç¤ºçš„é¢œè‰²ï¼Œè¿™é‡Œè¯´çš„æ²¡æœ‰æ–¹å—æ˜¯è¯´æ²¡æœ‰ä¿„ç½—æ–¯æ–¹å—ã€‚</p>

<p>ç„¶åæˆ‘ä»¬ç»™æ¯ä¸ªæ–¹å—è¾¹æ¡†ï¼ŒStrokeï¼Œä»–ä»¬çš„ä½ç½®ã€‚</p>

<p>è¿™æ ·æˆ‘ä»¬çš„å±å¹•å°±æœ‰äº†200ä¸ªæ–¹å—ï¼Œä½†æ˜¯æ”¾è¿›å»æˆ‘ä»¬ä¼šå‘ç°å’Œæˆ‘ä»¬ä¸Šé¢çš„å›¾ä¸åŒï¼Œå› ä¸ºå®½åº¦å’Œé«˜åº¦ä¸åŒ</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">canvas</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="n">size</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
            <span class="n">canvas</span><span class="p">.</span><span class="n">Height</span> <span class="p">=</span> <span class="n">size</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
</code></pre></div></div>

<p>è¿™æ ·å°±å¥½äº†ã€‚</p>

<p>ç•Œé¢å¤§æ¦‚å°±éœ€è¦åšçš„å°±è¿™æ ·ï¼Œç®—æ³•å¾ˆç®€å•ï¼Œæ”¾åœ¨æœ€åã€‚</p>

<p>æˆ‘ä»¬æœ‰çš„modelï¼Œæœ‰ä¿„ç½—æ–¯æ–¹å—çš„åˆå§‹æ–¹å—ã€ç§»åŠ¨ã€å˜å½¢ã€å‘ä¸‹</p>

<p>ä»–æŠŠæ‰€æœ‰çš„æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªæ•°ç»„<code class="language-plaintext highlighter-rouge">grid_observable</code>ï¼Œç±»å‹gridé‡Œé¢æœ‰ä¸ª<code class="language-plaintext highlighter-rouge">rectangle</code>ï¼Œå¦‚æœä¸º0è¡¨ç¤ºè¿™ä¸ªåœ°æ–¹æ²¡æœ‰æ–¹å—ï¼Œå¦‚æœä¸º1è¡¨ç¤ºæœ‰æ–¹å—ã€‚</p>

<p>ç±»å‹grid</p>

<ul>
  <li>é•¿</li>
  <li>å®½</li>
  <li>æ˜¯å¦æœ‰æ–¹å—</li>
</ul>

<p>æˆ‘ä»¬ç•Œé¢æ ¹æ®rectangleæ˜¾ç¤ºï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆæ˜¾ç¤ºç°è‰²ï¼Œæ²¡æœ‰æ˜¾ç¤ºç™½è‰²ã€‚</p>

<p>å› ä¸ºæˆ‘ä»¬viewæ˜¯ä¸çŸ¥é“åå°ï¼Œæ‰€ä»¥è¿™ä¸ªæ˜¾ç¤ºéœ€è¦viewModelæŠŠåå°çš„rectangleå˜ä¸ºé¢œè‰²ã€‚</p>

<p>æˆ‘ä»¬ViewModelæŠŠé¢œè‰²æ”¾<code class="language-plaintext highlighter-rouge">ObservableCollection&lt;solid&gt; solid_collection</code></p>

<p>éœ€è¦æŠŠrectangleå˜ä¸ºé¢œè‰²</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_model</span><span class="p">.</span><span class="n">grid_observable</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">rectangle</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">solid_collection</span><span class="p">[</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="n">solids</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Gray</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> 
                <span class="p">{</span>
                    <span class="n">solid_collection</span><span class="p">[</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="n">solids</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">White</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            
</code></pre></div></div>

<p>ä¸ºäº†è®©solidä¸€ä¿®æ”¹å°±å¯ä»¥å‘Šè¯‰view</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">solid</span> <span class="p">:</span> <span class="n">notify_property</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">solid</span><span class="p">(</span><span class="n">SolidColorBrush</span> <span class="n">solid</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_solid</span> <span class="p">=</span> <span class="n">solid</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">SolidColorBrush</span> <span class="n">solids</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_solid</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="nf">OnPropertyChanged</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_solid</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="n">SolidColorBrush</span> <span class="n">_solid</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>å› ä¸ºæ¯æ¬¡å†™INotifyPropertyChangedè¦å†™å¾ˆå¤šï¼Œæˆ‘ä»¬éœ€è¦é€šçŸ¥æœ‰å¾ˆå¤š ï¼Œæ‰€ä»¥å†™notify_property</p>

<p>ViewModelèƒ½æŠŠåå°çš„rectangleå˜é¢œè‰²ï¼Œé‚£ä¹ˆæˆ‘ä»¬viewæŠŠé¢œè‰²æ˜¾ç¤º</p>

<p>æˆ‘ä»¬åˆšæ‰new äº†200ä¸ª<code class="language-plaintext highlighter-rouge">Rectangle</code>æˆ‘ä»¬æŠŠä»–çš„é¢œè‰²ç»‘å®šViewModel</p>

<p>å¦‚æœä½¿ç”¨xamlï¼Œæˆ‘è§‰å¾—æˆ‘æ²¡æ³•</p>

<p>é‚£ä¹ˆæˆ‘ä»¬åœ¨ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rectangle</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Width</span> <span class="p">=</span> <span class="n">size</span><span class="p">,</span>
                        <span class="n">Height</span> <span class="p">=</span> <span class="n">size</span><span class="p">,</span>
                        <span class="n">Fill</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Gray</span><span class="p">),</span>
                        <span class="n">Stroke</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">LightCoral</span><span class="p">),</span>                      
                        <span class="n">AllowDrop</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                        <span class="n">CanDrag</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                        <span class="n">Margin</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Thickness</span><span class="p">(</span><span class="n">j</span> <span class="p">*</span> <span class="n">size</span><span class="p">,</span> <span class="n">i</span> <span class="p">*</span> <span class="n">size</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">};</span>      
                    <span class="n">Binding</span> <span class="n">bind</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Binding</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Path</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PropertyPath</span><span class="p">(</span><span class="s">"solid_collection["</span> <span class="p">+</span> <span class="p">(</span><span class="n">i</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span> <span class="p">+</span> <span class="n">j</span><span class="p">)</span> <span class="p">+</span> <span class="s">"].solids"</span><span class="p">),</span>
                        <span class="n">Mode</span> <span class="p">=</span> <span class="n">BindingMode</span><span class="p">.</span><span class="n">OneWay</span>
                    <span class="p">};</span>
                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">DataContext</span> <span class="p">=</span> <span class="n">view</span><span class="p">;</span>
                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="nf">SetBinding</span><span class="p">(</span><span class="n">Shape</span><span class="p">.</span><span class="n">FillProperty</span><span class="p">,</span> <span class="n">bind</span><span class="p">);</span>
</code></pre></div></div>

<p>ç»‘å®šå¯ä»¥<code class="language-plaintext highlighter-rouge"> Binding bind = new Binding()</code>
é‡Œé¢å†™è·¯å¾„ï¼Œå¯ä»¥æ•°ç»„ä¸­<code class="language-plaintext highlighter-rouge">Path = new PropertyPath("solid_collection[" + (i * view.col + j) + "].solids"),</code>
å…¶å®Pathå†™åœ¨new Binding(string Path)</p>

<p>æˆ‘ä»¬å¯ä»¥è®¾ç½®<code class="language-plaintext highlighter-rouge">Source = view</code></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                    <span class="n">Binding</span> <span class="n">bind</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Binding</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Path</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PropertyPath</span><span class="p">(</span><span class="s">"solid_collection["</span> <span class="p">+</span> <span class="p">(</span><span class="n">i</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span> <span class="p">+</span> <span class="n">j</span><span class="p">)</span> <span class="p">+</span> <span class="s">"].solids"</span><span class="p">),</span>
                        <span class="n">Mode</span> <span class="p">=</span> <span class="n">BindingMode</span><span class="p">.</span><span class="n">OneWay</span><span class="p">,</span>
                        <span class="n">Source</span> <span class="p">=</span> <span class="n">view</span>
                    <span class="p">};</span>
</code></pre></div></div>
<p>ä¹Ÿå¯ä»¥<code class="language-plaintext highlighter-rouge">_rectangle[i, j].DataContext = view;</code>
å†™å®Œæˆ‘ä»¬éœ€è¦</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="nf">SetBinding</span><span class="p">(</span><span class="n">Shape</span><span class="p">.</span><span class="n">FillProperty</span><span class="p">,</span> <span class="n">bind</span><span class="p">);</span>
</code></pre></div></div>

<p>å¦‚æœæˆ‘ä»¬åå°æ˜¯å¯ä»¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½çœ‹åˆ°</p>

<p><img src="http://img.blog.csdn.net/20160505153644699" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>æˆ‘æƒ³è¯´çš„ä¸æ˜¯å†™ä¿„ç½—æ–¯ï¼Œè€Œæ˜¯æŠŠä¹‹å‰çš„è½¯ä»¶ç§»æ¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠäºŒç»´è¡¨ï¼Œboolï¼Œè¡¨ç¤ºä¸ºé¢œè‰²ï¼ŒæŠŠé¢œè‰²æ˜¾ç¤ºï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šæ¸¸æˆéƒ½æ˜¯å¯ä»¥è¿™æ ·ï¼Œé‚£ä¹ˆç§»æ¤UWPç®€å•ï¼Œéœ€è¦ä½¿ç”¨ç»‘å®šï¼Œä¸€ä¸ªè½¬æ¢ã€‚</p>

<p>å¤§ç¥ï¼šå¯ä»¥ç›´æ¥ç»‘å®šè½¬æ¢ã€‚</p>

<p>å…¶å®æˆ‘æ˜¯ä¸å–œæ¬¢ç›´æ¥ç»‘å®šå°±è½¬æ¢ï¼Œå› ä¸ºè¿™æ ·ç±»å¾ˆå¤šï¼Œæˆ‘ä»¬éœ€è¦æ–‡ä»¶å¤¹
Converté‡Œé¢æ˜¯è½¬æ¢ç±»</p>

<p>æˆ‘æƒ³è¯´çš„ä¸æ˜¯åšä¸€ä¸ªä¿„ç½—æ–¯æ–¹å—ï¼Œè€Œæ˜¯æŠŠä¹‹å‰æ•°æ®ä¿å­˜äºŒè¿›åˆ¶çŸ©é˜µçš„æ¸¸æˆç§»æ¤åˆ°UWPæ€è·¯ã€‚å¾ˆç®€å•ä¸ç”¨å¤šä¿®æ”¹å°±å¯ä»¥ä½¿ç”¨ï¼Œç•Œé¢æˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥å†™ï¼Œåªè¦ç»‘å®šå†™äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ã€‚</p>

<p>å†™åˆ°è¿™ï¼Œåé¢éƒ½æ˜¯å°ç™½</p>

<h1 id="ä¿„ç½—æ–¯æ–¹å—">ä¿„ç½—æ–¯æ–¹å—</h1>

<p>æˆ‘ä»¬å…ˆæ‰“å¼€vsç¥å™¨ï¼Œä¹‹å‰ä¸‹è½½vså®‰è£…ï¼Œéœ€è¦sdkï¼Œè¿™ä¸ªåœ¨å®‰è£…è‡ªå·±å¼„ã€‚</p>

<p>æ–°å»ºé¡¹ç›®ï¼Œæˆ‘å«tetris</p>

<p>æ–°å»ºä¸€ä¸ªç±»å«viewModelï¼Œä¸€ä¸ªmodel</p>

<p>å†æ–°å»ºä¸€ä¸ªç±»notify_propertyï¼Œæ¥å£INotifyPropertyChanged</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// æä¾›ç»§æ‰¿é€šçŸ¥UIæ”¹å˜å€¼</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">notify_property</span> <span class="p">:</span> <span class="n">INotifyPropertyChanged</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">event</span> <span class="n">PropertyChangedEventHandler</span> <span class="n">PropertyChanged</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="n">UpdateProper</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">ref</span> <span class="n">T</span> <span class="n">properValue</span> <span class="p">,</span> <span class="n">T</span> <span class="n">newValue</span> <span class="p">,</span> <span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">CompilerServices</span><span class="p">.</span><span class="n">CallerMemberName</span><span class="p">]</span> <span class="kt">string</span> <span class="n">properName</span> <span class="p">=</span> <span class="s">""</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="kt">object</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">properValue</span> <span class="p">,</span> <span class="n">newValue</span><span class="p">))</span>
                <span class="k">return</span><span class="p">;</span>

            <span class="n">properValue</span> <span class="p">=</span> <span class="n">newValue</span><span class="p">;</span>
            <span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="n">properName</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnPropertyChanged</span><span class="p">([</span><span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">CompilerServices</span><span class="p">.</span><span class="n">CallerMemberName</span><span class="p">]</span> <span class="kt">string</span> <span class="n">name</span><span class="p">=</span><span class="s">""</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">PropertyChangedEventHandler</span> <span class="n">handler</span> <span class="p">=</span> <span class="n">PropertyChanged</span><span class="p">;</span>
            <span class="n">handler</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span> <span class="p">,</span> <span class="k">new</span> <span class="nf">PropertyChangedEventArgs</span><span class="p">(</span><span class="n">name</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>è¿™ä¸ªç±»æ˜¯æˆ‘ä»¬æ¯æ¬¡éœ€è¦INotifyPropertyChangedéƒ½éœ€è¦å†™PropertyChangedï¼Œè§‰å¾—è¿˜æ˜¯æ”¾æˆç±»ï¼Œè®©éœ€è¦çš„ç»§æ‰¿</p>

<p>ä¿„ç½—æ–¯æ–¹å—æœ‰</p>

<ul>
  <li>æ–°å»ºæ–¹å—</li>
  <li>æ–¹å—ç§»åŠ¨</li>
  <li>æ–¹å—å‘ä¸‹</li>
  <li>ç¢°åˆ°ä¸‹é¢æ–¹å—</li>
  <li>æ¸…é™¤</li>
</ul>

<p>æˆ‘ä»¬æŠŠç®—æ³•å†™model</p>

<p>æ–¹å—æœ‰</p>

<ul>
  <li>straight, 
<img src="http://img.blog.csdn.net/20160505154803058" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></li>
  <li>square,
<img src="http://img.blog.csdn.net/20160505154810261" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></li>
  <li>t,
<img src="http://img.blog.csdn.net/20160505154818235" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></li>
  <li>bent 
<img src="http://img.blog.csdn.net/20160505154825152" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></li>
</ul>

<p>æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªæ¥ä¿å­˜</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">enum</span> <span class="n">block</span>
    <span class="p">{</span>
        <span class="n">straight</span><span class="p">,</span> 
        <span class="n">square</span><span class="p">,</span>
        <span class="n">t</span><span class="p">,</span>
        <span class="n">bent</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¥æ”¾æˆ‘ä»¬çš„æ–¹å—</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">grid</span> <span class="p">:</span> <span class="n">notify_property</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">grid</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_rectangle</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="nf">grid</span><span class="p">(</span><span class="kt">int</span> <span class="n">col</span><span class="p">,</span> <span class="kt">int</span> <span class="n">row</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_col</span> <span class="p">=</span> <span class="n">col</span><span class="p">;</span>
            <span class="n">_row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
            <span class="n">_rectangle</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">grid</span> <span class="nf">clone</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">grid</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">row</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_row</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="nf">OnPropertyChanged</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_row</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">col</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_col</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="nf">OnPropertyChanged</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_col</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">rectangle</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_rectangle</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">_col</span><span class="p">;</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">_rectangle</span><span class="p">;</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">_row</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>è¡Œåˆ—ï¼Œæ˜¯å¦æœ‰æ–¹å—</p>

<p>æˆ‘ä»¬å‘ç°è¿™ä¸ªåªèƒ½æ”¾ä¸€ä¸ªæ–¹å—ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™</p>

<p><img src="http://img.blog.csdn.net/20160505164603757" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>æ”¾ç€<code class="language-plaintext highlighter-rouge">grid[] _grid;</code></p>

<p>æ–°å»ºæ–¹å—ï¼š
square(block block, int center)
æˆ‘ä»¬éœ€è¦æ–¹å—æ˜¯ä»€ä¹ˆï¼Œä¸­å¿ƒ</p>

<p>æˆ‘ä»¬å…ˆåšç›´çº¿</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="nf">square</span><span class="p">(</span><span class="n">block</span> <span class="n">block</span><span class="p">,</span> <span class="kt">int</span> <span class="n">center</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_block</span> <span class="p">=</span> <span class="n">block</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">4</span><span class="p">;</span>
            <span class="n">_grid</span> <span class="p">=</span> <span class="k">new</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">grid</span><span class="p">();</span>
                <span class="k">switch</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">straight</span><span class="p">:</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="n">i</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="p">:</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">block</span><span class="p">),</span> <span class="n">block</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p><img src="http://img.blog.csdn.net/20160505164614054" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>æˆ‘ä»¬æ¥åšt</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">t</span><span class="p">:</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">3</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="p">}</span>
</code></pre></div></div>

<p><img src="http://img.blog.csdn.net/20160505164621304" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>square</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                   <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">square</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;=</span> <span class="m">1</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">2</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="p">}</span>
</code></pre></div></div>

<p><img src="http://img.blog.csdn.net/20160505164628461" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>bent</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">bent</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;=</span> <span class="m">1</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">3</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="p">}</span>
</code></pre></div></div>

<p><img src="http://img.blog.csdn.net/20160505164635199" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="nf">square</span><span class="p">(</span><span class="n">block</span> <span class="n">block</span><span class="p">,</span> <span class="kt">int</span> <span class="n">center</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_block</span> <span class="p">=</span> <span class="n">block</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">4</span><span class="p">;</span>
            <span class="n">_grid</span> <span class="p">=</span> <span class="k">new</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">grid</span><span class="p">();</span>
                <span class="k">switch</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">straight</span><span class="p">:</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="n">i</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">t</span><span class="p">:</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">3</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">square</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;=</span> <span class="m">1</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">2</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">bent</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;=</span> <span class="m">1</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">3</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="p">:</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">block</span><span class="p">),</span> <span class="n">block</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>è¿™æ ·çœ‹èµ·æ¥ä»£ç å¾ˆå¤šï¼Œè¿™æ ·ä¸å¥½ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ¯ä¸ªæ”¾åœ¨ä¸€ä¸ªå‡½æ•°</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="nf">square</span><span class="p">(</span><span class="n">block</span> <span class="n">block</span><span class="p">,</span> <span class="kt">int</span> <span class="n">center</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_block</span> <span class="p">=</span> <span class="n">block</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">4</span><span class="p">;</span>
            <span class="n">_grid</span> <span class="p">=</span> <span class="k">new</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">grid</span><span class="p">();</span>
                <span class="k">switch</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">straight</span><span class="p">:</span>
                        <span class="nf">block_straight</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">t</span><span class="p">:</span>
                        <span class="nf">block_t</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">square</span><span class="p">:</span>
                        <span class="nf">block_square</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">bent</span><span class="p">:</span>
                        <span class="nf">block_bent</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="p">:</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">block</span><span class="p">),</span> <span class="n">block</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">block_straight</span><span class="p">(</span><span class="kt">int</span> <span class="n">center</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span><span class="p">;</span>
            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">block_t</span><span class="p">(</span><span class="kt">int</span> <span class="n">center</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span><span class="p">;</span>
            <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">3</span><span class="p">;</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">block_bent</span><span class="p">(</span><span class="kt">int</span> <span class="n">center</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;=</span> <span class="m">1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span><span class="p">;</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">3</span><span class="p">;</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬modelè¿˜æ²¡å†™ä¸œè¥¿
æˆ‘ä»¬å…ˆåšæ–°å»ºæ–¹å—</p>

<p>æˆ‘ä»¬éœ€è¦æœ€å¤§å€¼</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="kt">int</span> <span class="n">row</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_row</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_row</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">col</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_col</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_col</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">_col</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">_row</span> <span class="p">=</span> <span class="m">20</span><span class="p">;</span>
</code></pre></div></div>

<p>å½“å‰æ–¹å—</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="n">square</span> <span class="n">_square</span>
        <span class="p">{</span>
            <span class="k">set</span><span class="p">;</span>
            <span class="k">get</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æ–°å»ºæ–¹å—</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">new_block</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">block</span> <span class="n">_block</span> <span class="p">=</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span><span class="n">ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">4</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">center</span> <span class="p">=</span> <span class="n">_col</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>
            <span class="n">_square</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">square</span><span class="p">(</span><span class="n">_block</span><span class="p">,</span> <span class="n">center</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬ç°åœ¨æ²¡æœ‰æƒ³ç€å»ä»€ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜¾ç¤º</p>

<p>æ¯æ¬¡ä¸‹é™</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">down</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_square</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">new_block</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬åœ¨ViewModel</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="nf">viewModel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">solid_collection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">solid</span><span class="p">&gt;();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">col</span> <span class="p">*</span> <span class="n">row</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">solid_collection</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">solid</span><span class="p">(</span><span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Gray</span><span class="p">)));</span>
            <span class="p">}</span>
            <span class="n">DispatcherTimer</span> <span class="n">time</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DispatcherTimer</span>
            <span class="p">{</span>
                <span class="n">Interval</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">0.5</span><span class="p">)</span>
            <span class="p">};</span>
            <span class="n">time</span><span class="p">.</span><span class="n">Tick</span> <span class="p">+=</span> <span class="n">tick</span><span class="p">;</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">col</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="k">value</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_model</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">row</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="k">value</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_model</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">solid</span><span class="p">&gt;</span> <span class="n">solid_collection</span>
        <span class="p">{</span>
            <span class="k">set</span><span class="p">;</span>
            <span class="k">get</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">tick</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="kt">object</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">DispatcherTimer</span> <span class="n">time</span> <span class="p">=</span> <span class="n">sender</span> <span class="k">as</span> <span class="n">DispatcherTimer</span><span class="p">;</span>
            <span class="n">time</span><span class="p">?.</span><span class="nf">Stop</span><span class="p">();</span>
            <span class="nf">down</span><span class="p">();</span>
            <span class="n">time</span><span class="p">?.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">down</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_model</span><span class="p">.</span><span class="nf">down</span><span class="p">();</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬éœ€è¦DispatcherTimerï¼Œç»™ä»–æ—¶é—´<code class="language-plaintext highlighter-rouge">Interval = TimeSpan.FromSeconds(0.5)</code>å°±å‘ä¸‹</p>

<p>å¦‚æœmodel</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">if</span> <span class="p">(</span><span class="n">_square</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">new_block</span><span class="p">();</span>
            <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬ç°åœ¨æ–°å»ºå‡ºæ¥ï¼Œè¿˜æ²¡æœ‰æ˜¾ç¤º</p>

<p>æˆ‘ä»¬éœ€è¦æŠŠ<code class="language-plaintext highlighter-rouge">_square </code>æ˜¾ç¤º</p>

<p>viewModel</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">down</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_model</span><span class="p">.</span><span class="nf">down</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_model</span><span class="p">.</span><span class="n">_square</span><span class="p">.</span><span class="n">_grid</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">temp</span> <span class="p">=&gt;</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">solid_collection</span><span class="p">[</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="n">solids</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">White</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬ç°åœ¨é™¤äº†ç•Œé¢ï¼Œéƒ½åšå¥½äº†ã€‚</p>

<p>æ‰“å¼€MainPage</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;Grid</span> <span class="na">Background=</span><span class="s">"{ThemeResource ApplicationPageBackgroundThemeBrush}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;TextBox</span> <span class="na">Margin=</span><span class="s">"10,10,10,10"</span> <span class="na">Width=</span><span class="s">"1"</span> <span class="na">Height=</span><span class="s">"1"</span> <span class="na">KeyDown=</span><span class="s">"keydown"</span><span class="nt">&gt;&lt;/TextBox&gt;</span>
        <span class="nt">&lt;Canvas</span> <span class="na">x:Name=</span><span class="s">"canvas"</span> <span class="na">Margin=</span><span class="s">"10,10,10,10"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;/Canvas&gt;</span>
    <span class="nt">&lt;/Grid&gt;</span>
</code></pre></div></div>

<p>TextBox æˆ‘ä»¬éœ€è¦æŒ‰é”®</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="n">viewModel</span> <span class="n">view</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">MainPage</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="nf">rectangle</span><span class="p">();</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>rectangleç»‘å®šæˆ‘ä»¬çš„ç•Œé¢</p>

<p>ç»‘å®šåœ¨ä¸Šé¢æœ‰å†™äº†</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">rectangle</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">view</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">viewModel</span><span class="p">();</span>
            <span class="n">Rectangle</span><span class="p">[,]</span> <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">[</span><span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span><span class="p">];</span>
            <span class="kt">double</span> <span class="n">height</span> <span class="p">=</span> <span class="m">600</span><span class="p">;</span>
            <span class="kt">double</span> <span class="n">size</span> <span class="p">=</span> <span class="n">height</span> <span class="p">/</span> <span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">size</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">canvas</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="n">size</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
            <span class="n">canvas</span><span class="p">.</span><span class="n">Height</span> <span class="p">=</span> <span class="n">size</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
            <span class="n">canvas</span><span class="p">.</span><span class="n">Background</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">BurlyWood</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rectangle</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Width</span> <span class="p">=</span> <span class="n">size</span><span class="p">,</span>
                        <span class="n">Height</span> <span class="p">=</span> <span class="n">size</span><span class="p">,</span>
                        <span class="n">Fill</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Gray</span><span class="p">),</span>
                        <span class="n">Stroke</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">LightCoral</span><span class="p">),</span>
                        <span class="n">AllowDrop</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                        <span class="n">CanDrag</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                        <span class="n">Margin</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Thickness</span><span class="p">(</span><span class="n">j</span> <span class="p">*</span> <span class="n">size</span><span class="p">,</span> <span class="n">i</span> <span class="p">*</span> <span class="n">size</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">};</span>
                    <span class="n">Binding</span> <span class="n">bind</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Binding</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Path</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PropertyPath</span><span class="p">(</span><span class="s">"solid_collection["</span> <span class="p">+</span> <span class="p">(</span><span class="n">i</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span> <span class="p">+</span> <span class="n">j</span><span class="p">)</span> <span class="p">+</span> <span class="s">"].solids"</span><span class="p">),</span>
                        <span class="n">Mode</span> <span class="p">=</span> <span class="n">BindingMode</span><span class="p">.</span><span class="n">OneWay</span>
                    <span class="p">};</span>
                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">DataContext</span> <span class="p">=</span> <span class="n">view</span><span class="p">;</span>
                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="nf">SetBinding</span><span class="p">(</span><span class="n">Shape</span><span class="p">.</span><span class="n">FillProperty</span><span class="p">,</span> <span class="n">bind</span><span class="p">);</span>
                    <span class="n">canvas</span><span class="p">.</span><span class="n">Children</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬å¯ä»¥å¼€å§‹è¿è¡Œï¼Œå°±å¯ä»¥çœ‹åˆ°ï¼Œåªä¸‹æ¥ä¸€å—</p>

<p>æˆ‘ä»¬è¦è®©æ•´ä¸ªæ–¹å—å‘ä¸‹</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">down</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_square</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">new_block</span><span class="p">();</span>
            <span class="p">}</span>
           
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_square</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">temp</span><span class="p">.</span><span class="n">row</span><span class="p">++;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æ¯ä¸ªéƒ½å‘ä¸‹</p>

<p>æˆ‘ä»¬ä¼šå‘ç°æˆ‘ä»¬çš„æ–¹å—ä¸‹åˆ°æœ€ä¸‹è¿˜æ˜¯æ²¡æœ‰åœä¸‹æ¥</p>

<p>æˆ‘ä»¬éœ€è¦åˆ¤æ–­æ–¹å—æ˜¯ä¸æ˜¯åˆ°æœ€ä¸‹</p>

<p>åˆ¤æ–­æ–¹å—æ˜¯ä¸æ˜¯è¦åˆ°çš„ä½ç½®ä¸å¯ä»¥ï¼Œè¿™å¥è¯æ˜¯è¯´åˆ¤æ–­æ˜¯ä¸æ˜¯åœ¨gridé‡Œï¼Œä½ç½®è¶…è¿‡æœ€å¤§å¯ä»¥çš„ä½ç½®ï¼Œæˆ–è€…å°äº0ï¼Œä½ç½®æ˜¯ä¸æ˜¯æœ‰æ–¹å—ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="kt">bool</span> <span class="nf">rectangle</span><span class="p">(</span><span class="n">square</span> <span class="n">_square</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_square</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">)</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">_grid_observable</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="n">n</span> <span class="p">&amp;&amp;</span> <span class="n">_grid_observable</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">rectangle</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">&gt;=</span> <span class="n">_row</span> <span class="p">||</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&gt;=</span> <span class="n">_col</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">_rectangle</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬å…ˆå¤åˆ¶æ–¹å—ï¼Œç„¶åè®©æ–¹å—å‘ä¸‹ï¼Œåˆ¤æ–­æ˜¯ä¸ªæ–¹å—æ˜¯ä¸æ˜¯å¯ä»¥åœ¨ä»–çš„ä½ç½®ï¼Œå¦‚æœå¯ä»¥ï¼Œå¤åˆ¶å›å»ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">down</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_square</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">new_block</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">square</span> <span class="n">temp</span> <span class="p">=</span> <span class="n">_square</span><span class="p">.</span><span class="nf">clone</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">t</span> <span class="k">in</span> <span class="n">temp</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">t</span><span class="p">.</span><span class="n">row</span><span class="p">++;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nf">rectangle</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">_square</span> <span class="p">=</span> <span class="n">temp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>å¤åˆ¶</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="n">square</span> <span class="nf">clone</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">square</span> <span class="n">temp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">square</span><span class="p">(</span><span class="n">_block</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_grid</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">temp</span><span class="p">.</span><span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">clone</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">temp</span><span class="p">.</span><span class="n">rotate_count</span> <span class="p">=</span> <span class="n">rotate_count</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>
<p>è¿è¡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–¹å—èƒ½å‘ä¸‹ï¼Œåœ¨æœ€ä¸‹åœä¸‹ï¼Œä½†æ˜¯ä¸ä¼šå‡ºæ–°æ–¹å—ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­å‘ä¸‹ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥ä½ç½®ï¼Œé‚£ä¹ˆæ–°æ–¹å—</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">down</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_square</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">new_block</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">square</span> <span class="n">temp</span> <span class="p">=</span> <span class="n">_square</span><span class="p">.</span><span class="nf">clone</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">t</span> <span class="k">in</span> <span class="n">temp</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">t</span><span class="p">.</span><span class="n">row</span><span class="p">++;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="nf">rectangle</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span><span class="c1">//ä¿®æ”¹</span>
            <span class="p">{</span>
                <span class="nf">draw</span><span class="p">();</span>          <span class="c1">//ç”»å‡ºæ¥</span>
                <span class="nf">new_block</span><span class="p">();</span>     
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">_square</span> <span class="p">=</span> <span class="n">temp</span><span class="p">;</span> <span class="c1">//ä¸ºä»€ä¹ˆä¸clone</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç ç•™æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æœ€åçš„æŠŠå¯ä»¥çš„ä½ç½®å¤åˆ¶å›å»æ€ä¹ˆä¸éœ€è¦å†™å¤åˆ¶ï¼Œå½“ç„¶è¿™ä¸ªç®€å•ã€‚</p>

<p>æˆ‘ä»¬ç°åœ¨è¿˜éœ€è¦çœ‹ç”»å‡ºæ¥</p>

<p>æˆ‘ä»¬éœ€è¦æŠŠæ–¹å—ç”»åœ¨gridï¼Œé‚£äº›æˆ‘ä»¬æ— æ³•ç§»åŠ¨çš„æ–¹å—éœ€è¦ç”»åœ¨grid</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">draw</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_square</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">n</span> <span class="p">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">_grid_observable</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="n">n</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">_grid_observable</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">rectangle</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nf">clean</span><span class="p">();</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ç”»å®Œæˆ‘ä»¬åˆ¤æ–­æ˜¯ä¸æ˜¯å¯ä»¥åˆ æ‰ï¼Œåˆ¤æ–­ä¸€è¡Œæ˜¯ä¸æ˜¯æœ‰æ–¹å—ï¼Œæœ‰å°±åˆ æ‰</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">clean</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_grid_observable</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&lt;</span> <span class="n">_col</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">_rectangle</span> <span class="p">=</span> <span class="n">_rectangle</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">rectangle</span> <span class="p">!=</span> <span class="m">0</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">==</span> <span class="n">_col</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">_rectangle</span> <span class="p">=</span> <span class="n">_rectangle</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">rectangle</span> <span class="p">!=</span> <span class="m">0</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">_rectangle</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">n</span><span class="p">*</span><span class="n">_col</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&gt;</span> <span class="n">_col</span><span class="p">;</span> <span class="n">i</span><span class="p">--)</span>
                        <span class="p">{</span>
                            <span class="n">_grid_observable</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rectangle</span> <span class="p">=</span> <span class="n">_grid_observable</span><span class="p">[</span><span class="n">i</span> <span class="p">-</span> <span class="n">_col</span><span class="p">].</span><span class="n">rectangle</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="n">n</span><span class="p">--;</span>
                    <span class="p">}</span>
                    <span class="n">n</span><span class="p">++;</span>
                    <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ç°åœ¨æˆ‘ä»¬éœ€è¦å†™ç§»åŠ¨</p>

<p>å·¦ç§»colâ€“ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥å­˜åœ¨ï¼Œå¯ä»¥ï¼Œå¤åˆ¶å›å»</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">move</span><span class="p">(</span><span class="kt">bool</span> <span class="n">left</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">square</span> <span class="n">temp</span> <span class="p">=</span> <span class="n">_square</span><span class="p">.</span><span class="nf">clone</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">t</span> <span class="k">in</span> <span class="n">temp</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">left</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">t</span><span class="p">.</span><span class="n">col</span><span class="p">--;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">t</span><span class="p">.</span><span class="n">col</span><span class="p">++;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nf">rectangle</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">_square</span> <span class="p">=</span> <span class="n">temp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬åŸºæœ¬åšå¥½äº†ä¿„ç½—æ–¯æ–¹å—ç®—æ³•</p>

<p>æˆ‘ä»¬å»mainpageå†™</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">keydown</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Windows</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">Input</span><span class="p">.</span><span class="n">KeyRoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span> <span class="p">==</span> <span class="n">VirtualKey</span><span class="p">.</span><span class="n">Up</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">view</span><span class="p">.</span><span class="nf">translate</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span> <span class="p">==</span> <span class="n">VirtualKey</span><span class="p">.</span><span class="n">Left</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">view</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span><span class="p">==</span><span class="n">VirtualKey</span><span class="p">.</span><span class="n">Right</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">view</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span> <span class="p">==</span> <span class="n">VirtualKey</span><span class="p">.</span><span class="n">Down</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">view</span><span class="p">.</span><span class="nf">down</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>viewmodeåªæ˜¯ä½¿ç”¨model</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">move</span><span class="p">(</span><span class="kt">bool</span> <span class="n">left</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_model</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="n">left</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ç©äº†ï¼Œç„¶åä½ ä¼šå‘ç°å¥½åƒæˆ‘ä»¬è¿˜å°‘ä¸ªæ²¡æœ‰å†™</p>

<p>æˆ‘æŠŠå…¨éƒ¨ä»£ç æ”¾ä¸‹é¢ï¼Œç­‰åˆ°ä½ ä¸çŸ¥é“æ€ä¹ˆå†™æ‰å»ï¼Œæˆ‘çš„å˜é‡å‘½åå…¶å®æœ‰é—®é¢˜ï¼Œå¦‚æœå¯ä»¥å»æ”¹ä¸‹</p>

<p>MainPage.xaml</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Page</span>
    <span class="na">x:Class=</span><span class="s">"tetris.MainPage"</span>
    <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="na">xmlns:local=</span><span class="s">"using:tetris"</span>
    <span class="na">xmlns:d=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="na">xmlns:mc=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="na">mc:Ignorable=</span><span class="s">"d"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;Grid</span> <span class="na">Background=</span><span class="s">"{ThemeResource ApplicationPageBackgroundThemeBrush}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;TextBox</span> <span class="na">Margin=</span><span class="s">"10,10,10,10"</span> <span class="na">Width=</span><span class="s">"1"</span> <span class="na">Height=</span><span class="s">"1"</span> <span class="na">KeyDown=</span><span class="s">"keydown"</span><span class="nt">&gt;&lt;/TextBox&gt;</span>
        <span class="nt">&lt;Canvas</span> <span class="na">x:Name=</span><span class="s">"canvas"</span> <span class="na">Margin=</span><span class="s">"10,10,10,10"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;/Canvas&gt;</span>
    <span class="nt">&lt;/Grid&gt;</span>
<span class="nt">&lt;/Page&gt;</span>

</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lindexi</span>
<span class="c1">// 11:22</span>

<span class="cp"># region
</span>
<span class="k">using</span> <span class="nn">System.Runtime.CompilerServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml.Controls</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml.Media</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml.Media.Imaging</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml.Shapes</span><span class="p">;</span>

<span class="cp"># endregion
</span>
<span class="c1">//â€œç©ºç™½é¡µâ€é¡¹æ¨¡æ¿åœ¨ http://go.microsoft.com/fwlink/?LinkId=402352&amp;clcid=0x409 ä¸Šæœ‰ä»‹ç»</span>

<span class="k">namespace</span> <span class="nn">tetris</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// å¯ç”¨äºè‡ªèº«æˆ–å¯¼èˆªè‡³ Frame å†…éƒ¨çš„ç©ºç™½é¡µã€‚</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainPage</span> <span class="p">:</span> <span class="n">Page</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">viewModel</span> <span class="n">view</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">MainPage</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
            <span class="nf">rectangle</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">keydown</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Windows</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">Input</span><span class="p">.</span><span class="n">KeyRoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span> <span class="p">==</span> <span class="n">VirtualKey</span><span class="p">.</span><span class="n">Up</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">view</span><span class="p">.</span><span class="nf">translate</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span> <span class="p">==</span> <span class="n">VirtualKey</span><span class="p">.</span><span class="n">Left</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">view</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span><span class="p">==</span><span class="n">VirtualKey</span><span class="p">.</span><span class="n">Right</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">view</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span> <span class="p">==</span> <span class="n">VirtualKey</span><span class="p">.</span><span class="n">Down</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">view</span><span class="p">.</span><span class="nf">down</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">rectangle</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">view</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">viewModel</span><span class="p">();</span>
            <span class="n">Rectangle</span><span class="p">[,]</span> <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">[</span><span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span><span class="p">];</span>
            <span class="kt">double</span> <span class="n">height</span> <span class="p">=</span> <span class="m">600</span><span class="p">;</span>
            <span class="kt">double</span> <span class="n">size</span> <span class="p">=</span> <span class="n">height</span> <span class="p">/</span> <span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">size</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">canvas</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="n">size</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
            <span class="n">canvas</span><span class="p">.</span><span class="n">Height</span> <span class="p">=</span> <span class="n">size</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
            <span class="n">canvas</span><span class="p">.</span><span class="n">Background</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">BurlyWood</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">view</span><span class="p">.</span><span class="n">row</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rectangle</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Width</span> <span class="p">=</span> <span class="n">size</span><span class="p">,</span>
                        <span class="n">Height</span> <span class="p">=</span> <span class="n">size</span><span class="p">,</span>
                        <span class="n">Fill</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Gray</span><span class="p">),</span>
                        <span class="n">Stroke</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">LightCoral</span><span class="p">),</span>
                        <span class="n">AllowDrop</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                        <span class="n">CanDrag</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                        <span class="n">Margin</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Thickness</span><span class="p">(</span><span class="n">j</span> <span class="p">*</span> <span class="n">size</span><span class="p">,</span> <span class="n">i</span> <span class="p">*</span> <span class="n">size</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">};</span>
                    <span class="n">Binding</span> <span class="n">bind</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Binding</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Path</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PropertyPath</span><span class="p">(</span><span class="s">"solid_collection["</span> <span class="p">+</span> <span class="p">(</span><span class="n">i</span> <span class="p">*</span> <span class="n">view</span><span class="p">.</span><span class="n">col</span> <span class="p">+</span> <span class="n">j</span><span class="p">)</span> <span class="p">+</span> <span class="s">"].solids"</span><span class="p">),</span>
                        <span class="n">Mode</span> <span class="p">=</span> <span class="n">BindingMode</span><span class="p">.</span><span class="n">OneWay</span>
                    <span class="p">};</span>
                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="n">DataContext</span> <span class="p">=</span> <span class="n">view</span><span class="p">;</span>
                    <span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">].</span><span class="nf">SetBinding</span><span class="p">(</span><span class="n">Shape</span><span class="p">.</span><span class="n">FillProperty</span><span class="p">,</span> <span class="n">bind</span><span class="p">);</span>
                    <span class="n">canvas</span><span class="p">.</span><span class="n">Children</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">_rectangle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>viewModel</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.ObjectModel</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml.Controls.Primitives</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml.Media</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Windows.UI.Xaml.Shapes</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">tetris</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">viewModel</span> <span class="p">:</span> <span class="n">notify_property</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">viewModel</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">[,]</span> <span class="n">rectangle</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_rectangle</span> <span class="p">=</span> <span class="n">rectangle</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="nf">viewModel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//_solid = new SolidColorBrush[row, col];</span>
            <span class="n">solid_collection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">solid</span><span class="p">&gt;();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">col</span> <span class="p">*</span> <span class="n">row</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">solid_collection</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">solid</span><span class="p">(</span><span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Gray</span><span class="p">)));</span>
            <span class="p">}</span>
            <span class="n">visibility</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Visibility</span><span class="p">[</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span><span class="p">];</span>
            <span class="n">rectangle_visibility</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Visibility</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">];</span>
            <span class="n">DispatcherTimer</span> <span class="n">time</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DispatcherTimer</span>
            <span class="p">{</span>
                <span class="n">Interval</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">0.5</span><span class="p">)</span>
            <span class="p">};</span>
            <span class="n">time</span><span class="p">.</span><span class="n">Tick</span> <span class="p">+=</span> <span class="n">tick</span><span class="p">;</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">translate</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_model</span><span class="p">.</span><span class="nf">translate</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">move</span><span class="p">(</span><span class="kt">bool</span> <span class="n">left</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_model</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="n">left</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">tick</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="kt">object</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">DispatcherTimer</span> <span class="n">time</span> <span class="p">=</span> <span class="n">sender</span> <span class="k">as</span> <span class="n">DispatcherTimer</span><span class="p">;</span>
            <span class="n">time</span><span class="p">?.</span><span class="nf">Stop</span><span class="p">();</span>
            <span class="nf">down</span><span class="p">();</span>
            <span class="n">time</span><span class="p">?.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//Rectangle</span>
        <span class="k">private</span> <span class="n">Rectangle</span><span class="p">[,]</span> <span class="n">_rectangle</span><span class="p">;</span>
        <span class="c1">//private SolidColorBrush[,] _solid;</span>
        <span class="k">public</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">solid</span><span class="p">&gt;</span> <span class="n">solid_collection</span>
        <span class="p">{</span>
            <span class="k">set</span><span class="p">;</span>
            <span class="k">get</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//private void draw()</span>
        <span class="c1">//{</span>
        <span class="c1">//    foreach (grid temp in _model.grid_observable)</span>
        <span class="c1">//    {</span>

        <span class="c1">//    }</span>
        <span class="c1">//}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">col</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="k">value</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_model</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">row</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="k">value</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_model</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//public SolidColorBrush[,] solid</span>
        <span class="c1">//{</span>
        <span class="c1">//    set</span>
        <span class="c1">//    {</span>
        <span class="c1">//        _solid = value;</span>
        <span class="c1">//        OnPropertyChanged();</span>
        <span class="c1">//    }</span>
        <span class="c1">//    get</span>
        <span class="c1">//    {</span>
        <span class="c1">//        return _solid;</span>
        <span class="c1">//    }</span>
        <span class="c1">//}</span>

        <span class="k">public</span> <span class="n">Visibility</span><span class="p">[,]</span> <span class="n">rectangle_visibility</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_rectangle_visibility</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="nf">OnPropertyChanged</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_rectangle_visibility</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="p">}</span>

        <span class="k">private</span> <span class="n">Visibility</span><span class="p">[,]</span> <span class="n">_rectangle_visibility</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">Visibility</span><span class="p">[]</span> <span class="n">_visibility</span><span class="p">;</span>

        <span class="k">public</span> <span class="n">Visibility</span><span class="p">[]</span> <span class="n">visibility</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_visibility</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="nf">OnPropertyChanged</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_visibility</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">down</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//visibility = visibility == Visibility.Collapsed ? Visibility.Visible : Visibility.Collapsed;</span>
            <span class="n">_model</span><span class="p">.</span><span class="nf">down</span><span class="p">();</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_model</span><span class="p">.</span><span class="n">grid_observable</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//SolidColorBrush _sld=new SolidColorBrush();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">rectangle</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">//solid[temp.row, temp.col] = new SolidColorBrush(Colors.Gray);</span>
                    <span class="n">solid_collection</span><span class="p">[</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="n">solids</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Gray</span><span class="p">);</span>
                    <span class="c1">//rectangle_visibility[temp.row, temp.col] = Visibility.Collapsed;</span>
                    <span class="c1">//visibility[temp.row * col + temp.col] = Visibility.Collapsed;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="c1">//if(temp.rectangle == 1)</span>
                <span class="p">{</span>
                    <span class="c1">//solid[temp.row, temp.col] = new SolidColorBrush(Colors.White);</span>
                    <span class="n">solid_collection</span><span class="p">[</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="n">solids</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">White</span><span class="p">);</span>
                    <span class="c1">//rectangle_visibility[temp.row, temp.col] = Visibility.Visible;</span>
                    <span class="c1">//visibility[temp.row * col + temp.col] = Visibility.Visible;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_model</span><span class="p">.</span><span class="n">grid_observable</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">rectangle</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">solid_collection</span><span class="p">[</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="n">solids</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Gray</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> 
                <span class="p">{</span>
                    <span class="n">solid_collection</span><span class="p">[</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="n">solids</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">White</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_model</span><span class="p">.</span><span class="n">_square</span><span class="p">.</span><span class="n">_grid</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">temp</span> <span class="p">=&gt;</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">solid_collection</span><span class="p">[</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">*</span> <span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="n">solids</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">White</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">model</span> <span class="n">_model</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">model</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">solid</span> <span class="p">:</span> <span class="n">notify_property</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">solid</span><span class="p">(</span><span class="n">SolidColorBrush</span> <span class="n">solid</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_solid</span> <span class="p">=</span> <span class="n">solid</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">SolidColorBrush</span> <span class="n">solids</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_solid</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="nf">OnPropertyChanged</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_solid</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="n">SolidColorBrush</span> <span class="n">_solid</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>model</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lindexi</span>
<span class="c1">// 10:41</span>

<span class="cp"># region
</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.ObjectModel</span><span class="p">;</span>

<span class="cp"># endregion
</span>
<span class="k">namespace</span> <span class="nn">tetris</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">model</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">model</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_grid_observable</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">grid</span><span class="p">&gt;();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_row</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">_col</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="n">_grid_observable</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">grid</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">square</span> <span class="n">_square</span>
        <span class="p">{</span>
            <span class="k">set</span><span class="p">;</span>
            <span class="k">get</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">col</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_col</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_col</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">grid</span><span class="p">&gt;</span> <span class="n">grid_observable</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_grid_observable</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_grid_observable</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">row</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_row</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_row</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">translate</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">square</span> <span class="n">rotate</span> <span class="p">=</span> <span class="n">_square</span><span class="p">.</span><span class="nf">clone</span><span class="p">();</span>
            <span class="n">rotate</span><span class="p">.</span><span class="nf">rotate</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="nf">rectangle</span><span class="p">(</span><span class="n">rotate</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">_square</span> <span class="p">=</span> <span class="n">rotate</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">move</span><span class="p">(</span><span class="kt">bool</span> <span class="n">left</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">square</span> <span class="n">temp</span> <span class="p">=</span> <span class="n">_square</span><span class="p">.</span><span class="nf">clone</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">t</span> <span class="k">in</span> <span class="n">temp</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">left</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">t</span><span class="p">.</span><span class="n">col</span><span class="p">--;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">t</span><span class="p">.</span><span class="n">col</span><span class="p">++;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nf">rectangle</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">_square</span> <span class="p">=</span> <span class="n">temp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">down</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_square</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">new_block</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">square</span> <span class="n">temp</span> <span class="p">=</span> <span class="n">_square</span><span class="p">.</span><span class="nf">clone</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">t</span> <span class="k">in</span> <span class="n">temp</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">t</span><span class="p">.</span><span class="n">row</span><span class="p">++;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="nf">rectangle</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="nf">draw</span><span class="p">();</span>
                <span class="nf">new_block</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">_square</span> <span class="p">=</span> <span class="n">temp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">Random</span> <span class="n">ran</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_ran</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_ran</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">_col</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>

        <span class="k">private</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">grid</span><span class="p">&gt;</span> <span class="n">_grid_observable</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">Random</span> <span class="n">_ran</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">();</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">_row</span> <span class="p">=</span> <span class="m">20</span><span class="p">;</span>


        <span class="k">private</span> <span class="k">void</span> <span class="nf">new_block</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">block</span> <span class="n">_block</span> <span class="p">=</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="n">ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">4</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">center</span> <span class="p">=</span> <span class="n">_col</span><span class="p">/</span><span class="m">2</span><span class="p">;</span>
            <span class="n">_square</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">square</span><span class="p">(</span><span class="n">_block</span><span class="p">,</span> <span class="n">center</span><span class="p">);</span>
            <span class="c1">//_square = new square(block.straight, center);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">draw</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_square</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">n</span> <span class="p">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">row</span><span class="p">*</span><span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">_grid_observable</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="n">n</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">_grid_observable</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">rectangle</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nf">clean</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">bool</span> <span class="nf">rectangle</span><span class="p">(</span><span class="n">square</span> <span class="n">_square</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_square</span><span class="p">.</span><span class="n">_grid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">row</span><span class="p">*</span><span class="n">col</span> <span class="p">+</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">_grid_observable</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="n">n</span> <span class="p">&amp;&amp;</span> <span class="n">_grid_observable</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">rectangle</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">row</span> <span class="p">&gt;=</span> <span class="n">_row</span> <span class="p">||</span> <span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&gt;=</span> <span class="n">_col</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">_rectangle</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">clean</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">grid</span> <span class="n">temp</span> <span class="k">in</span> <span class="n">_grid_observable</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">&lt;</span> <span class="n">_col</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">_rectangle</span> <span class="p">=</span> <span class="n">_rectangle</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">rectangle</span> <span class="p">!=</span> <span class="m">0</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">col</span> <span class="p">==</span> <span class="n">_col</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">_rectangle</span> <span class="p">=</span> <span class="n">_rectangle</span> <span class="p">&amp;&amp;</span> <span class="n">temp</span><span class="p">.</span><span class="n">rectangle</span> <span class="p">!=</span> <span class="m">0</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">_rectangle</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">n</span><span class="p">*</span><span class="n">_col</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&gt;</span> <span class="n">_col</span><span class="p">;</span> <span class="n">i</span><span class="p">--)</span>
                        <span class="p">{</span>
                            <span class="n">_grid_observable</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rectangle</span> <span class="p">=</span> <span class="n">_grid_observable</span><span class="p">[</span><span class="n">i</span> <span class="p">-</span> <span class="n">_col</span><span class="p">].</span><span class="n">rectangle</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="n">n</span><span class="p">--;</span>
                    <span class="p">}</span>
                    <span class="n">n</span><span class="p">++;</span>
                    <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">grid</span> <span class="p">:</span> <span class="n">notify_property</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">grid</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_rectangle</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="nf">grid</span><span class="p">(</span><span class="kt">int</span> <span class="n">col</span><span class="p">,</span> <span class="kt">int</span> <span class="n">row</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_col</span> <span class="p">=</span> <span class="n">col</span><span class="p">;</span>
            <span class="n">_row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
            <span class="n">_rectangle</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">col</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_col</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="nf">OnPropertyChanged</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_col</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">rectangle</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_rectangle</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_rectangle</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="n">row</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_row</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="nf">OnPropertyChanged</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">_row</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">grid</span> <span class="nf">clone</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">grid</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">_col</span><span class="p">;</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">_rectangle</span><span class="p">;</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">_row</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">enum</span> <span class="n">block</span>
    <span class="p">{</span>
        <span class="n">straight</span><span class="p">,</span> <span class="c1">//ç›´</span>
        <span class="n">square</span><span class="p">,</span>
        <span class="n">t</span><span class="p">,</span>
        <span class="n">bent</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">square</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">square</span><span class="p">(</span><span class="n">block</span> <span class="n">block</span><span class="p">,</span> <span class="kt">int</span> <span class="n">center</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_block</span> <span class="p">=</span> <span class="n">block</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">4</span><span class="p">;</span>
            <span class="c1">//col = new int[n];</span>
            <span class="c1">//row = new int[n];</span>
            <span class="n">_grid</span> <span class="p">=</span> <span class="k">new</span> <span class="n">grid</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">grid</span><span class="p">();</span>
                <span class="k">switch</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">straight</span><span class="p">:</span>
                        <span class="c1">//col[i] = center;</span>
                        <span class="c1">//row[i] = -i;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="n">i</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">t</span><span class="p">:</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">3</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">square</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;=</span> <span class="m">1</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="c1">//col[i] = center + i;</span>
                            <span class="c1">//row[i] = 0;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="c1">//col[i] = center + i - 2;</span>
                            <span class="c1">//row[i] = -1;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">2</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">bent</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;=</span> <span class="m">1</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="c1">//col[i] = center + 1;</span>
                            <span class="c1">//row[i] = 0;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="c1">//col[i] = center + i - 3;</span>
                            <span class="c1">//row[i] = -1;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">i</span> <span class="p">-</span> <span class="m">3</span><span class="p">;</span>
                            <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="p">:</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">block</span><span class="p">),</span> <span class="n">block</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">rotate</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">_block</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">straight</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">rotate_count</span> <span class="p">==</span> <span class="m">0</span> <span class="p">||</span> <span class="n">rotate_count</span> <span class="p">==</span> <span class="m">2</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">int</span> <span class="n">row</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">row</span><span class="p">;</span>
                        <span class="kt">int</span> <span class="n">col</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">col</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span> <span class="p">+</span> <span class="m">2</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rotate_count</span> <span class="p">==</span> <span class="m">1</span> <span class="p">||</span> <span class="n">rotate_count</span> <span class="p">==</span> <span class="m">3</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">int</span> <span class="n">row</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">row</span><span class="p">;</span>
                        <span class="kt">int</span> <span class="n">col</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">col</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span> <span class="p">-</span> <span class="m">2</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">square</span><span class="p">:</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">t</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">rotate_count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">int</span> <span class="n">row</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">row</span><span class="p">;</span>
                        <span class="kt">int</span> <span class="n">col</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">col</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">row</span><span class="p">--;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">col</span><span class="p">++;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">row</span><span class="p">++;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">col</span><span class="p">--;</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rotate_count</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">int</span> <span class="n">row</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">row</span><span class="p">;</span>
                        <span class="kt">int</span> <span class="n">col</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">col</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span><span class="p">--;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rotate_count</span> <span class="p">==</span> <span class="m">2</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">int</span> <span class="n">row</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">row</span><span class="p">;</span>
                        <span class="kt">int</span> <span class="n">col</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">col</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span><span class="p">++;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rotate_count</span> <span class="p">==</span> <span class="m">3</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">int</span> <span class="n">row</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">row</span><span class="p">;</span>
                        <span class="kt">int</span> <span class="n">col</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">col</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span> <span class="p">+</span> <span class="m">2</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>

                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">row</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">col</span> <span class="p">+</span> <span class="m">2</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">block</span><span class="p">.</span><span class="n">bent</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">rotate_count</span> <span class="p">==</span> <span class="m">0</span> <span class="p">||</span> <span class="n">rotate_count</span> <span class="p">==</span> <span class="m">2</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">row</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">col</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rotate_count</span> <span class="p">==</span> <span class="m">1</span> <span class="p">||</span> <span class="n">rotate_count</span> <span class="p">==</span> <span class="m">3</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">row</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">row</span><span class="p">;</span>
                        <span class="n">_grid</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">col</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">col</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">default</span><span class="p">:</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">rotate_count</span><span class="p">++;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">square</span> <span class="nf">clone</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">square</span> <span class="n">temp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">square</span><span class="p">(</span><span class="n">_block</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_grid</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">temp</span><span class="p">.</span><span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">_grid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">clone</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">temp</span><span class="p">.</span><span class="n">rotate_count</span> <span class="p">=</span> <span class="n">rotate_count</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">rotate_count</span>
        <span class="p">{</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="p">&gt;=</span> <span class="m">4</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">value</span> <span class="p">=</span> <span class="k">value</span><span class="p">%</span><span class="m">4</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">_rotate_count</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_rotate_count</span> <span class="p">&gt;</span> <span class="m">4</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">_rotate_count</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">_rotate_count</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//public int[] col</span>
        <span class="c1">//{</span>
        <span class="c1">//    set</span>
        <span class="c1">//    {</span>
        <span class="c1">//        _col = value;</span>
        <span class="c1">//    }</span>
        <span class="c1">//    get</span>
        <span class="c1">//    {</span>
        <span class="c1">//        return _col;</span>
        <span class="c1">//    }</span>
        <span class="c1">//}</span>

        <span class="c1">//public int[] row</span>
        <span class="c1">//{</span>
        <span class="c1">//    set</span>
        <span class="c1">//    {</span>
        <span class="c1">//        _row = value;</span>
        <span class="c1">//    }</span>
        <span class="c1">//    get</span>
        <span class="c1">//    {</span>
        <span class="c1">//        return _row;</span>
        <span class="c1">//    }</span>
        <span class="c1">//}</span>

        <span class="k">private</span> <span class="n">block</span> <span class="n">_block</span><span class="p">;</span>

        <span class="k">private</span> <span class="kt">int</span> <span class="n">_rotate_count</span><span class="p">;</span>

        <span class="k">public</span> <span class="n">grid</span><span class="p">[]</span> <span class="n">_grid</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

:ET