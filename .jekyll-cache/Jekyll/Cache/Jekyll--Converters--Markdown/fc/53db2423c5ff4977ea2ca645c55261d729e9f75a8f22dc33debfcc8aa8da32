I"sí<p>æœ¬æ–‡ä¸»è¦ç¿»è¯‘å¾®è½¯å®˜æ–¹çš„æ–‡æ¡£å’Œæ·»åŠ ä¸€äº›åœ¨å¼€å‘è¿‡ç¨‹æ¯”è¾ƒå¤šå°ä¼™ä¼´é—®çš„é—®é¢˜ï¼Œå¯èƒ½å¸¦æœ‰ä¸€å®šçš„ä¸»è§‚æ€§å’Œå±€é™æ€§ï¼Œè¯´çš„ä¸œè¥¿å¯èƒ½ä¸å¯¹æˆ–è€…ä¸ç¬¦åˆæ¯ä¸ªäººçš„é¢„æœŸã€‚å¦‚æœè§‰å¾—æˆ‘æœ‰è®²çš„ä¸å¯¹çš„ï¼Œå°±å¤šå¤šåŒ…å«ï¼Œæˆ–è€…ç›´æ¥å…³æ‰è¿™ç¯‡æ–‡ç« ï¼Œä½†æ˜¯è¯·å‹¿ç”Ÿæ°”æˆ–è€…å‘æ€’åæ§½ï¼Œæ¬¢è¿åœ¨æˆ‘åšå®¢è¯„è®º</p>

<!--more-->

<!-- CreateTime:2019/5/25 20:00:52 -->

<div id="toc"></div>

<!-- csdn -->
<!-- æ ‡ç­¾ï¼šuwp,win2d -->

<h2 id="ä»‹ç»">ä»‹ç»</h2>

<p>Win2d æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„åº“ï¼Œè¿™ä¸ªåº“ä½¿ç”¨çš„åº•å±‚å›¾å½¢ Windows Runtime çš„ API é€šè¿‡è¿™ä¸ªåº“å®ç°çš„æ•ˆæœå¯ä»¥å……åˆ†åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿï¼Œç”¨ GPU å¼ºå¤§çš„è®¡ç®—èƒ½åŠ›åšå‡ºåä¸½ç•Œé¢ã€‚é€šè¿‡ Win2d å¯ä»¥ä½¿ç”¨ C# æˆ– C++ å†™åº”ç”¨å•†åº—åº”ç”¨ï¼ŒåŒ…æ‹¬ UWP æˆ– windows 8.1 åº”ç”¨ï¼Œå¯ä»¥åœ¨æ‰‹æœºæˆ–ç”µè„‘è¿è¡Œï¼Œä½†æ˜¯ç°åœ¨ä¸æ”¯æŒ WPF å’Œ WinForms å¼€å‘ã€‚åœ¨åº•å±‚ Win2d åˆ©ç”¨å¼ºå¤§çš„ Direct2D è€Œä¸”æ— ç¼é›†åˆ Windows çš„ Xamlï¼Œå¯ä»¥ä½¿ç”¨å¼ºå¤§çš„æ¸²æŸ“å¾—åˆ°æ¼‚äº®ç•Œé¢ï¼ŒåŒæ—¶æœ‰å¥½çœ‹çš„ API å‡½æ•°ã€‚ä½¿ç”¨ Win2d çš„ä¸€ä¸ªå¥½å¤„æ˜¯è®©æ¸²æŸ“åœ¨ GPU è®¡ç®—ï¼Œåœ¨ CPU å…¨åŠ›è®¡ç®—ä¸šåŠ¡åŠŸèƒ½ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Nuget æ¥å®‰è£… win2d åº“ï¼ŒNugetçš„windows10ç‰ˆwin2d:<a href="http://www.nuget.org/packages/Win2D.uwp">http://www.nuget.org/packages/Win2D.uwp</a>ï¼ŒNugetçš„windows 8.1ç‰ˆwin2d:http://www.nuget.org/packages/Win2D.win81</p>

<p>å¦‚ä½•ä½¿ç”¨å¯ä»¥å‚è§å¾®è½¯ç¤ºä¾‹ <a href="http://github.com/Microsoft/Win2D-samples">http://github.com/Microsoft/Win2D-samples</a> æˆ–ç»§ç»­çœ‹æœ¬æ–‡</p>

<p>åœ¨æœ¬æ–‡ä¸‹é¢ä¼šå‘Šè¯‰å¤§å®¶å¦‚ä½•å¿«é€Ÿä½¿ç”¨ Win2d åšå‡ºå¥½çœ‹ç•Œé¢ï¼Œå¤§æ¦‚çœ‹äº†è¿™ä¸ªåšå®¢å°±å¯ä»¥äº†è§£ Win2d æ˜¯å¦‚ä½•å†™çš„ï¼Œå› ä¸º Win2d çš„ä½¿ç”¨æ˜¯å¾ˆç®€å•ã€‚</p>

<p>ä¸€äº›é“¾æ¥ï¼š
å¦‚æœæ‰¾åˆ°bugå¯ä»¥é€šè¿‡ <a href="http://github.com/Microsoft/Win2D/issues">http://github.com/Microsoft/Win2D/issues</a> å‘Šè¯‰å¾®è½¯</p>

<p>å›¢é˜Ÿåšå®¢ï¼š<a href="http://blogs.msdn.com/b/win2d">http://blogs.msdn.com/b/win2d</a></p>

<h2 id="ç‰¹æ€§">ç‰¹æ€§</h2>

<ul>
  <li>
    <p>ä½æ˜ åƒå›¾å½¢</p>
  </li>
  <li>
    <p>åŠ è½½ã€ä¿å­˜ã€æ¸²æŸ“å›¾å½¢</p>
  </li>
  <li>
    <p>çº¹ç†æ¸²æŸ“</p>
  </li>
  <li>
    <p>è’™ç‰ˆ</p>
  </li>
  <li>
    <p>å¿«é€Ÿå¤„ç†å¤§é‡å›¾ç‰‡</p>
  </li>
  <li>
    <p>åˆ†å—å‹ç¼©å›¾åƒ</p>
  </li>
  <li>
    <p>åŠ è½½ã€ä¿å­˜ã€æ¸²æŸ“è™šæ‹Ÿä½å›¾ï¼Œè™šæ‹Ÿä½å›¾å°±æ˜¯è¶…è¿‡GPUçš„çº¹ç†ä¼šè‡ªåŠ¨åˆ†ä¸ºå¤šä¸ª</p>
  </li>
  <li>
    <p>çŸ¢é‡å›¾</p>
  </li>
  <li>
    <p>ç”»å›¾å½¢ï¼Œçº¿ã€çŸ©å½¢ã€åœ†ï¼Œæˆ–ä½¿ç”¨åŸºç¡€å›¾å½¢ç»„æˆå¤æ‚çš„</p>
  </li>
  <li>
    <p>ä½¿ç”¨ç¬”åˆ·ã€é¢œè‰²ã€å›¾å½¢å¡«å……å›¾å½¢</p>
  </li>
  <li>
    <p>ä»»æ„å®½åº¦çº¿æ®µ</p>
  </li>
  <li>
    <p>å›¾å½¢æ˜¾å½±æ•ˆåº”</p>
  </li>
</ul>

<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>

<p>æ‰“å¼€ vsï¼Œåˆ›å»º UWP é¡¹ç›®ï¼Œè¿™é‡ŒæŠŠé¡¹ç›®å« UmmyShirouValeri ï¼Œåå­—æ˜¯ç”¨æˆ‘çš„<a href="ms-windows-store://pdp/?productid=9P8LNZRNJX85">å‘½åè¾“å…¥æ³•</a>å†™å‡ºæ¥çš„ã€‚</p>

<p>æ‰“å¼€ Nuget æœç´¢ win2d å®‰è£…</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F20173262046.jpg" alt="" /></p>

<p>æ‰“å¼€ MainPage.xaml ï¼Œæ·»åŠ å‘½å<code class="language-plaintext highlighter-rouge">xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"</code>ã€‚åœ¨æœ¬æ–‡åé¢ï¼Œæˆ‘å¯èƒ½ä¼šä½¿ç”¨å¦ä¸€ä¸ªå‘½åç©ºé—´<code class="language-plaintext highlighter-rouge">xmlns:xaml="using:Microsoft.Graphics.Canvas.UI.Xaml"</code> ï¼Œä¸¤ä¸ªæ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºæœ¬æ–‡æˆ‘å†™äº†å¤§æ¦‚æœ‰åŠå¹´ï¼Œæ‰€ä»¥é‡Œé¢çš„ä»£ç æœ‰å¾ˆå¤šæ˜¯ä¸ç›¸åŒã€‚</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;Page</span>
    <span class="na">x:Class=</span><span class="s">"UmmyShirouValeri.MainPage"</span>
    <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="na">xmlns:local=</span><span class="s">"using:UmmyShirouValeri"</span>
    <span class="na">xmlns:d=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="na">xmlns:mc=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="na">xmlns:canvas=</span><span class="s">"using:Microsoft.Graphics.Canvas.UI.Xaml"</span>
    <span class="na">mc:Ignorable=</span><span class="s">"d"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>æ·»åŠ å‘½åä¹‹åï¼Œå¯ä»¥åœ¨ XAML æ·»åŠ æ§ä»¶æ˜¾ç¤ºç•Œé¢</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="p">&lt;</span><span class="n">canvas</span><span class="p">:</span><span class="n">CanvasControl</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"Canvas"</span> <span class="n">ClearColor</span><span class="p">=</span><span class="s">"Black"</span><span class="p">&gt;&lt;/</span><span class="n">canvas</span><span class="p">:</span><span class="n">CanvasControl</span><span class="p">&gt;</span>

</code></pre></div></div>

<p>å…ˆè¿è¡Œä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾çš„ç•Œé¢ã€‚</p>

<p>åœ¨ VisualStudio ä¸­ä¸€èˆ¬å¯ä»¥æŒ‰ F5 è¿è¡Œï¼Œä½†æ˜¯å¦‚æœåœ¨ç¼–è¯‘çš„è¿‡ç¨‹å‘ç°è¿˜ä¸åˆ°å¯ä»¥è¿è¡Œçš„æ—¶å€™ï¼Œè¿˜éœ€è¦åšä¸€äº›ä¿®æ”¹ï¼Œé‚£ä¹ˆè¯·æŒ‰ ctrl+break å–æ¶ˆç”Ÿæˆã€‚</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F20173262081.jpg" alt="" /></p>

<p>æŒ‰ä¸‹F5è¿™æ—¶çœ‹èµ·æ¥ä»€ä¹ˆæ²¡æœ‰ï¼Œå…¶å®å°ä¼™ä¼´æœ‰æ³¨æ„åˆ°èƒŒæ™¯é¢œè‰²æ›´æ”¹äº†ï¼Œå°±æ˜¯åœ¨ä¸Šé¢ä»£ç  ClearColor è®¾ç½®çš„å€¼ã€‚å¦‚æœæŒ‰ä¸‹ F5 è¿è¡Œçš„ç¨‹åºå¯ä»¥è¿è¡Œçœ‹åˆ°ç•Œé¢é¢œè‰²ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆå°±æ˜¯ Win2d å®‰è£…æˆåŠŸäº†ã€‚</p>

<p>å› ä¸ºwin2dçš„ç‰ˆæœ¬å’Œå¯¹åº”çš„ UWP çš„ sdk ç‰ˆæœ¬æ˜¯æœ‰è”ç³»çš„ï¼Œå¦‚æœå‘ç°æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œé‚£ä¹ˆè¯·åŒæ—¶å‡çº§ Win2d å’Œ <code class="language-plaintext highlighter-rouge">Microsoft.NETCore.UniversalWindowsPlatform</code> æœ€æ–°ï¼Œå‡çº§ UWP é¡¹ç›®ä½¿ç”¨æœ€æ–°çš„</p>

<p>åœ¨å‡†å¤‡å¥½äº†ä¹‹åï¼Œä¸‹é¢è®©æˆ‘å‘Šè¯‰å¤§å®¶åŸºç¡€çš„åŠŸèƒ½ï¼Œä½¿ç”¨åŸºç¡€çš„åŠŸèƒ½ä¸æ˜¯ç”¨æ¥åšå¥½çœ‹çš„ç•Œé¢çš„ï¼Œåªæ˜¯çŸ¥é“ Win2d å¦‚ä½•ä½¿ç”¨</p>

<h3 id="æ·»åŠ æ–‡å­—">æ·»åŠ æ–‡å­—</h3>

<p>éœ€è¦åœ¨ Canvas çš„ Draw æ·»åŠ å‡½æ•°ï¼Œå¯ä»¥åœ¨è¿™é‡Œç”»å‡ºå›¾æ¡ˆï¼Œæ–‡å­—ï¼Œäºæ˜¯ä½¿ç”¨è¿™å¥æ·»åŠ åœ¨ xaml ` <canvas:CanvasControl x:Name="canvas" ClearColor="Black" Draw="Canvas_OnDraw"></canvas:CanvasControl><code class="language-plaintext highlighter-rouge"> ã€‚åœ¨ MainPage.xaml.cs å†™å‡½æ•° </code>Canvas_OnDraw` è¿™æ ·å°±å¯ä»¥åœ¨åå°ä»£ç åšå‡ºå¥½çœ‹ç•Œé¢</p>

<p>å®é™…ä¸Šä¸Šé¢çš„ä»£ç çš„æ ¸å¿ƒå°±æ˜¯ <code class="language-plaintext highlighter-rouge">Draw="Canvas_OnDraw"</code> é€šè¿‡è¿™ä¸ªä»£ç å¯ä»¥åœ¨ MainPage.xaml.cs å‡½æ•°è¯·çœ‹ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnDraw</span><span class="p">(</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Graphics</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Graphics</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">CanvasDrawEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">draw</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">DrawingSession</span><span class="p">;</span>
            <span class="n">draw</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s">"lindexi"</span><span class="p">,</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">100</span><span class="p">),</span><span class="n">Color</span><span class="p">.</span><span class="nf">FromArgb</span><span class="p">(</span><span class="m">0xFF</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">100</span><span class="p">));</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ä¸Šé¢çš„ä»£ç åœ¨åæ ‡ï¼ˆ100ï¼Œ100ï¼‰å†™å‡ºæ–‡å­— â€œlindexiâ€ æ–‡å­—çš„é¢œè‰²è®¾ç½®äº†æˆ‘ä¹Ÿä¸çŸ¥é“çš„é¢œè‰²ã€‚</p>

<p>åœ¨å†™æ–‡å­—å°±éœ€è¦ç”¨åˆ° args.DrawingSession æä¾›å¾ˆå¤šæ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™äº›æ–¹æ³•å†™æ–‡å­—çš„æœ‰ä¸¤ä¸ªï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯é‡Œé¢æœ€ç®€å•çš„ä¸€ä¸ªã€‚</p>

<p>å¦‚æœä½¿ç”¨äº† <code class="language-plaintext highlighter-rouge">draw.DrawText</code> ï¼Œè¿™ä¸ªæ–¹æ³•æä¾›çš„é‡è½½å¾ˆå¤šï¼Œæ–¹æ³•æä¾›å¾ˆå¤šå‚æ•°ï¼Œä¸€èˆ¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è®¾ç½®æ˜¾ç¤ºä½ç½®ï¼Œæ˜¾ç¤ºé¢œè‰²ã€‚</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F2017326201422.jpg" alt="" /></p>

<p>å’Œä¸Šé¢åŒæ ·åŠŸèƒ½ï¼Œå¯ä»¥ä¸ä½¿ç”¨Vector2ï¼Œä½¿ç”¨è¿™ä¸ªä»£ç ä¹Ÿæ˜¯ä¸€æ ·<code class="language-plaintext highlighter-rouge">draw.DrawText("lindexi", 100, 100, Color.FromArgb(0xFF,100,100,100));</code></p>

<p>å¦‚æœéœ€è¦è®¾ç½®å­—ä½“å®½åº¦ï¼Œå¯ä»¥ä½¿ç”¨ CanvasTextFormat æ¥åšã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">draw</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s">"lindexi"</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">500</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="nf">FromArgb</span><span class="p">(</span><span class="m">0xFF</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="k">new</span> <span class="nf">CanvasTextFormat</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">FontSize</span> <span class="p">=</span> <span class="m">100</span>
            <span class="p">});</span>
</code></pre></div></div>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F2017326201856.jpg" alt="" /></p>

<p>éœ€è¦å‘Šè¯‰å¤§å®¶çš„æ˜¯ï¼Œä¸Šé¢çš„ä»£ç æ˜¯ä¸ºäº†è®©å¤§å®¶å¿«é€Ÿè·‘èµ·æ¥ï¼Œå¾ˆå¤šç»†èŠ‚éƒ½æ²¡æœ‰å‘Šè¯‰å¤§å®¶ã€‚å¦‚ DrawingSession çš„ä½¿ç”¨éœ€è¦ using ã€‚åœ¨è®¾ç½®å­—ä½“å®½åº¦ <code class="language-plaintext highlighter-rouge">new CanvasTextFormat</code> ä½¿ç”¨ä¹‹åéœ€è¦é‡Šæ”¾ã€‚</p>

<p>å¾®è½¯å¸Œæœ›ä½¿ç”¨çš„æ¸…çœŸæ–¹æ³•è¯·çœ‹ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">canvasDrawingSession</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">DrawingSession</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">canvasTextFormat</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CanvasTextFormat</span> <span class="p">{</span> <span class="n">FontSize</span> <span class="p">=</span> <span class="m">100</span> <span class="p">};</span>

                <span class="k">using</span> <span class="p">(</span><span class="n">canvasTextFormat</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">canvasDrawingSession</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s">"æ—å¾·ç†™"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">100</span><span class="p">),</span> <span class="n">Color</span><span class="p">.</span><span class="nf">FromArgb</span><span class="p">(</span><span class="m">0xA1</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="n">canvasTextFormat</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
</code></pre></div></div>

<h3 id="æ¸…ç†">æ¸…ç†</h3>

<p>å› ä¸º win2d ä¸ä¼šè‡ªå·±æ¸…ç†ï¼Œä¸€èˆ¬åœ¨é¡µé¢åˆ‡æ¢ï¼Œæ¸…ç†èµ„æº</p>

<p>æ‰“å¼€ MainPage.xaml ï¼Œæ·»åŠ  Unloaded çš„äº‹ä»¶ï¼Œè¿™æ ·åœ¨ Unloaded äº‹ä»¶å¯ä»¥æ¸…ç†</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;Page</span>
    <span class="na">x:Class=</span><span class="s">"UmmyShirouValeri.MainPage"</span>
    <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="na">xmlns:local=</span><span class="s">"using:UmmyShirouValeri"</span>
    <span class="na">xmlns:d=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="na">xmlns:mc=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="na">xmlns:canvas=</span><span class="s">"using:Microsoft.Graphics.Canvas.UI.Xaml"</span>
    <span class="na">Unloaded=</span><span class="s">"Page_OnUnloaded"</span>
    <span class="na">mc:Ignorable=</span><span class="s">"d"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>ä¸Šé¢ä»£ç çš„æ ¸å¿ƒæ˜¯ <code class="language-plaintext highlighter-rouge">Unloaded="Page_OnUnloaded"</code> é€šè¿‡ Unloaded å¯ä»¥çŸ¥é“é¡µé¢å…³é—­</p>

<p>æ‰“å¼€  MainPage.xaml.cs ï¼Œåœ¨å‡½æ•° Page_OnUnloaded æ·»åŠ ä¸‹é¢ä»£ç ï¼Œå°±æ˜¯æŠŠ Win2d ä»è§†è§‰æ ‘ç§»é™¤</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    
        <span class="k">private</span> <span class="k">void</span> <span class="nf">Page_OnUnloaded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">canvas</span><span class="p">.</span><span class="nf">RemoveFromVisualTree</span><span class="p">();</span>
            <span class="n">canvas</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>éœ€è¦è®°å¾—ï¼Œè¿™ä¸ªå¾ˆé‡è¦</p>

<p>ä¸ºä½•éœ€è¦è¿™æ ·ï¼Œå‚è§ï¼š<a href="http://validvoid.net/win2d-avoiding-memory-leaks/">é¿å…å†…å­˜æ³„æ¼</a></p>

<h3 id="è¿™ä¸ªæ ‡é¢˜ä¸çŸ¥é“å†™ä»€ä¹ˆ">è¿™ä¸ªæ ‡é¢˜ä¸çŸ¥é“å†™ä»€ä¹ˆ</h3>

<p>æäº‹ï¼Œä¸€å®šè¦</p>

<p><img src="http://image.acmx.xyz/AwCCAwMAItoFADbzBgABAAQArj4BAGZDAgBo6AkA6Nk%3D%2F2017%25E5%25B9%25B43%25E6%259C%258827%25E6%2597%25A5%252008005.gif" alt="" /></p>

<p>é‚£ä¹ˆè¿™æ˜¯å¦‚ä½•åšçš„ï¼Ÿ</p>

<p>å¦‚æœéœ€è¦é‡æ–°ç”»ï¼Œå¦‚ä½•åšï¼Ÿ</p>

<p>åœ¨ Win2d çš„ CanvasControl åªä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ Draw äº‹ä»¶ï¼Œå¦‚æœæƒ³è¦åšåŠ¨ç”»ï¼Œå¦‚ä½•å¤šæ¬¡è°ƒç”¨ï¼Ÿ
æƒ³è¦è®©ä»–é‡ç”»ï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">canvas.Invalidate();</code> å°±ä¼šé‡æ–°è°ƒç”¨ Canvas_OnDraw</p>

<p>åœ¨æ„é€ ä½¿ç”¨ä¸‹é¢ä»£ç è®©win2dä¸åœé‡ç”»ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">DispatcherTimer</span> <span class="n">t</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DispatcherTimer</span><span class="p">();</span>
            <span class="n">t</span><span class="p">.</span><span class="n">Interval</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TimeSpan</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span>
            <span class="n">t</span><span class="p">.</span><span class="n">Tick</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">canvas</span><span class="p">.</span><span class="nf">Invalidate</span><span class="p">();</span>
            <span class="p">};</span>
            <span class="n">t</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
</code></pre></div></div>

<p>è¿™æ ·å°±å¯ä»¥éš” 1000 æ¯«ç§’é‡ç”»ã€‚éœ€è¦çŸ¥é“ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ˜¯è®©å¤§å®¶å¯ä»¥ç”¨åˆ°ä¹‹å‰çš„æŠ€èƒ½ï¼Œæœ‰å°ä¼™ä¼´å‘Šè¯‰æˆ‘ï¼Œå¦‚æœå†™ä¸€ç¯‡åšå®¢é‡Œé¢ç”¨åˆ°çš„éƒ½ä¸æ˜¯å¤§å®¶é»˜è®¤çš„æŠ€èƒ½ï¼Œé‚£ä¹ˆå¾ˆå°‘æœ‰äººå¯ä»¥çœ‹ä¸‹å»ï¼Œæ‰€ä»¥æˆ‘å°½é‡ä½¿ç”¨å¤§å®¶éƒ½çŸ¥é“çš„æŠ€èƒ½æ¥åšã€‚è¿™é‡Œæ˜¯å‘Šè¯‰å¤§å®¶ï¼Œå¦‚æœæƒ³è¦è§¦å‘ Draw å°±éœ€è¦è°ƒç”¨ <code class="language-plaintext highlighter-rouge">canvas.Invalidate();</code> è°ƒç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥åœ¨ä¸å¯æ§çš„ä¸€ä¸ªæ—¶é—´è§¦å‘<code class="language-plaintext highlighter-rouge">Draw</code>ï¼Œæ‰€ä»¥æ— æ³•ç¨³å®šæŒ‡å®šæ—¶é—´é‡ç”»ã€‚åœ¨æœ¬æ–‡çš„åé¢ä¼šå‘Šè¯‰å¤§å®¶å¦‚ä½•åšåŠ¨ç”»ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnDraw</span><span class="p">(</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Graphics</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Graphics</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">CanvasDrawEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">draw</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">DrawingSession</span><span class="p">;</span>
            <span class="n">draw</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s">"lindexi"</span><span class="p">,</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">100</span><span class="p">),</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="m">500</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="nf">FromArgb</span><span class="p">(</span><span class="m">0xFF</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="k">new</span> <span class="nf">CanvasTextFormat</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">FontSize</span> <span class="p">=</span> <span class="m">100</span>
            <span class="p">});</span>

            <span class="n">draw</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">100</span><span class="p">),</span><span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">100</span><span class="p">),</span><span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">1000</span><span class="p">),</span><span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">1000</span><span class="p">),</span><span class="n">Color</span><span class="p">.</span><span class="nf">FromArgb</span><span class="p">(</span><span class="m">0xFF</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">100</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">Random</span> <span class="n">Ran</span> <span class="p">{</span> <span class="k">set</span><span class="p">;</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">();</span>

</code></pre></div></div>

<p>è¿è¡Œä¸Šé¢ä»£ç å°±å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„æ•ˆæœ</p>

<p>æ˜¯ä¸æ˜¯è§‰å¾—è¿˜ä¸å¥½çœ‹ï¼Œè¯•è¯•è¿™ä¸ªä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnDraw</span><span class="p">(</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Graphics</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Graphics</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">CanvasDrawEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">draw</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">DrawingSession</span><span class="p">;</span>
            <span class="n">draw</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s">"lindexi"</span><span class="p">,</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="m">500</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="nf">r</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">CanvasTextFormat</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">FontSize</span> <span class="p">=</span> <span class="m">100</span>
            <span class="p">});</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">draw</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">),</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">),</span> <span class="nf">r</span><span class="p">());</span>
            <span class="p">}</span>

            <span class="n">Color</span> <span class="nf">r</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">Color</span><span class="p">.</span><span class="nf">FromArgb</span><span class="p">(</span><span class="m">0xFF</span><span class="p">,</span> <span class="nf">rc</span><span class="p">(),</span> <span class="nf">rc</span><span class="p">(),</span> <span class="nf">rc</span><span class="p">());</span>
            <span class="p">}</span>

            <span class="kt">byte</span> <span class="nf">rc</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)(</span><span class="n">Ran</span><span class="p">.</span><span class="nf">NextDouble</span><span class="p">()</span> <span class="p">*</span> <span class="m">255</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

</code></pre></div></div>

<p>éœ€è¦åœ¨vs2017 æ‰å¯ä»¥è·‘ï¼Œå¦‚æœå¸Œæœ›ä¸‹è½½ vs2017 ï¼Œå¯ä»¥åˆ°æˆ‘ç½‘ç›˜ä¸‹è½½</p>

<p>é“¾æ¥ï¼š<a href="http://pan.baidu.com/s/1skXDc3z">http://pan.baidu.com/s/1skXDc3z</a> å¯†ç ï¼š70d6</p>

<p>å¦‚æœåº¦ç›˜é“¾æ¥æ²¡æ³•ä½¿ç”¨ï¼Œè¯·è”ç³»æˆ‘ã€‚</p>

<p>btsyncï¼šBTZR4YIPCLUUEL2BKDACVGLC3473MEWDN</p>

<p>å¦‚æœéœ€è¦ä½¿ç”¨ Win2d ä½¿ç”¨åŠ¨ç”»ï¼Œè¯·çœ‹ <a href="https://blog.lindexi.com/post/win10-uwp-win2d-CanvasVirtualControl-%E4%B8%8E-CanvasAnimatedControl.html">win10 uwp win2d CanvasVirtualControl</a></p>

<h3 id="å¦‚ä½•ç”»çº¿">å¦‚ä½•ç”»çº¿</h3>

<p>åˆšæ‰å·²ç»ä»£ç æœ‰ç”»çº¿çš„ï¼Œä¹Ÿè®¸å·²ç»çœ‹è§ä¸‹é¢çš„ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">draw</span><span class="p">.</span><span class="n">DrawLine</span><span class="err">ï¼ˆ</span><span class="n">x1</span><span class="err">ï¼Œ</span><span class="n">y1</span><span class="err">ï¼Œ</span><span class="n">x2</span><span class="err">ï¼Œ</span><span class="n">y2</span><span class="err">ï¼Œé¢œè‰²ï¼‰</span>
</code></pre></div></div>

<p>é™¤äº†å¯ä»¥è®¾ç½®çº¿æ‰€åœ¨çš„åœ°æ–¹ï¼Œå¯ä»¥è®¾ç½®çº¿æ¡å®½åº¦ã€æ ·å¼ï¼Œå› ä¸ºå¾ˆç®€å•ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸éœ€è¦å¤šè¯´äº†ã€‚</p>

<h3 id="æ·»åŠ å›¾ç‰‡">æ·»åŠ å›¾ç‰‡</h3>

<p>æ·»åŠ å›¾ç‰‡å¯ä»¥é€šè¿‡ <code class="language-plaintext highlighter-rouge">draw.DrawImage</code> ç”»å‡ºå›¾ç‰‡ï¼Œåœ¨ç”»ä¹‹å‰éœ€è¦æœ‰å›¾ç‰‡ï¼Œè¿™é‡Œçš„å›¾ç‰‡çš„ç±»æ˜¯ <code class="language-plaintext highlighter-rouge">CanvasBitmap</code> ä¸‹é¢æ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•ä»æ–‡ä»¶æˆ– URL äºŒè¿›åˆ¶è½¬æ¢å›¾ç‰‡</p>

<p>å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä¸‰ä¸ªæ–¹æ³•æ‹¿åˆ°å›¾ç‰‡</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">CanvasBitmap</span><span class="p">.</span><span class="nf">CreateFromBytes</span><span class="p">()</span> <span class="c1">// ä» bytes æ•°ç»„åˆ›å»º</span>
    <span class="n">CanvasBitmap</span><span class="p">.</span><span class="nf">CreateFromColors</span><span class="p">()</span> <span class="c1">// åˆ›å»ºçº¯è‰²çš„å›¾ç‰‡</span>
    <span class="n">CanvasBitmap</span><span class="p">.</span><span class="nf">LoadAsync</span><span class="p">()</span>       <span class="c1">// é€šè¿‡ URL æˆ–æ–‡ä»¶åˆ›å»º</span>
</code></pre></div></div>

<p>æ³¨æ„ï¼šä¼ å…¥çš„ <code class="language-plaintext highlighter-rouge">ICanvasResourceCreator</code> å°±æ˜¯ CanvasControl ä¹Ÿå°±æ˜¯ä¸€ä¸ªé¡µé¢å¦‚æœå­˜åœ¨å¤šä¸ª CanvasControl åœ¨å“ªä¸ª CanvasControl ä½¿ç”¨çš„å›¾ç‰‡å°±éœ€è¦åœ¨å“ªä¸ªåˆ›å»º</p>

<p>ä¸‹é¢ä½¿ç”¨ LoadAsync ä¼ å…¥å·¥ç¨‹çš„å›¾ç‰‡ï¼Œæ¯”è¾ƒæœŸæœ›çš„æ–¹æ³•æ˜¯åœ¨ <code class="language-plaintext highlighter-rouge">Canvas_OnCreateResources</code> äº‹ä»¶é‡Œé¢åŠ è½½å›¾ç‰‡ã€‚ä½†æ˜¯è¿™é‡Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿å°±ç›´æ¥åœ¨ <code class="language-plaintext highlighter-rouge">Canvas_OnDrawAsync</code> åˆ›å»ºå›¾ç‰‡ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnDrawAsync</span><span class="p">(</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Graphics</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Graphics</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Xaml</span><span class="p">.</span><span class="n">CanvasDrawEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">draw</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">DrawingSession</span><span class="p">;</span>
            <span class="c1">// è¿™æ˜¯æ–‡å­—</span>
            <span class="n">draw</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s">"lindexi"</span><span class="p">,</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="m">500</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="nf">r</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">CanvasTextFormat</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">FontSize</span> <span class="p">=</span> <span class="m">100</span>
            <span class="p">});</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">draw</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">),</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">),</span> <span class="nf">r</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">img</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">draw</span><span class="p">.</span><span class="nf">DrawImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">Ran</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">1000</span><span class="p">),</span> <span class="nf">rc</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">// è¿™æ˜¯å±é™©å†™æ³•ï¼Œè¯·çœ‹ [win10 uwp å¼‚æ­¥è½¬åŒæ­¥](https://lindexi.gitee.io/post/win10-uwp-%E5%BC%82%E6%AD%A5%E8%BD%AC%E5%90%8C%E6%AD%A5.html )</span>
                
                <span class="nf">Img</span><span class="p">().</span><span class="nf">Wait</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="n">Color</span> <span class="nf">r</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">Color</span><span class="p">.</span><span class="nf">FromArgb</span><span class="p">(</span><span class="m">0xFF</span><span class="p">,</span> <span class="nf">rc</span><span class="p">(),</span> <span class="nf">rc</span><span class="p">(),</span> <span class="nf">rc</span><span class="p">());</span>
            <span class="p">}</span>

            <span class="kt">byte</span> <span class="nf">rc</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)(</span><span class="n">Ran</span><span class="p">.</span><span class="nf">NextDouble</span><span class="p">()</span> <span class="p">*</span> <span class="m">255</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">async</span> <span class="n">Task</span> <span class="nf">Img</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="c1">// åŠ è½½å›¾ç‰‡</span>
                <span class="n">img</span> <span class="p">=</span> <span class="k">await</span> <span class="n">CanvasBitmap</span><span class="p">.</span><span class="nf">LoadAsync</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="s">"ms-appx:///Assets/SplashScreen.png"</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

</code></pre></div></div>

<p>åˆ›å»ºå›¾ç‰‡ä½¿ç”¨<code class="language-plaintext highlighter-rouge">img = await CanvasBitmap.LoadAsync(canvas, new Uri("ms-appx:///Assets/SplashScreen.png"));</code> åŠ è½½ï¼Œéœ€è¦æ³¨æ„åŠ è½½çš„æ–‡ä»¶éœ€è¦æ˜¯å†…å®¹</p>

<p>åˆ›å»ºä½¿ç”¨çš„ uri å‚è§ï¼š<a href="https://lindexi.gitee.io/post/win10-uwp-%E8%AE%BF%E9%97%AE%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%96%87%E4%BB%B6.html">win10 uwp è®¿é—®è§£å†³æ–¹æ¡ˆæ–‡ä»¶</a></p>

<h2 id="åˆ›å»ºèµ„æº">åˆ›å»ºèµ„æº</h2>

<p>ä¸Šé¢çš„ä»£ç å¤§å®¶çœ‹åˆ°äº†åœ¨ Draw çš„æ—¶å€™æ‰åˆ›å»ºå›¾ç‰‡ï¼Œè¿™ä¸ªå†™æ³•æ˜¯ä¸æ¸…çœŸã€‚æ­£è§„çš„å†™æ³•æ˜¯åœ¨ CreateResources é‡Œé¢åˆ›å»ºèµ„æºã€‚</p>

<p>å›¾ç‰‡æ˜¯ä¸€ä¸ªèµ„æºï¼Œé™¤äº†å›¾ç‰‡å¤–è¿˜æœ‰å…¶ä»–å¾ˆå¤šèµ„æºã€‚ä½†æ˜¯è¿™é‡Œä½¿ç”¨å›¾ç‰‡ä½œä¸ºä¾‹å­ã€‚</p>

<p>åœ¨ xaml æ·»åŠ  CreateResources äº‹ä»¶ï¼Œä¸‹é¢å°†ä¼šåœ¨è§£å†³æ–¹æ¡ˆè·å¾—ä¸¤å¼ å›¾ç‰‡ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">&lt;</span><span class="n">xaml</span><span class="p">:</span><span class="n">CanvasControl</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"Canvas"</span> <span class="n">ClearColor</span><span class="p">=</span><span class="s">"Black"</span> 
                            <span class="n">CreateResources</span><span class="p">=</span><span class="s">"Canvas_OnCreateResources"</span>
                            <span class="n">Draw</span><span class="p">=</span><span class="s">"Canvas_OnDraw"</span><span class="p">&gt;&lt;/</span><span class="n">xaml</span><span class="p">:</span><span class="n">CanvasControl</span><span class="p">&gt;</span> 
</code></pre></div></div>

<p>åœ¨åå°ä»£ç  <code class="language-plaintext highlighter-rouge">Canvas_OnCreateResources</code> å°±å¯ä»¥ç”¨æ¥åˆ›å»ºèµ„æºï¼Œåœ¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å¼‚æ­¥åˆ›å»ºèµ„æºï¼Œåªæœ‰åœ¨è¿™é‡Œåˆ›å»ºèµ„æºå®Œæˆä¹‹åæ‰ä¼šè°ƒç”¨ Draw æ–¹æ³•ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnCreateResources</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">CanvasCreateResourcesEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ä» CanvasCreateResourcesEventArgs å¯ä»¥çŸ¥é“èµ„æºéœ€è¦åˆ›å»ºçš„åŸå› ï¼Œé€šè¿‡åˆ¤æ–­èµ„æºåˆ›å»ºçš„åŸå› å†³å®šæ˜¯ä¸æ˜¯éœ€è¦åˆ›å»ºèµ„æºã€‚å¦‚æœåˆ¤æ–­æ˜¯ FirstTime é‚£ä¹ˆå°±å¿…é¡»åˆ›å»ºèµ„æºï¼Œå› ä¸ºè¿™æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ã€‚</p>

<p>åœ¨åˆ›å»ºèµ„æºå®Œæˆä¹‹å‰æ˜¯ä¸ä¼šè§¦å‘ Draw ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå‘ï¼Œå¦‚æœæˆ‘åˆ›å»ºèµ„æºéœ€è¦å¼‚æ­¥è¯»å†™ï¼Œé‚£ä¹ˆæˆ‘å¦‚ä½•é˜»å¡è¿™ä¸ªå‡½æ•°ï¼Œéš¾é“ä½¿ç”¨ waitï¼Ÿå®é™…ä¸Šåœ¨ args æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨ TrackAsyncAction å¯ä»¥ç”¨æ¥ç­‰å¾…ä¸€ä¸ª Task ï¼Œåœ¨ä»–å®Œæˆä¹‹åè°ƒç”¨ Draw è€Œä¸æ˜¯ä½¿ç”¨ wait ã€‚è¿™æ ·å†™çš„ä»£ç æ¯”è¾ƒç¬¦åˆå¾®è½¯çš„å¸Œæœ›ã€‚</p>

<p>ä¸ºäº†æ‹¿åˆ°ä¸€ä¸ª Task æ¥å¼‚æ­¥è¯»å†™ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¯·çœ‹ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnCreateResources</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">CanvasCreateResourcesEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">args</span><span class="p">.</span><span class="nf">TrackAsyncAction</span><span class="p">(</span><span class="nf">CreateResourcesAsync</span><span class="p">(</span><span class="n">sender</span><span class="p">).</span><span class="nf">AsAsyncAction</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">CreateResourcesAsync</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">canvasControl</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_bitmap1</span> <span class="p">=</span> <span class="k">await</span> <span class="n">CanvasBitmap</span><span class="p">.</span><span class="nf">LoadAsync</span><span class="p">(</span><span class="n">canvasControl</span><span class="p">,</span> <span class="s">"Assets/1.png"</span><span class="p">);</span>
            <span class="n">_bitmap2</span> <span class="p">=</span> <span class="k">await</span> <span class="n">CanvasBitmap</span><span class="p">.</span><span class="nf">LoadAsync</span><span class="p">(</span><span class="n">canvasControl</span><span class="p">,</span> <span class="s">"Assets/2.png"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">CanvasBitmap</span> <span class="n">_bitmap1</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">CanvasBitmap</span> <span class="n">_bitmap2</span><span class="p">;</span>
</code></pre></div></div>

<p>ä¸Šé¢çš„ä»£ç åœ¨å¤§å®¶çš„è®¾å¤‡ä¸ä¸€å®šèƒ½ä½¿ç”¨ï¼ŒåŸå› æ˜¯éœ€è¦å¤§å®¶åœ¨ Assets æ–‡ä»¶å¤¹æ”¾ä¸¤å¼ å›¾ç‰‡ï¼Œéœ€è¦å‘½åå’Œæˆ‘ä¸€æ ·è€Œä¸”å±æ€§çš„ç”Ÿæˆæ˜¯å†…å®¹ï¼Œè¿™æ ·æ‰å¯ä»¥æ‰¾åˆ°ã€‚</p>

<p>å»ºè®®ä½¿ç”¨è¿™ä¸ªæ–¹æ³•åˆ›å»ºèµ„æºï¼Œåœ¨åŠ è½½å›¾ç‰‡çš„æ—¶å€™ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯ä¸Šé¢çš„ç­‰å¾…ã€‚</p>

<p>èµ„æºçš„åˆ›å»ºä¼šå‘ç”Ÿçš„å¦ä¸€ä¸ªè§¦å‘æ˜¯ä¸¢å¤±è®¾å¤‡ï¼Œå…³äºä¸¢å¤±è®¾å¤‡è¯·çœ‹<a href="https://www.cnblogs.com/validvoid/p/win2d-handling-device-lost.html">Win2D å®˜æ–¹æ–‡ç« ç³»åˆ—ç¿»è¯‘ - å¤„ç†è®¾å¤‡ä¸¢å¤± - voidÂ² - åšå®¢å›­</a></p>

<h2 id="è®¾ç½®-win2d-èƒŒæ™¯">è®¾ç½® win2d èƒŒæ™¯</h2>

<p>win2d ä¼šå¿½ç•¥åœ¨ xaml è®¾ç½®çš„èƒŒæ™¯ï¼Œå¦‚æœä½¿ç”¨ Background = xx çš„æ–¹æ³•è®¾ç½®èƒŒæ™¯ï¼Œä¼šåœ¨ win2d å¿½ç•¥</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">&lt;</span><span class="n">xaml</span><span class="p">:</span><span class="n">CanvasControl</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"Canvas"</span> <span class="n">Background</span><span class="p">=</span><span class="s">"Brown"</span> <span class="n">Draw</span><span class="p">=</span><span class="s">"Canvas_OnDraw"</span><span class="p">&gt;&lt;/</span><span class="n">xaml</span><span class="p">:</span><span class="n">CanvasControl</span><span class="p">&gt;</span>

</code></pre></div></div>

<p>ä¸Šé¢çš„ä»£ç ä¸ä¼šæŠŠ win2d çš„èƒŒæ™¯è®¾ç½®ï¼Œå› ä¸º win2d éœ€è¦è®¾ç½® <code class="language-plaintext highlighter-rouge">ClearColor</code> æ¥ç”»å‡ºèƒŒæ™¯</p>

<p>å¦‚æœæƒ³æŠŠ win2d çš„èƒŒæ™¯é¢œè‰²è®¾ç½®ä¸º ç™½è‰²ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">&lt;</span><span class="n">xaml</span><span class="p">:</span><span class="n">CanvasControl</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"Canvas"</span> <span class="n">ClearColor</span><span class="p">=</span><span class="s">"White"</span> <span class="n">Draw</span><span class="p">=</span><span class="s">"Canvas_OnDraw"</span><span class="p">&gt;&lt;/</span><span class="n">xaml</span><span class="p">:</span><span class="n">CanvasControl</span><span class="p">&gt;</span>

</code></pre></div></div>

<p>å¦‚æœåœ¨ä¸€æ¬¡åˆ·æ–°éœ€è¦è®¾ç½® win2d çš„é¢œè‰²ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ ä¸‹é¢ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">sender</span><span class="p">.</span><span class="n">ClearColor</span> <span class="p">=</span> <span class="n">Colors</span><span class="p">.</span><span class="n">White</span><span class="p">;</span>

</code></pre></div></div>

<p>å…³äº Alpha è¯·çœ‹ <a href="https://www.cnblogs.com/validvoid/p/win2d-premultiplied-alpha.html">Win2D å®˜æ–¹æ–‡ç« ç³»åˆ—ç¿»è¯‘ - é¢„ä¹˜ Alpha - voidÂ² - åšå®¢å›­</a></p>

<h2 id="ç‰¹æ•ˆ">ç‰¹æ•ˆ</h2>

<p>ç°åœ¨çš„ç‰¹æ•ˆï¼Œè¶Šæ¥è¶Šä¾¿å®œï¼Œä»åŸå…ˆçš„å¾ˆè´µçš„ç‰¹æ•ˆï¼Œåˆ°ç°åœ¨çš„ä¸åˆ°ä¸€å—é’±ã€‚ä¸€ä¸ªå¥½çš„åº”ç”¨å°±éœ€è¦å¤šåŠ ä¸€äº›ç‰¹æ•ˆã€‚çœ‹åˆ°äº†è¿™é‡Œï¼Œæˆ‘å‡†å¤‡å‘Šè¯‰å¤§å®¶å¦‚ä½•åœ¨ Win2d ä½¿ç”¨ç‰¹æ•ˆã€‚</p>

<p>æ‰€æœ‰çš„å®ç° IGraphicsEffectSource éƒ½å¯ä»¥æ·»åŠ ç‰¹æ•ˆï¼Œè€Œç‰¹æ•ˆæœ¬èº«å°±å®ç° IGraphicsEffectSource ï¼Œå¦‚æœéœ€è¦å¤æ‚çš„å›¾ç‰‡å¯ä»¥å †ç‰¹æ•ˆæ¥åšã€‚</p>

<p>æœ¬æ–‡åªå‘Šè¯‰å¤§å®¶å¦‚ä½•ä½¿ç”¨ç‰¹æ•ˆï¼Œå› ä¸ºå‡ ä¹æ‰€æœ‰çš„ç‰¹æ•ˆä½¿ç”¨æ–¹æ³•éƒ½å·®ä¸å¤šï¼Œå°±æ˜¯è¾“å…¥ä½å›¾ï¼Œä¿®æ”¹å‚æ•°ï¼Œè¾“å‡ºä¿®æ”¹åçš„ä½å›¾ã€‚å¦‚æœéœ€è¦ä½¿ç”¨å¤šä¸ªç‰¹æ•ˆåˆåœ¨ä¸€èµ·ï¼Œå°±æŠŠå‰é¢ç‰¹æ•ˆè¾“å‡ºçš„ä½å›¾è¾“å…¥åˆ°ç¬¬äºŒä¸ªç‰¹æ•ˆã€‚é€šè¿‡è¿æ¥å¤šä¸ªç‰¹æ•ˆå°±å¯ä»¥åšå‡ºå¥½çœ‹çš„å›¾ç‰‡ã€‚</p>

<p>å…·ä½“ Win2d æœ‰å“ªäº›ç‰¹æ•ˆè€Œä¸”è¿™äº›ç‰¹æ•ˆéœ€è¦å¦‚ä½•ä½¿ç”¨ï¼Œå°±è¯·çœ‹é±¼å“¥çš„çŸ¥ä¹ä¸“æ ï¼Œåœ¨ä¸‹é¢çš„å‚è§æˆ‘æ·»åŠ äº†ä»–çš„åšå®¢ã€‚</p>

<p>å®é™…çš„ç‰¹æ•ˆä¸æ˜¯åªèƒ½åœ¨å›¾ç‰‡ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨æ‰€æœ‰ IGraphicsEffectSource ä¸Šä½¿ç”¨ã€‚</p>

<p>åœ¨å¼€å§‹å‡†å¤‡ä¹‹å‰ï¼Œéœ€è¦å‡†å¤‡ä¸€äº›å›¾ç‰‡å’Œæ–‡å­—ä½œä¸ºèµ„æºç”¨æ¥åé¢åˆ›å»ºèµ„æºã€‚åœ¨å‰å°æ·»åŠ  CreateResources äº‹ä»¶ï¼Œè¯·çœ‹ä»£ç </p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">&lt;</span><span class="n">xaml</span><span class="p">:</span><span class="n">CanvasControl</span> <span class="n">x</span><span class="p">:</span><span class="n">Name</span><span class="p">=</span><span class="s">"Canvas"</span> <span class="n">ClearColor</span><span class="p">=</span><span class="s">"Black"</span> 
                            <span class="n">CreateResources</span><span class="p">=</span><span class="s">"Canvas_OnCreateResources"</span>
                            <span class="n">Draw</span><span class="p">=</span><span class="s">"Canvas_OnDraw"</span><span class="p">&gt;&lt;/</span><span class="n">xaml</span><span class="p">:</span><span class="n">CanvasControl</span><span class="p">&gt;</span> 
</code></pre></div></div>

<p>åœ¨åå°çš„äº‹ä»¶è¯»å–å›¾ç‰‡èµ„æº</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnDraw</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">CanvasDrawEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnCreateResources</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">CanvasCreateResourcesEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
           <span class="c1">// åœ¨è¿™é‡Œæ·»åŠ èµ„æº</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘éšæ„æ‰¾åˆ°ä¸¤å¼ å¥½çœ‹çš„å›¾ç‰‡ï¼ŒæŠŠä»–æ”¾åœ¨ Assets æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä»£ç å°†ä¼šå»è¯»å–è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚éœ€è¦æ³¨æ„ä¸¤ä¸ªæ–‡ä»¶éƒ½éœ€è¦å³å‡»å±æ€§ï¼Œé€‰æ‹©ç”Ÿæˆæ˜¯å†…å®¹ï¼Œä¸ç„¶ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ‰¾ä¸åˆ°ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnCreateResources</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">CanvasCreateResourcesEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">args</span><span class="p">.</span><span class="nf">TrackAsyncAction</span><span class="p">(</span><span class="nf">CreateResourcesAsync</span><span class="p">(</span><span class="n">sender</span><span class="p">).</span><span class="nf">AsAsyncAction</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">CreateResourcesAsync</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">canvasControl</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_bitmap1</span> <span class="p">=</span> <span class="k">await</span> <span class="n">CanvasBitmap</span><span class="p">.</span><span class="nf">LoadAsync</span><span class="p">(</span><span class="n">canvasControl</span><span class="p">,</span> <span class="s">"Assets/1.png"</span><span class="p">);</span>
            <span class="n">_bitmap2</span> <span class="p">=</span> <span class="k">await</span> <span class="n">CanvasBitmap</span><span class="p">.</span><span class="nf">LoadAsync</span><span class="p">(</span><span class="n">canvasControl</span><span class="p">,</span> <span class="s">"Assets/2.jpg"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">CanvasBitmap</span> <span class="n">_bitmap1</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">CanvasBitmap</span> <span class="n">_bitmap2</span><span class="p">;</span>
</code></pre></div></div>

<p>å› ä¸ºç°åœ¨ä¸çŸ¥é“æ˜¯å¦è¯»å–äº†å›¾ç‰‡ï¼Œæ‰€ä»¥å…ˆæŠŠå›¾ç‰‡ç”»å‡ºæ¥è¯•è¯•</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnDraw</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">CanvasDrawEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">canvasDrawingSession</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">DrawingSession</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">canvasDrawingSession</span><span class="p">.</span><span class="nf">DrawImage</span><span class="p">(</span><span class="n">_bitmap1</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>å¦‚æœè¿è¡Œä¸€ä¸‹å¯ä»¥çœ‹åˆ°å›¾ç‰‡ï¼Œé‚£ä¹ˆå°±æ˜¯åˆ›å»ºèµ„æºæˆåŠŸã€‚</p>

<p>ç°åœ¨ä»¥ AlphaMaskEffect ä½œä¸ºä¾‹å­å‘Šè¯‰å¤§å®¶å¦‚ä½•åœ¨ä½å›¾æ·»åŠ ç‰¹æ•ˆ</p>

<p>é¦–å…ˆåˆ›å»º AlphaMaskEffect ï¼Œç„¶åä¼ å…¥å›¾ç‰‡ï¼Œæœ€åç”»å‡ºç‰¹æ•ˆã€‚</p>

<p>å› ä¸º AlphaMaskEffect éœ€è¦æŒ‡å®šä¸€ä¸ªåŒºåŸŸçš„ Alpha å€¼ï¼Œè®©å¯¹åº”å›¾ç‰‡çš„å¯¹åº”åŒºåŸŸæ˜¾ç¤ºï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ° CanvasCommandList ç”¨æ¥ç”»å‡ºçŸ©å½¢åŒºåŸŸ</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnDraw</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">CanvasDrawEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">alphaMask</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CanvasCommandList</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">canvasDrawingSession</span> <span class="p">=</span> <span class="n">alphaMask</span><span class="p">.</span><span class="nf">CreateDrawingSession</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">canvasDrawingSession</span><span class="p">.</span><span class="nf">FillRectangle</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">200</span><span class="p">),</span> <span class="n">Color</span><span class="p">.</span><span class="nf">FromArgb</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">alphaMaskEffect</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AlphaMaskEffect</span>
            <span class="p">{</span>
                <span class="n">Source</span> <span class="p">=</span> <span class="n">_bitmap1</span><span class="p">,</span>
                <span class="n">AlphaMask</span> <span class="p">=</span> <span class="n">alphaMask</span>
            <span class="p">};</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">canvasDrawingSession</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">DrawingSession</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">canvasDrawingSession</span><span class="p">.</span><span class="nf">DrawImage</span><span class="p">(</span><span class="n">alphaMaskEffect</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ç°åœ¨è¿è¡Œç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°åœ¨(10,10)ï¼Œå¤§å°æ˜¯(100,100)çš„çŸ©å½¢åŒºåŸŸæ˜¾ç¤ºå›¾ç‰‡ã€‚åœ¨ Color.FromArgb æˆ‘å†™çš„æ˜¯ Alpha ä¸æ˜¯ 0xFF æ‰€ä»¥å°±æ²¡æœ‰å®Œå…¨æ˜¾ç¤ºå›¾ç‰‡</p>

<!-- ![](image/win10_uwp_win2d/win10_uwp_win2d0.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F201862165039707" alt="" /></p>

<p>è¿™æ—¶æˆ‘å¯ä»¥å åŠ ä¸€å¼ å…¶ä»–çš„å›¾ç‰‡ï¼Œè€Œä¸”åœ¨ç¬¬ä¸€å¼ å›¾ç‰‡é‡Œé¢æŒ–å‡ºæ–‡å­—ï¼Œå¦‚ä¸‹å›¾ï¼Œå°±æ˜¯æˆ‘ä½¿ç”¨ä¸‹é¢ä»£ç å†™å‡ºæ¥çš„ã€‚æˆ‘ç”¨æ–‡å­—ä»ä¸€å¼ å›¾ç‰‡æŒ–å»ä¸€å—åŒºåŸŸï¼Œè®©ä»–æ˜¾ç¤ºï¼Œç„¶åå åŠ åˆ°ç¬¬äºŒç« å›¾ç‰‡ã€‚</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="k">void</span> <span class="nf">Canvas_OnDraw</span><span class="p">(</span><span class="n">CanvasControl</span> <span class="n">sender</span><span class="p">,</span> <span class="n">CanvasDrawEventArgs</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">alphaMask</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CanvasCommandList</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">center</span> <span class="p">=</span> <span class="n">sender</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="nf">ToVector2</span><span class="p">()</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>
            <span class="n">center</span><span class="p">.</span><span class="n">X</span> <span class="p">-=</span> <span class="m">100</span><span class="p">;</span>
            <span class="n">center</span><span class="p">.</span><span class="n">Y</span> <span class="p">-=</span> <span class="m">100</span><span class="p">;</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">canvasDrawingSession</span> <span class="p">=</span> <span class="n">alphaMask</span><span class="p">.</span><span class="nf">CreateDrawingSession</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">canvasTextFormat</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CanvasTextFormat</span> <span class="p">{</span><span class="n">FontSize</span> <span class="p">=</span> <span class="m">100</span><span class="p">};</span>

                <span class="k">using</span> <span class="p">(</span><span class="n">canvasTextFormat</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">canvasDrawingSession</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s">"æ—å¾·ç†™"</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="nf">FromArgb</span><span class="p">(</span><span class="m">0xA1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="n">canvasTextFormat</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">alphaMaskEffect</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AlphaMaskEffect</span>
            <span class="p">{</span>
                <span class="n">Source</span> <span class="p">=</span> <span class="n">_bitmap1</span><span class="p">,</span>
                <span class="n">AlphaMask</span> <span class="p">=</span> <span class="n">alphaMask</span>
            <span class="p">};</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">canvasDrawingSession</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">DrawingSession</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">canvasDrawingSession</span><span class="p">.</span><span class="nf">DrawImage</span><span class="p">(</span><span class="n">_bitmap2</span><span class="p">);</span>
                <span class="n">canvasDrawingSession</span><span class="p">.</span><span class="nf">DrawImage</span><span class="p">(</span><span class="n">alphaMaskEffect</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

</code></pre></div></div>

<!-- ![](image/win10_uwp_win2d/win10_uwp_win2d1.png) -->

<p><img src="http://image.acmx.xyz/lindexi%2F201862165817512" alt="" /></p>

<p>å¦‚æœæƒ³çŸ¥é“ Win2d çš„ç‰¹æ•ˆæœ‰å“ªäº›è¯·çœ‹ <a href="https://lindexi.gitee.io/lindexi/post/win10-uwp-win2d-%E7%89%B9%E6%95%88.html">win10 uwp win2d ç‰¹æ•ˆ</a></p>

<p>å‚è§ï¼š<a href="https://zhuanlan.zhihu.com/p/37128817">ç¬¬äºŒç«  ç”»å¸ƒæ¸²æŸ“ç›®æ ‡CanvasRenderTarget</a></p>

<p><a href="https://zhuanlan.zhihu.com/p/37131345">ç¬¬ä¸‰ç« (ä»‹ç»ç¯‡) å›¾åƒç‰¹æ•ˆEffect</a></p>

<p><a href="https://zhuanlan.zhihu.com/p/37178216">ç¬¬ä¸‰ç« (è°ƒæ•´ç¯‡) å›¾åƒç‰¹æ•ˆEffect</a></p>

<h2 id="å…¶ä»–åšå®¢">å…¶ä»–åšå®¢</h2>

<p><a href="https://zhuanlan.zhihu.com/p/37101680">é±¼å“¥çš„ win2d çŸ¥ä¹ä¸“æ </a></p>

<p><a href="https://validvoid.net/">void</a></p>

<p>win2d æ¯›ç»ç’ƒï¼š<a href="https://lindexi.gitee.io/post/win10-uwp-%E6%AF%9B%E7%8E%BB%E7%92%83.html">win10 uwp æ¯›ç»ç’ƒ</a></p>

<p><a href="https://lindexi.gitee.io/post/win2d-%E7%94%BB%E5%87%BA%E5%A5%BD%E7%9C%8B%E7%9A%84%E5%9B%BE%E5%BD%A2.html">win2d ç”»å‡ºå¥½çœ‹çš„å›¾å½¢</a></p>

<p><a href="https://lindexi.gitee.io/post/win10-uwp-%E8%90%A4%E7%81%AB%E8%99%AB%E6%95%88%E6%9E%9C.html">win10 uwp è¤ç«è™«æ•ˆæœ</a></p>

<p><a href="https://lindexi.gitee.io/post/win2d-%E5%9B%BE%E7%89%87%E6%B0%B4%E5%8D%B0.html">win2d å›¾ç‰‡æ°´å°</a></p>

<p><img src="http://image.acmx.xyz/34fdad35-5dfe-a75b-2b4b-8c5e313038e2%2F2017888552.jpg" alt="" /></p>

:ET