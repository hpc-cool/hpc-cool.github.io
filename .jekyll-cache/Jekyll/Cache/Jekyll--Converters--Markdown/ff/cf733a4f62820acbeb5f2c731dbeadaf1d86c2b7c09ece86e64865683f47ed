I"¯<p>åœ¨åŠ ä¸Š IL Link çš„é¡¹ç›®é‡Œé¢ï¼Œåœ¨å‡çº§åˆ° .NET 6 é¢„è§ˆç‰ˆï¼Œæœ‰ä¸€äº›é¡¹ç›®å°†ä¼šæ„å»ºä¸é€šè¿‡ï¼Œæˆ–è€…æœ‰äº› C++ CLI é¡¹ç›®åŠ è½½å¤±è´¥ã€‚æç¤º å…ƒç´  UsingTask ä¸­â€œAssemblyFileâ€ç‰¹æ€§çš„å€¼â€œ$(ILLinkTasksAssembly)â€çš„è®¡ç®—ç»“æœâ€œâ€æ— æ•ˆã€‚åŸå› å°±æ˜¯ .NET 6 é¢„è§ˆç‰ˆé‡Œé¢ï¼Œæˆ–è€…è‡ªå·±çš„è®¾å¤‡ä¸Š ILLinkTasksAssembly å±æ€§å®šä¹‰å¤±æ•ˆ</p>

<!--more-->

<!-- CreateTime:2021/4/6 8:34:27 -->

<!-- å‘å¸ƒ -->

<p>è§£å†³æ–¹æ³•æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªç©ºç™½é¡¹ç›®ï¼Œæ‰¾æ‰¾è‡ªå·±æœ¬åœ°çš„ ILLinkTasksAssembly å®šä¹‰æ˜¯å¦å­˜åœ¨ï¼Œé»˜è®¤åœ¨ SDK é‡Œé¢æ˜¯å­˜åœ¨ Microsoft.NET.ILLink.Tasks çš„ã€‚å¦‚æœå‘ç°è‡ªå·±çš„è®¾å¤‡ä¸Šä¸å­˜åœ¨ Microsoft.NET.ILLink.Tasks è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆè¯·å°† dotnet sdk å¸è½½é‡æ–°å®‰è£…ï¼Œæˆ–è€…å®‰è£…æ›´æ–°ç‰ˆæœ¬çš„ sdk ç„¶åæŸ¥çœ‹è‡ªå·±çš„ç¯å¢ƒå˜é‡ï¼Œæ˜¯å¦æœ‰è®¾ç½®ç‰¹å®šç‰ˆæœ¬çš„ dotnet sdk å¦‚æœæœ‰è®¾ç½®ï¼Œå°±åˆ é™¤æ­¤é¡¹å€¼æˆ–è€…ä¿®æ”¹ä¸ºæ›´æ–°ç‰ˆæœ¬</p>

<p>åˆ›å»ºç©ºç™½é¡¹ç›®ï¼Œæ‰¾æ‰¾è‡ªå·±æœ¬åœ°çš„ ILLinkTasksAssembly å®šä¹‰çš„åšæ³•æ˜¯åœ¨ç©ºé¡¹ç›®çš„ csproj é‡Œé¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œç”¨æ¥è¾“å‡º IL Link çš„è·¯å¾„</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"Foo"</span> <span class="na">BeforeTargets=</span><span class="s">"BeforeBuild"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Warning</span> <span class="na">Text=</span><span class="s">"$(ILLinkTasksAssembly)"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Target&gt;</span>
</code></pre></div></div>

<p>æ­¤æ—¶çš„ç©ºç™½é¡¹ç›®çš„ csproj å†…å®¹å¤§æ¦‚å¦‚ä¸‹</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;OutputType&gt;</span>Exe<span class="nt">&lt;/OutputType&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>net5.0<span class="nt">&lt;/TargetFramework&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"Foo"</span> <span class="na">BeforeTargets=</span><span class="s">"BeforeBuild"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Warning</span> <span class="na">Text=</span><span class="s">"$(ILLinkTasksAssembly)"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Target&gt;</span>
<span class="nt">&lt;/Project&gt;</span>
</code></pre></div></div>

<p>æ­¤æ—¶æ„å»ºè¿™ä¸ªç©ºç™½é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºçš„è­¦å‘Šï¼Œè­¦å‘Šé‡Œé¢å°±æ˜¯ IL Link çš„è·¯å¾„ã€‚å¦‚ <code class="language-plaintext highlighter-rouge">C:\Program Files\dotnet\sdk\6.0.100-preview.2.21155.3\Sdks\Microsoft.NET.ILLink.Tasks\Sdk\..\tools\net472\ILLink.Tasks.dll</code> çš„è·¯å¾„</p>

<p>åœ¨è‡ªå·±æ„å»ºå¤±è´¥çš„é¡¹ç›®ï¼Œæˆ–è€…åŠ è½½å¤±è´¥çš„ C++\CLI é¡¹ç›®çš„é¡¹ç›®æ–‡ä»¶é‡Œé¢ï¼Œåœ¨ PropertyGroup é‡Œé¢æ·»åŠ å¦‚ä¸‹ä»£ç </p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ILLinkTasksAssembly&gt;</span>C:\Program Files\dotnet\sdk\6.0.100-preview.2.21155.3\Sdks\Microsoft.NET.ILLink.Tasks\Sdk\..\tools\net472\ILLink.Tasks.dll<span class="nt">&lt;/ILLinkTasksAssembly&gt;</span>
</code></pre></div></div>

<p>åœ¨ PropertyGroup æ·»åŠ å¦‚ä¸Šä»£ç çš„æ•ˆæœå¦‚ä¸‹</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;ILLinkTasksAssembly&gt;</span>C:\Program Files\dotnet\sdk\6.0.100-preview.2.21155.3\Sdks\Microsoft.NET.ILLink.Tasks\Sdk\..\tools\net472\ILLink.Tasks.dll<span class="nt">&lt;/ILLinkTasksAssembly&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>
</code></pre></div></div>

<p>è¯·å°†ä¸Šé¢çš„è·¯å¾„æ›¿æ¢ä¸ºä½ è‡ªå·±æœ¬åœ°çš„è·¯å¾„ï¼Œå¤§æ¦‚æ­¤æ—¶å°±èƒ½ä¿®æ”¹æ„å»ºæˆ–é¡¹ç›®åŠ è½½ã€‚æœ¬æ–‡çš„æ–¹æ³•èƒ½ä¿®å¤çš„æ˜¯åœ¨æ„å»ºå’ŒåŠ è½½é¡¹ç›®æç¤ºå¦‚ä¸‹å†…å®¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> error  : å…ƒç´  &lt;UsingTask&gt; ä¸­â€œAssemblyFileâ€ç‰¹æ€§çš„å€¼â€œ$(ILLinkTasksAssembly)â€çš„è®¡ç®—ç»“æœâ€œâ€æ— æ•ˆã€‚  C:\Program Files\dotnet\sdk\6.0.100-preview.2.21155.3\Sdks\Microsoft.NET.Sdk\targets\Microsoft.NET.ILLink.targets
</code></pre></div></div>

<p>åœ¨ Microsoft.NET.ILLink.targets æ–‡ä»¶å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å®šä¹‰</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;UsingTask</span> <span class="na">TaskName=</span><span class="s">"ILLink"</span> <span class="na">AssemblyFile=</span><span class="s">"$(ILLinkTasksAssembly)"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>ä¸Šé¢æç¤ºå†…å®¹å°±æ˜¯ <code class="language-plaintext highlighter-rouge">$(ILLinkTasksAssembly)</code> æ²¡æœ‰å®šä¹‰ï¼Œæ‹¿åˆ°ç©ºå€¼ã€‚å› æ­¤è‡ªå·±åœ¨é¡¹ç›®é‡Œé¢åŠ ä¸Šå®šä¹‰æ˜¯å¯ä»¥è§£å†³æ­¤é—®é¢˜</p>

<p>æœ¬æ–‡çš„ç©ºé¡¹ç›®ä»£ç æ”¾åœ¨ <a href="https://github.com/lindexi/lindexi_gd/tree/ffe013bf/JoruneecijerDaryiqikuhakuye">github</a> æ¬¢è¿å°ä¼™ä¼´è®¿é—®</p>

:ET